var tv=Object.defineProperty,ZE=Object.defineProperties;var JE=Object.getOwnPropertyDescriptors;var Mu=Object.getOwnPropertySymbols;var nv=Object.prototype.hasOwnProperty,rv=Object.prototype.propertyIsEnumerable;var ev=(t,n,e)=>n in t?tv(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,re=(t,n)=>{for(var e in n||={})nv.call(n,e)&&ev(t,e,n[e]);if(Mu)for(var e of Mu(n))rv.call(n,e)&&ev(t,e,n[e]);return t},lt=(t,n)=>ZE(t,JE(n));var Hd=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(n,e)=>(typeof require<"u"?require:n)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var ov=(t,n)=>{var e={};for(var r in t)nv.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&Mu)for(var r of Mu(t))n.indexOf(r)<0&&rv.call(t,r)&&(e[r]=t[r]);return e};var zd=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),eI=(t,n)=>{for(var e in n)tv(t,e,{get:n[e],enumerable:!0})};var xr=(t,n,e)=>new Promise((r,o)=>{var i=u=>{try{s(e.next(u))}catch(c){o(c)}},a=u=>{try{s(e.throw(u))}catch(c){o(c)}},s=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);s((e=e.apply(t,n)).next())});var aw=zd(()=>{"use strict"});var uw=zd((ea,sw)=>{"use strict";sw.exports=ea=window.fetch;ea.default=window.fetch.bind(window);ea.Headers=window.Headers;ea.Request=window.Request;ea.Response=window.Response});var cw=zd(()=>{"use strict"});var iv=null;var $d=1,av=Symbol("SIGNAL");function Oe(t){let n=iv;return iv=t,n}var sv={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function tI(t){if(!(Kd(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===$d)){if(!t.producerMustRecompute(t)&&!Gd(t)){t.dirty=!1,t.lastCleanEpoch=$d;return}t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=$d}}function uv(t){return t&&(t.nextProducerIndex=0),Oe(t)}function cv(t,n){if(Oe(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(Kd(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)qd(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Gd(t){Ru(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(tI(e),r!==e.version))return!0}return!1}function lv(t){if(Ru(t),Kd(t))for(let n=0;n<t.producerNode.length;n++)qd(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function qd(t,n){if(nI(t),Ru(t),t.liveConsumerNode.length===1)for(let r=0;r<t.producerNode.length;r++)qd(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];Ru(o),o.producerIndexOfThis[r]=n}}function Kd(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Ru(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function nI(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function rI(){throw new Error}var oI=rI;function dv(t){oI=t}function fe(t){return typeof t=="function"}function gi(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Au=gi(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function Ua(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var gt=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(fe(r))try{r()}catch(i){n=i instanceof Au?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{fv(i)}catch(a){n=n??[],a instanceof Au?n=[...n,...a.errors]:n.push(a)}}if(n)throw new Au(n)}}add(n){var e;if(n&&n!==this)if(this.closed)fv(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&Ua(e,n)}remove(n){let{_finalizers:e}=this;e&&Ua(e,n),n instanceof t&&n._removeParent(this)}};gt.EMPTY=(()=>{let t=new gt;return t.closed=!0,t})();var Xd=gt.EMPTY;function Nu(t){return t instanceof gt||t&&"closed"in t&&fe(t.remove)&&fe(t.add)&&fe(t.unsubscribe)}function fv(t){fe(t)?t():t.unsubscribe()}var Nn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var vi={setTimeout(t,n,...e){let{delegate:r}=vi;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=vi;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function ku(t){vi.setTimeout(()=>{let{onUnhandledError:n}=Nn;if(n)n(t);else throw t})}function Wa(){}var hv=Yd("C",void 0,void 0);function pv(t){return Yd("E",void 0,t)}function mv(t){return Yd("N",t,void 0)}function Yd(t,n,e){return{kind:t,value:n,error:e}}var yo=null;function yi(t){if(Nn.useDeprecatedSynchronousErrorHandling){let n=!yo;if(n&&(yo={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=yo;if(yo=null,e)throw r}}else t()}function gv(t){Nn.useDeprecatedSynchronousErrorHandling&&yo&&(yo.errorThrown=!0,yo.error=t)}var bo=class extends gt{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Nu(n)&&n.add(this)):this.destination=sI}static create(n,e,r){return new bi(n,e,r)}next(n){this.isStopped?Zd(mv(n),this):this._next(n)}error(n){this.isStopped?Zd(pv(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Zd(hv,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},iI=Function.prototype.bind;function Qd(t,n){return iI.call(t,n)}var Jd=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Fu(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Fu(r)}else Fu(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Fu(e)}}},bi=class extends bo{constructor(n,e,r){super();let o;if(fe(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Nn.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&Qd(n.next,i),error:n.error&&Qd(n.error,i),complete:n.complete&&Qd(n.complete,i)}):o=n}this.destination=new Jd(o)}};function Fu(t){Nn.useDeprecatedSynchronousErrorHandling?gv(t):ku(t)}function aI(t){throw t}function Zd(t,n){let{onStoppedNotification:e}=Nn;e&&vi.setTimeout(()=>e(t,n))}var sI={closed:!0,next:Wa,error:aI,complete:Wa};var xi=typeof Symbol=="function"&&Symbol.observable||"@@observable";function rn(t){return t}function ef(...t){return tf(t)}function tf(t){return t.length===0?rn:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var Ve=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=cI(e)?e:new bi(e,r,o);return yi(()=>{let{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=vv(r),new r((o,i)=>{let a=new bi({next:s=>{try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[xi](){return this}pipe(...e){return tf(e)(this)}toPromise(e){return e=vv(e),new e((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return t.create=n=>new t(n),t})();function vv(t){var n;return(n=t??Nn.Promise)!==null&&n!==void 0?n:Promise}function uI(t){return t&&fe(t.next)&&fe(t.error)&&fe(t.complete)}function cI(t){return t&&t instanceof bo||uI(t)&&Nu(t)}function nf(t){return fe(t?.lift)}function Re(t){return n=>{if(nf(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ae(t,n,e,r,o){return new rf(t,n,e,r,o)}var rf=class extends bo{constructor(n,e,r,o,i,a){super(n),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=e?function(s){try{e(s)}catch(u){n.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){n.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){n.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function wi(){return Re((t,n)=>{let e=null;t._refCount++;let r=Ae(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var Ci=class extends Ve{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,nf(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new gt;let e=this.getSubject();n.add(this.source.subscribe(Ae(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=gt.EMPTY)}return n}refCount(){return wi()(this)}};var yv=gi(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ht=(()=>{class t extends Ve{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new Pu(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new yv}next(e){yi(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){yi(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){yi(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?Xd:(this.currentObservers=null,i.push(e),new gt(()=>{this.currentObservers=null,Ua(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new Ve;return e.source=this,e}}return t.create=(n,e)=>new Pu(n,e),t})(),Pu=class extends Ht{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:Xd}};var At=class extends Ht{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var on=new Ve(t=>t.complete());function bv(t){return t&&fe(t.schedule)}function xv(t){return t[t.length-1]}function wv(t){return fe(xv(t))?t.pop():void 0}function Gr(t){return bv(xv(t))?t.pop():void 0}function Dv(t,n,e,r){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}function Cv(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function xo(t){return this instanceof xo?(this.v=t,this):new xo(t)}function Ev(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",a),o[Symbol.asyncIterator]=function(){return this},o;function a(h){return function(p){return Promise.resolve(p).then(h,d)}}function s(h,p){r[h]&&(o[h]=function(m){return new Promise(function(g,v){i.push([h,m,g,v])>1||u(h,m)})},p&&(o[h]=p(o[h])))}function u(h,p){try{c(r[h](p))}catch(m){f(i[0][3],m)}}function c(h){h.value instanceof xo?Promise.resolve(h.value.v).then(l,d):f(i[0][2],h)}function l(h){u("next",h)}function d(h){u("throw",h)}function f(h,p){h(p),i.shift(),i.length&&u(i[0][0],i[0][1])}}function Iv(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof Cv=="function"?Cv(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(a){return new Promise(function(s,u){a=t[i](a),o(s,u,a.done,a.value)})}}function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}}var Ou=t=>t&&typeof t.length=="number"&&typeof t!="function";function Lu(t){return fe(t?.then)}function Bu(t){return fe(t[xi])}function ju(t){return Symbol.asyncIterator&&fe(t?.[Symbol.asyncIterator])}function Vu(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function lI(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Uu=lI();function Wu(t){return fe(t?.[Uu])}function Hu(t){return Ev(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield xo(e.read());if(o)return yield xo(void 0);yield yield xo(r)}}finally{e.releaseLock()}})}function zu(t){return fe(t?.getReader)}function Ct(t){if(t instanceof Ve)return t;if(t!=null){if(Bu(t))return dI(t);if(Ou(t))return fI(t);if(Lu(t))return hI(t);if(ju(t))return _v(t);if(Wu(t))return pI(t);if(zu(t))return mI(t)}throw Vu(t)}function dI(t){return new Ve(n=>{let e=t[xi]();if(fe(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function fI(t){return new Ve(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function hI(t){return new Ve(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,ku)})}function pI(t){return new Ve(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function _v(t){return new Ve(n=>{gI(t,n).catch(e=>n.error(e))})}function mI(t){return _v(Hu(t))}function gI(t,n){var e,r,o,i;return Dv(this,void 0,void 0,function*(){try{for(e=Iv(t);r=yield e.next(),!r.done;){let a=r.value;if(n.next(a),n.closed)return}}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function Xt(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function $u(t,n=0){return Re((e,r)=>{e.subscribe(Ae(r,o=>Xt(r,t,()=>r.next(o),n),()=>Xt(r,t,()=>r.complete(),n),o=>Xt(r,t,()=>r.error(o),n)))})}function Gu(t,n=0){return Re((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function Sv(t,n){return Ct(t).pipe(Gu(n),$u(n))}function Tv(t,n){return Ct(t).pipe(Gu(n),$u(n))}function Mv(t,n){return new Ve(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function Rv(t,n){return new Ve(e=>{let r;return Xt(e,n,()=>{r=t[Uu](),Xt(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){e.error(a);return}i?e.complete():e.next(o)},0,!0)}),()=>fe(r?.return)&&r.return()})}function qu(t,n){if(!t)throw new Error("Iterable cannot be null");return new Ve(e=>{Xt(e,n,()=>{let r=t[Symbol.asyncIterator]();Xt(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function Av(t,n){return qu(Hu(t),n)}function Nv(t,n){if(t!=null){if(Bu(t))return Sv(t,n);if(Ou(t))return Mv(t,n);if(Lu(t))return Tv(t,n);if(ju(t))return qu(t,n);if(Wu(t))return Rv(t,n);if(zu(t))return Av(t,n)}throw Vu(t)}function dt(t,n){return n?Nv(t,n):Ct(t)}function le(...t){let n=Gr(t);return dt(t,n)}function Di(t,n){let e=fe(t)?t:()=>t,r=o=>o.error(e());return new Ve(n?o=>n.schedule(r,0,o):r)}function of(t){return!!t&&(t instanceof Ve||fe(t.lift)&&fe(t.subscribe))}var wr=gi(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Se(t,n){return Re((e,r)=>{let o=0;e.subscribe(Ae(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:vI}=Array;function yI(t,n){return vI(n)?t(...n):t(n)}function kv(t){return Se(n=>yI(t,n))}var{isArray:bI}=Array,{getPrototypeOf:xI,prototype:wI,keys:CI}=Object;function Fv(t){if(t.length===1){let n=t[0];if(bI(n))return{args:n,keys:null};if(DI(n)){let e=CI(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function DI(t){return t&&typeof t=="object"&&xI(t)===wI}function Pv(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function Ku(...t){let n=Gr(t),e=wv(t),{args:r,keys:o}=Fv(t);if(r.length===0)return dt([],n);let i=new Ve(EI(r,n,o?a=>Pv(o,a):rn));return e?i.pipe(kv(e)):i}function EI(t,n,e=rn){return r=>{Ov(n,()=>{let{length:o}=t,i=new Array(o),a=o,s=o;for(let u=0;u<o;u++)Ov(n,()=>{let c=dt(t[u],n),l=!1;c.subscribe(Ae(r,d=>{i[u]=d,l||(l=!0,s--),s||r.next(e(i.slice()))},()=>{--a||r.complete()}))},r)},r)}}function Ov(t,n,e){t?Xt(e,t,n):n()}function Lv(t,n,e,r,o,i,a,s){let u=[],c=0,l=0,d=!1,f=()=>{d&&!u.length&&!c&&n.complete()},h=m=>c<r?p(m):u.push(m),p=m=>{i&&n.next(m),c++;let g=!1;Ct(e(m,l++)).subscribe(Ae(n,v=>{o?.(v),i?h(v):n.next(v)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;u.length&&c<r;){let v=u.shift();a?Xt(n,a,()=>p(v)):p(v)}f()}catch(v){n.error(v)}}))};return t.subscribe(Ae(n,h,()=>{d=!0,f()})),()=>{s?.()}}function vt(t,n,e=1/0){return fe(n)?vt((r,o)=>Se((i,a)=>n(r,i,o,a))(Ct(t(r,o))),e):(typeof n=="number"&&(e=n),Re((r,o)=>Lv(r,o,t,e)))}function af(t=1/0){return vt(rn,t)}function Bv(){return af(1)}function Ei(...t){return Bv()(dt(t,Gr(t)))}function Xu(t){return new Ve(n=>{Ct(t()).subscribe(n)})}function gn(t,n){return Re((e,r)=>{let o=0;e.subscribe(Ae(r,i=>t.call(n,i,o++)&&r.next(i)))})}function qr(t){return Re((n,e)=>{let r=null,o=!1,i;r=n.subscribe(Ae(e,void 0,void 0,a=>{i=Ct(t(a,qr(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function jv(t,n,e,r,o){return(i,a)=>{let s=e,u=n,c=0;i.subscribe(Ae(a,l=>{let d=c++;u=s?t(u,l,d):(s=!0,l),r&&a.next(u)},o&&(()=>{s&&a.next(u),a.complete()})))}}function wo(t,n){return fe(n)?vt(t,n,1):vt(t,1)}function Kr(t){return Re((n,e)=>{let r=!1;n.subscribe(Ae(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function Cr(t){return t<=0?()=>on:Re((n,e)=>{let r=0;n.subscribe(Ae(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function sf(t){return Se(()=>t)}function Yu(t=II){return Re((n,e)=>{let r=!1;n.subscribe(Ae(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function II(){return new wr}function Ii(t){return Re((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function kn(t,n){let e=arguments.length>=2;return r=>r.pipe(t?gn((o,i)=>t(o,i,r)):rn,Cr(1),e?Kr(n):Yu(()=>new wr))}function _i(t){return t<=0?()=>on:Re((n,e)=>{let r=[];n.subscribe(Ae(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function uf(t,n){let e=arguments.length>=2;return r=>r.pipe(t?gn((o,i)=>t(o,i,r)):rn,_i(1),e?Kr(n):Yu(()=>new wr))}function cf(t,n){return Re(jv(t,n,arguments.length>=2,!0))}function lf(...t){let n=Gr(t);return Re((e,r)=>{(n?Ei(t,e,n):Ei(t,e)).subscribe(r)})}function vn(t,n){return Re((e,r)=>{let o=null,i=0,a=!1,s=()=>a&&!o&&r.complete();e.subscribe(Ae(r,u=>{o?.unsubscribe();let c=0,l=i++;Ct(t(u,l)).subscribe(o=Ae(r,d=>r.next(n?n(u,d,l,c++):d),()=>{o=null,s()}))},()=>{a=!0,s()}))})}function df(t){return Re((n,e)=>{Ct(t).subscribe(Ae(e,()=>e.complete(),Wa)),!e.closed&&n.subscribe(e)})}function yt(t,n,e){let r=fe(t)||n||e?{next:t,error:n,complete:e}:t;return r?Re((o,i)=>{var a;(a=r.subscribe)===null||a===void 0||a.call(r);let s=!0;o.subscribe(Ae(i,u=>{var c;(c=r.next)===null||c===void 0||c.call(r,u),i.next(u)},()=>{var u;s=!1,(u=r.complete)===null||u===void 0||u.call(r),i.complete()},u=>{var c;s=!1,(c=r.error)===null||c===void 0||c.call(r,u),i.error(u)},()=>{var u,c;s&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):rn}var xy="https://g.co/ng/security#xss",ce=class extends Error{constructor(n,e){super(Ec(n,e)),this.code=n}};function Ec(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}function Ic(t){return{toString:t}.toString()}var Ha=globalThis;function Ge(t){for(let n in t)if(t[n]===Ge)return n;throw Error("Could not find renamed property on target object.")}function Yt(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Yt).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function Vv(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var _I=Ge({__forward_ref__:Ge});function wy(t){return t.__forward_ref__=wy,t.toString=function(){return Yt(this())},t}function bn(t){return Cy(t)?t():t}function Cy(t){return typeof t=="function"&&t.hasOwnProperty(_I)&&t.__forward_ref__===wy}function he(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function _c(t){return{providers:t.providers||[],imports:t.imports||[]}}function Sc(t){return Uv(t,Ey)||Uv(t,Iy)}function Dy(t){return Sc(t)!==null}function Uv(t,n){return t.hasOwnProperty(n)?t[n]:null}function SI(t){let n=t&&(t[Ey]||t[Iy]);return n||null}function Wv(t){return t&&(t.hasOwnProperty(Hv)||t.hasOwnProperty(TI))?t[Hv]:null}var Ey=Ge({\u0275prov:Ge}),Hv=Ge({\u0275inj:Ge}),Iy=Ge({ngInjectableDef:Ge}),TI=Ge({ngInjectorDef:Ge}),xe=class{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=he({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function _y(t){return t&&!!t.\u0275providers}var MI=Ge({\u0275cmp:Ge}),RI=Ge({\u0275dir:Ge}),AI=Ge({\u0275pipe:Ge}),NI=Ge({\u0275mod:Ge}),ac=Ge({\u0275fac:Ge}),za=Ge({__NG_ELEMENT_ID__:Ge}),zv=Ge({__NG_ENV_ID__:Ge});function Sy(t){return typeof t=="string"?t:t==null?"":String(t)}function kI(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Sy(t)}function FI(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new ce(-200,t)}function lh(t,n){throw new ce(-201,!1)}var we=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(we||{}),Ef;function Ty(){return Ef}function yn(t){let n=Ef;return Ef=t,n}function My(t,n,e){let r=Sc(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&we.Optional)return null;if(n!==void 0)return n;lh(t,"Injector")}var PI={},$a=PI,OI="__NG_DI_FLAG__",sc="ngTempTokenPath",LI="ngTokenPath",BI=/\n/gm,jI="\u0275",$v="__source",Ri;function VI(){return Ri}function Xr(t){let n=Ri;return Ri=t,n}function UI(t,n=we.Default){if(Ri===void 0)throw new ce(-203,!1);return Ri===null?My(t,void 0,n):Ri.get(t,n&we.Optional?null:void 0,n)}function Ne(t,n=we.Default){return(Ty()||UI)(bn(t),n)}function X(t,n=we.Default){return Ne(t,Tc(n))}function Tc(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function If(t){let n=[];for(let e=0;e<t.length;e++){let r=bn(t[e]);if(Array.isArray(r)){if(r.length===0)throw new ce(900,!1);let o,i=we.Default;for(let a=0;a<r.length;a++){let s=r[a],u=WI(s);typeof u=="number"?u===-1?o=s.token:i|=u:o=s}n.push(Ne(o,i))}else n.push(Ne(r))}return n}function WI(t){return t[OI]}function HI(t,n,e,r){let o=t[sc];throw n[$v]&&o.unshift(n[$v]),t.message=zI(`
`+t.message,o,e,r),t[LI]=o,t[sc]=null,t}function zI(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==jI?t.slice(2):t;let o=Yt(n);if(Array.isArray(n))o=n.map(Yt).join(" -> ");else if(typeof n=="object"){let i=[];for(let a in n)if(n.hasOwnProperty(a)){let s=n[a];i.push(a+":"+(typeof s=="string"?JSON.stringify(s):Yt(s)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(BI,`
  `)}`}function Ni(t,n){let e=t.hasOwnProperty(ac);return e?t[ac]:null}function $I(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],i=n[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}function GI(t){return t.flat(Number.POSITIVE_INFINITY)}function dh(t,n){t.forEach(e=>Array.isArray(e)?dh(e,n):n(e))}function Ry(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function uc(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}var Ga={},Pn=[],Do=new xe(""),Ay=new xe("",-1),Ny=new xe(""),cc=class{get(n,e=$a){if(e===$a){let r=new Error(`NullInjectorError: No provider for ${Yt(n)}!`);throw r.name="NullInjectorError",r}return e}},ky=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(ky||{}),nr=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(nr||{}),Zr=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Zr||{});function qI(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}function _f(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],a=e[r++],s=e[r++];t.setAttribute(n,a,s,i)}else{let i=o,a=e[++r];XI(i)?t.setProperty(n,i,a):t.setAttribute(n,i,a),r++}}return r}function KI(t){return t===3||t===4||t===6}function XI(t){return t.charCodeAt(0)===64}function fh(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?Gv(t,e,o,null,n[++r]):Gv(t,e,o,null,null))}}return t}function Gv(t,n,e,r,o){let i=0,a=t.length;if(n===-1)a=-1;else for(;i<t.length;){let s=t[i++];if(typeof s=="number"){if(s===n){a=-1;break}else if(s>n){a=i-1;break}}}for(;i<t.length;){let s=t[i];if(typeof s=="number")break;if(s===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}a!==-1&&(t.splice(a,0,n),i=a+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var Fy="ng-template";function YI(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&qI(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(hh(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function hh(t){return t.type===4&&t.value!==Fy}function QI(t,n,e){let r=t.type===4&&!e?Fy:t.value;return n===r}function ZI(t,n,e){let r=4,o=t.attrs,i=o!==null?t_(o):0,a=!1;for(let s=0;s<n.length;s++){let u=n[s];if(typeof u=="number"){if(!a&&!Fn(r)&&!Fn(u))return!1;if(a&&Fn(u))continue;a=!1,r=u|r&1;continue}if(!a)if(r&4){if(r=2|r&1,u!==""&&!QI(t,u,e)||u===""&&n.length===1){if(Fn(r))return!1;a=!0}}else if(r&8){if(o===null||!YI(t,o,u,e)){if(Fn(r))return!1;a=!0}}else{let c=n[++s],l=JI(u,o,hh(t),e);if(l===-1){if(Fn(r))return!1;a=!0;continue}if(c!==""){let d;if(l>i?d="":d=o[l+1].toLowerCase(),r&2&&c!==d){if(Fn(r))return!1;a=!0}}}}return Fn(r)||a}function Fn(t){return(t&1)===0}function JI(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let a=n[o];if(a===t)return o;if(a===3||a===6)i=!0;else if(a===1||a===2){let s=n[++o];for(;typeof s=="string";)s=n[++o];continue}else{if(a===4)break;if(a===0){o+=4;continue}}o+=i?1:2}return-1}else return n_(n,t)}function e_(t,n,e=!1){for(let r=0;r<n.length;r++)if(ZI(t,n[r],e))return!0;return!1}function t_(t){for(let n=0;n<t.length;n++){let e=t[n];if(KI(e))return n}return t.length}function n_(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function qv(t,n){return t?":not("+n.trim()+")":n}function r_(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let a=t[e];if(typeof a=="string")if(r&2){let s=t[++e];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else r&8?o+="."+a:r&4&&(o+=" "+a);else o!==""&&!Fn(a)&&(n+=qv(i,o),o=""),r=a,i=i||!Fn(r);e++}return o!==""&&(n+=qv(i,o)),n}function o_(t){return t.map(r_).join(",")}function i_(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!Fn(o))break;o=i}r++}return{attrs:n,classes:e}}function Li(t){return Ic(()=>{let n=jy(t),e=lt(re({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===ky.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||nr.Emulated,styles:t.styles||Pn,_:null,schemas:t.schemas||null,tView:null,id:""});Vy(e);let r=t.dependencies;return e.directiveDefs=Xv(r,!1),e.pipeDefs=Xv(r,!0),e.id=u_(e),e})}function a_(t){return Eo(t)||Py(t)}function s_(t){return t!==null}function Mc(t){return Ic(()=>({type:t.type,bootstrap:t.bootstrap||Pn,declarations:t.declarations||Pn,imports:t.imports||Pn,exports:t.exports||Pn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Kv(t,n){if(t==null)return Ga;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,a,s=Zr.None;Array.isArray(o)?(s=o[0],i=o[1],a=o[2]??i):(i=o,a=o),n?(e[i]=s!==Zr.None?[r,s]:r,n[i]=a):e[i]=r}return e}function Rc(t){return Ic(()=>{let n=jy(t);return Vy(n),n})}function Eo(t){return t[MI]||null}function Py(t){return t[RI]||null}function Oy(t){return t[AI]||null}function Ly(t){let n=Eo(t)||Py(t)||Oy(t);return n!==null?n.standalone:!1}function By(t,n){let e=t[NI]||null;if(!e&&n===!0)throw new Error(`Type ${Yt(t)} does not have '\u0275mod' property.`);return e}function jy(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||Ga,exportAs:t.exportAs||null,standalone:t.standalone===!0,signals:t.signals===!0,selectors:t.selectors||Pn,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Kv(t.inputs,n),outputs:Kv(t.outputs),debugInfo:null}}function Vy(t){t.features?.forEach(n=>n(t))}function Xv(t,n){if(!t)return null;let e=n?Oy:a_;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(s_)}function u_(t){let n=0,e=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(let o of e)n=Math.imul(31,n)+o.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function Mo(t){return{\u0275providers:t}}function c_(...t){return{\u0275providers:Uy(!0,t),\u0275fromNgModule:!0}}function Uy(t,...n){let e=[],r=new Set,o,i=a=>{e.push(a)};return dh(n,a=>{let s=a;Sf(s,i,[],r)&&(o||=[],o.push(s))}),o!==void 0&&Wy(o,i),e}function Wy(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];ph(o,i=>{n(i,r)})}}function Sf(t,n,e,r){if(t=bn(t),!t)return!1;let o=null,i=Wv(t),a=!i&&Eo(t);if(!i&&!a){let u=t.ngModule;if(i=Wv(u),i)o=u;else return!1}else{if(a&&!a.standalone)return!1;o=t}let s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){let u=typeof a.dependencies=="function"?a.dependencies():a.dependencies;for(let c of u)Sf(c,n,e,r)}}else if(i){if(i.imports!=null&&!s){r.add(o);let c;try{dh(i.imports,l=>{Sf(l,n,e,r)&&(c||=[],c.push(l))})}finally{}c!==void 0&&Wy(c,n)}if(!s){let c=Ni(o)||(()=>new o);n({provide:o,useFactory:c,deps:Pn},o),n({provide:Ny,useValue:o,multi:!0},o),n({provide:Do,useValue:()=>Ne(o),multi:!0},o)}let u=i.providers;if(u!=null&&!s){let c=t;ph(u,l=>{n(l,c)})}}else return!1;return o!==t&&t.providers!==void 0}function ph(t,n){for(let e of t)_y(e)&&(e=e.\u0275providers),Array.isArray(e)?ph(e,n):n(e)}var l_=Ge({provide:String,useValue:Ge});function Hy(t){return t!==null&&typeof t=="object"&&l_ in t}function d_(t){return!!(t&&t.useExisting)}function f_(t){return!!(t&&t.useFactory)}function Tf(t){return typeof t=="function"}var Ac=new xe(""),ec={},h_={},ff;function mh(){return ff===void 0&&(ff=new cc),ff}var wn=class{},qa=class extends wn{get destroyed(){return this._destroyed}constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Rf(n,a=>this.processProvider(a)),this.records.set(Ay,Si(void 0,this)),o.has("environment")&&this.records.set(wn,Si(void 0,this));let i=this.records.get(Ac);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Ny,Pn,we.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let n=Oe(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Oe(n)}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();let e=Xr(this),r=yn(void 0),o;try{return n()}finally{Xr(e),yn(r)}}get(n,e=$a,r=we.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(zv))return n[zv](this);r=Tc(r);let o,i=Xr(this),a=yn(void 0);try{if(!(r&we.SkipSelf)){let u=this.records.get(n);if(u===void 0){let c=b_(n)&&Sc(n);c&&this.injectableDefInScope(c)?u=Si(Mf(n),ec):u=null,this.records.set(n,u)}if(u!=null)return this.hydrate(n,u)}let s=r&we.Self?mh():this.parent;return e=r&we.Optional&&e===$a?null:e,s.get(n,e)}catch(s){if(s.name==="NullInjectorError"){if((s[sc]=s[sc]||[]).unshift(Yt(n)),i)throw s;return HI(s,n,"R3InjectorError",this.source)}else throw s}finally{yn(a),Xr(i)}}resolveInjectorInitializers(){let n=Oe(null),e=Xr(this),r=yn(void 0),o;try{let i=this.get(Do,Pn,we.Self);for(let a of i)a()}finally{Xr(e),yn(r),Oe(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Yt(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ce(205,!1)}processProvider(n){n=bn(n);let e=Tf(n)?n:bn(n&&n.provide),r=m_(n);if(!Tf(n)&&n.multi===!0){let o=this.records.get(e);o||(o=Si(void 0,ec,!0),o.factory=()=>If(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=Oe(null);try{return e.value===ec&&(e.value=h_,e.value=e.factory()),typeof e.value=="object"&&e.value&&y_(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Oe(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=bn(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function Mf(t){let n=Sc(t),e=n!==null?n.factory:Ni(t);if(e!==null)return e;if(t instanceof xe)throw new ce(204,!1);if(t instanceof Function)return p_(t);throw new ce(204,!1)}function p_(t){if(t.length>0)throw new ce(204,!1);let e=SI(t);return e!==null?()=>e.factory(t):()=>new t}function m_(t){if(Hy(t))return Si(void 0,t.useValue);{let n=g_(t);return Si(n,ec)}}function g_(t,n,e){let r;if(Tf(t)){let o=bn(t);return Ni(o)||Mf(o)}else if(Hy(t))r=()=>bn(t.useValue);else if(f_(t))r=()=>t.useFactory(...If(t.deps||[]));else if(d_(t))r=()=>Ne(bn(t.useExisting));else{let o=bn(t&&(t.useClass||t.provide));if(v_(t))r=()=>new o(...If(t.deps));else return Ni(o)||Mf(o)}return r}function Si(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function v_(t){return!!t.deps}function y_(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function b_(t){return typeof t=="function"||typeof t=="object"&&t instanceof xe}function Rf(t,n){for(let e of t)Array.isArray(e)?Rf(e,n):e&&_y(e)?Rf(e.\u0275providers,n):n(e)}function eo(t,n){t instanceof qa&&t.assertNotDestroyed();let e,r=Xr(t),o=yn(void 0);try{return n()}finally{Xr(r),yn(o)}}function x_(){return Ty()!==void 0||VI()!=null}function w_(t){return typeof t=="function"}var an=0,ve=1,se=2,Dt=3,On=4,Vn=5,Ln=6,Ka=7,Bn=8,ki=9,jn=10,bt=11,Xa=12,Yv=13,Bi=14,Cn=15,rs=16,Ti=17,Dr=18,Nc=19,zy=20,Yr=21,hf=22,Io=23,sn=25,$y=1,Ya=6,Er=7,lc=8,Fi=9,Qt=10,gh=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t}(gh||{});function Qr(t){return Array.isArray(t)&&typeof t[$y]=="object"}function or(t){return Array.isArray(t)&&t[$y]===!0}function Gy(t){return(t.flags&4)!==0}function os(t){return t.componentOffset>-1}function vh(t){return(t.flags&1)===1}function is(t){return!!t.template}function qy(t){return(t[se]&512)!==0}var Af=class{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function Ky(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}function kc(){return Xy}function Xy(t){return t.type.prototype.ngOnChanges&&(t.setInput=D_),C_}kc.ngInherit=!0;function C_(){let t=Qy(this),n=t?.current;if(n){let e=t.previous;if(e===Ga)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function D_(t,n,e,r,o){let i=this.declaredInputs[r],a=Qy(t)||E_(t,{previous:Ga,current:null}),s=a.current||(a.current={}),u=a.previous,c=u[i];s[i]=new Af(c&&c.currentValue,e,u===Ga),Ky(t,n,o,e)}var Yy="__ngSimpleChanges__";function Qy(t){return t[Yy]||null}function E_(t,n){return t[Yy]=n}var Qv=null;var er=function(t,n,e){Qv?.(t,n,e)},I_="svg",__="math",S_=!1;function T_(){return S_}function rr(t){for(;Array.isArray(t);)t=t[an];return t}function Dn(t,n){return rr(n[t.index])}function Zy(t,n){return t.data[n]}function Ro(t,n){let e=n[t];return Qr(e)?e:e[an]}function M_(t){return(t[se]&4)===4}function yh(t){return(t[se]&128)===128}function R_(t){return or(t[Dt])}function dc(t,n){return n==null?null:t[n]}function Jy(t){t[Ti]=0}function A_(t){t[se]&1024||(t[se]|=1024,yh(t)&&Qa(t))}function N_(t,n){for(;t>0;)n=n[Bi],t--;return n}function bh(t){return!!(t[se]&9216||t[Io]?.dirty)}function Nf(t){t[jn].changeDetectionScheduler?.notify(1),bh(t)?Qa(t):t[se]&64&&(T_()?(t[se]|=1024,Qa(t)):t[jn].changeDetectionScheduler?.notify())}function Qa(t){t[jn].changeDetectionScheduler?.notify();let n=Za(t);for(;n!==null&&!(n[se]&8192||(n[se]|=8192,!yh(n)));)n=Za(n)}function e0(t,n){if((t[se]&256)===256)throw new ce(911,!1);t[Yr]===null&&(t[Yr]=[]),t[Yr].push(n)}function k_(t,n){if(t[Yr]===null)return;let e=t[Yr].indexOf(n);e!==-1&&t[Yr].splice(e,1)}function Za(t){let n=t[Dt];return or(n)?n[Dt]:n}var Ee={lFrame:s0(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function F_(){return Ee.lFrame.elementDepthCount}function P_(){Ee.lFrame.elementDepthCount++}function O_(){Ee.lFrame.elementDepthCount--}function t0(){return Ee.bindingsEnabled}function as(){return Ee.skipHydrationRootTNode!==null}function L_(t){return Ee.skipHydrationRootTNode===t}function B_(t){Ee.skipHydrationRootTNode=t}function j_(){Ee.skipHydrationRootTNode=null}function ut(){return Ee.lFrame.lView}function _r(){return Ee.lFrame.tView}function Fc(t){return Ee.lFrame.contextLView=t,t[Bn]}function Pc(t){return Ee.lFrame.contextLView=null,t}function ir(){let t=n0();for(;t!==null&&t.type===64;)t=t.parent;return t}function n0(){return Ee.lFrame.currentTNode}function V_(){let t=Ee.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function ss(t,n){let e=Ee.lFrame;e.currentTNode=t,e.isParent=n}function r0(){return Ee.lFrame.isParent}function U_(){Ee.lFrame.isParent=!1}function W_(t){return Ee.lFrame.bindingIndex=t}function H_(){return Ee.lFrame.bindingIndex++}function z_(){return Ee.lFrame.inI18n}function $_(t,n){let e=Ee.lFrame;e.bindingIndex=e.bindingRootIndex=t,kf(n)}function G_(){return Ee.lFrame.currentDirectiveIndex}function kf(t){Ee.lFrame.currentDirectiveIndex=t}function o0(){return Ee.lFrame.currentQueryIndex}function xh(t){Ee.lFrame.currentQueryIndex=t}function q_(t){let n=t[ve];return n.type===2?n.declTNode:n.type===1?t[Vn]:null}function i0(t,n,e){if(e&we.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&we.Host);)if(o=q_(i),o===null||(i=i[Bi],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=Ee.lFrame=a0();return r.currentTNode=n,r.lView=t,!0}function wh(t){let n=a0(),e=t[ve];Ee.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function a0(){let t=Ee.lFrame,n=t===null?null:t.child;return n===null?s0(t):n}function s0(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function u0(){let t=Ee.lFrame;return Ee.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var c0=u0;function Ch(){let t=u0();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function K_(t){return(Ee.lFrame.contextLView=N_(t,Ee.lFrame.contextLView))[Bn]}function l0(){return Ee.lFrame.selectedIndex}function _o(t){Ee.lFrame.selectedIndex=t}function X_(){let t=Ee.lFrame;return Zy(t.tView,t.selectedIndex)}function d0(){return Ee.lFrame.currentNamespace}var f0=!0;function Dh(){return f0}function ar(t){f0=t}function Y_(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let a=Xy(n);(e.preOrderHooks??=[]).push(t,a),(e.preOrderCheckHooks??=[]).push(t,a)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function Eh(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(t.contentHooks??=[]).push(-e,a),s&&((t.contentHooks??=[]).push(e,s),(t.contentCheckHooks??=[]).push(e,s)),u&&(t.viewHooks??=[]).push(-e,u),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),l!=null&&(t.destroyHooks??=[]).push(e,l)}}function tc(t,n,e){h0(t,n,3,e)}function nc(t,n,e,r){(t[se]&3)===e&&h0(t,n,e,r)}function pf(t,n){let e=t[se];(e&3)===n&&(e&=16383,e+=1,t[se]=e)}function h0(t,n,e,r){let o=r!==void 0?t[Ti]&65535:0,i=r??-1,a=n.length-1,s=0;for(let u=o;u<a;u++)if(typeof n[u+1]=="number"){if(s=n[u],r!=null&&s>=r)break}else n[u]<0&&(t[Ti]+=65536),(s<i||i==-1)&&(Q_(t,e,n,u),t[Ti]=(t[Ti]&4294901760)+u+2),u++}function Zv(t,n){er(4,t,n);let e=Oe(null);try{n.call(t)}finally{Oe(e),er(5,t,n)}}function Q_(t,n,e,r){let o=e[r]<0,i=e[r+1],a=o?-e[r]:e[r],s=t[a];o?t[se]>>14<t[Ti]>>16&&(t[se]&3)===n&&(t[se]+=16384,Zv(s,i)):Zv(s,i)}var Ai=-1,Ja=class{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}};function Z_(t){return t instanceof Ja}function J_(t){return(t.flags&8)!==0}function eS(t){return(t.flags&16)!==0}function p0(t){return t!==Ai}function fc(t){return t&32767}function tS(t){return t>>16}function hc(t,n){let e=tS(t),r=n;for(;e>0;)r=r[Bi],e--;return r}var Ff=!0;function Jv(t){let n=Ff;return Ff=t,n}var nS=256,m0=nS-1,g0=5,rS=0,tr={};function oS(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(za)&&(r=e[za]),r==null&&(r=e[za]=rS++);let o=r&m0,i=1<<o;n.data[t+(o>>g0)]|=i}function v0(t,n){let e=y0(t,n);if(e!==-1)return e;let r=n[ve];r.firstCreatePass&&(t.injectorIndex=n.length,mf(r.data,t),mf(n,null),mf(r.blueprint,null));let o=Ih(t,n),i=t.injectorIndex;if(p0(o)){let a=fc(o),s=hc(o,n),u=s[ve].data;for(let c=0;c<8;c++)n[i+c]=s[a+c]|u[a+c]}return n[i+8]=o,i}function mf(t,n){t.push(0,0,0,0,0,0,0,0,n)}function y0(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function Ih(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=D0(o),r===null)return Ai;if(e++,o=o[Bi],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return Ai}function iS(t,n,e){oS(t,n,e)}function b0(t,n,e){if(e&we.Optional||t!==void 0)return t;lh(n,"NodeInjector")}function x0(t,n,e,r){if(e&we.Optional&&r===void 0&&(r=null),!(e&(we.Self|we.Host))){let o=t[ki],i=yn(void 0);try{return o?o.get(n,r,e&we.Optional):My(n,r,e&we.Optional)}finally{yn(i)}}return b0(r,n,e)}function w0(t,n,e,r=we.Default,o){if(t!==null){if(n[se]&2048&&!(r&we.Self)){let a=cS(t,n,e,r,tr);if(a!==tr)return a}let i=C0(t,n,e,r,tr);if(i!==tr)return i}return x0(n,e,r,o)}function C0(t,n,e,r,o){let i=sS(e);if(typeof i=="function"){if(!i0(n,t,r))return r&we.Host?b0(o,e,r):x0(n,e,r,o);try{let a;if(a=i(r),a==null&&!(r&we.Optional))lh(e);else return a}finally{c0()}}else if(typeof i=="number"){let a=null,s=y0(t,n),u=Ai,c=r&we.Host?n[Cn][Vn]:null;for((s===-1||r&we.SkipSelf)&&(u=s===-1?Ih(t,n):n[s+8],u===Ai||!ty(r,!1)?s=-1:(a=n[ve],s=fc(u),n=hc(u,n)));s!==-1;){let l=n[ve];if(ey(i,s,l.data)){let d=aS(s,n,e,a,r,c);if(d!==tr)return d}u=n[s+8],u!==Ai&&ty(r,n[ve].data[s+8]===c)&&ey(i,s,n)?(a=l,s=fc(u),n=hc(u,n)):s=-1}}return o}function aS(t,n,e,r,o,i){let a=n[ve],s=a.data[t+8],u=r==null?os(s)&&Ff:r!=a&&(s.type&3)!==0,c=o&we.Host&&i===s,l=rc(s,a,e,u,c);return l!==null?Pi(n,a,l,s):tr}function rc(t,n,e,r,o){let i=t.providerIndexes,a=n.data,s=i&1048575,u=t.directiveStart,c=t.directiveEnd,l=i>>20,d=r?s:s+l,f=o?s+l:c;for(let h=d;h<f;h++){let p=a[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(o){let h=a[u];if(h&&is(h)&&h.type===e)return u}return null}function Pi(t,n,e,r){let o=t[e],i=n.data;if(Z_(o)){let a=o;a.resolving&&FI(kI(i[e]));let s=Jv(a.canSeeViewProviders);a.resolving=!0;let u,c=a.injectImpl?yn(a.injectImpl):null,l=i0(t,r,we.Default);try{o=t[e]=a.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&Y_(e,i[e],n)}finally{c!==null&&yn(c),Jv(s),a.resolving=!1,c0()}}return o}function sS(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(za)?t[za]:void 0;return typeof n=="number"?n>=0?n&m0:uS:n}function ey(t,n,e){let r=1<<t;return!!(e[n+(t>>g0)]&r)}function ty(t,n){return!(t&we.Self)&&!(t&we.Host&&n)}var Co=class{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return w0(this._tNode,this._lView,n,Tc(r),e)}};function uS(){return new Co(ir(),ut())}function _h(t){return Ic(()=>{let n=t.prototype.constructor,e=n[ac]||Pf(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[ac]||Pf(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function Pf(t){return Cy(t)?()=>{let n=Pf(bn(t));return n&&n()}:Ni(t)}function cS(t,n,e,r,o){let i=t,a=n;for(;i!==null&&a!==null&&a[se]&2048&&!(a[se]&512);){let s=C0(i,a,e,r|we.Self,tr);if(s!==tr)return s;let u=i.parent;if(!u){let c=a[zy];if(c){let l=c.get(e,tr,r);if(l!==tr)return l}u=D0(a),a=a[Bi]}i=u}return o}function D0(t){let n=t[ve],e=n.type;return e===2?n.declTNode:e===1?t[Vn]:null}function ny(t,n=null,e=null,r){let o=E0(t,n,e,r);return o.resolveInjectorInitializers(),o}function E0(t,n=null,e=null,r,o=new Set){let i=[e||Pn,c_(t)];return r=r||(typeof t=="object"?void 0:Yt(t)),new qa(i,n||mh(),r||null,o)}var Ao=(()=>{class t{static{this.THROW_IF_NOT_FOUND=$a}static{this.NULL=new cc}static create(e,r){if(Array.isArray(e))return ny({name:""},r,e,"");{let o=e.name??"";return ny({name:o},e.parent,e.providers,o)}}static{this.\u0275prov=he({token:t,providedIn:"any",factory:()=>Ne(Ay)})}static{this.__NG_ELEMENT_ID__=-1}}return t})();var lS="ngOriginalError";function gf(t){return t[lS]}var Ir=class{constructor(){this._console=console}handleError(n){let e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&gf(n);for(;e&&gf(e);)e=gf(e);return e||null}},I0=new xe("",{providedIn:"root",factory:()=>X(Ir).handleError.bind(void 0)}),_0=(()=>{class t{static{this.__NG_ELEMENT_ID__=dS}static{this.__NG_ENV_ID__=e=>e}}return t})(),Of=class extends _0{constructor(n){super(),this._lView=n}onDestroy(n){return e0(this._lView,n),()=>k_(this._lView,n)}};function dS(){return new Of(ut())}function fS(){return ji(ir(),ut())}function ji(t,n){return new No(Dn(t,n))}var No=(()=>{class t{constructor(e){this.nativeElement=e}static{this.__NG_ELEMENT_ID__=fS}}return t})();function hS(t){return t instanceof No?t.nativeElement:t}var Lf=class extends Ht{constructor(n=!1){super(),this.destroyRef=void 0,this.__isAsync=n,x_()&&(this.destroyRef=X(_0,{optional:!0})??void 0)}emit(n){let e=Oe(null);try{super.next(n)}finally{Oe(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),a=r;if(n&&typeof n=="object"){let u=n;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=vf(i),o&&(o=vf(o)),a&&(a=vf(a)));let s=super.subscribe({next:o,error:i,complete:a});return n instanceof gt&&n.add(s),s}};function vf(t){return n=>{setTimeout(t,void 0,n)}}var xn=Lf;function pS(){return this._results[Symbol.iterator]()}var Bf=class t{get changes(){return this._changes??=new xn}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let e=t.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=pS)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;let r=GI(n);(this._changesDetected=!$I(this._results,r,e))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}},mS="ngSkipHydration",gS="ngskiphydration";function S0(t){let n=t.mergedAttrs;if(n===null)return!1;for(let e=0;e<n.length;e+=2){let r=n[e];if(typeof r=="number")return!1;if(typeof r=="string"&&r.toLowerCase()===gS)return!0}return!1}function T0(t){return t.hasAttribute(mS)}function pc(t){return(t.flags&128)===128}function vS(t){if(pc(t))return!0;let n=t.parent;for(;n;){if(pc(t)||S0(n))return!0;n=n.parent}return!1}var M0=new Map,yS=0;function bS(){return yS++}function xS(t){M0.set(t[Nc],t)}function wS(t){M0.delete(t[Nc])}var ry="__ngContext__";function So(t,n){Qr(n)?(t[ry]=n[Nc],xS(n)):t[ry]=n}function R0(t){return N0(t[Xa])}function A0(t){return N0(t[On])}function N0(t){for(;t!==null&&!or(t);)t=t[On];return t}var jf;function k0(t){jf=t}function Oc(){if(jf!==void 0)return jf;if(typeof document<"u")return document;throw new ce(210,!1)}var Lc=new xe("",{providedIn:"root",factory:()=>CS}),CS="ng",Sh=new xe(""),En=new xe("",{providedIn:"platform",factory:()=>"unknown"});var Th=new xe("",{providedIn:"root",factory:()=>Oc().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function DS(){let t=new ko;return X(En)==="browser"&&(t.store=ES(Oc(),X(Lc))),t}var ko=(()=>{class t{constructor(){this.store={},this.onSerializeCallbacks={}}static{this.\u0275prov=he({token:t,providedIn:"root",factory:DS})}get(e,r){return this.store[e]!==void 0?this.store[e]:r}set(e,r){this.store[e]=r}remove(e){delete this.store[e]}hasKey(e){return this.store.hasOwnProperty(e)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(e,r){this.onSerializeCallbacks[e]=r}toJson(){for(let e in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(e))try{this.store[e]=this.onSerializeCallbacks[e]()}catch(r){console.warn("Exception in onSerialize callback: ",r)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}}return t})();function ES(t,n){let e=t.getElementById(n+"-state");if(e?.textContent)try{return JSON.parse(e.textContent)}catch(r){console.warn("Exception while restoring TransferState for app "+n,r)}return{}}var F0="h",P0="b",Vf=function(t){return t.FirstChild="f",t.NextSibling="n",t}(Vf||{}),IS="e",_S="t",Mh="c",O0="x",mc="r",SS="i",TS="n",MS="d",RS="__nghData__",L0=RS,yf="ngh",AS="nghm",B0=()=>null;function NS(t,n,e=!1){let r=t.getAttribute(yf);if(r==null)return null;let[o,i]=r.split("|");if(r=e?i:o,!r)return null;let a=i?`|${i}`:"",s=e?o:a,u={};if(r!==""){let l=n.get(ko,null,{optional:!0});l!==null&&(u=l.get(L0,[])[Number(r)])}let c={data:u,firstChild:t.firstChild??null};return e&&(c.firstChild=t,Bc(c,0,t.nextSibling)),s?t.setAttribute(yf,s):t.removeAttribute(yf),c}function kS(){B0=NS}function Rh(t,n,e=!1){return B0(t,n,e)}function FS(t){let n=t._lView;return n[ve].type===2?null:(qy(n)&&(n=n[sn]),n)}function PS(t){return t.textContent?.replace(/\s/gm,"")}function OS(t){let n=Oc(),e=n.createNodeIterator(t,NodeFilter.SHOW_COMMENT,{acceptNode(i){let a=PS(i);return a==="ngetn"||a==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),r,o=[];for(;r=e.nextNode();)o.push(r);for(let i of o)i.textContent==="ngetn"?i.replaceWith(n.createTextNode("")):i.remove()}function Bc(t,n,e){t.segmentHeads??={},t.segmentHeads[n]=e}function Uf(t,n){return t.segmentHeads?.[n]??null}function LS(t,n){let e=t.data,r=e[IS]?.[n]??null;return r===null&&e[Mh]?.[n]&&(r=Ah(t,n)),r}function j0(t,n){return t.data[Mh]?.[n]??null}function Ah(t,n){let e=j0(t,n)??[],r=0;for(let o of e)r+=o[mc]*(o[O0]??1);return r}function jc(t,n){if(typeof t.disconnectedNodes>"u"){let e=t.data[MS];t.disconnectedNodes=e?new Set(e):null}return!!t.disconnectedNodes?.has(n)}var Qu=new xe(""),V0=!1,U0=new xe("",{providedIn:"root",factory:()=>V0}),BS=new xe("");var gc=class{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${xy})`}};function Nh(t){return t instanceof gc?t.changingThisBreaksApplicationSecurity:t}function W0(t,n){let e=jS(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${xy})`)}return e===n}function jS(t){return t instanceof gc&&t.getTypeName()||null}var VS=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function H0(t){return t=String(t),t.match(VS)?t:"unsafe:"+t}var kh=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(kh||{});function z0(t){let n=US();return n?n.sanitize(kh.URL,t)||"":W0(t,"URL")?Nh(t):H0(Sy(t))}function US(){let t=ut();return t&&t[jn].sanitizer}var WS=/^>|^->|<!--|-->|--!>|<!-$/g,HS=/(<|>)/g,zS="\u200B$1\u200B";function $S(t){return t.replace(WS,n=>n.replace(HS,zS))}function GS(t){return t.ownerDocument.body}function $0(t){return t instanceof Function?t():t}function Zu(t){return(t??X(Ao)).get(En)==="browser"}var Fo=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Fo||{}),qS;function Fh(t,n){return qS(t,n)}function Mi(t,n,e,r,o){if(r!=null){let i,a=!1;or(r)?i=r:Qr(r)&&(a=!0,r=r[an]);let s=rr(r);t===0&&e!==null?o==null?X0(n,e,s):vc(n,e,s,o||null,!0):t===1&&e!==null?vc(n,e,s,o||null,!0):t===2?jh(n,s,a):t===3&&n.destroyNode(s),i!=null&&cT(n,t,i,e,o)}}function Ph(t,n){return t.createText(n)}function Oh(t,n){return t.createComment($S(n))}function Vc(t,n,e){return t.createElement(n,e)}function KS(t,n){G0(t,n),n[an]=null,n[Vn]=null}function XS(t,n,e,r,o,i){r[an]=o,r[Vn]=n,Uc(t,r,e,1,o,i)}function G0(t,n){n[jn].changeDetectionScheduler?.notify(1),Uc(t,n,n[bt],2,null,null)}function YS(t){let n=t[Xa];if(!n)return bf(t[ve],t);for(;n;){let e=null;if(Qr(n))e=n[Xa];else{let r=n[Qt];r&&(e=r)}if(!e){for(;n&&!n[On]&&n!==t;)Qr(n)&&bf(n[ve],n),n=n[Dt];n===null&&(n=t),Qr(n)&&bf(n[ve],n),e=n&&n[On]}n=e}}function QS(t,n,e,r){let o=Qt+r,i=e.length;r>0&&(e[o-1][On]=n),r<i-Qt?(n[On]=e[o],Ry(e,Qt+r,n)):(e.push(n),n[On]=null),n[Dt]=e;let a=n[rs];a!==null&&e!==a&&ZS(a,n);let s=n[Dr];s!==null&&s.insertView(t),Nf(n),n[se]|=128}function ZS(t,n){let e=t[Fi],o=n[Dt][Dt][Cn];n[Cn]!==o&&(t[se]|=gh.HasTransplantedViews),e===null?t[Fi]=[n]:e.push(n)}function q0(t,n){let e=t[Fi],r=e.indexOf(n);e.splice(r,1)}function Wf(t,n){if(t.length<=Qt)return;let e=Qt+n,r=t[e];if(r){let o=r[rs];o!==null&&o!==t&&q0(o,r),n>0&&(t[e-1][On]=r[On]);let i=uc(t,Qt+n);KS(r[ve],r);let a=i[Dr];a!==null&&a.detachView(i[ve]),r[Dt]=null,r[On]=null,r[se]&=-129}return r}function K0(t,n){if(!(n[se]&256)){let e=n[bt];e.destroyNode&&Uc(t,n,e,3,null,null),YS(n)}}function bf(t,n){if(n[se]&256)return;let e=Oe(null);try{n[se]&=-129,n[se]|=256,n[Io]&&lv(n[Io]),eT(t,n),JS(t,n),n[ve].type===1&&n[bt].destroy();let r=n[rs];if(r!==null&&or(n[Dt])){r!==n[Dt]&&q0(r,n);let o=n[Dr];o!==null&&o.detachView(t)}wS(n)}finally{Oe(e)}}function JS(t,n){let e=t.cleanup,r=n[Ka];if(e!==null)for(let i=0;i<e.length-1;i+=2)if(typeof e[i]=="string"){let a=e[i+3];a>=0?r[a]():r[-a].unsubscribe(),i+=2}else{let a=r[e[i+1]];e[i].call(a)}r!==null&&(n[Ka]=null);let o=n[Yr];if(o!==null){n[Yr]=null;for(let i=0;i<o.length;i++){let a=o[i];a()}}}function eT(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof Ja)){let i=e[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){let s=o[i[a]],u=i[a+1];er(4,s,u);try{u.call(s)}finally{er(5,s,u)}}else{er(4,o,i);try{i.call(o)}finally{er(5,o,i)}}}}}function tT(t,n,e){return nT(t,n.parent,e)}function nT(t,n,e){let r=n;for(;r!==null&&r.type&40;)n=r,r=n.parent;if(r===null)return e[an];{let{componentOffset:o}=r;if(o>-1){let{encapsulation:i}=t.data[r.directiveStart+o];if(i===nr.None||i===nr.Emulated)return null}return Dn(r,e)}}function vc(t,n,e,r,o){t.insertBefore(n,e,r,o)}function X0(t,n,e){t.appendChild(n,e)}function oy(t,n,e,r,o){r!==null?vc(t,n,e,r,o):X0(t,n,e)}function rT(t,n,e,r){t.removeChild(n,e,r)}function Lh(t,n){return t.parentNode(n)}function oT(t,n){return t.nextSibling(n)}function iT(t,n,e){return sT(t,n,e)}function aT(t,n,e){return t.type&40?Dn(t,e):null}var sT=aT,iy;function Bh(t,n,e,r){let o=tT(t,r,n),i=n[bt],a=r.parent||n[Vn],s=iT(a,r,n);if(o!=null)if(Array.isArray(e))for(let u=0;u<e.length;u++)oy(i,o,e[u],s,!1);else oy(i,o,e,s,!1);iy!==void 0&&iy(i,r,n,e,o)}function oc(t,n){if(n!==null){let e=n.type;if(e&3)return Dn(n,t);if(e&4)return Hf(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return oc(t,r);{let o=t[n.index];return or(o)?Hf(-1,o):rr(o)}}else{if(e&32)return Fh(n,t)()||rr(t[n.index]);{let r=Y0(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=Za(t[Cn]);return oc(o,r)}else return oc(t,n.next)}}}return null}function Y0(t,n){if(n!==null){let r=t[Cn][Vn],o=n.projection;return r.projection[o]}return null}function Hf(t,n){let e=Qt+t+1;if(e<n.length){let r=n[e],o=r[ve].firstChild;if(o!==null)return oc(r,o)}return n[Er]}function jh(t,n,e){let r=Lh(t,n);r&&rT(t,r,n,e)}function Q0(t){t.textContent=""}function Vh(t,n,e,r,o,i,a){for(;e!=null;){let s=r[e.index],u=e.type;if(a&&n===0&&(s&&So(rr(s),r),e.flags|=2),(e.flags&32)!==32)if(u&8)Vh(t,n,e.child,r,o,i,!1),Mi(n,t,o,s,i);else if(u&32){let c=Fh(e,r),l;for(;l=c();)Mi(n,t,o,l,i);Mi(n,t,o,s,i)}else u&16?uT(t,n,r,e,o,i):Mi(n,t,o,s,i);e=a?e.projectionNext:e.next}}function Uc(t,n,e,r,o,i){Vh(e,r,t.firstChild,n,o,i,!1)}function uT(t,n,e,r,o,i){let a=e[Cn],u=a[Vn].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++){let l=u[c];Mi(n,t,o,l,i)}else{let c=u,l=a[Dt];pc(r)&&(c.flags|=128),Vh(t,n,c,l,o,i,!0)}}function cT(t,n,e,r,o){let i=e[Er],a=rr(e);i!==a&&Mi(n,t,r,i,o);for(let s=Qt;s<e.length;s++){let u=e[s];Uc(u[ve],u,t,n,r,i)}}function lT(t,n,e){t.setAttribute(n,"style",e)}function Z0(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function J0(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&_f(t,n,r),o!==null&&Z0(t,n,o),i!==null&&lT(t,n,i)}var eb={};function Uh(t=1){tb(_r(),ut(),l0()+t,!1)}function tb(t,n,e,r){if(!r)if((n[se]&3)===3){let i=t.preOrderCheckHooks;i!==null&&tc(n,i,e)}else{let i=t.preOrderHooks;i!==null&&nc(n,i,0,e)}_o(e)}function Po(t,n=we.Default){let e=ut();if(e===null)return Ne(t,n);let r=ir();return w0(r,e,bn(t),n)}function nb(t,n,e,r,o,i){let a=Oe(null);try{let s=null;o&Zr.SignalBased&&(s=n[r][av]),s!==null&&s.transformFn!==void 0&&(i=s.transformFn(i)),o&Zr.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,s,i,e,r):Ky(n,s,r,i)}finally{Oe(a)}}function dT(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)_o(~o);else{let i=o,a=e[++r],s=e[++r];$_(a,i);let u=n[i];s(2,u)}}}finally{_o(-1)}}function Wc(t,n,e,r,o,i,a,s,u,c,l){let d=n.blueprint.slice();return d[an]=o,d[se]=r|4|128|8|64,(c!==null||t&&t[se]&2048)&&(d[se]|=2048),Jy(d),d[Dt]=d[Bi]=t,d[Bn]=e,d[jn]=a||t&&t[jn],d[bt]=s||t&&t[bt],d[ki]=u||t&&t[ki]||null,d[Vn]=i,d[Nc]=bS(),d[Ln]=l,d[zy]=c,d[Cn]=n.type==2?t[Cn]:d,d}function Hc(t,n,e,r,o){let i=t.data[n];if(i===null)i=fT(t,n,e,r,o),z_()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let a=V_();i.injectorIndex=a===null?-1:a.injectorIndex}return ss(i,!0),i}function fT(t,n,e,r,o){let i=n0(),a=r0(),s=a?i:i&&i.parent,u=t.data[n]=bT(t,s,e,n,r,o);return t.firstChild===null&&(t.firstChild=u),i!==null&&(a?i.child==null&&u.parent!==null&&(i.child=u):i.next===null&&(i.next=u,u.prev=i)),u}function rb(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function ob(t,n,e,r,o){let i=l0(),a=r&2;try{_o(-1),a&&n.length>sn&&tb(t,n,sn,!1),er(a?2:0,o),e(r,o)}finally{_o(i),er(a?3:1,o)}}function ib(t,n,e){if(Gy(n)){let r=Oe(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let a=o;a<i;a++){let s=t.data[a];if(s.contentQueries){let u=e[a];s.contentQueries(1,u,a)}}}finally{Oe(r)}}}function ab(t,n,e){t0()&&(_T(t,n,e,Dn(e,n)),(e.flags&64)===64&&fb(t,n,e))}function sb(t,n,e=Dn){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let a=r[i+1],s=a===-1?e(n,t):t[a];t[o++]=s}}}function ub(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=Wh(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function Wh(t,n,e,r,o,i,a,s,u,c,l){let d=sn+r,f=d+o,h=hT(d,f),p=typeof c=="function"?c():c;return h[ve]={type:t,blueprint:h,template:e,queries:null,viewQuery:s,declTNode:n,data:h.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof a=="function"?a():a,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1,ssrId:l}}function hT(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:eb);return e}function pT(t,n,e,r){let i=r.get(U0,V0)||e===nr.ShadowDom,a=t.selectRootElement(n,i);return mT(a),a}function mT(t){cb(t)}var cb=()=>null;function gT(t){T0(t)?Q0(t):OS(t)}function vT(){cb=gT}function yT(t,n,e,r){let o=mb(n);o.push(e),t.firstCreatePass&&gb(t).push(r,o.length-1)}function bT(t,n,e,r,o,i){let a=n?n.injectorIndex:-1,s=0;return as()&&(s|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:a,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:s,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function ay(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let a=n[i];if(a===void 0)continue;r??={};let s,u=Zr.None;Array.isArray(a)?(s=a[0],u=a[1]):s=a;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?sy(r,e,c,s,u):sy(r,e,c,s)}return r}function sy(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function xT(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,a=n.attrs,s=[],u=null,c=null;for(let l=r;l<o;l++){let d=i[l],f=e?e.get(d):null,h=f?f.inputs:null,p=f?f.outputs:null;u=ay(0,d.inputs,l,u,h),c=ay(1,d.outputs,l,c,p);let m=u!==null&&a!==null&&!hh(n)?PT(u,l,a):null;s.push(m)}u!==null&&(u.hasOwnProperty("class")&&(n.flags|=8),u.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=s,n.inputs=u,n.outputs=c}function wT(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function CT(t,n,e,r,o,i,a,s){let u=Dn(n,e),c=n.inputs,l;!s&&c!=null&&(l=c[r])?(Hh(t,e,l,r,o),os(n)&&DT(e,n.index)):n.type&3?(r=wT(r),o=a!=null?a(o,n.value||"",r):o,i.setProperty(u,r,o)):n.type&12}function DT(t,n){let e=Ro(n,t);e[se]&16||(e[se]|=64)}function lb(t,n,e,r){if(t0()){let o=r===null?null:{"":-1},i=TT(t,e),a,s;i===null?a=s=null:[a,s]=i,a!==null&&db(t,n,e,a,o,s),o&&MT(e,r,o)}e.mergedAttrs=fh(e.mergedAttrs,e.attrs)}function db(t,n,e,r,o,i){for(let c=0;c<r.length;c++)iS(v0(e,n),t,r[c].type);AT(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let l=r[c];l.providersResolver&&l.providersResolver(l)}let a=!1,s=!1,u=rb(t,n,r.length,null);for(let c=0;c<r.length;c++){let l=r[c];e.mergedAttrs=fh(e.mergedAttrs,l.hostAttrs),NT(t,e,n,u,l),RT(u,l,o),l.contentQueries!==null&&(e.flags|=4),(l.hostBindings!==null||l.hostAttrs!==null||l.hostVars!==0)&&(e.flags|=64);let d=l.type.prototype;!a&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),a=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),s=!0),u++}xT(t,e,i)}function ET(t,n,e,r,o){let i=o.hostBindings;if(i){let a=t.hostBindingOpCodes;a===null&&(a=t.hostBindingOpCodes=[]);let s=~n.index;IT(a)!=s&&a.push(s),a.push(e,r,i)}}function IT(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function _T(t,n,e,r){let o=e.directiveStart,i=e.directiveEnd;os(e)&&kT(n,e,t.data[o+e.componentOffset]),t.firstCreatePass||v0(e,n),So(r,n);let a=e.initialInputs;for(let s=o;s<i;s++){let u=t.data[s],c=Pi(n,t,s,e);if(So(c,n),a!==null&&FT(n,s-o,c,u,e,a),is(u)){let l=Ro(e.index,n);l[Bn]=Pi(n,t,s,e)}}}function fb(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,a=G_();try{_o(i);for(let s=r;s<o;s++){let u=t.data[s],c=n[s];kf(s),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&ST(u,c)}}finally{_o(-1),kf(a)}}function ST(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function TT(t,n){let e=t.directiveRegistry,r=null,o=null;if(e)for(let i=0;i<e.length;i++){let a=e[i];if(e_(n,a.selectors,!1))if(r||(r=[]),is(a))if(a.findHostDirectiveDefs!==null){let s=[];o=o||new Map,a.findHostDirectiveDefs(a,s,o),r.unshift(...s,a);let u=s.length;zf(t,n,u)}else r.unshift(a),zf(t,n,0);else o=o||new Map,a.findHostDirectiveDefs?.(a,r,o),r.push(a)}return r===null?null:[r,o]}function zf(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function MT(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new ce(-301,!1);r.push(n[o],i)}}}function RT(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;is(n)&&(e[""]=t)}}function AT(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function NT(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=Ni(o.type,!0)),a=new Ja(i,is(o),Po);t.blueprint[r]=a,e[r]=a,ET(t,n,r,rb(t,e,o.hostVars,eb),o)}function kT(t,n,e){let r=Dn(n,t),o=ub(e),i=t[jn].rendererFactory,a=16;e.signals?a=4096:e.onPush&&(a=64);let s=zc(t,Wc(t,o,null,a,r,n,null,i.createRenderer(r,e),null,null,null));t[n.index]=s}function FT(t,n,e,r,o,i){let a=i[n];if(a!==null)for(let s=0;s<a.length;){let u=a[s++],c=a[s++],l=a[s++],d=a[s++];nb(r,e,u,c,l,d)}}function PT(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let a=t[i];for(let s=0;s<a.length;s+=3)if(a[s]===n){r.push(i,a[s+1],a[s+2],e[o+1]);break}}o+=2}return r}function hb(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function pb(t,n){let e=t.contentQueries;if(e!==null){let r=Oe(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],a=e[o+1];if(a!==-1){let s=t.data[a];xh(i),s.contentQueries(2,n[a],a)}}}finally{Oe(r)}}}function zc(t,n){return t[Xa]?t[Yv][On]=n:t[Xa]=n,t[Yv]=n,n}function $f(t,n,e){xh(0);let r=Oe(null);try{n(t,e)}finally{Oe(r)}}function mb(t){return t[Ka]||(t[Ka]=[])}function gb(t){return t.cleanup||(t.cleanup=[])}function vb(t,n){let e=t[ki],r=e?e.get(Ir,null):null;r&&r.handleError(n)}function Hh(t,n,e,r,o){for(let i=0;i<e.length;){let a=e[i++],s=e[i++],u=e[i++],c=n[a],l=t.data[a];nb(l,c,r,s,u,o)}}function OT(t,n){let e=Ro(n,t),r=e[ve];LT(r,e);let o=e[an];o!==null&&e[Ln]===null&&(e[Ln]=Rh(o,e[ki])),zh(r,e,e[Bn])}function LT(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function zh(t,n,e){wh(n);try{let r=t.viewQuery;r!==null&&$f(1,r,e);let o=t.template;o!==null&&ob(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[Dr]?.finishViewCreation(t),t.staticContentQueries&&pb(t,n),t.staticViewQueries&&$f(2,t.viewQuery,e);let i=t.components;i!==null&&BT(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[se]&=-5,Ch()}}function BT(t,n){for(let e=0;e<n.length;e++)OT(t,n[e])}function jT(t,n,e,r){let o=Oe(null);try{let i=n.tView,s=t[se]&4096?4096:16,u=Wc(t,i,e,s,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];u[rs]=c;let l=t[Dr];return l!==null&&(u[Dr]=l.createEmbeddedView(i)),zh(i,u,e),u}finally{Oe(o)}}function uy(t,n){return!n||n.firstChild===null||pc(t)}function VT(t,n,e,r=!0){let o=n[ve];if(QS(o,n,t,e),r){let a=Hf(e,t),s=n[bt],u=Lh(s,t[Er]);u!==null&&XS(o,t[Vn],s,n,u,a)}let i=n[Ln];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function yc(t,n,e,r,o=!1){for(;e!==null;){let i=n[e.index];i!==null&&r.push(rr(i)),or(i)&&UT(i,r);let a=e.type;if(a&8)yc(t,n,e.child,r);else if(a&32){let s=Fh(e,n),u;for(;u=s();)r.push(u)}else if(a&16){let s=Y0(n,e);if(Array.isArray(s))r.push(...s);else{let u=Za(n[Cn]);yc(u[ve],u,s,r,!0)}}e=o?e.projectionNext:e.next}return r}function UT(t,n){for(let e=Qt;e<t.length;e++){let r=t[e],o=r[ve].firstChild;o!==null&&yc(r[ve],r,o,n)}t[Er]!==t[an]&&n.push(t[Er])}var yb=[];function WT(t){return t[Io]??HT(t)}function HT(t){let n=yb.pop()??Object.create($T);return n.lView=t,n}function zT(t){t.lView[Io]!==t&&(t.lView=null,yb.push(t))}var $T=lt(re({},sv),{consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{Qa(t.lView)},consumerOnSignalRead(){this.lView[Io]=this}}),bb=100;function xb(t,n=!0,e=0){let r=t[jn],o=r.rendererFactory,i=!1;i||o.begin?.();try{GT(t,e)}catch(a){throw n&&vb(t,a),a}finally{i||(o.end?.(),r.inlineEffectRunner?.flush())}}function GT(t,n){Gf(t,n);let e=0;for(;bh(t);){if(e===bb)throw new ce(103,!1);e++,Gf(t,1)}}function qT(t,n,e,r){let o=n[se];if((o&256)===256)return;let i=!1;!i&&n[jn].inlineEffectRunner?.flush(),wh(n);let a=null,s=null;!i&&KT(t)&&(s=WT(n),a=uv(s));try{Jy(n),W_(t.bindingStartIndex),e!==null&&ob(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let d=t.preOrderCheckHooks;d!==null&&tc(n,d,null)}else{let d=t.preOrderHooks;d!==null&&nc(n,d,0,null),pf(n,0)}if(XT(n),wb(n,0),t.contentQueries!==null&&pb(t,n),!i)if(u){let d=t.contentCheckHooks;d!==null&&tc(n,d)}else{let d=t.contentHooks;d!==null&&nc(n,d,1),pf(n,1)}dT(t,n);let c=t.components;c!==null&&Db(n,c,0);let l=t.viewQuery;if(l!==null&&$f(2,l,r),!i)if(u){let d=t.viewCheckHooks;d!==null&&tc(n,d)}else{let d=t.viewHooks;d!==null&&nc(n,d,2),pf(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[hf]){for(let d of n[hf])d();n[hf]=null}i||(n[se]&=-73)}catch(u){throw Qa(n),u}finally{s!==null&&(cv(s,a),zT(s)),Ch()}}function KT(t){return t.type!==2}function wb(t,n){for(let e=R0(t);e!==null;e=A0(e))for(let r=Qt;r<e.length;r++){let o=e[r];Cb(o,n)}}function XT(t){for(let n=R0(t);n!==null;n=A0(n)){if(!(n[se]&gh.HasTransplantedViews))continue;let e=n[Fi];for(let r=0;r<e.length;r++){let o=e[r],i=o[Dt];A_(o)}}}function YT(t,n,e){let r=Ro(n,t);Cb(r,e)}function Cb(t,n){yh(t)&&Gf(t,n)}function Gf(t,n){let r=t[ve],o=t[se],i=t[Io],a=!!(n===0&&o&16);if(a||=!!(o&64&&n===0),a||=!!(o&1024),a||=!!(i?.dirty&&Gd(i)),i&&(i.dirty=!1),t[se]&=-9217,a)qT(r,t,r.template,t[Bn]);else if(o&8192){wb(t,1);let s=r.components;s!==null&&Db(t,s,1)}}function Db(t,n,e){for(let r=0;r<n.length;r++)YT(t,n[r],e)}function $h(t){for(t[jn].changeDetectionScheduler?.notify();t;){t[se]|=64;let n=Za(t);if(qy(t)&&!n)return t;t=n}return null}var To=class{get rootNodes(){let n=this._lView,e=n[ve];return yc(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Bn]}set context(n){this._lView[Bn]=n}get destroyed(){return(this._lView[se]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Dt];if(or(n)){let e=n[lc],r=e?e.indexOf(this):-1;r>-1&&(Wf(n,r),uc(e,r))}this._attachedToViewContainer=!1}K0(this._lView[ve],this._lView)}onDestroy(n){e0(this._lView,n)}markForCheck(){$h(this._cdRefInjectingView||this._lView)}detach(){this._lView[se]&=-129}reattach(){Nf(this._lView),this._lView[se]|=128}detectChanges(){this._lView[se]|=1024,xb(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ce(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,G0(this._lView[ve],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new ce(902,!1);this._appRef=n,Nf(this._lView)}},Oi=(()=>{class t{static{this.__NG_ELEMENT_ID__=JT}}return t})(),QT=Oi,ZT=class extends QT{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=jT(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new To(o)}};function JT(){return Gh(ir(),ut())}function Gh(t,n){return t.type&4?new ZT(n,t,ji(t,n)):null}function Eb(t){let n=t[Ya]??[],r=t[Dt][bt];for(let o of n)eM(o,r);t[Ya]=Pn}function eM(t,n){let e=0,r=t.firstChild;if(r){let o=t.data[mc];for(;e<o;){let i=r.nextSibling;jh(n,r,!1),r=i,e++}}}function Ib(t){Eb(t);for(let n=Qt;n<t.length;n++)bc(t[n])}function tM(t){let n=t[Ln]?.i18nNodes;if(n){let e=t[bt];for(let r of n.values())jh(e,r,!1);t[Ln].i18nNodes=void 0}}function bc(t){tM(t);let n=t[ve];for(let e=sn;e<n.bindingStartIndex;e++)if(or(t[e])){let r=t[e];Ib(r)}else Qr(t[e])&&bc(t[e])}function nM(t){let n=t._views;for(let e of n){let r=FS(e);if(r!==null&&r[an]!==null)if(Qr(r))bc(r);else{let o=r[an];bc(o),Ib(r)}}}var rM=new RegExp(`^(\\d+)*(${P0}|${F0})*(.*)`);function oM(t){let n=t.match(rM),[e,r,o,i]=n,a=r?parseInt(r,10):o,s=[];for(let[u,c,l]of i.matchAll(/(f|n)(\d*)/g)){let d=parseInt(l,10)||1;s.push(c,d)}return[a,...s]}function iM(t){return!t.prev&&t.parent?.type===8}function xf(t){return t.index-sn}function aM(t,n){let e=t.i18nNodes;if(e){let r=e.get(n);return r&&e.delete(n),r}return null}function $c(t,n,e,r){let o=xf(r),i=aM(t,o);if(!i){let a=t.data[TS];if(a?.[o])i=uM(a[o],e);else if(n.firstChild===r)i=t.firstChild;else{let s=r.prev===null,u=r.prev??r.parent;if(iM(r)){let c=xf(r.parent);i=Uf(t,c)}else{let c=Dn(u,e);if(s)i=c.firstChild;else{let l=xf(u),d=Uf(t,l);if(u.type===2&&d){let h=Ah(t,l)+1;i=Gc(h,d)}else i=c.nextSibling}}}}return i}function Gc(t,n){let e=n;for(let r=0;r<t;r++)e=e.nextSibling;return e}function sM(t,n){let e=t;for(let r=0;r<n.length;r+=2){let o=n[r],i=n[r+1];for(let a=0;a<i;a++)switch(o){case Vf.FirstChild:e=e.firstChild;break;case Vf.NextSibling:e=e.nextSibling;break}}return e}function uM(t,n){let[e,...r]=oM(t),o;if(e===F0)o=n[Cn][an];else if(e===P0)o=GS(n[Cn][an]);else{let i=Number(e);o=rr(n[i+sn])}return sM(o,r)}function cM(t,n){let e=[];for(let r of n)for(let o=0;o<(r[O0]??1);o++){let i={data:r,firstChild:null};r[mc]>0&&(i.firstChild=t,t=Gc(r[mc],t)),e.push(i)}return[t,e]}var _b=()=>null;function lM(t,n){let e=t[Ya];return!n||e===null||e.length===0?null:e[0].data[SS]===n?e.shift():(Eb(t),null)}function dM(){_b=lM}function cy(t,n){return _b(t,n)}var qf=class{},Kf=class{},xc=class{};function fM(t){let n=Error(`No component factory found for ${Yt(t)}.`);return n[hM]=t,n}var hM="ngComponent";var Xf=class{resolveComponentFactory(n){throw fM(n)}},qc=(()=>{class t{static{this.NULL=new Xf}}return t})(),es=class{};var pM=(()=>{class t{static{this.\u0275prov=he({token:t,providedIn:"root",factory:()=>null})}}return t})(),wf={};var ly=new Set;function us(t){ly.has(t)||(ly.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function dy(...t){}function mM(){let t=typeof Ha.requestAnimationFrame=="function",n=Ha[t?"requestAnimationFrame":"setTimeout"],e=Ha[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&e){let r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);let o=e[Zone.__symbol__("OriginalDelegate")];o&&(e=o)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}var st=class t{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new xn(!1),this.onMicrotaskEmpty=new xn(!1),this.onStable=new xn(!1),this.onError=new xn(!1),typeof Zone>"u")throw new ce(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&e,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=mM().nativeRequestAnimationFrame,yM(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new ce(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new ce(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,n,gM,dy,dy);try{return i.runTask(a,e,r)}finally{i.cancelTask(a)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},gM={};function qh(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function vM(t){t.isCheckStableRunning||t.lastRequestAnimationFrameId!==-1||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Ha,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Yf(t),t.isCheckStableRunning=!0,qh(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Yf(t))}function yM(t){let n=()=>{vM(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,o,i,a,s)=>{if(bM(s))return e.invokeTask(o,i,a,s);try{return fy(t),e.invokeTask(o,i,a,s)}finally{(t.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),hy(t)}},onInvoke:(e,r,o,i,a,s,u)=>{try{return fy(t),e.invoke(o,i,a,s,u)}finally{t.shouldCoalesceRunChangeDetection&&n(),hy(t)}},onHasTask:(e,r,o,i)=>{e.hasTask(o,i),r===o&&(i.change=="microTask"?(t._hasPendingMicrotasks=i.microTask,Yf(t),qh(t)):i.change=="macroTask"&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,o,i)=>(e.handleError(o,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}function Yf(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.lastRequestAnimationFrameId!==-1?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function fy(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function hy(t){t._nesting--,qh(t)}function bM(t){return!Array.isArray(t)||t.length!==1?!1:t[0].data?.__ignore_ng_zone__===!0}var Sb=(()=>{class t{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let e=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let r of e)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static{this.\u0275prov=he({token:t,providedIn:"root",factory:()=>new t})}}return t})();function Qf(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let a=0;a<n.length;a++){let s=n[a];if(typeof s=="number")i=s;else if(i==1)o=Vv(o,s);else if(i==2){let u=s,c=n[++a];r=Vv(r,u+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var wc=class extends qc{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=Eo(n);return new ts(e,this.ngModule)}};function py(t){let n=[];for(let e in t){if(!t.hasOwnProperty(e))continue;let r=t[e];r!==void 0&&n.push({propName:Array.isArray(r)?r[0]:r,templateName:e})}return n}function xM(t){let n=t.toLowerCase();return n==="svg"?I_:n==="math"?__:null}var Zf=class{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Tc(r);let o=this.injector.get(n,wf,r);return o!==wf||e===wf?o:this.parentInjector.get(n,e,r)}},ts=class extends xc{get inputs(){let n=this.componentDef,e=n.inputTransforms,r=py(n.inputs);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return py(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=o_(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,o){let i=Oe(null);try{o=o||this.ngModule;let a=o instanceof wn?o:o?.injector;a&&this.componentDef.getStandaloneInjector!==null&&(a=this.componentDef.getStandaloneInjector(a)||a);let s=a?new Zf(n,a):n,u=s.get(es,null);if(u===null)throw new ce(407,!1);let c=s.get(pM,null),l=s.get(Sb,null),d=s.get(qf,null),f={rendererFactory:u,sanitizer:c,inlineEffectRunner:null,afterRenderEventManager:l,changeDetectionScheduler:d},h=u.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",m=r?pT(h,r,this.componentDef.encapsulation,s):Vc(h,p,xM(p)),g=512;this.componentDef.signals?g|=4096:this.componentDef.onPush||(g|=16);let v=null;m!==null&&(v=Rh(m,s,!0));let b=Wh(0,null,null,1,0,null,null,null,null,null,null),x=Wc(null,b,null,g,null,null,f,h,s,null,v);wh(x);let y,w;try{let C=this.componentDef,T,S=null;C.findHostDirectiveDefs?(T=[],S=new Map,C.findHostDirectiveDefs(C,T,S),T.push(C)):T=[C];let I=wM(x,m),_=CM(I,m,C,T,x,f,h);w=Zy(b,sn),m&&IM(h,C,m,r),e!==void 0&&_M(w,this.ngContentSelectors,e),y=EM(_,C,T,S,x,[SM]),zh(b,x,null)}finally{Ch()}return new Jf(this.componentType,y,ji(w,x),x,w)}finally{Oe(i)}}},Jf=class extends Kf{constructor(n,e,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new To(o,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;Hh(i[ve],i,o,n,e),this.previousInputValues.set(n,e);let a=Ro(this._tNode.index,i);$h(a)}}get injector(){return new Co(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function wM(t,n){let e=t[ve],r=sn;return t[r]=n,Hc(e,r,2,"#host",null)}function CM(t,n,e,r,o,i,a){let s=o[ve];DM(r,t,n,a);let u=null;n!==null&&(u=Rh(n,o[ki]));let c=i.rendererFactory.createRenderer(n,e),l=16;e.signals?l=4096:e.onPush&&(l=64);let d=Wc(o,ub(e),null,l,o[t.index],t,i,c,null,null,u);return s.firstCreatePass&&zf(s,t,r.length-1),zc(o,d),o[t.index]=d}function DM(t,n,e,r){for(let o of t)n.mergedAttrs=fh(n.mergedAttrs,o.hostAttrs);n.mergedAttrs!==null&&(Qf(n,n.mergedAttrs,!0),e!==null&&J0(r,e,n))}function EM(t,n,e,r,o,i){let a=ir(),s=o[ve],u=Dn(a,o);db(s,o,a,e,null,r);for(let l=0;l<e.length;l++){let d=a.directiveStart+l,f=Pi(o,s,d,a);So(f,o)}fb(s,o,a),u&&So(u,o);let c=Pi(o,s,a.directiveStart+a.componentOffset,a);if(t[Bn]=o[Bn]=c,i!==null)for(let l of i)l(c,n);return ib(s,a,o),c}function IM(t,n,e,r){if(r)_f(t,e,["ng-version","17.3.12"]);else{let{attrs:o,classes:i}=i_(n.selectors[0]);o&&_f(t,e,o),i&&i.length>0&&Z0(t,e,i.join(" "))}}function _M(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null?Array.from(i):null)}}function SM(){let t=ir();Eh(ut()[ve],t)}var Oo=(()=>{class t{static{this.__NG_ELEMENT_ID__=TM}}return t})();function TM(){let t=ir();return Mb(t,ut())}var MM=Oo,Tb=class extends MM{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return ji(this._hostTNode,this._hostLView)}get injector(){return new Co(this._hostTNode,this._hostLView)}get parentInjector(){let n=Ih(this._hostTNode,this._hostLView);if(p0(n)){let e=hc(n,this._hostLView),r=fc(n),o=e[ve].data[r+8];return new Co(o,e)}else return new Co(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=my(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-Qt}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let a=cy(this._lContainer,n.ssrId),s=n.createEmbeddedViewImpl(e||{},i,a);return this.insertImpl(s,o,uy(this._hostTNode,a)),s}createComponent(n,e,r,o,i){let a=n&&!w_(n),s;if(a)s=e;else{let p=e||{};s=p.index,r=p.injector,o=p.projectableNodes,i=p.environmentInjector||p.ngModuleRef}let u=a?n:new ts(Eo(n)),c=r||this.parentInjector;if(!i&&u.ngModule==null){let m=(a?c:this.parentInjector).get(wn,null);m&&(i=m)}let l=Eo(u.componentType??{}),d=cy(this._lContainer,l?.id??null),f=d?.firstChild??null,h=u.create(c,o,f,i);return this.insertImpl(h.hostView,s,uy(this._hostTNode,d)),h}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(R_(o)){let s=this.indexOf(n);if(s!==-1)this.detach(s);else{let u=o[Dt],c=new Tb(u,u[Vn],u[Dt]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),a=this._lContainer;return VT(a,o,i,r),n.attachToViewContainerRef(),Ry(Cf(a),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=my(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=Wf(this._lContainer,e);r&&(uc(Cf(this._lContainer),e),K0(r[ve],r))}detach(n){let e=this._adjustIndex(n,-1),r=Wf(this._lContainer,e);return r&&uc(Cf(this._lContainer),e)!=null?new To(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function my(t){return t[lc]}function Cf(t){return t[lc]||(t[lc]=[])}function Mb(t,n){let e,r=n[t.index];return or(r)?e=r:(e=hb(r,n,null,t),n[t.index]=e,zc(n,e)),Rb(e,n,t,r),new Tb(e,t,n)}function RM(t,n){let e=t[bt],r=e.createComment(""),o=Dn(n,t),i=Lh(e,o);return vc(e,i,r,oT(e,o),!1),r}var Rb=Ab,Kh=()=>!1;function AM(t,n,e){return Kh(t,n,e)}function Ab(t,n,e,r){if(t[Er])return;let o;e.type&8?o=rr(r):o=RM(n,e),t[Er]=o}function NM(t,n,e){if(t[Er]&&t[Ya])return!0;let r=e[Ln],o=n.index-sn;if(!r||vS(n)||jc(r,o))return!1;let a=Uf(r,o),s=r.data[Mh]?.[o],[u,c]=cM(a,s);return t[Er]=u,t[Ya]=c,!0}function kM(t,n,e,r){Kh(t,e,n)||Ab(t,n,e,r)}function FM(){Rb=kM,Kh=NM}var eh=class t{constructor(n){this.queryList=n,this.matches=null}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},th=class t{constructor(n=[]){this.queries=n}createEmbeddedView(n){let e=n.queries;if(e!==null){let r=n.contentQueries!==null?n.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){let a=e.getByIndex(i),s=this.queries[a.indexInDeclarationView];o.push(s.clone())}return new t(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)Xh(n,e).matches!==null&&this.queries[e].setDirty()}},nh=class{constructor(n,e,r=null){this.flags=e,this.read=r,typeof n=="string"?this.predicate=WM(n):this.predicate=n}},rh=class t{constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){let o=e!==null?e.length:0,i=this.getByIndex(r).embeddedTView(n,o);i&&(i.indexInDeclarationView=r,e!==null?e.push(i):e=[i])}return e!==null?new t(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},oh=class t{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new t(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,r=n.parent;for(;r!==null&&r.type&8&&r.index!==e;)r=r.parent;return e===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){let r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){let i=r[o];this.matchTNodeWithReadOption(n,e,PM(e,i)),this.matchTNodeWithReadOption(n,e,rc(e,n,i,!1,!1))}else r===Oi?e.type&4&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,rc(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(r!==null){let o=this.metadata.read;if(o!==null)if(o===No||o===Oo||o===Oi&&e.type&4)this.addMatch(e.index,-2);else{let i=rc(e,n,o,!1,!1);i!==null&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(n,e){this.matches===null?this.matches=[n,e]:this.matches.push(n,e)}};function PM(t,n){let e=t.localNames;if(e!==null){for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1]}return null}function OM(t,n){return t.type&11?ji(t,n):t.type&4?Gh(t,n):null}function LM(t,n,e,r){return e===-1?OM(n,t):e===-2?BM(t,n,r):Pi(t,t[ve],e,n)}function BM(t,n,e){if(e===No)return ji(n,t);if(e===Oi)return Gh(n,t);if(e===Oo)return Mb(n,t)}function Nb(t,n,e,r){let o=n[Dr].queries[r];if(o.matches===null){let i=t.data,a=e.matches,s=[];for(let u=0;a!==null&&u<a.length;u+=2){let c=a[u];if(c<0)s.push(null);else{let l=i[c];s.push(LM(n,l,a[u+1],e.metadata.read))}}o.matches=s}return o.matches}function ih(t,n,e,r){let o=t.queries.getByIndex(e),i=o.matches;if(i!==null){let a=Nb(t,n,o,e);for(let s=0;s<i.length;s+=2){let u=i[s];if(u>0)r.push(a[s/2]);else{let c=i[s+1],l=n[-u];for(let d=Qt;d<l.length;d++){let f=l[d];f[rs]===f[Dt]&&ih(f[ve],f,c,r)}if(l[Fi]!==null){let d=l[Fi];for(let f=0;f<d.length;f++){let h=d[f];ih(h[ve],h,c,r)}}}}}return r}function jM(t,n){return t[Dr].queries[n].queryList}function VM(t,n,e){let r=new Bf((e&4)===4);return yT(t,n,r,r.destroy),(n[Dr]??=new th).queries.push(new eh(r))-1}function UM(t,n,e){let r=_r();return r.firstCreatePass&&(HM(r,new nh(t,n,e),-1),(n&2)===2&&(r.staticViewQueries=!0)),VM(r,ut(),n)}function WM(t){return t.split(",").map(n=>n.trim())}function HM(t,n,e){t.queries===null&&(t.queries=new rh),t.queries.track(new oh(n,e))}function Xh(t,n){return t.queries.getByIndex(n)}function zM(t,n){let e=t[ve],r=Xh(e,n);return r.crossesNgTemplate?ih(e,t,n,[]):Nb(e,t,r,n)}var Jr=class{},ns=class{};var ah=class extends Jr{constructor(n,e,r){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new wc(this);let o=By(n);this._bootstrapComponents=$0(o.bootstrap),this._r3Injector=E0(n,e,[{provide:Jr,useValue:this},{provide:qc,useValue:this.componentFactoryResolver},...r],Yt(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},sh=class extends ns{constructor(n){super(),this.moduleType=n}create(n){return new ah(this.moduleType,n,[])}};var Cc=class extends Jr{constructor(n){super(),this.componentFactoryResolver=new wc(this),this.instance=null;let e=new qa([...n.providers,{provide:Jr,useValue:this},{provide:qc,useValue:this.componentFactoryResolver}],n.parent||mh(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function Yh(t,n,e=null){return new Cc({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var cs=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new At(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function $M(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function ls(t){return(t.flags&32)===32}function GM(t,n,e,r,o,i,a,s,u){let c=n.consts,l=Hc(n,t,4,a||null,dc(c,s));lb(n,e,l,dc(c,u)),Eh(n,l);let d=l.tView=Wh(2,l,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,l),d.queries=n.queries.embeddedTView(l)),l}function Qh(t,n,e,r,o,i,a,s){let u=ut(),c=_r(),l=t+sn,d=c.firstCreatePass?GM(l,c,u,n,e,r,o,i,a):c.data[l];ss(d,!1);let f=kb(c,u,d,t);Dh()&&Bh(c,u,f,d),So(f,u);let h=hb(f,u,f,d);return u[l]=h,zc(u,h),AM(h,d,u),vh(d)&&ab(c,u,d),a!=null&&sb(u,d,s),Qh}var kb=Fb;function Fb(t,n,e,r){return ar(!0),n[bt].createComment("")}function qM(t,n,e,r){let o=n[Ln],i=!o||as()||ls(e)||jc(o,r);if(ar(i),i)return Fb(t,n,e,r);let a=o.data[_S]?.[r]??null;a!==null&&e.tView!==null&&e.tView.ssrId===null&&(e.tView.ssrId=a);let s=$c(o,t,n,e);Bc(o,r,s);let u=Ah(o,r);return Gc(u,s)}function KM(){kb=qM}function Kc(t,n,e){let r=ut(),o=H_();if($M(r,o,n)){let i=_r(),a=X_();CT(i,a,r,t,n,r[bt],e,!1)}return Kc}function gy(t,n,e,r,o){let i=n.inputs,a=o?"class":"style";Hh(t,e,i[a],a,r)}function XM(t,n,e,r,o,i){let a=n.consts,s=dc(a,o),u=Hc(n,t,2,r,s);return lb(n,e,u,dc(a,i)),u.attrs!==null&&Qf(u,u.attrs,!1),u.mergedAttrs!==null&&Qf(u,u.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,u),u}function Sr(t,n,e,r){let o=ut(),i=_r(),a=sn+t,s=o[bt],u=i.firstCreatePass?XM(a,i,o,n,e,r):i.data[a],c=Pb(i,o,u,s,n,t);o[a]=c;let l=vh(u);return ss(u,!0),J0(s,c,u),!ls(u)&&Dh()&&Bh(i,o,c,u),F_()===0&&So(c,o),P_(),l&&(ab(i,o,u),ib(i,u,o)),r!==null&&sb(o,u),Sr}function Un(){let t=ir();r0()?U_():(t=t.parent,ss(t,!1));let n=t;L_(n)&&j_(),O_();let e=_r();return e.firstCreatePass&&(Eh(e,t),Gy(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&J_(n)&&gy(e,n,ut(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&eS(n)&&gy(e,n,ut(),n.stylesWithoutHost,!1),Un}function to(t,n,e,r){return Sr(t,n,e,r),Un(),to}var Pb=(t,n,e,r,o,i)=>(ar(!0),Vc(r,o,d0()));function YM(t,n,e,r,o,i){let a=n[Ln],s=!a||as()||ls(e)||jc(a,i);if(ar(s),s)return Vc(r,o,d0());let u=$c(a,t,n,e);return j0(a,i)&&Bc(a,i,u.nextSibling),a&&(S0(e)||T0(u))&&os(e)&&(B_(e),Q0(u)),u}function QM(){Pb=YM}var ZM=(t,n,e,r)=>(ar(!0),Oh(n[bt],""));function JM(t,n,e,r){let o,i=n[Ln],a=!i||as()||ls(e);if(ar(a),a)return Oh(n[bt],"");let s=$c(i,t,n,e),u=LS(i,r);return Bc(i,r,s),o=Gc(u,s),o}function eR(){ZM=JM}function Ob(){return ut()}var Dc="en-US";var tR=Dc;function nR(t){typeof t=="string"&&(tR=t.toLowerCase().replace(/_/g,"-"))}function Lb(t,n,e){let r=t[bt];switch(e){case Node.COMMENT_NODE:return Oh(r,n);case Node.TEXT_NODE:return Ph(r,n);case Node.ELEMENT_NODE:return Vc(r,n,null)}}var rR=(t,n,e,r)=>(ar(!0),Lb(t,e,r));function oR(t,n,e,r){return ar(!0),Lb(t,e,r)}function iR(){rR=oR}function Vi(t,n,e,r){let o=ut(),i=_r(),a=ir();return sR(i,o,o[bt],a,t,n,r),Vi}function aR(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let a=o[i];if(a===e&&o[i+1]===r){let s=n[Ka],u=o[i+2];return s.length>u?s[u]:null}typeof a=="string"&&(i+=2)}return null}function sR(t,n,e,r,o,i,a){let s=vh(r),c=t.firstCreatePass&&gb(t),l=n[Bn],d=mb(n),f=!0;if(r.type&3||a){let m=Dn(r,n),g=a?a(m):m,v=d.length,b=a?y=>a(rr(y[r.index])):r.index,x=null;if(!a&&s&&(x=aR(t,n,o,r.index)),x!==null){let y=x.__ngLastListenerFn__||x;y.__ngNextListenerFn__=i,x.__ngLastListenerFn__=i,f=!1}else{i=yy(r,n,l,i,!1);let y=e.listen(g,o,i);d.push(i,y),c&&c.push(o,b,v,v+1)}}else i=yy(r,n,l,i,!1);let h=r.outputs,p;if(f&&h!==null&&(p=h[o])){let m=p.length;if(m)for(let g=0;g<m;g+=2){let v=p[g],b=p[g+1],w=n[v][b].subscribe(i),C=d.length;d.push(i,w),c&&c.push(o,r.index,C,-(C+1))}}}function vy(t,n,e,r){let o=Oe(null);try{return er(6,n,e),e(r)!==!1}catch(i){return vb(t,i),!1}finally{er(7,n,e),Oe(o)}}function yy(t,n,e,r,o){return function i(a){if(a===Function)return r;let s=t.componentOffset>-1?Ro(t.index,n):n;$h(s);let u=vy(n,e,r,a),c=i.__ngNextListenerFn__;for(;c;)u=vy(n,e,c,a)&&u,c=c.__ngNextListenerFn__;return o&&u===!1&&a.preventDefault(),u}}function Bb(t=1){return K_(t)}function Zh(t,n,e){UM(t,n,e)}function Xc(t){let n=ut(),e=_r(),r=o0();xh(r+1);let o=Xh(e,r);if(t.dirty&&M_(n)===((o.metadata.flags&2)===2)){if(o.matches===null)t.reset([]);else{let i=zM(n,r);t.reset(i,hS),t.notifyOnChanges()}return!0}return!1}function Yc(){return jM(ut(),o0())}function Ui(t,n=""){let e=ut(),r=_r(),o=t+sn,i=r.firstCreatePass?Hc(r,o,1,n,null):r.data[o],a=jb(r,e,i,n,t);e[o]=a,Dh()&&Bh(r,e,a,i),ss(i,!1)}var jb=(t,n,e,r,o)=>(ar(!0),Ph(n[bt],r));function uR(t,n,e,r,o){let i=n[Ln],a=!i||as()||ls(e)||jc(i,o);return ar(a),a?Ph(n[bt],r):$c(i,t,n,e)}function cR(){jb=uR}var lR=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=Uy(!1,e.type),o=r.length>0?Yh([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=he({token:t,providedIn:"environment",factory:()=>new t(Ne(wn))})}}return t})();function Wi(t){us("NgStandalone"),t.getStandaloneInjector=n=>n.get(lR).getOrCreateStandaloneInjector(t)}var Qc=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();var Vb=new xe("");function ds(t){return!!t&&typeof t.then=="function"}function Ub(t){return!!t&&typeof t.subscribe=="function"}var Wb=new xe(""),Hb=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),this.appInits=X(Wb,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=o();if(ds(i))e.push(i);else if(Ub(i)){let a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});e.push(a)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Hi=new xe("");function dR(){dv(()=>{throw new ce(600,!1)})}function fR(t){return t.isBoundToModule}function hR(t,n,e){try{let r=e();return ds(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var no=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=X(I0),this.afterRenderEffectManager=X(Sb),this.externalTestViews=new Set,this.beforeRender=new Ht,this.afterTick=new Ht,this.componentTypes=[],this.components=[],this.isStable=X(cs).hasPendingTasks.pipe(Se(e=>!e)),this._injector=X(wn)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,r){let o=e instanceof xc;if(!this._injector.get(Hb).done){let f=!o&&Ly(e),h=!1;throw new ce(405,h)}let a;o?a=e:a=this._injector.get(qc).resolveComponentFactory(e),this.componentTypes.push(a.componentType);let s=fR(a)?void 0:this._injector.get(Jr),u=r||a.selector,c=a.create(Ao.NULL,[],u,s),l=c.location.nativeElement,d=c.injector.get(Vb,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),Df(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){this._tick(!0)}_tick(e){if(this._runningTick)throw new ce(101,!1);let r=Oe(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(e)}catch(o){this.internalErrorHandler(o)}finally{this.afterTick.next(),this._runningTick=!1,Oe(r)}}detectChangesInAttachedViews(e){let r=0,o=this.afterRenderEffectManager;for(;;){if(r===bb)throw new ce(103,!1);if(e){let i=r===0;this.beforeRender.next(i);for(let{_lView:a,notifyErrorHandler:s}of this._views)pR(a,i,s)}if(r++,o.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:i})=>uh(i))&&(o.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:i})=>uh(i))))break}}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;Df(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);let r=this._injector.get(Hi,[]);[...this._bootstrapListeners,...r].forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Df(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new ce(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Df(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var Ju;function Jh(t){Ju??=new WeakMap;let n=Ju.get(t);if(n)return n;let e=t.isStable.pipe(kn(r=>r)).toPromise().then(()=>{});return Ju.set(t,e),t.onDestroy(()=>Ju?.delete(t)),e}function pR(t,n,e){!n&&!uh(t)||mR(t,e,n)}function uh(t){return bh(t)}function mR(t,n,e){let r;e?(r=0,t[se]|=1024):t[se]&64?r=0:r=1,xb(t,n,r)}var ch=class{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},ep=(()=>{class t{compileModuleSync(e){return new sh(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=By(e),i=$0(o.declarations).reduce((a,s)=>{let u=Eo(s);return u&&a.push(new ts(u)),a},[]);return new ch(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var gR=(()=>{class t{constructor(){this.zone=X(st),this.applicationRef=X(no)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function vR(t){return[{provide:st,useFactory:t},{provide:Do,multi:!0,useFactory:()=>{let n=X(gR,{optional:!0});return()=>n.initialize()}},{provide:Do,multi:!0,useFactory:()=>{let n=X(wR);return()=>{n.initialize()}}},{provide:I0,useFactory:yR}]}function yR(){let t=X(st),n=X(Ir);return e=>t.runOutsideAngular(()=>n.handleError(e))}function bR(t){let n=vR(()=>new st(xR(t)));return Mo([[],n])}function xR(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var wR=(()=>{class t{constructor(){this.subscription=new gt,this.initialized=!1,this.zone=X(st),this.pendingTasks=X(cs)}initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{st.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{st.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function CR(){return typeof $localize<"u"&&$localize.locale||Dc}var tp=new xe("",{providedIn:"root",factory:()=>X(tp,we.Optional|we.SkipSelf)||CR()});var zb=new xe("");var ic=null;function DR(t=[],n){return Ao.create({name:n,providers:[{provide:Ac,useValue:"platform"},{provide:zb,useValue:new Set([()=>ic=null])},...t]})}function ER(t=[]){if(ic)return ic;let n=DR(t);return ic=n,dR(),IR(n),n}function IR(t){t.get(Sh,null)?.forEach(e=>e())}var fs=(()=>{class t{static{this.__NG_ELEMENT_ID__=_R}}return t})();function _R(t){return SR(ir(),ut(),(t&16)===16)}function SR(t,n,e){if(os(t)&&!e){let r=Ro(t.index,n);return new To(r,r)}else if(t.type&47){let r=n[Cn];return new To(r,n)}return null}function $b(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=ER(r),i=[bR(),...e||[]],s=new Cc({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1}).injector,u=s.get(st);return u.run(()=>{s.resolveInjectorInitializers();let c=s.get(Ir,null),l;u.runOutsideAngular(()=>{l=u.onError.subscribe({next:h=>{c.handleError(h)}})});let d=()=>s.destroy(),f=o.get(zb);return f.add(d),s.onDestroy(()=>{l.unsubscribe(),f.delete(d)}),hR(c,u,()=>{let h=s.get(Hb);return h.runInitializers(),h.donePromise.then(()=>{let p=s.get(tp,Dc);nR(p||Dc);let m=s.get(no);return n!==void 0&&m.bootstrap(n),m})})})}catch(n){return Promise.reject(n)}}var by=!1,TR=!1;function MR(){by||(by=!0,kS(),QM(),cR(),eR(),KM(),FM(),dM(),vT(),iR())}function RR(t,n){return Jh(t)}function Gb(){return Mo([{provide:Qu,useFactory:()=>{let t=!0;return Zu()&&(t=!!X(ko,{optional:!0})?.get(L0,null)),t&&us("NgHydration"),t}},{provide:Do,useValue:()=>{TR=!!X(BS,{optional:!0}),Zu()&&X(Qu)&&(AR(),MR())},multi:!0},{provide:U0,useFactory:()=>Zu()&&X(Qu)},{provide:Hi,useFactory:()=>{if(Zu()&&X(Qu)){let t=X(no),n=X(Ao);return()=>{RR(t,n).then(()=>{nM(t)})}}return()=>{}},multi:!0}])}function AR(){let t=Oc(),n;for(let e of t.body.childNodes)if(e.nodeType===Node.COMMENT_NODE&&e.textContent?.trim()===AS){n=e;break}if(!n)throw new ce(-507,!1)}var Zb=null;function zi(){return Zb}function Jb(t){Zb??=t}var Zc=class{};var un=new xe(""),ex=(()=>{class t{historyGo(e){throw new Error("")}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(PR),providedIn:"platform"})}}return t})();var PR=(()=>{class t extends ex{constructor(){super(),this._doc=X(un),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return zi().getBaseHref(this._doc)}onPopState(e){let r=zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>new t,providedIn:"platform"})}}return t})();function tx(t,n){if(t.length==0)return n;if(n.length==0)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,e==2?t+n.substring(1):e==1?t+n:t+"/"+n}function qb(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function Lo(t){return t&&t[0]!=="?"?"?"+t:t}var el=(()=>{class t{historyGo(e){throw new Error("")}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(nx),providedIn:"root"})}}return t})(),OR=new xe(""),nx=(()=>{class t extends el{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??X(un).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return tx(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Lo(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let a=this.prepareExternalUrl(o+Lo(i));this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){let a=this.prepareExternalUrl(o+Lo(i));this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(r){return new(r||t)(Ne(ex),Ne(OR,8))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ps=(()=>{class t{constructor(e){this._subject=new xn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=jR(qb(Kb(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Lo(r))}normalize(e){return t.stripTrailingSlash(BR(this._basePath,Kb(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Lo(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Lo(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r,complete:o})}static{this.normalizeQueryParams=Lo}static{this.joinWithSlash=tx}static{this.stripTrailingSlash=qb}static{this.\u0275fac=function(r){return new(r||t)(Ne(el))}}static{this.\u0275prov=he({token:t,factory:()=>LR(),providedIn:"root"})}}return t})();function LR(){return new ps(Ne(el))}function BR(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function Kb(t){return t.replace(/\/index.html$/,"")}function jR(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}function rp(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var rx=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new np,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Xb("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Xb("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}static{this.\u0275fac=function(r){return new(r||t)(Po(Oo),Po(Oi))}}static{this.\u0275dir=Rc({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return t})(),np=class{constructor(){this.$implicit=null,this.ngIf=null}};function Xb(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Yt(n)}'.`)}var ms=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=Mc({type:t})}static{this.\u0275inj=_c({})}}return t})(),op="browser",VR="server";function ox(t){return t===op}function gs(t){return t===VR}var Jc=class{};var nl=class t{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=o.toLowerCase(),a=e.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.setHeaderEntries(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let a=this.headers.get(e);if(!a)return;a=a.filter(s=>i.indexOf(s)===-1),a.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}break}}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var fx=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(fx||{}),ip=class{constructor(n,e=hx.Ok,r="OK"){this.headers=n.headers||new nl,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}};var rl=class t extends ip{constructor(n={}){super(n),this.type=fx.Response,this.body=n.body!==void 0?n.body:null}clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}};var hx=function(t){return t[t.Continue=100]="Continue",t[t.SwitchingProtocols=101]="SwitchingProtocols",t[t.Processing=102]="Processing",t[t.EarlyHints=103]="EarlyHints",t[t.Ok=200]="Ok",t[t.Created=201]="Created",t[t.Accepted=202]="Accepted",t[t.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",t[t.NoContent=204]="NoContent",t[t.ResetContent=205]="ResetContent",t[t.PartialContent=206]="PartialContent",t[t.MultiStatus=207]="MultiStatus",t[t.AlreadyReported=208]="AlreadyReported",t[t.ImUsed=226]="ImUsed",t[t.MultipleChoices=300]="MultipleChoices",t[t.MovedPermanently=301]="MovedPermanently",t[t.Found=302]="Found",t[t.SeeOther=303]="SeeOther",t[t.NotModified=304]="NotModified",t[t.UseProxy=305]="UseProxy",t[t.Unused=306]="Unused",t[t.TemporaryRedirect=307]="TemporaryRedirect",t[t.PermanentRedirect=308]="PermanentRedirect",t[t.BadRequest=400]="BadRequest",t[t.Unauthorized=401]="Unauthorized",t[t.PaymentRequired=402]="PaymentRequired",t[t.Forbidden=403]="Forbidden",t[t.NotFound=404]="NotFound",t[t.MethodNotAllowed=405]="MethodNotAllowed",t[t.NotAcceptable=406]="NotAcceptable",t[t.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",t[t.RequestTimeout=408]="RequestTimeout",t[t.Conflict=409]="Conflict",t[t.Gone=410]="Gone",t[t.LengthRequired=411]="LengthRequired",t[t.PreconditionFailed=412]="PreconditionFailed",t[t.PayloadTooLarge=413]="PayloadTooLarge",t[t.UriTooLong=414]="UriTooLong",t[t.UnsupportedMediaType=415]="UnsupportedMediaType",t[t.RangeNotSatisfiable=416]="RangeNotSatisfiable",t[t.ExpectationFailed=417]="ExpectationFailed",t[t.ImATeapot=418]="ImATeapot",t[t.MisdirectedRequest=421]="MisdirectedRequest",t[t.UnprocessableEntity=422]="UnprocessableEntity",t[t.Locked=423]="Locked",t[t.FailedDependency=424]="FailedDependency",t[t.TooEarly=425]="TooEarly",t[t.UpgradeRequired=426]="UpgradeRequired",t[t.PreconditionRequired=428]="PreconditionRequired",t[t.TooManyRequests=429]="TooManyRequests",t[t.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",t[t.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",t[t.InternalServerError=500]="InternalServerError",t[t.NotImplemented=501]="NotImplemented",t[t.BadGateway=502]="BadGateway",t[t.ServiceUnavailable=503]="ServiceUnavailable",t[t.GatewayTimeout=504]="GatewayTimeout",t[t.HttpVersionNotSupported=505]="HttpVersionNotSupported",t[t.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",t[t.InsufficientStorage=507]="InsufficientStorage",t[t.LoopDetected=508]="LoopDetected",t[t.NotExtended=510]="NotExtended",t[t.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",t}(hx||{});var HR=new xe("");var ix="b",ax="h",sx="s",ux="st",cx="u",lx="rt",tl=new xe(""),zR=["GET","HEAD"];function $R(t,n){let d=X(tl),{isCacheActive:e}=d,r=ov(d,["isCacheActive"]),{transferCache:o,method:i}=t;if(!e||i==="POST"&&!r.includePostRequests&&!o||i!=="POST"&&!zR.includes(i)||o===!1||r.filter?.(t)===!1)return n(t);let a=X(ko),s=qR(t),u=a.get(s,null),c=r.includeHeaders;if(typeof o=="object"&&o.includeHeaders&&(c=o.includeHeaders),u){let{[ix]:f,[lx]:h,[ax]:p,[sx]:m,[ux]:g,[cx]:v}=u,b=f;switch(h){case"arraybuffer":b=new TextEncoder().encode(f).buffer;break;case"blob":b=new Blob([f]);break}let x=new nl(p);return le(new rl({body:b,headers:x,status:m,statusText:g,url:v}))}let l=gs(X(En));return n(t).pipe(yt(f=>{f instanceof rl&&l&&a.set(s,{[ix]:f.body,[ax]:GR(f.headers,c),[sx]:f.status,[ux]:f.statusText,[cx]:f.url||"",[lx]:t.responseType})}))}function GR(t,n){if(!n)return{};let e={};for(let r of n){let o=t.getAll(r);o!==null&&(e[r]=o)}return e}function dx(t){return[...t.keys()].sort().map(n=>`${n}=${t.getAll(n)}`).join("&")}function qR(t){let{params:n,method:e,responseType:r,url:o}=t,i=dx(n),a=t.serializeBody();a instanceof URLSearchParams?a=dx(a):typeof a!="string"&&(a="");let s=[e,r,o,a,i].join("|"),u=KR(s);return u}function KR(t){let n=0;for(let e of t)n=Math.imul(31,n)+e.charCodeAt(0)<<0;return n+=2147483648,n.toString()}function px(t){return[{provide:tl,useFactory:()=>(us("NgHttpTransferCache"),re({isCacheActive:!0},t))},{provide:HR,useValue:$R,multi:!0,deps:[ko,tl]},{provide:Hi,multi:!0,useFactory:()=>{let n=X(no),e=X(tl);return()=>{Jh(n).then(()=>{e.isCacheActive=!1})}}}]}var up=class extends Zc{constructor(){super(...arguments),this.supportsDOMEvents=!0}},cp=class t extends up{static makeCurrent(){Jb(new t)}onAndCancel(n,e,r){return n.addEventListener(e,r),()=>{n.removeEventListener(e,r)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=YR();return e==null?null:QR(e)}resetBaseElement(){vs=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return rp(document.cookie,n)}},vs=null;function YR(){return vs=vs||document.querySelector("base"),vs?vs.getAttribute("href"):null}function QR(t){return new URL(t,document.baseURI).pathname}var ZR=(()=>{class t{build(){return new XMLHttpRequest}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})(),lp=new xe(""),yx=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o){return this._findPluginFor(r).addEventListener(e,r,o)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new ce(5101,!1);return this._eventNameToPlugin.set(e,r),r}static{this.\u0275fac=function(r){return new(r||t)(Ne(lp),Ne(st))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})(),ol=class{constructor(n){this._doc=n}},ap="ng-app-id",bx=(()=>{class t{constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=gs(i),this.resetHostNodes()}addStyles(e){for(let r of e)this.changeUsageCount(r,1)===1&&this.onStyleAdded(r)}removeStyles(e){for(let r of e)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){let e=this.styleNodesInDOM;e&&(e.forEach(r=>r.remove()),e.clear());for(let r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(let r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(let r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){let r=this.styleRef;r.get(e)?.elements?.forEach(o=>o.remove()),r.delete(e)}collectServerRenderedStyles(){let e=this.doc.head?.querySelectorAll(`style[${ap}="${this.appId}"]`);if(e?.length){let r=new Map;return e.forEach(o=>{o.textContent!=null&&r.set(o.textContent,o)}),r}return null}changeUsageCount(e,r){let o=this.styleRef;if(o.has(e)){let i=o.get(e);return i.usage+=r,i.usage}return o.set(e,{usage:r,elements:[]}),r}getStyleElement(e,r){let o=this.styleNodesInDOM,i=o?.get(r);if(i?.parentNode===e)return o.delete(r),i.removeAttribute(ap),i;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=r,this.platformIsServer&&a.setAttribute(ap,this.appId),e.appendChild(a),a}}addStyleToHost(e,r){let o=this.getStyleElement(e,r),i=this.styleRef,a=i.get(r)?.elements;a?a.push(o):i.set(r,{elements:[o],usage:1})}resetHostNodes(){let e=this.hostNodes;e.clear(),e.add(this.doc.head)}static{this.\u0275fac=function(r){return new(r||t)(Ne(un),Ne(Lc),Ne(Th,8),Ne(En))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})(),sp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},hp=/%COMP%/g,xx="%COMP%",JR=`_nghost-${xx}`,eA=`_ngcontent-${xx}`,tA=!0,nA=new xe("",{providedIn:"root",factory:()=>tA});function rA(t){return eA.replace(hp,t)}function oA(t){return JR.replace(hp,t)}function wx(t,n){return n.map(e=>e.replace(hp,t))}var mx=(()=>{class t{constructor(e,r,o,i,a,s,u,c=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=a,this.platformId=s,this.ngZone=u,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=gs(s),this.defaultRenderer=new ys(e,a,u,this.platformIsServer)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===nr.ShadowDom&&(r=lt(re({},r),{encapsulation:nr.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof il?o.applyToHost(e):o instanceof bs&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let a=this.doc,s=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,l=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(r.encapsulation){case nr.Emulated:i=new il(u,c,r,this.appId,l,a,s,d);break;case nr.ShadowDom:return new dp(u,c,e,r,a,s,this.nonce,d);default:i=new bs(u,c,r,l,a,s,d);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(r){return new(r||t)(Ne(yx),Ne(bx),Ne(Lc),Ne(nA),Ne(un),Ne(En),Ne(st),Ne(Th))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})(),ys=class{constructor(n,e,r,o){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,e){return e?this.doc.createElementNS(sp[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(gx(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(gx(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new ce(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=sp[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=sp[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(Fo.DashCase|Fo.Important)?n.style.setProperty(e,r,o&Fo.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&Fo.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r){if(typeof n=="string"&&(n=zi().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);return this.eventManager.addEventListener(n,e,this.decoratePreventDefault(r))}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function gx(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var dp=class extends ys{constructor(n,e,r,o,i,a,s,u){super(n,i,a,u),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=wx(o.id,o.styles);for(let l of c){let d=document.createElement("style");s&&d.setAttribute("nonce",s),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},bs=class extends ys{constructor(n,e,r,o,i,a,s,u){super(n,i,a,s),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o,this.styles=u?wx(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},il=class extends bs{constructor(n,e,r,o,i,a,s,u){let c=o+"-"+r.id;super(n,e,r,i,a,s,u,c),this.contentAttr=rA(c),this.hostAttr=oA(c)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},iA=(()=>{class t extends ol{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o){return e.addEventListener(r,o,!1),()=>this.removeEventListener(e,r,o)}removeEventListener(e,r,o){return e.removeEventListener(r,o)}static{this.\u0275fac=function(r){return new(r||t)(Ne(un))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})(),vx=["alt","control","meta","shift"],aA={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},sA={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},uA=(()=>{class t extends ol{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o){let i=t.parseEventName(r),a=t.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>zi().onAndCancel(e,i.domEventName,a))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),a="",s=r.indexOf("code");if(s>-1&&(r.splice(s,1),a="code."),vx.forEach(c=>{let l=r.indexOf(c);l>-1&&(r.splice(l,1),a+=c+".")}),a+=i,r.length!=0||i.length===0)return null;let u={};return u.domEventName=o,u.fullKey=a,u}static matchEventFullKeyCode(e,r){let o=aA[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),vx.forEach(a=>{if(a!==o){let s=sA[a];s(e)&&(i+=a+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static{this.\u0275fac=function(r){return new(r||t)(Ne(un))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac})}}return t})();function Cx(t,n){return $b(re({rootComponent:t},cA(n)))}function cA(t){return{appProviders:[...pA,...t?.providers??[]],platformProviders:hA}}function lA(){cp.makeCurrent()}function dA(){return new Ir}function fA(){return k0(document),document}var hA=[{provide:En,useValue:op},{provide:Sh,useValue:lA,multi:!0},{provide:un,useFactory:fA,deps:[]}];var pA=[{provide:Ac,useValue:"root"},{provide:Ir,useFactory:dA,deps:[]},{provide:lp,useClass:iA,multi:!0,deps:[un,st,En]},{provide:lp,useClass:uA,multi:!0,deps:[un]},mx,bx,yx,{provide:es,useExisting:mx},{provide:Jc,useClass:ZR,deps:[]},[]];var Dx=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static{this.\u0275fac=function(r){return new(r||t)(Ne(un))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var fp=function(t){return t[t.NoHttpTransferCache=0]="NoHttpTransferCache",t[t.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",t}(fp||{});function Ex(...t){let n=[],e=new Set,r=e.has(fp.HttpTransferCacheOptions);for(let{\u0275providers:o,\u0275kind:i}of t)e.add(i),o.length&&n.push(o);return Mo([[],Gb(),e.has(fp.NoHttpTransferCache)||r?[]:px({}),n])}var me="primary",Fs=Symbol("RouteTitle"),yp=class{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Xi(t){return new yp(t)}function gA(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function vA(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!sr(t[e],n[e]))return!1;return!0}function sr(t,n){let e=t?bp(t):void 0,r=n?bp(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!Rx(t[o],n[o]))return!1;return!0}function bp(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function Rx(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function Ax(t){return t.length>0?t[t.length-1]:null}function io(t){return of(t)?t:ds(t)?dt(Promise.resolve(t)):le(t)}var yA={exact:kx,subset:Fx},Nx={exact:bA,subset:xA,ignored:()=>!0};function Ix(t,n,e){return yA[e.paths](t.root,n.root,e.matrixParams)&&Nx[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function bA(t,n){return sr(t,n)}function kx(t,n,e){if(!jo(t.segments,n.segments)||!ul(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!kx(t.children[r],n.children[r],e))return!1;return!0}function xA(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>Rx(t[e],n[e]))}function Fx(t,n,e){return Px(t,n,n.segments,e)}function Px(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!jo(o,e)||n.hasChildren()||!ul(o,e,r))}else if(t.segments.length===e.length){if(!jo(t.segments,e)||!ul(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!Fx(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!jo(t.segments,o)||!ul(t.segments,o,r)||!t.children[me]?!1:Px(t.children[me],n,i,r)}}function ul(t,n,e){return n.every((r,o)=>Nx[e](t[o].parameters,r.parameters))}var ro=class{constructor(n=new Be([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Xi(this.queryParams),this._queryParamMap}toString(){return DA.serialize(this)}},Be=class{constructor(n,e){this.segments=n,this.children=e,this.parent=null,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return cl(this)}},Bo=class{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=Xi(this.parameters),this._parameterMap}toString(){return Lx(this)}};function wA(t,n){return jo(t,n)&&t.every((e,r)=>sr(e.parameters,n[r].parameters))}function jo(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function CA(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===me&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==me&&(e=e.concat(n(o,r)))}),e}var $p=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>new dl,providedIn:"root"})}}return t})(),dl=class{parse(n){let e=new wp(n);return new ro(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${xs(n.root,!0)}`,r=_A(n.queryParams),o=typeof n.fragment=="string"?`#${EA(n.fragment)}`:"";return`${e}${r}${o}`}},DA=new dl;function cl(t){return t.segments.map(n=>Lx(n)).join("/")}function xs(t,n){if(!t.hasChildren())return cl(t);if(n){let e=t.children[me]?xs(t.children[me],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==me&&r.push(`${o}:${xs(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=CA(t,(r,o)=>o===me?[xs(t.children[me],!1)]:[`${o}:${xs(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[me]!=null?`${cl(t)}/${e[0]}`:`${cl(t)}/(${e.join("//")})`}}function Ox(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function al(t){return Ox(t).replace(/%3B/gi,";")}function EA(t){return encodeURI(t)}function xp(t){return Ox(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ll(t){return decodeURIComponent(t)}function _x(t){return ll(t.replace(/\+/g,"%20"))}function Lx(t){return`${xp(t.path)}${IA(t.parameters)}`}function IA(t){return Object.entries(t).map(([n,e])=>`;${xp(n)}=${xp(e)}`).join("")}function _A(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${al(e)}=${al(o)}`).join("&"):`${al(e)}=${al(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var SA=/^[^\/()?;#]+/;function pp(t){let n=t.match(SA);return n?n[0]:""}var TA=/^[^\/()?;=#]+/;function MA(t){let n=t.match(TA);return n?n[0]:""}var RA=/^[^=?&#]+/;function AA(t){let n=t.match(RA);return n?n[0]:""}var NA=/^[^&#]+/;function kA(t){let n=t.match(NA);return n?n[0]:""}var wp=class{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Be([],{}):new Be([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[me]=new Be(n,e)),r}parseSegment(){let n=pp(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new ce(4009,!1);return this.capture(n),new Bo(ll(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=MA(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=pp(this.remaining);o&&(r=o,this.capture(r))}n[ll(e)]=ll(r)}parseQueryParam(n){let e=AA(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let a=kA(this.remaining);a&&(r=a,this.capture(r))}let o=_x(e),i=_x(r);if(n.hasOwnProperty(o)){let a=n[o];Array.isArray(a)||(a=[a],n[o]=a),a.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=pp(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new ce(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=me);let a=this.parseChildren();e[i]=Object.keys(a).length===1?a[me]:new Be([],a),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new ce(4011,!1)}};function Bx(t){return t.segments.length>0?new Be([],{[me]:t}):t}function jx(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=jx(o);if(r===me&&i.segments.length===0&&i.hasChildren())for(let[a,s]of Object.entries(i.children))n[a]=s;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new Be(t.segments,n);return FA(e)}function FA(t){if(t.numberOfChildren===1&&t.children[me]){let n=t.children[me];return new Be(t.segments.concat(n.segments),n.children)}return t}function Yi(t){return t instanceof ro}function PA(t,n,e=null,r=null){let o=Vx(t);return Ux(o,n,e,r)}function Vx(t){let n;function e(i){let a={};for(let u of i.children){let c=e(u);a[u.outlet]=c}let s=new Be(i.url,a);return i===t&&(n=s),s}let r=e(t.root),o=Bx(r);return n??o}function Ux(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return mp(o,o,o,e,r);let i=OA(n);if(i.toRoot())return mp(o,o,new Be([],{}),e,r);let a=LA(i,o,t),s=a.processChildren?Ds(a.segmentGroup,a.index,i.commands):Hx(a.segmentGroup,a.index,i.commands);return mp(o,a.segmentGroup,s,e,r)}function fl(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function _s(t){return typeof t=="object"&&t!=null&&t.outlets}function mp(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([u,c])=>{i[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let a;t===n?a=e:a=Wx(t,n,e);let s=Bx(jx(a));return new ro(s,i,o)}function Wx(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=Wx(i,n,e)}),new Be(t.segments,r)}var hl=class{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&fl(r[0]))throw new ce(4003,!1);let o=r.find(_s);if(o&&o!==Ax(r))throw new ce(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function OA(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new hl(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,a)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let s={};return Object.entries(i.outlets).forEach(([u,c])=>{s[u]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:s}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:a===0?(i.split("/").forEach((s,u)=>{u==0&&s==="."||(u==0&&s===""?e=!0:s===".."?n++:s!=""&&o.push(s))}),o):[...o,i]},[]);return new hl(e,n,r)}var qi=class{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function LA(t,n,e){if(t.isAbsolute)return new qi(n,!0,0);if(!e)return new qi(n,!1,NaN);if(e.parent===null)return new qi(e,!0,0);let r=fl(t.commands[0])?0:1,o=e.segments.length-1+r;return BA(e,o,t.numberOfDoubleDots)}function BA(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new ce(4005,!1);o=r.segments.length}return new qi(r,!1,o-i)}function jA(t){return _s(t[0])?t[0].outlets:{[me]:t}}function Hx(t,n,e){if(t??=new Be([],{}),t.segments.length===0&&t.hasChildren())return Ds(t,n,e);let r=VA(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new Be(t.segments.slice(0,r.pathIndex),{});return i.children[me]=new Be(t.segments.slice(r.pathIndex),t.children),Ds(i,0,o)}else return r.match&&o.length===0?new Be(t.segments,{}):r.match&&!t.hasChildren()?Cp(t,n,e):r.match?Ds(t,0,o):Cp(t,n,e)}function Ds(t,n,e){if(e.length===0)return new Be(t.segments,{});{let r=jA(e),o={};if(Object.keys(r).some(i=>i!==me)&&t.children[me]&&t.numberOfChildren===1&&t.children[me].segments.length===0){let i=Ds(t.children[me],n,e);return new Be(t.segments,i.children)}return Object.entries(r).forEach(([i,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(o[i]=Hx(t.children[i],n,a))}),Object.entries(t.children).forEach(([i,a])=>{r[i]===void 0&&(o[i]=a)}),new Be(t.segments,o)}}function VA(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let a=t.segments[o],s=e[r];if(_s(s))break;let u=`${s}`,c=r<e.length-1?e[r+1]:null;if(o>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!Tx(u,c,a))return i;r+=2}else{if(!Tx(u,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function Cp(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(_s(i)){let u=UA(i.outlets);return new Be(r,u)}if(o===0&&fl(e[0])){let u=t.segments[n];r.push(new Bo(u.path,Sx(e[0]))),o++;continue}let a=_s(i)?i.outlets[me]:`${i}`,s=o<e.length-1?e[o+1]:null;a&&s&&fl(s)?(r.push(new Bo(a,Sx(s))),o+=2):(r.push(new Bo(a,{})),o++)}return new Be(r,{})}function UA(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=Cp(new Be([],{}),0,r))}),n}function Sx(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function Tx(t,n,e){return t==e.path&&sr(n,e.parameters)}var Es="imperative",Nt=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(Nt||{}),In=class{constructor(n,e){this.id=n,this.url=e}},Ss=class extends In{constructor(n,e,r="imperative",o=null){super(n,e),this.type=Nt.NavigationStart,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Vo=class extends In{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=Nt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ln=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(ln||{}),Dp=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(Dp||{}),oo=class extends In{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=Nt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Uo=class extends In{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=Nt.NavigationSkipped}},Ts=class extends In{constructor(n,e,r,o){super(n,e),this.error=r,this.target=o,this.type=Nt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},pl=class extends In{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=Nt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ep=class extends In{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=Nt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ip=class extends In{constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i,this.type=Nt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},_p=class extends In{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=Nt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Sp=class extends In{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=Nt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Tp=class{constructor(n){this.route=n,this.type=Nt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Mp=class{constructor(n){this.route=n,this.type=Nt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Rp=class{constructor(n){this.snapshot=n,this.type=Nt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ap=class{constructor(n){this.snapshot=n,this.type=Nt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Np=class{constructor(n){this.snapshot=n,this.type=Nt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},kp=class{constructor(n){this.snapshot=n,this.type=Nt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Ms=class{},Rs=class{constructor(n){this.url=n}};var Fp=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new xl,this.attachRef=null}},xl=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new Fp,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),ml=class{constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=Pp(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=Pp(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=Op(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Op(n,this._root).map(e=>e.value)}};function Pp(t,n){if(t===n.value)return n;for(let e of n.children){let r=Pp(t,e);if(r)return r}return null}function Op(t,n){if(t===n.value)return[n];for(let e of n.children){let r=Op(t,e);if(r.length)return r.unshift(n),r}return[]}var cn=class{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Gi(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var gl=class extends ml{constructor(n,e){super(n),this.snapshot=e,qp(this,n)}toString(){return this.snapshot.toString()}};function zx(t){let n=WA(t),e=new At([new Bo("",{})]),r=new At({}),o=new At({}),i=new At({}),a=new At(""),s=new Qi(e,r,i,a,o,me,t,n.root);return s.snapshot=n.root,new gl(new cn(s,[]),n)}function WA(t){let n={},e={},r={},o="",i=new As([],n,r,o,e,me,t,null,{});return new vl("",new cn(i,[]))}var Qi=class{constructor(n,e,r,o,i,a,s,u){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=a,this.component=s,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(Se(c=>c[Fs]))??le(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Se(n=>Xi(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Se(n=>Xi(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Gp(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:re(re({},n.params),t.params),data:re(re({},n.data),t.data),resolve:re(re(re(re({},t.data),n.data),o?.data),t._resolvedData)}:r={params:re({},t.params),data:re({},t.data),resolve:re(re({},t.data),t._resolvedData??{})},o&&Gx(o)&&(r.resolve[Fs]=o.title),r}var As=class{get title(){return this.data?.[Fs]}constructor(n,e,r,o,i,a,s,u,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Xi(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Xi(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},vl=class extends ml{constructor(n,e){super(e),this.url=n,qp(this,e)}toString(){return $x(this._root)}};function qp(t,n){n.value._routerState=t,n.children.forEach(e=>qp(t,e))}function $x(t){let n=t.children.length>0?` { ${t.children.map($x).join(", ")} } `:"";return`${t.value}${n}`}function gp(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,sr(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),sr(n.params,e.params)||t.paramsSubject.next(e.params),vA(n.url,e.url)||t.urlSubject.next(e.url),sr(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Lp(t,n){let e=sr(t.params,n.params)&&wA(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||Lp(t.parent,n.parent))}function Gx(t){return typeof t.title=="string"||t.title===null}var HA=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=me,this.activateEvents=new xn,this.deactivateEvents=new xn,this.attachEvents=new xn,this.detachEvents=new xn,this.parentContexts=X(xl),this.location=X(Oo),this.changeDetector=X(fs),this.environmentInjector=X(wn),this.inputBinder=X(Kp,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ce(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ce(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ce(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new ce(4013,!1);this._activatedRoute=e;let o=this.location,a=e.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new Bp(e,s,o.injector);this.activated=o.createComponent(a,{index:o.length,injector:u,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275dir=Rc({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[kc]})}}return t})(),Bp=class t{__ngOutletInjector(n){return new t(this.route,this.childContexts,n)}constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===Qi?this.route:n===xl?this.childContexts:this.parent.get(n,e)}},Kp=new xe("");function zA(t,n,e){let r=Ns(t,n._root,e?e._root:void 0);return new gl(r,n)}function Ns(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=$A(t,n,e);return new cn(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let a=i.route;return a.value._futureSnapshot=n.value,a.children=n.children.map(s=>Ns(t,s)),a}}let r=GA(n.value),o=n.children.map(i=>Ns(t,i));return new cn(r,o)}}function $A(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Ns(t,r,o);return Ns(t,r)})}function GA(t){return new Qi(new At(t.url),new At(t.params),new At(t.queryParams),new At(t.fragment),new At(t.data),t.outlet,t.component,t)}var qx="ngNavigationCancelingError";function Kx(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Yi(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=Xx(!1,ln.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function Xx(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[qx]=!0,e.cancellationCode=n,e}function qA(t){return Yx(t)&&Yi(t.url)}function Yx(t){return!!t&&t[qx]}var KA=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=Li({type:t,selectors:[["ng-component"]],standalone:!0,features:[Wi],decls:1,vars:0,template:function(r,o){r&1&&to(0,"router-outlet")},dependencies:[HA],encapsulation:2})}}return t})();function XA(t,n){return t.providers&&!t._injector&&(t._injector=Yh(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Xp(t){let n=t.children&&t.children.map(Xp),e=n?lt(re({},t),{children:n}):re({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==me&&(e.component=KA),e}function ur(t){return t.outlet||me}function YA(t,n){let e=t.filter(r=>ur(r)===n);return e.push(...t.filter(r=>ur(r)!==n)),e}function Ps(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var QA=(t,n,e,r)=>Se(o=>(new jp(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),jp=class{constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),gp(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Gi(e);n.children.forEach(i=>{let a=i.value.outlet;this.deactivateRoutes(i,o[a],r),delete o[a]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let a=r.getContext(o.outlet);a&&this.deactivateChildRoutes(n,e,a.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Gi(n);for(let a of Object.values(i))this.deactivateRouteAndItsChildren(a,o);if(r&&r.outlet){let a=r.outlet.detach(),s=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:a,route:n,contexts:s})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Gi(n);for(let a of Object.values(i))this.deactivateRouteAndItsChildren(a,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Gi(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new kp(i.value.snapshot))}),n.children.length&&this.forwardEvent(new Ap(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(gp(o),o===i)if(o.component){let a=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,a.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let a=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let s=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),gp(s.route.value),this.activateChildRoutes(n,null,a.children)}else{let s=Ps(o.snapshot);a.attachRef=null,a.route=o,a.injector=s,a.outlet&&a.outlet.activateWith(o,a.injector),this.activateChildRoutes(n,null,a.children)}}else this.activateChildRoutes(n,null,r)}},yl=class{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},Ki=class{constructor(n,e){this.component=n,this.route=e}};function ZA(t,n,e){let r=t._root,o=n?n._root:null;return ws(r,o,e,[r.value])}function JA(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function Ji(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!Dy(t)?t:n.get(t):r}function ws(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Gi(n);return t.children.forEach(a=>{e2(a,i[a.value.outlet],e,r.concat([a.value]),o),delete i[a.value.outlet]}),Object.entries(i).forEach(([a,s])=>Is(s,e.getContext(a),o)),o}function e2(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,a=n?n.value:null,s=e?e.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){let u=t2(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new yl(r)):(i.data=a.data,i._resolvedData=a._resolvedData),i.component?ws(t,n,s?s.children:null,r,o):ws(t,n,e,r,o),u&&s&&s.outlet&&s.outlet.isActivated&&o.canDeactivateChecks.push(new Ki(s.outlet.component,a))}else a&&Is(n,s,o),o.canActivateChecks.push(new yl(r)),i.component?ws(t,null,s?s.children:null,r,o):ws(t,null,e,r,o);return o}function t2(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!jo(t.url,n.url);case"pathParamsOrQueryParamsChange":return!jo(t.url,n.url)||!sr(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Lp(t,n)||!sr(t.queryParams,n.queryParams);case"paramsChange":default:return!Lp(t,n)}}function Is(t,n,e){let r=Gi(t),o=t.value;Object.entries(r).forEach(([i,a])=>{o.component?n?Is(a,n.children.getContext(i),e):Is(a,null,e):Is(a,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new Ki(n.outlet.component,o)):e.canDeactivateChecks.push(new Ki(null,o)):e.canDeactivateChecks.push(new Ki(null,o))}function Os(t){return typeof t=="function"}function n2(t){return typeof t=="boolean"}function r2(t){return t&&Os(t.canLoad)}function o2(t){return t&&Os(t.canActivate)}function i2(t){return t&&Os(t.canActivateChild)}function a2(t){return t&&Os(t.canDeactivate)}function s2(t){return t&&Os(t.canMatch)}function Qx(t){return t instanceof wr||t?.name==="EmptyError"}var sl=Symbol("INITIAL_VALUE");function Zi(){return vn(t=>Ku(t.map(n=>n.pipe(Cr(1),lf(sl)))).pipe(Se(n=>{for(let e of n)if(e!==!0){if(e===sl)return sl;if(e===!1||e instanceof ro)return e}return!0}),gn(n=>n!==sl),Cr(1)))}function u2(t,n){return vt(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:a}}=e;return a.length===0&&i.length===0?le(lt(re({},e),{guardsResult:!0})):c2(a,r,o,t).pipe(vt(s=>s&&n2(s)?l2(r,i,t,n):le(s)),Se(s=>lt(re({},e),{guardsResult:s})))})}function c2(t,n,e,r){return dt(t).pipe(vt(o=>m2(o.component,o.route,e,n,r)),kn(o=>o!==!0,!0))}function l2(t,n,e,r){return dt(n).pipe(wo(o=>Ei(f2(o.route.parent,r),d2(o.route,r),p2(t,o.path,e),h2(t,o.route,e))),kn(o=>o!==!0,!0))}function d2(t,n){return t!==null&&n&&n(new Np(t)),le(!0)}function f2(t,n){return t!==null&&n&&n(new Rp(t)),le(!0)}function h2(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return le(!0);let o=r.map(i=>Xu(()=>{let a=Ps(n)??e,s=Ji(i,a),u=o2(s)?s.canActivate(n,t):eo(a,()=>s(n,t));return io(u).pipe(kn())}));return le(o).pipe(Zi())}function p2(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(a=>JA(a)).filter(a=>a!==null).map(a=>Xu(()=>{let s=a.guards.map(u=>{let c=Ps(a.node)??e,l=Ji(u,c),d=i2(l)?l.canActivateChild(r,t):eo(c,()=>l(r,t));return io(d).pipe(kn())});return le(s).pipe(Zi())}));return le(i).pipe(Zi())}function m2(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return le(!0);let a=i.map(s=>{let u=Ps(n)??o,c=Ji(s,u),l=a2(c)?c.canDeactivate(t,n,e,r):eo(u,()=>c(t,n,e,r));return io(l).pipe(kn())});return le(a).pipe(Zi())}function g2(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return le(!0);let i=o.map(a=>{let s=Ji(a,t),u=r2(s)?s.canLoad(n,e):eo(t,()=>s(n,e));return io(u)});return le(i).pipe(Zi(),Zx(r))}function Zx(t){return ef(yt(n=>{if(Yi(n))throw Kx(t,n)}),Se(n=>n===!0))}function v2(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return le(!0);let i=o.map(a=>{let s=Ji(a,t),u=s2(s)?s.canMatch(n,e):eo(t,()=>s(n,e));return io(u)});return le(i).pipe(Zi(),Zx(r))}var ks=class{constructor(n){this.segmentGroup=n||null}},bl=class extends Error{constructor(n){super(),this.urlTree=n}};function $i(t){return Di(new ks(t))}function y2(t){return Di(new ce(4e3,!1))}function b2(t){return Di(Xx(!1,ln.GuardRejected))}var Vp=class{constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return le(r);if(o.numberOfChildren>1||!o.children[me])return y2(n.redirectTo);o=o.children[me]}}applyRedirectCommands(n,e,r){let o=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e.startsWith("/"))throw new bl(o);return o}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new ro(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i.startsWith(":")){let s=i.substring(1);r[o]=e[s]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),a={};return Object.entries(e.children).forEach(([s,u])=>{a[s]=this.createSegmentGroup(n,u,r,o)}),new Be(i,a)}createSegments(n,e,r,o){return e.map(i=>i.path.startsWith(":")?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new ce(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},Up={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function x2(t,n,e,r,o){let i=Yp(t,n,e);return i.matched?(r=XA(n,r),v2(r,n,e,o).pipe(Se(a=>a===!0?i:re({},Up)))):le(i)}function Yp(t,n,e){if(n.path==="**")return w2(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?re({},Up):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||gA)(e,t,n);if(!o)return re({},Up);let i={};Object.entries(o.posParams??{}).forEach(([s,u])=>{i[s]=u.path});let a=o.consumed.length>0?re(re({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:a,positionalParamSegments:o.posParams??{}}}function w2(t){return{matched:!0,parameters:t.length>0?Ax(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function Mx(t,n,e,r){return e.length>0&&E2(t,e,r)?{segmentGroup:new Be(n,D2(r,new Be(e,t.children))),slicedSegments:[]}:e.length===0&&I2(t,e,r)?{segmentGroup:new Be(t.segments,C2(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new Be(t.segments,t.children),slicedSegments:e}}function C2(t,n,e,r){let o={};for(let i of e)if(wl(t,n,i)&&!r[ur(i)]){let a=new Be([],{});o[ur(i)]=a}return re(re({},r),o)}function D2(t,n){let e={};e[me]=n;for(let r of t)if(r.path===""&&ur(r)!==me){let o=new Be([],{});e[ur(r)]=o}return e}function E2(t,n,e){return e.some(r=>wl(t,n,r)&&ur(r)!==me)}function I2(t,n,e){return e.some(r=>wl(t,n,r))}function wl(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function _2(t,n,e,r){return ur(t)!==r&&(r===me||!wl(n,e,t))?!1:Yp(n,t,e).matched}function S2(t,n,e){return n.length===0&&!t.children[e]}var Wp=class{};function T2(t,n,e,r,o,i,a="emptyOnly"){return new Hp(t,n,e,r,o,a,i).recognize()}var M2=31,Hp=class{constructor(n,e,r,o,i,a,s){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=a,this.urlSerializer=s,this.applyRedirects=new Vp(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new ce(4002,`'${n.segmentGroup}'`)}recognize(){let n=Mx(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Se(e=>{let r=new As([],Object.freeze({}),Object.freeze(re({},this.urlTree.queryParams)),this.urlTree.fragment,{},me,this.rootComponentType,null,{}),o=new cn(r,e),i=new vl("",o),a=PA(r,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(a),this.inheritParamsAndData(i._root,null),{state:i,tree:a}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,me).pipe(qr(r=>{if(r instanceof bl)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof ks?this.noMatchError(r):r}))}inheritParamsAndData(n,e){let r=n.value,o=Gp(r,e,this.paramsInheritanceStrategy);r.params=Object.freeze(o.params),r.data=Object.freeze(o.data),n.children.forEach(i=>this.inheritParamsAndData(i,r))}processSegmentGroup(n,e,r,o){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,o,!0).pipe(Se(i=>i instanceof cn?[i]:[]))}processChildren(n,e,r){let o=[];for(let i of Object.keys(r.children))i==="primary"?o.unshift(i):o.push(i);return dt(o).pipe(wo(i=>{let a=r.children[i],s=YA(e,i);return this.processSegmentGroup(n,s,a,i)}),cf((i,a)=>(i.push(...a),i)),Kr(null),uf(),vt(i=>{if(i===null)return $i(r);let a=Jx(i);return R2(a),le(a)}))}processSegment(n,e,r,o,i,a){return dt(e).pipe(wo(s=>this.processSegmentAgainstRoute(s._injector??n,e,s,r,o,i,a).pipe(qr(u=>{if(u instanceof ks)return le(null);throw u}))),kn(s=>!!s),qr(s=>{if(Qx(s))return S2(r,o,i)?le(new Wp):$i(r);throw s}))}processSegmentAgainstRoute(n,e,r,o,i,a,s){return _2(r,o,i,a)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,a):this.allowRedirects&&s?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,a):$i(o):$i(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){let{matched:s,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=Yp(e,o,i);if(!s)return $i(e);o.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>M2&&(this.allowRedirects=!1));let d=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,c);return this.applyRedirects.lineralizeSegments(o,d).pipe(vt(f=>this.processSegment(n,r,e,f.concat(l),a,!1)))}matchSegmentAgainstRoute(n,e,r,o,i){let a=x2(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(vn(s=>s.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(vn(({routes:u})=>{let c=r._loadedInjector??n,{consumedSegments:l,remainingSegments:d,parameters:f}=s,h=new As(l,f,Object.freeze(re({},this.urlTree.queryParams)),this.urlTree.fragment,N2(r),ur(r),r.component??r._loadedComponent??null,r,k2(r)),{segmentGroup:p,slicedSegments:m}=Mx(e,l,d,u);if(m.length===0&&p.hasChildren())return this.processChildren(c,u,p).pipe(Se(v=>v===null?null:new cn(h,v)));if(u.length===0&&m.length===0)return le(new cn(h,[]));let g=ur(r)===i;return this.processSegment(c,u,p,m,g?me:i,!0).pipe(Se(v=>new cn(h,v instanceof cn?[v]:[])))}))):$i(e)))}getChildConfig(n,e,r){return e.children?le({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?le({routes:e._loadedRoutes,injector:e._loadedInjector}):g2(n,e,r,this.urlSerializer).pipe(vt(o=>o?this.configLoader.loadChildren(n,e).pipe(yt(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):b2(e))):le({routes:[],injector:n})}};function R2(t){t.sort((n,e)=>n.value.outlet===me?-1:e.value.outlet===me?1:n.value.outlet.localeCompare(e.value.outlet))}function A2(t){let n=t.value.routeConfig;return n&&n.path===""}function Jx(t){let n=[],e=new Set;for(let r of t){if(!A2(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=Jx(r.children);n.push(new cn(r.value,o))}return n.filter(r=>!e.has(r))}function N2(t){return t.data||{}}function k2(t){return t.resolve||{}}function F2(t,n,e,r,o,i){return vt(a=>T2(t,n,e,r,a.extractedUrl,o,i).pipe(Se(({state:s,tree:u})=>lt(re({},a),{targetSnapshot:s,urlAfterRedirects:u}))))}function P2(t,n){return vt(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return le(e);let i=new Set(o.map(u=>u.route)),a=new Set;for(let u of i)if(!a.has(u))for(let c of ew(u))a.add(c);let s=0;return dt(a).pipe(wo(u=>i.has(u)?O2(u,r,t,n):(u.data=Gp(u,u.parent,t).resolve,le(void 0))),yt(()=>s++),_i(1),vt(u=>s===a.size?le(e):on))})}function ew(t){let n=t.children.map(e=>ew(e)).flat();return[t,...n]}function O2(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!Gx(o)&&(i[Fs]=o.title),L2(i,t,n,r).pipe(Se(a=>(t._resolvedData=a,t.data=Gp(t,t.parent,e).resolve,null)))}function L2(t,n,e,r){let o=bp(t);if(o.length===0)return le({});let i={};return dt(o).pipe(vt(a=>B2(t[a],n,e,r).pipe(kn(),yt(s=>{i[a]=s}))),_i(1),sf(i),qr(a=>Qx(a)?on:Di(a)))}function B2(t,n,e,r){let o=Ps(n)??r,i=Ji(t,o),a=i.resolve?i.resolve(n,e):eo(o,()=>i(n,e));return io(a)}function vp(t){return vn(n=>{let e=t(n);return e?dt(e).pipe(Se(()=>n)):le(n)})}var tw=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===me);return r}getResolvedTitleForRoute(e){return e.data[Fs]}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(j2),providedIn:"root"})}}return t})(),j2=(()=>{class t extends tw{constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static{this.\u0275fac=function(r){return new(r||t)(Ne(Dx))}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Qp=new xe("",{providedIn:"root",factory:()=>({})}),Zp=new xe(""),V2=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=X(ep)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return le(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=io(e.loadComponent()).pipe(Se(nw),yt(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),Ii(()=>{this.componentLoaders.delete(e)})),o=new Ci(r,()=>new Ht).pipe(wi());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return le({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=U2(r,this.compiler,e,this.onLoadEndListener).pipe(Ii(()=>{this.childrenLoaders.delete(r)})),a=new Ci(i,()=>new Ht).pipe(wi());return this.childrenLoaders.set(r,a),a}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function U2(t,n,e,r){return io(t.loadChildren()).pipe(Se(nw),vt(o=>o instanceof ns||Array.isArray(o)?le(o):dt(n.compileModuleAsync(o))),Se(o=>{r&&r(t);let i,a,s=!1;return Array.isArray(o)?(a=o,s=!0):(i=o.create(e).injector,a=i.get(Zp,[],{optional:!0,self:!0}).flat()),{routes:a.map(Xp),injector:i}}))}function W2(t){return t&&typeof t=="object"&&"default"in t}function nw(t){return W2(t)?t.default:t}var Jp=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(H2),providedIn:"root"})}}return t})(),H2=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),z2=new xe("");var $2=(()=>{class t{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Ht,this.transitionAbortSubject=new Ht,this.configLoader=X(V2),this.environmentInjector=X(wn),this.urlSerializer=X($p),this.rootContexts=X(xl),this.location=X(ps),this.inputBindingEnabled=X(Kp,{optional:!0})!==null,this.titleStrategy=X(tw),this.options=X(Qp,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=X(Jp),this.createViewTransition=X(z2,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>le(void 0),this.rootComponentType=null;let e=o=>this.events.next(new Tp(o)),r=o=>this.events.next(new Mp(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(lt(re(re({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new At({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Es,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(gn(i=>i.id!==0),Se(i=>lt(re({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),vn(i=>{let a=!1,s=!1;return le(i).pipe(vn(u=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",ln.SupersededByNewNavigation),on;this.currentTransition=i,this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?lt(re({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),l=u.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&l!=="reload"){let d="";return this.events.next(new Uo(u.id,this.urlSerializer.serialize(u.rawUrl),d,Dp.IgnoredSameUrlNavigation)),u.resolve(null),on}if(this.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return le(u).pipe(vn(d=>{let f=this.transitions?.getValue();return this.events.next(new Ss(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?on:Promise.resolve(d)}),F2(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),yt(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=lt(re({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new pl(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){let{id:d,extractedUrl:f,source:h,restoredState:p,extras:m}=u,g=new Ss(d,this.urlSerializer.serialize(f),h,p);this.events.next(g);let v=zx(this.rootComponentType).snapshot;return this.currentTransition=i=lt(re({},u),{targetSnapshot:v,urlAfterRedirects:f,extras:lt(re({},m),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,le(i)}else{let d="";return this.events.next(new Uo(u.id,this.urlSerializer.serialize(u.extractedUrl),d,Dp.IgnoredByUrlHandlingStrategy)),u.resolve(null),on}}),yt(u=>{let c=new Ep(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}),Se(u=>(this.currentTransition=i=lt(re({},u),{guards:ZA(u.targetSnapshot,u.currentSnapshot,this.rootContexts)}),i)),u2(this.environmentInjector,u=>this.events.next(u)),yt(u=>{if(i.guardsResult=u.guardsResult,Yi(u.guardsResult))throw Kx(this.urlSerializer,u.guardsResult);let c=new Ip(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(c)}),gn(u=>u.guardsResult?!0:(this.cancelNavigationTransition(u,"",ln.GuardRejected),!1)),vp(u=>{if(u.guards.canActivateChecks.length)return le(u).pipe(yt(c=>{let l=new _p(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),vn(c=>{let l=!1;return le(c).pipe(P2(this.paramsInheritanceStrategy,this.environmentInjector),yt({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(c,"",ln.NoDataFromResolver)}}))}),yt(c=>{let l=new Sp(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}))}),vp(u=>{let c=l=>{let d=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(l.routeConfig).pipe(yt(f=>{l.component=f}),Se(()=>{})));for(let f of l.children)d.push(...c(f));return d};return Ku(c(u.targetSnapshot.root)).pipe(Kr(null),Cr(1))}),vp(()=>this.afterPreactivation()),vn(()=>{let{currentSnapshot:u,targetSnapshot:c}=i,l=this.createViewTransition?.(this.environmentInjector,u.root,c.root);return l?dt(l).pipe(Se(()=>i)):le(i)}),Se(u=>{let c=zA(e.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=i=lt(re({},u),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),yt(()=>{this.events.next(new Ms)}),QA(this.rootContexts,e.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),Cr(1),yt({next:u=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Vo(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),this.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{a=!0}}),df(this.transitionAbortSubject.pipe(yt(u=>{throw u}))),Ii(()=>{!a&&!s&&this.cancelNavigationTransition(i,"",ln.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),qr(u=>{if(s=!0,Yx(u))this.events.next(new oo(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode)),qA(u)?this.events.next(new Rs(u.url)):i.resolve(!1);else{this.events.next(new Ts(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0));try{i.resolve(e.errorHandler(u))}catch(c){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(c)}}return on}))}))}cancelNavigationTransition(e,r,o){let i=new oo(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function G2(t){return t!==Es}var q2=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(K2),providedIn:"root"})}}return t})(),zp=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},K2=(()=>{class t extends zp{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=_h(t)))(o||t)}})()}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),rw=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:()=>X(X2),providedIn:"root"})}}return t})(),X2=(()=>{class t extends rw{constructor(){super(...arguments),this.location=X(ps),this.urlSerializer=X($p),this.options=X(Qp,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=X(Jp),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ro,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=zx(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof Ss)this.stateMemento=this.createStateMemento();else if(e instanceof Uo)this.rawUrlTree=r.initialUrl;else if(e instanceof pl){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(o,r)}}else e instanceof Ms?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r))):e instanceof oo&&(e.code===ln.GuardRejected||e.code===ln.NoDataFromResolver)?this.restoreHistory(r):e instanceof Ts?this.restoreHistory(r,!0):e instanceof Vo&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,a=re(re({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",a)}else{let i=re(re({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=_h(t)))(o||t)}})()}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Cs=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(Cs||{});function Y2(t,n){t.events.pipe(gn(e=>e instanceof Vo||e instanceof oo||e instanceof Ts||e instanceof Uo),Se(e=>e instanceof Vo||e instanceof Uo?Cs.COMPLETE:(e instanceof oo?e.code===ln.Redirect||e.code===ln.SupersededByNewNavigation:!1)?Cs.REDIRECTING:Cs.FAILED),gn(e=>e!==Cs.REDIRECTING),Cr(1)).subscribe(()=>{n()})}function Q2(t){throw t}var Z2={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},J2={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ow=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=X(Qc),this.stateManager=X(rw),this.options=X(Qp,{optional:!0})||{},this.pendingTasks=X(cs),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=X($2),this.urlSerializer=X($p),this.location=X(ps),this.urlHandlingStrategy=X(Jp),this._events=new Ht,this.errorHandler=this.options.errorHandler||Q2,this.navigated=!1,this.routeReuseStrategy=X(q2),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=X(Zp,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!X(Kp,{optional:!0}),this.eventsSubscription=new gt,this.isNgZoneEnabled=X(st)instanceof st&&st.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof oo&&r.code!==ln.Redirect&&r.code!==ln.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Vo)this.navigated=!0;else if(r instanceof Rs){let a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),s={info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||G2(o.source)};this.scheduleNavigation(a,Es,null,s,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}tN(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Es,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},a=o?.navigationId?o:null;if(o){let u=re({},o);delete u.navigationId,delete u.\u0275routerPageId,Object.keys(u).length!==0&&(i.state=u)}let s=this.parseUrl(e);this.scheduleNavigation(s,r,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(Xp),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:a,queryParamsHandling:s,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:a,l=null;switch(s){case"merge":l=re(re({},this.currentUrlTree.queryParams),i);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}l!==null&&(l=this.removeEmptyProps(l));let d;try{let f=o?o.snapshot:this.routerState.snapshot.root;d=Vx(f)}catch{(typeof e[0]!="string"||!e[0].startsWith("/"))&&(e=[]),d=this.currentUrlTree.root}return Ux(d,e,l,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Yi(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Es,null,r)}navigate(e,r={skipLocationChange:!1}){return eN(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=re({},Z2):r===!1?o=re({},J2):o=r,Yi(e))return Ix(this.currentUrlTree,e,o);let i=this.parseUrl(e);return Ix(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,a){if(this.disposed)return Promise.resolve(!1);let s,u,c;a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise((d,f)=>{s=d,u=f});let l=this.pendingTasks.add();return Y2(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(l))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=he({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function eN(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new ce(4008,!1)}function tN(t){return!(t instanceof Ms)&&!(t instanceof Rs)}var nN=new xe("");function iw(t,...n){return Mo([{provide:Zp,multi:!0,useValue:t},[],{provide:Qi,useFactory:rN,deps:[ow]},{provide:Hi,multi:!0,useFactory:oN},n.map(e=>e.\u0275providers)])}function rN(t){return t.routerState.root}function oN(){let t=X(Ao);return n=>{let e=t.get(no);if(n!==e.components[0])return;let r=t.get(ow),o=t.get(iN);t.get(aN)===1&&r.initialNavigation(),t.get(sN,null,we.Optional)?.setUpPreloading(),t.get(nN,null,we.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var iN=new xe("",{factory:()=>new Ht}),aN=new xe("",{providedIn:"root",factory:()=>1});var sN=new xe("");var qw=function(t,n){return(qw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function $n(t,n){function e(){this.constructor=t}qw(t,n),t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}function J(t,n,e,r){return new(e||(e=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new e(function(l){l(c.value)}).then(a,s)}u((r=r.apply(t,n||[])).next())})}function ee(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(l[0]===6&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(t,a)}catch(d){l=[6,d],r=0}finally{e=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var uN=function(){function t(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(n,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},t.prototype.registerFlag=function(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},t.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},t.prototype.getNumber=function(n){return this.get(n)},t.prototype.getBool=function(n){return this.get(n)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(n,e){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)},t.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},t.prototype.setFlags=function(n){this.flags=Object.assign({},n)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,r,o=(e=this.global.location.search,r={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return cN(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0],u=a[1];n.urlFlags[s]=function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,u)})}},t}();function cN(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function P(){return Kw}var Kw=null,Bl=new Map,wm=new Map;function Xw(t,n){var e=Qw(t,n);return Bl.get(e)}function lN(t){return wm.get(t)}function lw(t){for(var n=Bl.entries(),e=[];;){var r=n.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===t&&e.push(s)}return e}function Yw(t){var n=t.kernelName,e=t.backendName,r=Qw(n,e);if(Bl.has(r))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");Bl.set(r,t)}function dN(t){var n=t.kernelName;wm.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),wm.set(n,t)}function Qw(t,n){return n+"_"+t}function dw(t){for(var n=t.length,e=0,r=0;n>0;)r=Math.random()*n|0,e=t[--n],t[n]=t[r],t[r]=e}function jl(t,n,e){return Math.max(t,Math.min(n,e))}function Wm(t){return t%2==0?t:t+1}function Zw(t){for(var n=0,e=0;e<t.length;e++)n+=t[e];return n}function E(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function Le(t,n,e){e===void 0&&(e=""),E(ft(t,n),function(){return e+" Shapes "+t+" and "+n+" must match"})}function ei(t){E(t!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Nr(t,n,e){if(n===void 0&&(n=[]),e===void 0&&(e=!1),n==null&&(n=[]),Array.isArray(t)||Pt(t)&&!e)for(var r=0;r<t.length;++r)Nr(t[r],n,e);else n.push(t);return n}function te(t){if(t.length===0)return 1;for(var n=t[0],e=1;e<t.length;e++)n*=t[e];return n}function ft(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function nt(t){return t%1==0}function Jw(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var n=Math.exp(2*t);return(n-1)/(n+1)}function Vl(t){var n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function Ko(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Cm(t,n,e){return n===void 0&&(n=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=n(i);e!=null&&i>=e?o():setTimeout(a,s)}};a()})}function eC(t,n){for(var e=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)e*=t[o];else if(t[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(r===-1){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+t);return t}if(e===0)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var i=t.slice();return i[r]=n/e,i}function pt(t,n){var e=n.length;return E((t=t==null?n.map(function(r,o){return o}):[].concat(t)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+t}),E(t.every(function(r){return nt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?e+r:r})}function ao(t,n){for(var e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:pt(n,t).sort(),a=0,s=0;s<t.length;++s){if(i!=null){if(i[a]===s&&t[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(i[a]==null||i[a]>s)&&t[s]===1&&(e.push(t[s]),r.push(s)),i[a]<=s&&a++}t[s]!==1&&(e.push(t[s]),r.push(s))}return{newShape:e,keptDims:r}}function fa(t,n){var e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);e=new Uint8Array(n)}return e}function Gs(t,n){var e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else{if(t!=="string")throw new Error("Unknown data type "+t);e=new Array(n)}return e}function tC(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function nC(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function rC(t,n){return n!=="complex64"&&(n!=="float32"||t==="complex64")&&(n!=="int32"||t==="float32"||t==="complex64")&&(n!=="bool"||t!=="bool")}function Pt(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Hm(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error("Unknown dtype "+t)}function oC(t){if(t==null)return 0;var n=0;return t.forEach(function(e){return n+=e.length}),n}function so(t){return typeof t=="string"||t instanceof String}function iC(t){return typeof t=="boolean"}function aC(t){return typeof t=="number"}function pa(t){return Array.isArray(t)?pa(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":aC(t)?"float32":so(t)?"string":iC(t)?"bool":"float32"}function Ul(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Wl(t,n){for(var e=n;e<t;++e)if(t%e==0)return e;return t}function Hn(t){var n=t.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=t[n-1];for(var r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function zm(t,n,e){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Nr(t)),e&&tC(t,n),function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"}(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)Math.round(t[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function Dm(t,n){if(t.length===0)return n[0];var e=t.reduce(function(r,o){return r*o});if(e===0)return[];if(e!==n.length)throw new Error("["+t+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)s[c]=r(o+c*d,l,a)}return s}(0,t,n)}function $m(t,n){for(var e=ma(t,n),r=0;r<e.length;r++)e[r]=1;return e}function ma(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error("Unknown data type "+n)}function Wn(){return P().platform.now()}function Gm(t){t.forEach(function(n){E(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function sC(t,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",P().platform.encode(t,n)}function qs(t,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",P().platform.decode(t,n)}function Em(t,n,e){if(n===0)return 0;if(n===1)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function uC(t,n,e){if(n===0)return[];if(n===1)return[t];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}var NH=Object.freeze({shuffle:dw,clamp:jl,nearestLargerEven:Wm,sum:Zw,randUniform:function(t,n){var e=Math.random();return n*e+(1-e)*t},distSquared:function(t,n){for(var e=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(n[r]);e+=o*o}return e},assert:E,assertShapesMatch:Le,assertNonNull:ei,flatten:Nr,sizeFromShape:te,isScalarShape:function(t){return t.length===0},arraysEqual:ft,isInt:nt,tanh:Jw,sizeToSquarishShape:Vl,createShuffledIndices:function(t){for(var n=new Uint32Array(t),e=0;e<t;++e)n[e]=e;return dw(n),n},rightPad:Ko,repeatedTry:Cm,inferFromImplicitShape:eC,parseAxisParam:pt,squeezeShape:ao,getTypedArrayFromDType:fa,getArrayFromDType:Gs,checkConversionForErrors:tC,isValidDtype:nC,hasEncodingLoss:rC,isTypedArray:Pt,bytesPerElement:Hm,bytesFromStringArray:oC,isString:so,isBoolean:iC,isNumber:aC,inferDtype:pa,isFunction:Ul,nearestDivisor:Wl,computeStrides:Hn,toTypedArray:zm,toNestedArray:Dm,makeOnesTypedArray:$m,makeZerosTypedArray:ma,now:Wn,assertNonNegativeIntegerDimensions:Gm,fetch:function(t,n){return P().platform.fetch(t,n)},encodeString:sC,decodeString:qs,locToIndex:Em,indexToLoc:uC}),fN=function(){function t(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new hN)}return t.prototype.profileKernel=function(n,e,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,d){if(l!=="float32")return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),a.then(function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,e,l)})})}),o},t}(),hN=function(){function t(){}return t.prototype.logKernelProfile=function(n,e,r,o,i,a){var s=typeof o=="number"?Ko(o+"ms",9):o.error,u=Ko(n,25),c=e.rank,l=e.size,d=Ko(e.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||e.shape,m=p.length;f+=h+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+d+"	%c"+l+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),fw=20,Ls=3,em=7;function pN(t,n,e,r){var o=Hn(n),i=function(c,l,d,f){var h=te(l),p=f[f.length-1],m=new Array(p).fill(0),g=l.length,v=d==="complex64"?js(c):c;if(g>1)for(var b=0;b<h/p;b++)for(var x=b*p,y=0;y<p;y++)m[y]=Math.max(m[y],Bs(v[x+y],0,d).length);return m}(t,n,e,o),a=n.length,s=function c(l,d,f,h,p,m){m===void 0&&(m=!0);var g=f==="complex64"?2:1,v=d[0],b=d.length;if(b===0)return f==="complex64"?[Bs(js(l)[0],0,f)]:f==="bool"?[cC(l[0])]:[l[0].toString()];if(b===1){if(v>fw){var x=Ls*g,y=Array.from(l.slice(0,x)),w=Array.from(l.slice((v-Ls)*g,v*g));return f==="complex64"&&(y=js(y),w=js(w)),["["+y.map(function(L,U){return Bs(L,p[U],f)}).join(", ")+", ..., "+w.map(function(L,U){return Bs(L,p[v-Ls+U],f)}).join(", ")+"]"]}return["["+(f==="complex64"?js(l):Array.from(l)).map(function(L,U){return Bs(L,p[U],f)}).join(", ")+"]"]}var C=d.slice(1),T=h.slice(1),S=h[0]*g,I=[];if(v>fw){for(var _=0;_<Ls;_++){var N=(A=_*S)+S;I.push.apply(I,c(l.slice(A,N),C,f,T,p,!1))}for(I.push("..."),_=v-Ls;_<v;_++)N=(A=_*S)+S,I.push.apply(I,c(l.slice(A,N),C,f,T,p,_===v-1))}else for(_=0;_<v;_++){var A;N=(A=_*S)+S,I.push.apply(I,c(l.slice(A,N),C,f,T,p,_===v-1))}var B=b===2?",":"";for(I[0]="["+I[0]+B,_=1;_<I.length-1;_++)I[_]=" "+I[_]+B;var O=`,
`;for(_=2;_<b;_++)O+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(m?"":O),I}(t,n,e,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function Bs(t,n,e){return Ko(Array.isArray(t)?parseFloat(t[0].toFixed(em))+" + "+parseFloat(t[1].toFixed(em))+"j":so(t)?"'"+t+"'":e==="bool"?cC(t):parseFloat(t.toFixed(em)).toString(),n)}function cC(t){return t===0?"false":"true"}function js(t){for(var n=[],e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Ks=function(){function t(n,e,r){var o=this;if(this.dtype=e,this.shape=n.slice(),this.size=te(n),r!=null){var i=r.length;E(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Gs(e,this.size),this.strides=Hn(n)}return t.prototype.set=function(n){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),E(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=n},t.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];n.length===0&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},t.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var e=n[n.length-1],r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e},t.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return cr().makeTensor(this.values,this.shape,this.dtype)},t}(),cr=null,F=null,lC=null,ze=function(){function t(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=te(n),this.strides=Hn(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},t.prototype.as3D=function(n,e,r){return this.throwIfDisposed(),this.reshape([n,e,r])},t.prototype.as4D=function(n,e,r,o){return this.throwIfDisposed(),this.reshape([n,e,r,o])},t.prototype.as5D=function(n,e,r,o,i){return this.throwIfDisposed(),this.reshape([n,e,r,o,i])},t.prototype.asType=function(n){return this.throwIfDisposed(),F.cast(this,n)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return J(this,void 0,void 0,function(){var n;return ee(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,F.buffer(this.shape,this.dtype,n)]}})})},t.prototype.bufferSync=function(){return F.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return J(this,void 0,void 0,function(){var n;return ee(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,Dm(this.shape,n)]}})})},t.prototype.arraySync=function(){return Dm(this.shape,this.dataSync())},t.prototype.data=function(){return J(this,void 0,void 0,function(){var n,e;return ee(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=cr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:e=r.sent();try{return[2,e.map(function(o){return qs(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var n=cr().readSync(this.dataId);if(this.dtype==="string")try{return n.map(function(e){return qs(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},t.prototype.bytes=function(){return J(this,void 0,void 0,function(){var n;return ee(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,cr().read(this.dataId)];case 1:return n=e.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(cr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(n){return n===void 0&&(n=!1),F.print(this,n)},t.prototype.reshape=function(n){return this.throwIfDisposed(),F.reshape(this,n)},t.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},t.prototype.expandDims=function(n){return n===void 0&&(n=0),F.expandDims(this,n)},t.prototype.cumsum=function(n,e,r){return n===void 0&&(n=0),e===void 0&&(e=!1),r===void 0&&(r=!1),F.cumsum(this,n,e,r)},t.prototype.squeeze=function(n){return this.throwIfDisposed(),F.squeeze(this,n)},t.prototype.clone=function(){return this.throwIfDisposed(),F.clone(this)},t.prototype.oneHot=function(n,e,r){return this.throwIfDisposed(),F.oneHot(this,n,e,r)},t.prototype.toString=function(n){return n===void 0&&(n=!1),pN(this.dataSync(),this.shape,this.dtype,n)},t.prototype.tile=function(n){return this.throwIfDisposed(),F.tile(this,n)},t.prototype.gather=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),F.gather(this,n,e)},t.prototype.matMul=function(n,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!1),this.throwIfDisposed(),F.matMul(this,n,e,r)},t.prototype.dot=function(n){return this.throwIfDisposed(),F.dot(this,n)},t.prototype.norm=function(n,e,r){return n===void 0&&(n="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1),this.throwIfDisposed(),F.norm(this,n,e,r)},t.prototype.slice=function(n,e){return this.throwIfDisposed(),F.slice(this,n,e)},t.prototype.reverse=function(n){return this.throwIfDisposed(),F.reverse(this,n)},t.prototype.concat=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),n instanceof t&&(n=[n]),F.concat([this].concat(n),e)},t.prototype.split=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),F.split(this,n,e)},t.prototype.stack=function(n,e){return e===void 0&&(e=0),F.stack([this,n],e)},t.prototype.unstack=function(n){return n===void 0&&(n=0),F.unstack(this,n)},t.prototype.pad=function(n,e){return e===void 0&&(e=0),F.pad(this,n,e)},t.prototype.batchNormalization=function(n,e,r,o,i){return r===void 0&&(r=.001),lC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,i,o,r)},t.prototype.batchNorm=function(n,e,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),F.batchNorm(this,n,e,r,o,i)},t.prototype.all=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.all(this,n,e)},t.prototype.any=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.any(this,n,e)},t.prototype.logSumExp=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.logSumExp(this,n,e)},t.prototype.sum=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.sum(this,n,e)},t.prototype.prod=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.prod(this,n,e)},t.prototype.mean=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.mean(this,n,e)},t.prototype.min=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.min(this,n,e)},t.prototype.max=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),F.max(this,n,e)},t.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),F.argMin(this,n)},t.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),F.argMax(this,n)},t.prototype.cast=function(n){return this.throwIfDisposed(),F.cast(this,n)},t.prototype.add=function(n){return this.throwIfDisposed(),F.add(this,n)},t.prototype.addStrict=function(n){return this.throwIfDisposed(),F.addStrict(this,n)},t.prototype.atan2=function(n){return this.throwIfDisposed(),F.atan2(this,n)},t.prototype.sub=function(n){return this.throwIfDisposed(),F.sub(this,n)},t.prototype.subStrict=function(n){return this.throwIfDisposed(),F.subStrict(this,n)},t.prototype.pow=function(n){return this.throwIfDisposed(),F.pow(this,n)},t.prototype.powStrict=function(n){return this.throwIfDisposed(),F.powStrict(this,n)},t.prototype.mul=function(n){return this.throwIfDisposed(),F.mul(this,n)},t.prototype.mulStrict=function(n){return this.throwIfDisposed(),F.mulStrict(this,n)},t.prototype.div=function(n){return this.throwIfDisposed(),F.div(this,n)},t.prototype.divNoNan=function(n){return this.throwIfDisposed(),F.divNoNan(this,n)},t.prototype.floorDiv=function(n){return this.throwIfDisposed(),F.floorDiv(this,n)},t.prototype.divStrict=function(n){return this.throwIfDisposed(),F.divStrict(this,n)},t.prototype.minimum=function(n){return this.throwIfDisposed(),F.minimum(this,n)},t.prototype.minimumStrict=function(n){return this.throwIfDisposed(),F.minimumStrict(this,n)},t.prototype.maximum=function(n){return this.throwIfDisposed(),F.maximum(this,n)},t.prototype.maximumStrict=function(n){return this.throwIfDisposed(),F.maximumStrict(this,n)},t.prototype.mod=function(n){return this.throwIfDisposed(),F.mod(this,n)},t.prototype.modStrict=function(n){return this.throwIfDisposed(),F.modStrict(this,n)},t.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),F.squaredDifferenceStrict(this,n)},t.prototype.transpose=function(n){return this.throwIfDisposed(),F.transpose(this,n)},t.prototype.notEqual=function(n){return this.throwIfDisposed(),F.notEqual(this,n)},t.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),F.notEqualStrict(this,n)},t.prototype.less=function(n){return this.throwIfDisposed(),F.less(this,n)},t.prototype.lessStrict=function(n){return this.throwIfDisposed(),F.lessStrict(this,n)},t.prototype.equal=function(n){return this.throwIfDisposed(),F.equal(this,n)},t.prototype.equalStrict=function(n){return this.throwIfDisposed(),F.equalStrict(this,n)},t.prototype.lessEqual=function(n){return this.throwIfDisposed(),F.lessEqual(this,n)},t.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),F.lessEqualStrict(this,n)},t.prototype.greater=function(n){return this.throwIfDisposed(),F.greater(this,n)},t.prototype.greaterStrict=function(n){return this.throwIfDisposed(),F.greaterStrict(this,n)},t.prototype.greaterEqual=function(n){return this.throwIfDisposed(),F.greaterEqual(this,n)},t.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),F.greaterEqualStrict(this,n)},t.prototype.logicalAnd=function(n){return this.throwIfDisposed(),F.logicalAnd(this,n)},t.prototype.logicalOr=function(n){return this.throwIfDisposed(),F.logicalOr(this,n)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),F.logicalNot(this)},t.prototype.logicalXor=function(n){return this.throwIfDisposed(),F.logicalXor(this,n)},t.prototype.where=function(n,e){return this.throwIfDisposed(),F.where(n,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),F.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),F.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),F.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),F.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),F.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),F.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),F.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),F.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),F.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),F.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),F.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),F.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),F.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),F.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),F.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),F.abs(this)},t.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),F.clipByValue(this,n,e)},t.prototype.relu=function(){return this.throwIfDisposed(),F.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),F.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),F.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),F.selu(this)},t.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),F.leakyRelu(this,n)},t.prototype.prelu=function(n){return this.throwIfDisposed(),F.prelu(this,n)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),F.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),F.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),F.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),F.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),F.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),F.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),F.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),F.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),F.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),F.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),F.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),F.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),F.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),F.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),F.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),F.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),F.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),F.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),F.round(this)},t.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),F.step(this,n)},t.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),F.softmax(this,n)},t.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),F.logSoftmax(this,n)},t.prototype.resizeBilinear=function(n,e){return e===void 0&&(e=!1),this.throwIfDisposed(),F.image.resizeBilinear(this,n,e)},t.prototype.resizeNearestNeighbor=function(n,e){return e===void 0&&(e=!1),this.throwIfDisposed(),F.image.resizeNearestNeighbor(this,n,e)},t.prototype.conv1d=function(n,e,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),F.conv1d(this,n,e,r,o,i,a)},t.prototype.conv2d=function(n,e,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),F.conv2d(this,n,e,r,o,i,a)},t.prototype.conv2dTranspose=function(n,e,r,o,i){return this.throwIfDisposed(),F.conv2dTranspose(this,n,e,r,o,i)},t.prototype.depthwiseConv2D=function(n,e,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),F.depthwiseConv2d(this,n,e,r,o,i,a)},t.prototype.separableConv2d=function(n,e,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),F.separableConv2d(this,n,e,r,o,i,a)},t.prototype.avgPool=function(n,e,r,o){return this.throwIfDisposed(),F.avgPool(this,n,e,r,o)},t.prototype.maxPool=function(n,e,r,o){return this.throwIfDisposed(),F.maxPool(this,n,e,r,o)},t.prototype.localResponseNormalization=function(n,e,r,o){return n===void 0&&(n=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5),F.localResponseNormalization(this,n,e,r,o)},t.prototype.pool=function(n,e,r,o,i){return this.throwIfDisposed(),F.pool(this,n,e,r,o,i)},t.prototype.variable=function(n,e,r){return n===void 0&&(n=!0),this.throwIfDisposed(),cr().makeVariable(this,n,e,r)},t.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),F.unsortedSegmentSum(this,n,e)},t.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),F.batchToSpaceND(this,n,e)},t.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),F.spaceToBatchND(this,n,e)},t.prototype.topk=function(n,e){return n===void 0&&(n=1),e===void 0&&(e=!0),this.throwIfDisposed(),F.topk(this,n,e)},t.prototype.stridedSlice=function(n,e,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),F.stridedSlice(this,n,e,r,o,i,a,s,u)},t.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),F.depthToSpace(this,n,e)},t.prototype.fft=function(){return this.throwIfDisposed(),F.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),F.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),F.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),F.spectral.irfft(this)},t}();Object.defineProperty(ze,Symbol.hasInstance,{value:function(t){return!!t&&t.dataId!=null&&t.shape!=null&&t.dtype!=null}});var hw,Im,_m,Sm,Tm,Yo=function(t){function n(e,r,o,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=r,a.name=o,a}return $n(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!ft(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");cr().disposeTensor(this),this.dataId=e.dataId,cr().incRef(this,null)},n.prototype.dispose=function(){cr().disposeVariable(this),this.isDisposedInternal=!0},n}(ze);Object.defineProperty(Yo,Symbol.hasInstance,{value:function(t){return t instanceof ze&&t.assign!=null&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(hw||(hw={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Im||(Im={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(_m||(_m={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Sm||(Sm={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Tm||(Tm={}));var mN={float32:Sm,int32:Im,bool:_m,complex64:Tm};function Et(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error("Can not upcast "+t+" with "+n)}return mN[t][n]}function tm(t){return Et(t,"int32")}function Qe(t,n){if(t.dtype===n.dtype)return[t,n];var e=Et(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function dC(t,n){E(t.dtype===n.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+n.dtype+") input must match"})}function qm(t){var n=[];return function e(r,o,i){if(r!=null){if(r instanceof ze)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,o,i))}}}}(t,n,new Set),n}var nm,kH=Object.freeze({makeTypesMatch:Qe,assertTypesMatch:dC,isTensorInList:function(t,n){return n.some(function(e){return e.id===t.id})},getTensorsInContainer:qm}),pw=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},t}(),gN=function(){function t(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pw}return t.prototype.ready=function(){return J(this,void 0,void 0,function(){var n,e,r;return ee(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),e=0,o.label=1;case 1:return e<n.length?(r=n[e],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},t.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},t.prototype.registerBackend=function(n,e,r){return r===void 0&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:r},!0)},t.prototype.setBackend=function(n){return J(this,void 0,void 0,function(){var e,r,o;return ee(this,function(i){switch(i.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new fN(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var n=this;lw(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(n.backendInstance)})},t.prototype.disposeRegisteredKernels=function(n){var e=this;lw(n).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(e.registry[n])})},t.prototype.initializeBackend=function(n){var e=this,r=this.registryFactory[n];if(r==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<e.pendingBackendInitId)&&(e.registry[n]=s,e.pendingBackendInit=null,!0)}).catch(function(s){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return n.registryFactory[r].priority-n.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var r=n[e],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(n,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=n,n.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(n,e){var r,o=this,i=null;if(e==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");e=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(n,e,r){n();try{var o=r();return e(),o}catch(i){throw e(),i}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),r={x:n};return this.addTapeNode(this.state.activeScope.name,r,[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},t.prototype.runKernel=function(n,e,r,o,i){return this.runKernelFunc(null,e,null,n,r,o,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(n,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-e-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},t.prototype.runKernelFunc=function(n,e,r,o,i,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],d=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var f,h=function(b){d&&(l=b.map(function(x){return c.keep(c.clone(x))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=Xw(o,this.backendName);return f=v!=null?function(){var b=c.backend.numDataIds();g=v.kernelFunc({inputs:e,attrs:i,backend:c.backend});var x=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,x);var y=x.map(function(C){var T=C.dataId,S=C.shape,I=C.dtype;return c.makeTensorFromDataId(T,S,I)}),w=y.filter(function(C,T){return s[T]});return h((a||[]).slice().concat(w)),y}:function(){var b=c.backend.numDataIds();g=c.tidy(function(){return n(c.backend,h)});var x=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,x),x},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:u.map(function(b){return b.shape})}),Array.isArray(g)?u:u[0]},t.prototype.makeTensor=function(n,e,r,o){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=n;r==="string"&&so(n[0])&&(i=n.map(function(l){return sC(l)}));var a=o.write(i,e,r),s=new ze(e,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),c=oC(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},t.prototype.makeTensorFromDataId=function(n,e,r,o){var i=new ze(e,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},t.prototype.makeVariable=function(n,e,r,o){e===void 0&&(e=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==n.dtype&&(n=n.asType(o));var i=new Yo(n,e,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(n,e){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(o=n.size*Hm(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Yo||this.track(n)},t.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var e=this.state.registeredVariables[n];this.disposeVariable(e)}},t.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},t.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},t.prototype.profile=function(n){return J(this,void 0,void 0,function(){var e,r;return ee(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},t.prototype.addTapeNode=function(n,e,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:r,saved:i},u=lN(n);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(c){return c=c.map(function(l,d){if(l==null){var f=r[d],h=ma(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},t.prototype.keep=function(n){return n.kept=!0,n},t.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(n){for(var e=this,r=qm(n),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},t.prototype.gradients=function(n,e,r,o){var i=this;if(o===void 0&&(o=!1),E(e.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",n)});E(a instanceof ze,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(C=u[h]).inputs;for(var m in p){for(var g=p[m],v=!1,b=0;b<c.length;b++)if(d[g.id]){C.outputs.forEach(function(_){return d[_.id]=!0}),v=!0,f[C.id]=!0;break}if(v)break}}var x={};x[l.id]=!0;var y={};for(h=u.length-1;h>=0;h--)for(p=(C=u[h]).inputs,b=0;b<C.outputs.length;b++)if(x[C.outputs[b].id]){for(var m in p)x[p[m].id]=!0,y[C.id]=!0;break}var w=[];for(h=0;h<u.length;h++){var C;if(f[(C=u[h]).id]&&y[C.id]){var T={};for(var m in C.inputs){var S=C.inputs[m];d[S.id]&&(T[m]=S)}var I=Object.assign({},C);I.inputs=T,I.outputs=C.outputs,w.push(I)}}return w}(this.state.activeTape,e,a);if(!o&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(u=a.shape,c=$m(te(u),"float32"),R.makeTensor(c,u,"float32")),function(f,h,p){for(var m=function(v){var b=h[v],x=[];if(b.outputs.forEach(function(T){var S=f[T.id];S!=null?x.push(S):x.push(null)}),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var y=b.gradient(x),w=function(T){if(!(T in y))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(y)+".");var S=p(function(){return y[T]()});if(S.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+S.dtype+"'");var I=b.inputs[T];if(!ft(S.shape,I.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+T+"' has shape '"+S.shape+"', which does not match the shape of the input '"+I.shape+"'");if(f[I.id]==null)f[I.id]=S;else{var _=f[I.id];f[I.id]=_.add(S),_.dispose()}};for(var C in b.inputs)w(C)},g=h.length-1;g>=0;g--)m(g)}(l,s,function(f){return i.tidy(f)});var d=e.map(function(f){return l[f.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},t.prototype.customGrad=function(n){var e=this;return E(Ul(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];E(o.every(function(s){return s instanceof ze}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return E((r=n.apply(void 0,o.concat([u]))).value instanceof ze,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),E(Ul(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];E(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),E(l.every(function(f){return f instanceof ze}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},t.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},t.prototype.time=function(n){return J(this,void 0,void 0,function(){var e,r;return ee(this,function(o){switch(o.label){case 0:return e=Wn(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=Wn()-e,[2,r]}})})},t.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pw,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),R=function(){var t=function(){if(nm==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}nm=e}return nm}();if(t._tfengine==null){var n=new uN(t);t._tfengine=new gN(n)}return function(e){Kw=e}(t._tfengine.ENV),cr=function(){return t._tfengine},t._tfengine}();function fC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Tr=P();Tr.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Tr.registerFlag("IS_BROWSER",function(){return fC()}),Tr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Tr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Tr.registerFlag("PROD",function(){return!1}),Tr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Tr.getBool("DEBUG")}),Tr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Tr.registerFlag("IS_TEST",function(){return!1});var Xs,fn,dn,zo={},rm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hC(t,n){zo[t]=n}function hr(t){t in zo||(zo[t]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete zo[e]},!1),e===1?r.getContext("webgl",rm)||r.getContext("experimental-webgl",rm):r.getContext("webgl2",rm)}(t));var n=zo[t];return n.isContextLost()?(delete zo[t],hr(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),zo[t])}function ed(t,n){return[n,t]}function zs(t){var n=te(t);return Vl(Math.ceil(n/4))}function nu(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function Km(t,n){var e,r,o,i,a,s,u,c,l,d=t;return P().getNumber("WEBGL_VERSION")===2?(e=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=t.RGBA,r=t.RGBA,o=t.RGBA,i=d.RGBA,a=t.RGBA,s=4,u=4,c=n!=null?n.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Z(t,n,e){var r=e();return n&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+mC(o,i))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Xs||(Xs={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(fn||(fn={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(dn||(dn={}));var vN=596e-10,yN=65504;function pC(t){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||vN<Math.abs(t)&&Math.abs(t)<yN)}function mC(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function Us(t,n,e){return kr(t,n,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function gC(t,n,e){var r=kr(t,n,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Z(t,n,function(){return t.shaderSource(r,e)}),Z(t,n,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function vC(t,n,e){var r=kr(t,n,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Z(t,n,function(){return t.shaderSource(r,e)}),Z(t,n,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw function(o,i){var a=bN.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),c=u.length.toString().length+2,l=u.map(function(g,v){return Ko((v+1).toString(),c)+g}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,s-1),p=l.slice(s-1,s),m=l.slice(s);console.log(h.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Ko(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Al,Nl,bN=/ERROR: [0-9]+:([0-9]+):/g;function yC(t,n){return kr(t,n,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function bC(t,n,e){if(Z(t,n,function(){return t.linkProgram(e)}),t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function kl(t,n,e){if(Z(t,n,function(){return t.validateProgram(e)}),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function xC(t,n,e){var r=kr(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Z(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Z(t,n,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function wC(t,n,e){var r=kr(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Z(t,n,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Z(t,n,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function CC(t,n){return kr(t,n,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function DC(t,n){var e=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){var r="["+t+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e)throw r="["+t+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function EC(t,n){return kr(t,n,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Mm(t,n,e,r,o,i,a,s){var u=t.getAttribLocation(e,r);return u!==-1&&(Z(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),Z(t,n,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),Z(t,n,function(){return t.enableVertexAttribArray(u)}),!0)}function IC(t,n,e,r){RC(t,r),Z(t,n,function(){return t.activeTexture(t.TEXTURE0+r)}),Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function _C(t,n,e,r){return kr(t,n,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function SC(t,n,e){return t.getUniformLocation(n,e)}function TC(t,n,e,r,o,i){Z(t,n,function(){return IC(t,n,r,i)}),Z(t,n,function(){return t.uniform1i(o,i)})}function Fl(t,n,e,r){Z(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Z(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function Rm(t,n,e){Z(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),Z(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Ws(t){var n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+MC(t,n))}function MC(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function kr(t,n,e,r){var o=Z(t,n,function(){return e()});if(o==null)throw new Error(r);return o}function RC(t,n){var e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function Ys(t,n){return n===void 0&&(n=2),te(t.slice(0,t.length-n))}function Qs(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Pl(t){var n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[Ys(t)].concat(Qs(t))),n}function AC(t,n){var e;n===void 0&&(n=!1);var r=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,(t=t.map(function(c,l){return l>=t.length-2?Wm(t[l]):t[l]})).length===1&&(t=[2,t[0]])),t.length!==2){var o=ao(t);t=o.newShape}var i=te(t);if(t.length<=1&&i<=r)return[1,i];if(t.length===2&&t[0]<=r&&t[1]<=r)return t;if(t.length===3&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(n){var a=Ys(t),s=2,u=2;return t.length&&(s=(e=Qs(t))[0],u=e[1]),Vl(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return Vl(i)}function Cl(t){return t%2==0}function Hs(t,n){if(ft(t=t.slice(-2),n=n.slice(-2))||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){var e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||Cl(e)&&Cl(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&Cl(t[0])&&Cl(n[0])}function NC(t){if(Al==null){var n=hr(t);Al=n.getParameter(n.MAX_TEXTURE_SIZE)}return Al}function kC(t){if(Nl==null){var n=hr(t);Nl=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Nl)}function FC(t){if(t===0)return 0;var n=hr(t);return hn(n,"EXT_disjoint_timer_query_webgl2")&&t===2?2:hn(n,"EXT_disjoint_timer_query")?1:0}function hn(t,n){return t.getExtension(n)!=null}function Am(t){try{if(hr(t)!=null)return!0}catch{return!1}return!1}function PC(t){if(t===0)return!1;var n=hr(t);if(t===1){if(!hn(n,"OES_texture_float"))return!1}else if(!hn(n,"EXT_color_buffer_float"))return!1;return Nm(n)}function OC(t){if(t===0)return!1;var n=hr(t);if(t!==1){if(hn(n,"EXT_color_buffer_float"))return Nm(n);if(hn(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=Km(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(n,e)}return!1}return!!hn(n,"OES_texture_float")&&!!hn(n,"WEBGL_color_buffer_float")&&Nm(n)}function Nm(t){var n=Km(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(r),o}function LC(t){return t===2&&hr(t).fenceSync!=null}var xN=Object.freeze({callAndCheck:Z,canBeRepresented:pC,getWebGLErrorMessage:mC,getExtensionOrThrow:Us,createVertexShader:gC,createFragmentShader:vC,createProgram:yC,linkProgram:bC,validateProgram:kl,createStaticVertexBuffer:xC,createStaticIndexBuffer:wC,getNumChannels:function(){return P().getNumber("WEBGL_VERSION")===2?1:4},createTexture:CC,validateTextureSize:DC,createFramebuffer:EC,bindVertexBufferToProgramAttribute:Mm,bindTextureUnit:IC,unbindTextureUnit:function(t,n,e){RC(t,e),Z(t,n,function(){return t.activeTexture(t.TEXTURE0+e)}),Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:_C,getProgramUniformLocation:SC,bindTextureToProgramUniformSampler:TC,bindCanvasToFramebuffer:function(t,n){Z(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Z(t,n,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Z(t,n,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:Fl,unbindColorTextureFromFramebuffer:Rm,validateFramebuffer:Ws,getFramebufferErrorMessage:MC,getBatchDim:Ys,getRowsCols:Qs,getShapeAs3D:Pl,getTextureShapeFromLogicalShape:AC,isReshapeFree:Hs,getWebGLMaxTextureSize:NC,resetMaxTextureSize:function(){Al=null},resetMaxTexturesInShader:function(){Nl=null},getMaxTexturesInShader:kC,getWebGLDisjointQueryTimerVersion:FC,hasExtension:hn,isWebGLVersionEnabled:Am,isCapableOfRenderingToFloatTexture:PC,isDownloadFloatTextureEnabled:OC,isWebGLFenceEnabled:LC}),ue=P();function BC(t){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function H(t,n){return R.tidy(t,n)}function en(t){qm(t).forEach(function(n){return n.dispose()})}function wN(t){return R.keep(t)}function Hl(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];P().getBool("IS_TEST")||console.warn.apply(console,t)}function fr(t,n){var e=t;if(Pt(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(e)||Pt(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Pt(i))return void E(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});E(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),E(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}(t,r,[]),r}function mw(t,n,e,r){if(t!=null&&(t!=="numeric"&&t!==n||t==="numeric"&&n==="string"))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+t+" tensor, but got "+n+" tensor")}function D(t,n,e,r){if(r===void 0&&(r="numeric"),t instanceof ze)return mw(r,t.dtype,n,e),t;var o=pa(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),mw(r,o,n,e),t==null||!Pt(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){var i=t==null?"null":t.constructor.name;throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=fr(t,o);Pt(t)||Array.isArray(t)||(t=[t]);var s=o!=="string"?zm(t,o,P().getBool("DEBUG")):Nr(t,[],!0);return R.makeTensor(s,a,o)}function zl(t,n,e,r){if(r===void 0&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(o,i){return D(o,n+"["+i+"]",e)},r)}function Xm(t,n){for(var e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function jC(t,n,e){for(var r=t.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)e.indexOf(s)===-1?o.push(t[i++]):o.push(n[a++]);return o}function Ft(t,n){for(var e=[],r=t.length,o=0;o<r;o++)n.indexOf(o)===-1&&e.push(t[o]);return[e,n.map(function(i){return t[i]})]}function zt(t,n){return jC(t,n.map(function(e){return 1}),n)}function Zt(t,n,e){E(Xm(n,e),function(){return t+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function Gn(t,n){if(Xm(t,n))return null;for(var e=[],r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(function(o){return e.push(o)}),e}function td(t){return t.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function qn(t,n){for(var e=[],r=n-t;r<n;++r)e.push(r);return e}function VC(t,n){var e=t[0].length;t.forEach(function(o,i){E(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),E(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=t[0];t.forEach(function(o,i){for(var a=0;a<e;a++)E(a===n||o[a]===r[a],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function Qo(t,n){for(var e=t[0].slice(),r=1;r<t.length;r++)e[n]+=t[r][n];return e}function M(t){var n=Object.keys(t);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];R.startScope(e);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),R.endScope(s),s}catch(u){throw R.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}ue.registerFlag("HAS_WEBGL",function(){return ue.getNumber("WEBGL_VERSION")>0}),ue.registerFlag("WEBGL_VERSION",function(){return Am(2)?2:Am(1)?1:0}),ue.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return ue.get("WEBGL_VERSION")===2}),ue.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ue.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ue.registerFlag("WEBGL_PACK",function(){return ue.getBool("HAS_WEBGL")}),ue.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_CLIP",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ue.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_PACK_REDUCE",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_CONV_IM2COL",function(){return ue.getBool("WEBGL_PACK")}),ue.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return NC(ue.getNumber("WEBGL_VERSION"))}),ue.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return kC(ue.getNumber("WEBGL_VERSION"))}),ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=ue.getNumber("WEBGL_VERSION");return t===0?0:FC(t)}),ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ue.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),ue.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return PC(ue.getNumber("WEBGL_VERSION"))}),ue.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ue.getBool("WEBGL_FORCE_F16_TEXTURES")&&ue.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ue.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return OC(ue.getNumber("WEBGL_VERSION"))}),ue.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return LC(ue.getNumber("WEBGL_VERSION"))}),ue.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ue.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),lC=BC;var kt=M({complex_:function(t,n){var e=D(t,"real","complex"),r=D(n,"imag","complex");return Le(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),R.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),_n=M({real_:function(t){var n=D(t,"input","real");return R.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),lr=M({imag_:function(t){var n=D(t,"input","imag");return R.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function It(t,n,e){return lo(t,n,fr(t,e),e)}function lo(t,n,e,r){if(r==null&&(r=pa(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Pt(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Gm(n);var o=te(n),i=te(e);E(o===i,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<e.length;++a){var s=e[a],u=a!==e.length-1||s!==te(n.slice(a));E(e[a]===n[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return Pt(t)||Array.isArray(t)||(t=[t]),n=n||e,t=r!=="string"?zm(t,r,P().getBool("DEBUG")):Nr(t,[],!0),R.makeTensor(t,n,r)}function K(t,n){if((Pt(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Pt(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return lo(t,[],[],n)}function qe(t,n){ei(t);var e=fr(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return lo(t,null,e,n)}function dr(t,n,e){if(ei(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=fr(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return lo(t,n,r,e)}function nd(t,n,e){if(ei(t),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=fr(t,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return lo(t,n,r,e)}function xt(t,n,e){if(ei(t),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=fr(t,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return lo(t,n,r,e)}function CN(t,n,e){if(ei(t),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=fr(t,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return lo(t,n,r,e)}function DN(t,n,e){if(ei(t),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=fr(t,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return lo(t,n=n||r,r,e)}function EN(t,n,e,r){return n===void 0&&(n=!0),R.makeVariable(t,n,e,r)}function ga(t,n){if(n===void 0&&(n="float32"),n==="complex64"){var e=ga(t,"float32"),r=Ke(t,"float32");return kt(e,r)}var o=$m(te(t),n);return R.makeTensor(o,t,n)}function Ke(t,n){if(n===void 0&&(n="float32"),n==="complex64"){var e=Ke(t,"float32"),r=Ke(t,"float32");return kt(e,r)}var o=ma(te(t),n);return R.makeTensor(o,t,n)}function mn(t,n,e){return R.runKernelFunc(function(r){return r.fill(t,n,e)},{})}function IN(t,n,e){if(e<=0)throw new Error("The number of values should be positive.");return R.runKernelFunc(function(r){return r.linspace(t,n,e)},{})}function $l(t,n,e,r){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e===0)throw new Error("Cannot have a step of zero");if(t===n||t<n&&e<0||n<t&&e>1)return Ke([0],r);var o=ma(Math.abs(Math.ceil((n-t)/e)),r);n<t&&e===1&&(e=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return qe(o,r)}var UC=M({onesLike_:function(t){var n=D(t,"x","onesLike");if(n.dtype==="complex64"){var e=UC(_n(n)),r=ke(lr(n));return kt(e,r)}return R.runKernelFunc(function(o){return o.onesLike(n)},{$x:n},function(o,i){return{$x:function(){return ke(o)}}})}}),ke=M({zerosLike_:function(t){var n=D(t,"x","zerosLike");return R.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,r){return{$x:function(){return ke(e)}}})}}),Ye=M({concat_:function(t,n){n===void 0&&(n=0),E(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=zl(t,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),n=pt(n,e[0].shape)[0];var r=Qo(e.map(function(s){return s.shape}),n);if(te(r)===0)return It([],r);if((e=e.filter(function(s){return s.size>0})).length===1)return e[0];var o=e.map(function(s){return s.shape});VC(o,n);var i=e,a={axis:n};return R.runKernelFunc(function(s){return s.concat(e,n)},i,function(s){var u=o.map(function(c){return c[n]});return Ym(s,u,n).map(function(c){return function(){return c}})},"Concat",a)}}),_N=M({concat1d_:function(t){return Ye(t,0)}}),SN=M({concat2d_:function(t,n){return Ye(t,n)}}),TN=M({concat3d_:function(t,n){return Ye(t,n)}}),MN=M({concat4d_:function(t,n){return Ye(t,n)}}),Ym=M({split_:function(t,n,e){e===void 0&&(e=0);var r,o=D(t,"x","split");return e=pt(e,o.shape)[0],typeof n=="number"?(E(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(o.shape[e]/n)):(E(o.shape[e]===n.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),R.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return Ye(i,e)}}})}});function ti(t,n){return t(n={exports:{}},n.exports),n.exports}var RN=ti(function(t){(function(n,e,r){function o(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var d=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.alea=a})(0,t,!1)}),AN=ti(function(t){(function(n,e,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a})(0,t,!1)}),NN=ti(function(t){(function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a})(0,t,!1)}),kN=ti(function(t){(function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a})(0,t,!1)}),FN=ti(function(t){(function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=f[h]=l^c,u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,m,g=[],v=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,v=Math.max(v,l.length)),h=0,p=-32;p<v;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),p===0&&(m=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(m=m+1640531527|0,h=(d=g[127&p]^=f+m)==0?h+1:0);for(h>=128&&(g[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=g[h+34&127],d=g[h=h+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[h]=f^d;c.w=m,c.X=g,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a})(0,t,!1)}),PN=ti(function(t){(function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a})(0,t,!1)}),$o=ti(function(t){(function(n,e){var r,o=this,i=256,a=6,s="random",u=e.pow(i,a),c=e.pow(2,52),l=2*c,d=i-1;function f(v,b,x){var y=[],w=m(function S(I,_){var N,A=[],B=typeof I;if(_&&B=="object")for(N in I)try{A.push(S(I[N],_-1))}catch{}return A.length?A:B=="string"?I:I+"\0"}((b=b==1?{entropy:!0}:b||{}).entropy?[v,g(n)]:v??function(){try{var S;return r&&(S=r.randomBytes)?S=S(i):(S=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(S)),g(S)}catch{var I=o.navigator,_=I&&I.plugins;return[+new Date,o,_,o.screen,g(n)]}}(),3),y),C=new h(y),T=function(){for(var S=C.g(a),I=u,_=0;S<c;)S=(S+_)*i,I*=i,_=C.g(1);for(;S>=l;)S/=2,I/=2,_>>>=1;return(S+_)/I};return T.int32=function(){return 0|C.g(4)},T.quick=function(){return C.g(4)/4294967296},T.double=T,m(g(C.S),n),(b.pass||x||function(S,I,_,N){return N&&(N.S&&p(N,C),S.state=function(){return p(C,{})}),_?(e[s]=S,I):S})(T,w,"global"in b?b.global:this==e,b.state)}function h(v){var b,x=v.length,y=this,w=0,C=y.i=y.j=0,T=y.S=[];for(x||(v=[x++]);w<i;)T[w]=w++;for(w=0;w<i;w++)T[w]=T[C=d&C+v[w%x]+(b=T[w])],T[C]=b;(y.g=function(S){for(var I,_=0,N=y.i,A=y.j,B=y.S;S--;)I=B[N=d&N+1],_=_*i+B[d&(B[N]=B[A=d&A+I])+(B[A]=I)];return y.i=N,y.j=A,_})(i)}function p(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function m(v,b){for(var x,y=v+"",w=0;w<y.length;)b[d&w]=d&(x^=19*b[d&w])+y.charCodeAt(w++);return g(b)}function g(v){return String.fromCharCode.apply(0,v)}if(e["seed"+s]=f,m(e.random(),n),t.exports){t.exports=f;try{r=aw()}catch{}}})([],Math)});$o.alea=RN,$o.xor128=AN,$o.xorwow=NN,$o.xorshift7=kN,$o.xor4096=FN,$o.tychei=PN;var rd=$o.alea,Qm=function(){function t(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=rd(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},t.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},t}(),ON=function(){function t(n,e,r,o){this.alpha=n,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=rd(i.toString()),this.randn=new Qm(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var n,e,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,e=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-a+Math.log(a)),(i=this.randu())<e||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},t}(),LN=function(){function t(n,e,r,o){var i=this;if(n===void 0&&(n=0),e===void 0&&(e=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=rd(o)}return t.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function de(t,n,e){return n===void 0&&(n="float32"),n=n||"float32",Gm(t),new Ks(t,n,e)}function BN(t,n){n===void 0&&(n=!1),console.log(t.toString(n))}var WC=M({batchToSpaceND_:function(t,n,e){var r=D(t,"x","batchToSpaceND"),o=n.reduce(function(i,a){return i*a});return E(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),E(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),E(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o}),R.runKernelFunc(function(i){return i.batchToSpaceND(r,n,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(n,e)}}})}}),jN=M({broadcastTo_:function(t,n){var e=D(t,"broadcastTo","x"),r=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var o=e.shape.slice();o.length<n.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(e.shape[a]===n[a])i[a]=1;else if(e.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return s.length===0?e.clone():R.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),VN=M({cast_:function(t,n){var e=D(t,"x","cast");if(!nC(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:n};return R.runKernelFunc(function(o){return o.cast(e,n)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),UN=M({clone_:function(t){var n=D(t,"x","clone",null);return R.runKernelFunc(function(){return R.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),WN=M({cumsum_:function(t,n,e,r){n===void 0&&(n=0),e===void 0&&(e=!1),r===void 0&&(r=!1);var o=D(t,"x","cumsum"),i=Gn([n|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=qn(1,o.rank)[0],u=R.runKernelFunc(function(c){return c.cumsum(a,s,e,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(n,e,!r)}}});return i!=null&&(u=u.transpose(i)),u}}),HN=M({depthToSpace_:function(t,n,e){e===void 0&&(e="NHWC");var r=D(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],a=e==="NHWC"?r.shape[3]:r.shape[1];return E(o*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+n+`  for depthToSpace with input shape
      `+r.shape}),E(i*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+n+` for depthToSpace with input shape
          `+r.shape}),E(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),R.runKernelFunc(function(s){return s.depthToSpace(r,n,e)},{$x:r})}}),Bt=M({expandDims_:function(t,n){n===void 0&&(n=0);var e=D(t,"x","expandDims",null);E(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return n<0&&(E(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),r.splice(n,0,1),Gt(e,r)}}),HC=M({eye_:function(t,n,e,r){r===void 0&&(r="float32"),n==null&&(n=t);for(var o=de([t,n],r),i=t<=n?t:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,n);if(e==null)return s;if(e.length===1)return Xo(Bt(s,0),[e[0],1,1]);if(e.length===2)return Xo(Bt(Bt(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return Xo(Bt(Bt(Bt(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),zN=M({multinomial_:function(t,n,e,r){r===void 0&&(r=!1);var o=D(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=a===1?o.as2D(1,-1):o,u=R.runKernelFunc(function(c){return c.multinomial(s,r,n,e)},{logits2D:s});return a===1?u.as1D():u}}),km=M({oneHot_:function(t,n,e,r){if(e===void 0&&(e=1),r===void 0&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=D(t,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),R.runKernelFunc(function(a){return a.oneHot(o,n,e,r)},{$indices:o},function(a){return{$indices:function(){return Ke(o.shape,"float32")}}}).reshape(i)}}),Fr=M({pad_:function(t,n,e){e===void 0&&(e=0);var r=D(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:n,constantValue:e};return R.runKernelFunc(function(i){return i.pad(r,n,e)},{x:r},function(i){var a=n.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",o)}}),$N=M({pad1d_:function(t,n,e){return e===void 0&&(e=0),E(n.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Fr(t,[n],e)}}),GN=M({pad2d_:function(t,n,e){return e===void 0&&(e=0),E(n.length===2&&n[0].length===2&&n[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fr(t,n,e)}}),qN=M({pad3d_:function(t,n,e){return e===void 0&&(e=0),E(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fr(t,n,e)}}),KN=M({pad4d_:function(t,n,e){return e===void 0&&(e=0),E(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Fr(t,n,e)}}),XN=M({rand_:function(t,n,e){var r=te(t),o=null;if(e==null||e==="float32")o=new Float32Array(r);else if(e==="int32")o=new Int32Array(r);else{if(e!=="bool")throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return R.makeTensor(o,t,e)}}),YN=M({randomNormal_:function(t,n,e,r,o){if(n===void 0&&(n=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Qm(n,e,r,!1,o),a=de(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),QN=M({randomGamma_:function(t,n,e,r,o){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new ON(n,e,r,o),a=de(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),zC=M({randomUniform_:function(t,n,e,r,o){n===void 0&&(n=0),e===void 0&&(e=1),r===void 0&&(r="float32");for(var i=de(t,r),a=new LN(n,e,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Gt=M({reshape_:function(t,n){var e=D(t,"x","reshape",null);n=eC(n,e.size),E(e.size===te(n),function(){return"new shape and old shape must have the same number of elements."});var r={shape:n};return R.runKernelFunc(function(o){return o.reshape(e,n)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",r)}}),$C=M({spaceToBatchND_:function(t,n,e){var r=D(t,"x","spaceToBatchND");return E(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),E(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),E(r.shape.reduce(function(o,i,a){return a>0&&a<=n.length?o&&(i+e[a-1][0]+e[a-1][1])%n[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),R.runKernelFunc(function(o){return o.spaceToBatchND(r,n,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(n,e)}}})}}),GC=M({squeeze_:function(t,n){var e=D(t,"x","squeeze");return Gt(e,ao(e.shape,n).newShape)}}),Ot=M({stack_:function(t,n){n===void 0&&(n=0);var e=zl(t,"tensors","stack");if(E(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(n);var r=e[0].rank,o=e[0].shape,i=e[0].dtype;E(n<=r,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Le(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){E(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(n)});return Ye(a,n)}}),Xo=M({tile_:function(t,n){var e=D(t,"x","tile",null);E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."});var r=[e],o={reps:n};return R.runKernelFunc(function(i,a){var s=i.tile(e,n);return a([e]),s},{x:e},function(i,a){var s=a[0];return{x:function(){var u=ke(s);if(s.rank===1)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,r)}}),ZN=M({truncatedNormal_:function(t,n,e,r,o){if(n===void 0&&(n=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Qm(n,e,r,!0,o),a=de(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Ue=M({unstack_:function(t,n){n===void 0&&(n=0),n=n||0;var e=D(t,"x","unstack");E(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length);var r={axis:n};return R.runKernelFunc(function(o){return o.unstack(e,n)},{x:e},function(o){return{x:function(){return Ot(o,n)}}},"Unpack",r)}}),JN=function(t,n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return ee(this,function(f){switch(f.label){case 0:return e=D(t,"x","setdiff1d"),r=D(n,"y","setdiff1d"),E(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),E(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),E(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Ks([s],e.dtype),c=new Ks([s],"int32"),l=0,d=0;l<o.length;l++)a.has(o[l])||(u.values[d]=o[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})};function Gl(t,n,e,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([t[a+1]/n[a],n[a]]);o=o.concat(t.slice(i+1))}return o}function ql(t,n,e){e===void 0&&(e=!0);var r=[];if(e){r.push(n);for(var o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Kl(t,n,e,r){r===void 0&&(r=!0);var o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(var i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function qC(t,n){for(var e=[0],r=0;r<n;++r)e.push(t[r][0]);return e}function KC(t,n,e){for(var r=t.slice(0,1),o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}function Zm(t,n){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+t.rank);if(t.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var e=n.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var a=t.shape,s=e.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=Hn(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}var FH=Object.freeze({prepareAndValidate:Zm}),Jm=30;function Ol(t){return t<=Jm?t:Wl(t,Math.floor(Math.sqrt(t)))}function XC(t,n,e){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(e.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+e.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<e.rank-o;++a)if(e.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+e.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function YC(t,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(t.size===0)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}XC(e,n,t)}function Zs(t,n,e){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,a=1,s=o;s<i;++s)a*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:te(n.shape)/u,sliceSize:a,strides:Hn(e.slice(0,o)).concat([1]),outputSize:te(e)}}var PH=Object.freeze({validateUpdateShape:XC,validateInput:YC,calculateShapes:Zs});function QC(t,n,e){E(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+n+" must match the rank of the array ("+t.rank+")."}),E(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of size "+e+" must match the rank of the array ("+t.rank+")."});for(var r=function(i){E(n[i]+e[i]<=t.shape[i],function(){return"Error in slice"+t.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+e[i])+") would overflow input.shape["+i+"] ("+t.shape[i]+")"})},o=0;o<t.rank;++o)r(o)}function Fm(t){for(var n=[],e=0;t>0;)1&t&&n.push(e),t/=2,e++;return n}function od(t,n,e){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function ZC(t,n,e,r,o){var i=n[o],a=e[o]||1;(t&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=jl(0,i,s-1)}function JC(t,n,e,r,o){var i=n[o],a=e[o]||1;(t&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?jl(0,i,s):jl(-1,i,s-1)}function eg(t,n,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function tg(t,n){for(var e=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}var OH=Object.freeze({assertParamsValid:QC,maskToAxes:Fm,computeOutShape:od,startForAxis:ZC,stopForAxis:JC,isSliceContinous:eg,computeFlatOffset:tg});function ek(t,n){E(Ul(t),function(){return"The f passed in variableGrads(f) must be a function"}),E(n==null||Array.isArray(n)&&n.every(function(l){return l instanceof Yo}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=n!=null;if(!e)for(var r in n=[],R.registeredVariables)n.push(R.registeredVariables[r]);var o=e?n.filter(function(l){return!l.trainable}):null,i=n.length;E((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=R.gradients(t,n,null,!0),s=a.value,u=a.grads;E(u.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),E(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(l,d){u[d]!=null&&(c[l.name]=u[d])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}function id(t){return R.customGrad(t)}var qt=M({softmax_:function(t,n){n===void 0&&(n=-1);var e=D(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return R.runKernelFunc(function(r,o){var i=r.softmax(e,n);return o([i]),i},{logits:e},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}},"Softmax",{dim:n},[],[!0])}}),tk=M({logSoftmax_:function(t,n){n===void 0&&(n=-1);var e=D(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return id(function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),eD=function(){function t(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},t.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},t.prototype.has=function(n){return this.data.has(n)},t.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),tD=function(){function t(){}return t.prototype.time=function(n){return k("time")},t.prototype.read=function(n){return k("read")},t.prototype.readSync=function(n){return k("readSync")},t.prototype.numDataIds=function(){return k("numDataIds")},t.prototype.disposeData=function(n){return k("disposeData")},t.prototype.write=function(n,e,r){return k("write")},t.prototype.move=function(n,e,r,o){return k("move")},t.prototype.memory=function(){return k("memory")},t.prototype.floatPrecision=function(){return k("floatPrecision")},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.batchMatMul=function(n,e,r,o){return k("batchMatMul")},t.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,k("fusedBatchMatMul")},t.prototype.slice=function(n,e,r){return k("slice")},t.prototype.stridedSlice=function(n,e,r,o){return k("stridedSlice")},t.prototype.unstack=function(n,e){return k("unstack")},t.prototype.reverse=function(n,e){return k("reverse")},t.prototype.concat=function(n,e){return k("concat")},t.prototype.neg=function(n){return k("neg")},t.prototype.add=function(n,e){return k("add")},t.prototype.addN=function(n){return k("addN")},t.prototype.subtract=function(n,e){return k("subtract")},t.prototype.multiply=function(n,e){return k("multiply")},t.prototype.realDivide=function(n,e){return k("realDivide")},t.prototype.floorDiv=function(n,e){return k("floorDiv")},t.prototype.sum=function(n,e){return k("sum")},t.prototype.prod=function(n,e){return k("prod")},t.prototype.unsortedSegmentSum=function(n,e,r){return k("unsortedSegmentSum")},t.prototype.argMin=function(n,e){return k("argMin")},t.prototype.argMax=function(n,e){return k("argMax")},t.prototype.equal=function(n,e){return k("equal")},t.prototype.notEqual=function(n,e){return k("notEqual")},t.prototype.less=function(n,e){return k("less")},t.prototype.lessEqual=function(n,e){return k("lessEqual")},t.prototype.greater=function(n,e){return k("greater")},t.prototype.greaterEqual=function(n,e){return k("greaterEqual")},t.prototype.logicalNot=function(n){return k("logicalNot")},t.prototype.logicalAnd=function(n,e){return k("logicalAnd")},t.prototype.logicalOr=function(n,e){return k("logicalOr")},t.prototype.where=function(n){return k("where")},t.prototype.select=function(n,e,r){return k("select")},t.prototype.topk=function(n,e,r){return k("topk")},t.prototype.min=function(n,e){return k("min")},t.prototype.minimum=function(n,e){return k("minimum")},t.prototype.mod=function(n,e){return k("mod")},t.prototype.max=function(n,e){return k("max")},t.prototype.maximum=function(n,e){return k("maximum")},t.prototype.all=function(n,e){return k("all")},t.prototype.any=function(n,e){return k("any")},t.prototype.squaredDifference=function(n,e){return k("squaredDifference")},t.prototype.ceil=function(n){return k("ceil")},t.prototype.floor=function(n){return k("floor")},t.prototype.round=function(n){return k("round")},t.prototype.sign=function(n){return k("sign")},t.prototype.isNaN=function(n){return k("isNaN")},t.prototype.isInf=function(n){return k("isInf")},t.prototype.isFinite=function(n){return k("isFinite")},t.prototype.pow=function(n,e){return k("pow")},t.prototype.exp=function(n){return k("exp")},t.prototype.expm1=function(n){return k("expm1")},t.prototype.softmax=function(n,e){return k("softmax")},t.prototype.log=function(n){return k("log")},t.prototype.log1p=function(n){return k("log1p")},t.prototype.sqrt=function(n){return k("sqrt")},t.prototype.rsqrt=function(n){return k("rsqrt")},t.prototype.square=function(n){return k("square")},t.prototype.reciprocal=function(n){return k("reciprocal")},t.prototype.relu=function(n){return k("relu")},t.prototype.relu6=function(n){return k("relu6")},t.prototype.prelu=function(n,e){return k("prelu")},t.prototype.elu=function(n){return k("elu")},t.prototype.eluDer=function(n,e){return k("eluDer")},t.prototype.selu=function(n){return k("selu")},t.prototype.int=function(n){return k("int")},t.prototype.clip=function(n,e,r){return k("clip")},t.prototype.abs=function(n){return k("abs")},t.prototype.complexAbs=function(n){return k("complexAbs")},t.prototype.sigmoid=function(n){return k("sigmoid")},t.prototype.softplus=function(n){return k("softplus")},t.prototype.sin=function(n){return k("sin")},t.prototype.cos=function(n){return k("cos")},t.prototype.tan=function(n){return k("tan")},t.prototype.asin=function(n){return k("asin")},t.prototype.acos=function(n){return k("acos")},t.prototype.atan=function(n){return k("atan")},t.prototype.atan2=function(n,e){return k("atan2")},t.prototype.sinh=function(n){return k("sinh")},t.prototype.cosh=function(n){return k("cosh")},t.prototype.tanh=function(n){return k("tanh")},t.prototype.asinh=function(n){return k("asinh")},t.prototype.acosh=function(n){return k("acosh")},t.prototype.atanh=function(n){return k("atanh")},t.prototype.erf=function(n){return k("erf")},t.prototype.step=function(n,e){return k("step")},t.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,k("fusedConv2d")},t.prototype.conv2d=function(n,e,r){return k("conv2d")},t.prototype.conv2dDerInput=function(n,e,r){return k("conv2dDerInput")},t.prototype.conv2dDerFilter=function(n,e,r){return k("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,k("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(n,e,r){return k("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(n,e,r){return k("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(n,e,r){return k("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(n,e,r){return k("conv3d")},t.prototype.conv3dDerInput=function(n,e,r){return k("conv3dDerInput")},t.prototype.conv3dDerFilter=function(n,e,r){return k("conv3dDerFilter")},t.prototype.maxPool=function(n,e){return k("maxPool")},t.prototype.maxPoolBackprop=function(n,e,r,o){return k("maxPoolBackprop")},t.prototype.avgPool=function(n,e){return k("avgPool")},t.prototype.avgPoolBackprop=function(n,e,r){return k("avgPoolBackprop")},t.prototype.avgPool3d=function(n,e){return k("avgPool3d")},t.prototype.avgPool3dBackprop=function(n,e,r){return k("avgPool3dBackprop")},t.prototype.maxPool3d=function(n,e){return k("maxPool3d")},t.prototype.maxPool3dBackprop=function(n,e,r,o){return k("maxPool3dBackprop")},t.prototype.reshape=function(n,e){return k("reshape")},t.prototype.cast=function(n,e){return k("cast")},t.prototype.tile=function(n,e){return k("tile")},t.prototype.pad=function(n,e,r){return k("pad")},t.prototype.transpose=function(n,e){return k("transpose")},t.prototype.gather=function(n,e,r){return k("gather")},t.prototype.gatherND=function(n,e){return k("gatherND")},t.prototype.scatterND=function(n,e,r){return k("scatterND")},t.prototype.batchToSpaceND=function(n,e,r){return k("batchToSpaceND")},t.prototype.spaceToBatchND=function(n,e,r){return k("spaceToBatchND")},t.prototype.resizeBilinear=function(n,e,r,o){return k("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(n,e,r){return k("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(n,e,r,o){return k("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(n,e,r){return k("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(n,e,r,o,i,a){return k("batchNormalization")},t.prototype.localResponseNormalization4D=function(n,e,r,o,i){return k("localResponseNormalization4D")},t.prototype.LRNGrad=function(n,e,r,o,i,a,s){return k("LRNGrad")},t.prototype.multinomial=function(n,e,r,o){return k("multinomial")},t.prototype.oneHot=function(n,e,r,o){return k("oneHot")},t.prototype.cumsum=function(n,e,r,o){return k("cumsum")},t.prototype.nonMaxSuppression=function(n,e,r,o,i){return k("nonMaxSuppression")},t.prototype.fft=function(n){return k("fft")},t.prototype.ifft=function(n){return k("ifft")},t.prototype.complex=function(n,e){return k("complex")},t.prototype.real=function(n){return k("real")},t.prototype.imag=function(n){return k("imag")},t.prototype.cropAndResize=function(n,e,r,o,i,a){return k("cropAndResize")},t.prototype.depthToSpace=function(n,e,r){return k("depthToSpace")},t.prototype.split=function(n,e,r){return k("split")},t.prototype.sparseToDense=function(n,e,r,o){return k("sparseToDense")},t.prototype.diag=function(n){return k("diag")},t.prototype.fill=function(n,e,r){return k("fill")},t.prototype.onesLike=function(n){return k("onesLike")},t.prototype.zerosLike=function(n){return k("zerosLike")},t.prototype.linspace=function(n,e,r){return k("linspace")},t.prototype.dispose=function(){return k("dispose")},t}();function k(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ar(t,n){for(var e=t.length,r=[],o=0;o<e;o++){var i=e-1-o,a=t[i]||1;(n[n.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function ht(t,n){for(var e=[],r=0;r<n.length;r++){var o=t[t.length-r-1],i=n.length-r-1,a=n[i];(o==null||o===1&&a>1)&&e.unshift(i)}return e}function Ce(t,n){for(var e=[],r=Math.max(t.length,n.length),o=0;o<r;o++){var i=t[t.length-o-1];i==null&&(i=1);var a=n[n.length-o-1];if(a==null&&(a=1),i===1)e.unshift(a);else if(a===1)e.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+n+".");e.unshift(i)}}return e}function ha(t,n,e,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=Xl(n),c=u[0],l=u[1];if(a==="channelsLast")s=[c,l,t[3],t[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return fo(t,s,e,r,o,i,!1,a)}function Js(t,n,e,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,c=Pm(n),l=c[0],d=c[1],f=c[2];if(a==="NDHWC")u="channelsLast",s=[l,d,f,t[4],t[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,d,f,t[1],t[1]]}return eu(t,s,e,r,o,!1,u,i)}function fo(t,n,e,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if(s==="channelsLast")c=t[0],l=t[1],d=t[2],f=t[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=n[0],m=n[1],g=n[3],v=Xl(e),b=v[0],x=v[1],y=Xl(r),w=y[0],C=y[1],T=ua(p,w),S=ua(m,C),I=function(O,L,U,V,j,z,$,Q){var ne,ie,ye;if(typeof O=="number"){ne={top:O,bottom:O,left:O,right:O,type:O===0?"VALID":"NUMBER"};var be=function(_e,He,Pe,ot,Je){ot==null&&(ot=ng(_e,He,Pe));var et=_e[0],Qn=_e[1],Zn=$s((et-He+2*ot)/Pe+1,Je);E(nt(Zn),function(){return"The output # of rows ("+Zn+") must be an integer. Change the stride and/or zero pad parameters"});var nn=$s((Qn-He+2*ot)/Pe+1,Je);return E(nt(nn),function(){return"The output # of columns ("+nn+") must be an integer. Change the stride and/or zero pad parameters"}),[Zn,nn]}([L,U],z,V,O,Q);ie=be[0],ye=be[1]}else if(O==="same"){ie=Math.ceil(L/V),ye=Math.ceil(U/j);var De=Math.max(0,(ie-1)*V+z-L),Te=Math.max(0,(ye-1)*j+$-U),Ie=Math.floor(De/2),Me=De-Ie,at=Math.floor(Te/2);ne={top:Ie,bottom:Me,left:at,right:Te-at,type:"SAME"}}else{if(O!=="valid")throw Error("Unknown padding parameter: "+O);ne={top:0,bottom:0,left:0,right:0,type:"VALID"},ie=Math.ceil((L-z+1)/V),ye=Math.ceil((U-$+1)/j)}return{padInfo:ne,outHeight:ie,outWidth:ye}}(o,l,d,b,x,T,S,i),_=I.padInfo,N=I.outHeight,A=I.outWidth,B=a?g*f:g;return s==="channelsFirst"?h=[c,B,N,A]:s==="channelsLast"&&(h=[c,N,A,B]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:N,outWidth:A,outChannels:B,padInfo:_,strideHeight:b,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:C,inShape:t,outShape:h,filterShape:n}}function eu(t,n,e,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if(a==="channelsLast")c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,m=n[0],g=n[1],v=n[2],b=n[4],x=Pm(e),y=x[0],w=x[1],C=x[2],T=Pm(r),S=T[0],I=T[1],_=T[2],N=ua(m,S),A=ua(g,I),B=ua(v,_),O=function($,Q,ne,ie,ye,be,De,Te,Ie,Me,at){var _e,He,Pe,ot;if(typeof $=="number"){_e={top:$,bottom:$,left:$,right:$,front:$,back:$,type:$===0?"VALID":"NUMBER"};var Je=function(pi,br,Bd,mi,Jn,jd){Jn==null&&(Jn=ng(pi,br,mi));var XE=pi[0],YE=pi[1],QE=pi[2],Vd=$s((XE-br+2*Jn)/mi+1,jd);E(nt(Vd),function(){return"The output # of depths ("+Vd+") must be an integer. Change the stride and/or zero pad parameters"});var Ud=$s((YE-br+2*Jn)/mi+1,jd);E(nt(Ud),function(){return"The output # of rows ("+Ud+") must be an integer. Change the stride and/or zero pad parameters"});var Wd=$s((QE-br+2*Jn)/mi+1,jd);return E(nt(Wd),function(){return"The output # of columns ("+Wd+") must be an integer. Change the stride and/or zero pad parameters"}),[Vd,Ud,Wd,Bd]}([Q,ne,ie,1],Te,1,ye,$,at);He=Je[0],Pe=Je[1],ot=Je[2]}else if($==="same"){He=Math.ceil(Q/ye),Pe=Math.ceil(ne/be),ot=Math.ceil(ie/De);var et=(He-1)*ye+Te-Q,Qn=(Pe-1)*be+Ie-ne,Zn=(ot-1)*De+Me-ie,nn=Math.floor(et/2),hi=et-nn,vr=Math.floor(Qn/2),$r=Qn-vr,yr=Math.floor(Zn/2);_e={top:vr,bottom:$r,left:yr,right:Zn-yr,front:nn,back:hi,type:"SAME"}}else{if($!=="valid")throw Error("Unknown padding parameter: "+$);_e={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},He=Math.ceil((Q-Te+1)/ye),Pe=Math.ceil((ne-Ie+1)/be),ot=Math.ceil((ie-Me+1)/De)}return{padInfo:_e,outDepth:He,outHeight:Pe,outWidth:ot}}(o,l,d,f,y,w,C,N,A,B,s),L=O.padInfo,U=O.outDepth,V=O.outHeight,j=O.outWidth,z=i?b*h:b;return a==="channelsFirst"?p=[c,z,U,V,j]:a==="channelsLast"&&(p=[c,U,V,j,z]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:U,outHeight:V,outWidth:j,outChannels:z,padInfo:L,strideDepth:y,strideHeight:w,strideWidth:C,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:N,effectiveFilterHeight:A,effectiveFilterWidth:B,dilationDepth:S,dilationHeight:I,dilationWidth:_,inShape:t,outShape:p,filterShape:n}}function ng(t,n,e,r){r===void 0&&(r=1);var o=ua(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function Xl(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function Pm(t){return typeof t=="number"?[t,t,t]:t}function ua(t,n){return n<=1?t:t+(t-1)*(n-1)}function $s(t,n){if(!n)return t;switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+n)}}function Zo(t){var n=Xl(t),e=n[0],r=n[1],o=n[2];return e===1&&r===1&&o===1}function $t(t,n){return Zo(t)||Zo(n)}function ad(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function rg(t,n,e){if(n==="complex64"){if(t.dtype==="complex64")return t.clone();var r=Ke(t.shape),o=t.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!rC(t.dtype,n))return R.makeTensorFromDataId(t.dataId,t.shape,n);if(t.dtype==="complex64"){var a=e.real(t);return i=a.cast(n),a.dispose(),i}if(n==="int32")return e.int(t);if(n==="bool"){var s=K(0,t.dtype);return i=e.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+n)}function Yl(t,n){return R.makeTensorFromDataId(t.dataId,n,t.dtype)}function og(t,n,e){var r=(n-t)/(e-1),o=ma(e,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return qe(o,"float32")}var LH=Object.freeze({castTensor:rg,reshapeTensor:Yl,linspaceImpl:og,upcastType:Et,axesAreInnerMostDims:Xm,combineLocations:jC,computeOutAndReduceShapes:Ft,expandShapeToKeepDim:zt,assertAxesAreInnerMostDims:Zt,getAxesPermutation:Gn,getUndoAxesPermutation:td,getInnerMostAxes:qn,getBroadcastDims:Ar,getReductionAxes:ht,assertAndGetBroadcastShape:Ce,assertParamsConsistent:VC,computeOutShape:Qo,computePool2DInfo:ha,computePool3DInfo:Js,computeConv2DInfo:fo,computeConv3DInfo:eu,computeDefaultPad:ng,tupleValuesAreOne:Zo,eitherStridesOrDilationsAreOne:$t,convertConv2DDataFormat:ad,PARALLELIZE_THRESHOLD:Jm,computeOptimalWindowSize:Ol});function Om(t,n){if(t.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+n.length+".");for(var e=new Float32Array(2*t.length),r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function gw(t,n){return{real:t[2*n],imag:t[2*n+1]}}function nk(t,n,e,r){t[2*r]=n,t[2*r+1]=e}function rk(t,n,e){var r=(e?2:-2)*Math.PI*(t/n);return{real:Math.cos(r),imag:Math.sin(r)}}function ok(t,n,e){var r=function(i,a,s){return function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var m=l(c,u[h=d+(f-d>>>1)]);m>0?d=h+1:(f=h,p=!m)}return p?d:-d-1}(i,a,s||ik)}(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function ik(t,n){return t>n?1:t<n?-1:0}function ig(t,n,e,r,o){return nD(t,n,e,r,o,0).selectedIndices}function ag(t,n,e,r,o,i){var a=nD(t,n,e,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function nD(t,n,e,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s=!1);for(var u=Array.from(n).map(function(y,w){return{score:y,boxIndex:w,suppressBeginIndex:0}}).filter(function(y){return y.score>o}).sort(vw),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,m=f.suppressBeginIndex;if(h<o)break;for(var g=!1,v=l.length-1;v>=m;--v){var b=ak(t,p,l[v]);if(b>=r){g=!0;break}if(f.score=f.score*sk(r,c,b),f.score<=o)break}f.suppressBeginIndex=l.length,g||(f.score===h?(l.push(p),d.push(f.score)):f.score>o&&ok(u,f,vw))}var x=l.length;return s&&(l.fill(0,x),d.fill(0,x)),{selectedIndices:qe(l,"int32"),selectedScores:qe(d,"float32"),numValidOutputs:K(x,"int32")}}function ak(t,n,e){var r=t.subarray(4*n,4*n+4),o=t.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var m=Math.max(i,c),g=Math.max(a,l),v=Math.min(s,d),b=Math.min(u,f),x=Math.max(v-m,0)*Math.max(b-g,0);return x/(h+p-x)}function sk(t,n,e){var r=Math.exp(n*e*e);return e<=t?r:0}function vw(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function rD(t,n,e){var r=new Array(t.rank).fill(0),o=t.shape.slice();return n.map(function(i){o[e]=i;var a=t.slice(r,o);return r[e]+=i,a})}function oD(t,n){for(var e=new Array(t.rank),r=0;r<e.length;r++)e[r]=t.shape[r]*n[r];var o=de(e,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function iD(t,n,e,r,o){for(var i=n[n.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=fa(e,s*r),l=fa("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort(function(y,w){return w.value-y.value});var g=d*r,v=c.subarray(g,g+r),b=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,b[m]=p[m].index}var x=n.slice();return x[x.length-1]=r,[It(c,x,e),It(l,x,"int32")]}function sg(t,n){for(var e=[],r=0;r<n.length;r++)n[r]&&e.push(r);var o=de(t,"int32"),i=de([e.length,t.length],"int32");for(r=0;r<e.length;r++){var a=o.indexToLoc(e[r]),s=r*t.length;i.values.set(a,s)}return i.toTensor()}var uk=function(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},ck=function(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},lk=function(t,n,e){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=t.inSize,a=Math.ceil(i/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=n==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function aD(t,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return t+"."+e})}function Jt(t,n){return n===1?[t]:aD(t,n)}function jt(){var t,n,e,r,o,i,a,s,u,c;return P().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Go(t,n,e){e===void 0&&(e="index");var r=Hn(n);return r.map(function(o,i){return"int "+t[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+t[i+1]+" = "+e+" - "+t[i]+" * "+o:"index -= "+t[i]+" * "+o)+";"}).join("")}function ug(t){var n=Hn(t).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var sD=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function dk(t,n,e,r){var o=[];t.forEach(function(h){var p=te(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,s=o.join(`
`),u=t.map(function(h){return function(p,m,g){g===void 0&&(g=!1);var v="";v+=g?uD(p):oa(p);var b=p.shapeInfo.logicalShape,x=m.logicalShape;return b.length<=x.length&&(v+=g?function(y,w){var C,T=y.name,S=T.charAt(0).toUpperCase()+T.slice(1),I="get"+S+"AtOutCoords",_=y.shapeInfo.logicalShape.length,N=w.logicalShape.length,A=Ar(y.shapeInfo.logicalShape,w.logicalShape),B=Xe(N),O=N-_,L=["x","y","z","w","u","v"];C=_===0?"":N<2&&A.length>=1?"coords = 0;":A.map(function(ne){return"coords."+L[ne+O]+" = 0;"}).join(`
`);var U="";U=N<2&&_>0?"coords":y.shapeInfo.logicalShape.map(function(ne,ie){return"coords."+L[ie+O]}).join(", ");var V="return outputValue;",j=te(y.shapeInfo.logicalShape)===1,z=te(w.logicalShape)===1;if(_!==1||j||z){if(j&&!z)V=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(A.length){var $=_-2,Q=_-1;A.indexOf($)>-1&&A.indexOf(Q)>-1?V="return vec4(outputValue.x);":A.indexOf($)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":A.indexOf(Q)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+B+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+S+"("+U+`);
      `+V+`
    }
  `}(p,m):function(y,w){var C=y.name,T=C.charAt(0).toUpperCase()+C.slice(1),S="get"+T+"AtOutCoords",I=w.texShape,_=y.shapeInfo.texShape,N=y.shapeInfo.logicalShape.length,A=w.logicalShape.length;if(!y.shapeInfo.isUniform&&N===A&&y.shapeInfo.flatOffset==null&&ft(_,I))return`
      float `+S+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var B,O=Xe(A),L=Ar(y.shapeInfo.logicalShape,w.logicalShape),U=A-N,V=["x","y","z","w","u","v"];B=N===0?"":A<2&&L.length>=1?"coords = 0;":L.map(function(z){return"coords."+V[z+U]+" = 0;"}).join(`
`);var j="";return j=A<2&&N>0?"coords":y.shapeInfo.logicalShape.map(function(z,$){return"coords."+V[$+U]}).join(", "),`
    float `+S+`() {
      `+O+` coords = getOutputCoords();
      `+B+`
      return get`+T+"("+j+`);
    }
  `}(p,m)),v}(h,n,r)}).join(`
`),c=n.texShape,l=jt(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(l),f=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+fk+`
    `+hk+`
    `+pk+`
  `}(l);return n.isPacked?(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(y,w){var C=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(y,w){var C=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];if(ft(y,w))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var T=Math.ceil(y[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=h,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],b=Math.ceil(m[2]/2),x=b*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(y,w){for(var C=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],T=Math.ceil(y[y.length-1]/2),S=T*Math.ceil(y[y.length-2]/2),I=S,_="",N="b, r, c",A=2;A<y.length-1;A++)I*=y[y.length-A-1],_=`
      int b`+A+" = index / "+I+`;
      index -= b`+A+" * "+I+`;
    `+_,N="b"+A+", "+N;return`
    ivec`+y.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+_+`

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+y.length+"("+N+`);
    }
  `}(h,p)}var m,g,v,b,x}(n.logicalShape,c),a=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(l)):(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,b){return ft(v,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(h,p);case 3:return m=p,g=Go(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,b){var x=Go(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(h,p);case 5:return function(v,b){var x=Go(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,p);case 6:return function(v,b){var x=Go(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var m,g}(n.logicalShape,c),a=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),r&&(f+=mk),[f,d,a,s,i,u,e].join(`
`)}function oa(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=e.shapeInfo.texShape,c=u[0],l=u[1],d=Wo(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+ta(e)+`
      }
    `;var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Wo(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=e.shapeInfo.texShape;if(a!=null&&ft(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var c=ao(r),l=c.newShape,d=c.keptDims,f=l;if(f.length<r.length){var h=ia(e,f);return`
      `+oa(h)+`
      float `+i+`(int row, int col) {
        return `+i+"("+aa(["row","col"],d)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ta(e)+`
      }
    `;var p=a[0],m=a[1],g=Wo(o);return m===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(t);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=ao(r),c=u.newShape,l=u.keptDims,d=c;if(d.length<r.length){var f=ia(e,d);return`
        `+oa(f)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+aa(["row","col","depth"],l)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+ta(e)+`
      }
    `;var h=e.shapeInfo.texShape,p=h[0],m=h[1],g=e.shapeInfo.flatOffset;if(m===a&&g==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(m===s&&g==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var v=Wo(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(t);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=ao(r),l=c.newShape,d=c.keptDims;if(l.length<r.length){var f=ia(e,l);return`
      `+oa(f)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+aa(["row","col","depth","depth2"],d)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+ta(e)+`
      }
    `;var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],g=p[1];if(g===u&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var v=Wo(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+v+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(t);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=ao(r),d=l.newShape,f=l.keptDims;if(d.length<r.length){var h=ia(e,d);return`
      `+oa(h)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+aa(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+ta(e)+`
      }
    `;var p=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],v=m[1];if(v===c&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(v===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=Wo(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(t);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=ao(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var c=ia(e,s);return`
      `+oa(c)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+aa(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+ta(e)+`
      }
    `;var m=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,v=g[0],b=g[1];if(b===p&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+d+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===l&&m==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=Wo(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+l+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function uD(t){var n,e,r;switch(t.shapeInfo.logicalShape.length){case 0:return n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=jt(),`
    vec4 `+e+`() {
      return `+r.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=jt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+i+`, uv);
    }
  `}(t);case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],d=jt();if(u!=null&&ft(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+d.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+a+`, uv);
    }
  `}(t);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var l=i.slice(1),d=ia(o,l);return`
        `+uD(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+aa(["b","row","col"],[1,2])+`);
        }
      `}var f=c[0],h=c[1],p=Math.ceil(i[2]/2),m=p*Math.ceil(i[1]/2),g=jt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+h+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+a+`, uv);
    }
  `}(t);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<a-1;v++)m="int b"+v+", "+m,p*=i[a-v-1],g="b"+v+" * "+p+" + "+g;var b=jt();return`
    vec4 `+u+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+b.texture2D+"("+s+`, uv);
    }
  `}(t)}}var fk=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hk=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pk=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mk=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Wo(t){return"offset"+t}function ta(t){var n=t.name,e=te(t.shapeInfo.logicalShape);return e<2?"return "+n+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function Xe(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function ia(t,n){var e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function aa(t,n){return n.map(function(e){return t[e]}).join(", ")}var gk=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(t.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=t[t.length-1],i=Math.ceil(o/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Xe(c),d=Jt("coords",c);if(i===1){var f=Xe(s=c+1);a=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[c-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[c-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[c-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[c-2]+";"}else s=c,a=`
        `+l+` sourceLocR = coords;
        ++`+d[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+d[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+d[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map(function(S){return"int "+S}),g=Jt("sourceLocR",s-1).concat("inIdx.r"),v=Jt("sourceLocG",s-1).concat("inIdx.g"),b=Jt("sourceLocB",s-1).concat("inIdx.b"),x=Jt("sourceLocA",s-1).concat("inIdx.a"),y=e==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",C=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+d[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+d[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+w+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+y+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},vk=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.top,l=u-1-t.padInfo.left,d=1/(n*e);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},yk=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=l-1-t.padInfo.front,p=d-1-t.padInfo.top,m=f-1-t.padInfo.left,g=1/(n*e*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},bk=function(t,n,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ce(t,n),Ce(t,e);var a="0.0";r!=null&&(Ce(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Ce(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},xk=function(t,n,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ce(t,n),Ce(t,e);var a="vec4(0.0)";r!=null&&(Ce(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Ce(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},wk="return areal * breal - aimag * bimag;",Ck="return areal * bimag + aimag * breal;",yw=function(t,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ce(n,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+t+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},om="return a + b;",im="return a - b;",bw="return a * b;",cD="return (a < 0.) ? b * a : a;",it=function(t,n,e){this.variableNames=["A","B"],this.outputShape=Ce(n,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},lD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Mr=function(t,n,e,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ce(n,e);var o=this.outputShape.length,i="";if(r)if(o===0||te(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Xe(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Jt("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+t+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},Dk=function(){function t(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),Ek=function(){function t(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),Ik=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},_k=function(t){this.outputShape=[],this.outputShape=Qo(t,1),this.variableNames=t.map(function(s,u){return"T"+u});var n=new Array(t.length-1);n[0]=t[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+t[e][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++){var o=n[e-1];r.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+o+"));")}var i=n.length,a=n[n.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Sk=function(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Qo(t,n);var e=this.outputShape,r=e.length,o=Xe(r),i=Jt("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(g,v){return"T"+v});var s=new Array(t.length-1);s[0]=t[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][n];var c=a[n],l=a.slice(-2),d=a.join(),f="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];f+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Dl(a,c,h)+`),
            vec2(`+Dl(l,c,h)+`));
        }`}var p=s.length,m=s[s.length-1];f+=`
        return getChannel(
          getT`+p+"("+Dl(a,c,m)+`),
          vec2(`+Dl(l,c,m)+"));",this.userCode=`
      float getValue(`+a.map(function(g){return"int "+g})+`) {
        `+f+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+e[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+e[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+e[r-2]+` &&
            `+i[r-1]+" < "+e[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Dl(t,n,e){var r=t.indexOf(n);return t.map(function(o,i){return i===r?o+" - "+e:o}).join()}var Tk=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,e=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Mk=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dataFormat==="channelsLast",a=n-1-t.padInfo.top,s=e-1-t.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Rk=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,e=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yF = 0; yF < `+t.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+o+`;

            if (xF < 0 || xF >= `+t.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+t.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+i+`;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+t.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ak=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=n-1-t.padInfo.front,u=e-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+t.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Nk=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,e=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+o+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},kk=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=n-1-t.padInfo.top,a=e-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},xw=function(t,n,e,r){n===void 0&&(n=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p=t.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,v=p?3:1,b="",x="";e&&(b=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,x="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+t.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+y+`
        `+x+`
        setOutput(result);
      }
    `},Fk=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,e=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+n+", "+e+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},ww=function(t,n,e,r){n===void 0&&(n=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,m="",g="";e&&(m=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,g="result = activation(result);");var v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+g+`
        setOutput(result);
      }
    `},Cw=function(t,n,e,r){n===void 0&&(n=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,m="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var v=0;v<h;v++)m+=`
          vec4 xTexelR`+g+"C"+2*v+` = vec4(0.);
          vec4 wR`+g+"C"+v+` = vec4(0.);
          vec4 xR`+g+"C"+v+" = vec4(0.);";for(g=0;g<f;g++)for(var b=0;b<p;b++){if(m+=`
          xR = xRCorner + `+g*l+`;
          xC = xCCorner + `+(v=2*b)*d+`;
        `,c===1){if(v<h&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+g+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+`.xy);
                } else {
                  xR`+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xR`+g+"C"+v+" = xTexelR"+g+"C"+v+`;
              `,v+1<h)){var x=s%2==0?Wm(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+`;
                `}}else v<h&&(m+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
              `,v+1<h&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+`.xy);
              `,v+1<h&&(m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
                `)),m+="}");v<h&&(m+=`
            vec4 wTexelR`+g+"C"+v+" = getW("+g+", "+v+`, d1, q);
            wR`+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+`.xz);
          `,v+1<h&&(m+=`
              vec4 wTexelR`+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+`, d1, q);
              wR`+g+"C"+(v+1)+` =
                vec4(wTexelR`+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<f;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var y="",w="";e&&(y=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,w="result = activation(result);");var C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+C+`
        `+w+`
        setOutput(result);
      }
    `},Pk=function(t,n,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=t[3],c=n[0],l=e[0],d=e[1];this.outputShape=[c,l,d,u];var f=r==="bilinear"?1:0,h=[a-1+".0",s-1+".0"],p=h[0],m=h[1],g=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],b=g[1],x=g[2],y=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=y[0],C=y[1],T=y[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+w+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+C+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},Ok=function(t,n,e){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xe(r)+` coords = getOutputCoords();
        int end = `+Dw(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+Dw(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Dw(t,n){if(t===1)return""+n;if(t===2)return n+".y";if(t===3)return n+".z";if(t===4)return n+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var Lk=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xs.DENSE;var n=zs(t),e=jt();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Go(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},Bk=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xs.DENSE;var n=zs(t),e=jt();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Go(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},jk=function(){function t(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return t.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Vk=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Uk=function(t){this.variableNames=["A"],this.outTexUsage=fn.DOWNLOAD;var n=jt();this.outputShape=t,this.userCode=`
      `+sD+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},Wk=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=fn.DOWNLOAD;var n=jt();this.outputShape=t,this.userCode=`
      `+sD+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},Hk=function(t,n,e){e===void 0&&(e=!1),this.variableNames=["A"];var r=jt(),o=n[0],i=n[1];this.outputShape=t;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+ug(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},zk=function(t,n,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=jt(),o=n[0],i=n[1];this.outputShape=t;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+t[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+t[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+ug(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},$k="return real * expR - imag * expI;",Gk="return real * expI + imag * expR;",Ew=function(t,n,e){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=e?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+t+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},qk=function(){function t(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){e.valueLoc==null&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,n)}},t}(),Kk=function(t,n,e){this.variableNames=["A","indices"];var r=t.slice();r[e]=n,this.outputShape=r,this.rank=r.length;var o=Xe(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)d===s?l.push("int(getIndices("+c[d]+"))"):l.push(""+c[d]);return l.join()}(t,e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},Xk=function(t,n,e){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var r=Xe(n.length),o=Xe(e.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function dD(t,n){var e=jt();return gC(t,n,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function fD(t,n){return xC(t,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function hD(t,n){return wC(t,n,new Uint16Array([0,1,2,2,1,3]))}function ru(t,n,e,r,o,i,a){DC(e,r);var s=CC(t,n),u=t.TEXTURE_2D;return Z(t,n,function(){return t.bindTexture(u,s)}),Z(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Z(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Z(t,n,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Z(t,n,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Z(t,n,function(){return t.texImage2D(u,0,o,e,r,0,i,a,null)}),Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function pD(t,n,e,r,o){var i=ed(e,r);return ru(t,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function mD(t,n,e,r,o){var i=ed(e,r);return ru(t,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function gD(t,n,e,r,o){var i=ed(e,r);return ru(t,n,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function vD(t,n,e,r,o){var i=nu(e,r);return ru(t,n,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function yD(t,n,e,r,o){var i=nu(e,r);return ru(t,n,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function bD(t,n,e,r){return Z(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Mm(t,n,e,"clipSpacePos",r,3,20,0)&&Mm(t,n,e,"uv",r,2,20,12)}function xD(t,n,e,r,o,i,a){var s,u,c;Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),Z(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)}),Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function wD(t,n,e,r){Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),r.data instanceof Uint8Array?Z(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Z(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Z(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function CD(t,n,e,r,o){var i=t.createBuffer();Z(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*e*r;return Z(t,n,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),Z(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)}),Z(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function DD(t,n,e){var r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function ED(t,n,e,r,o){var i=ed(e,r),a=i[0],s=i[1],u=new Uint8Array(e*r*4);return Z(t,n,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function ID(t,n,e,r,o,i,a,s){var u=t,c=new Float32Array(function(l,d){var f=nu(l,d);return f[0]*f[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function _D(t,n,e,r){var o=new Float32Array(e*r*4);return Z(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,o)}),o}var Yk=Object.freeze({createVertexShader:dD,createVertexBuffer:fD,createIndexBuffer:hD,createFloat32MatrixTexture:pD,createFloat16MatrixTexture:mD,createUnsignedBytesMatrixTexture:gD,createPackedMatrixTexture:vD,createFloat16PackedMatrixTexture:yD,bindVertexProgramAttributeStreams:bD,uploadDenseMatrixToTexture:xD,uploadPixelDataToTexture:wD,createBufferFromOutputTexture:CD,downloadFloat32MatrixFromBuffer:DD,downloadByteEncodedFloatMatrixFromOutputTexture:ED,downloadPackedMatrixFromBuffer:ID,downloadMatrixFromPackedOutputTexture:_D}),SD=function(){function t(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=P().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,hC(e,n)):this.gl=hr(e);var r="WEBGL_color_buffer_float";if(P().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Us(this.gl,this.debug,"OES_texture_float"),hn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Us(this.gl,this.debug,"OES_texture_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),hn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Us(this.gl,this.debug,"EXT_color_buffer_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",hn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!hn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=fD(this.gl,this.debug),this.indexBuffer=hD(this.gl,this.debug),this.framebuffer=EC(this.gl,this.debug),this.textureConfig=Km(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return P().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Z(e,this.debug,function(){return e.finish()}),Z(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Z(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),Z(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Z(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Z(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),pD(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),mD(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),gD(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),wD(this.gl,this.debug,n,e)},t.prototype.uploadDenseMatrixToTexture=function(n,e,r,o){this.throwIfDisposed(),xD(this.gl,this.debug,n,e,r,o,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),yD(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),vD(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(Rm(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Z(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return ED(o.gl,o.debug,e,r,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(n,e,r,o,i,a){return ID(this.gl,n,0,0,0,i,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return DD(this.gl,n,e)},t.prototype.createBufferFromTexture=function(n,e,r){this.bindTextureToFrameBuffer(n);var o=CD(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},t.prototype.createFence=function(n){var e,r,o=this;if(P().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=a}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return _D(o.gl,o.debug,e,r)})},t.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,r=vC(e,this.debug,n),o=dD(e,this.debug),i=yC(e,this.debug);return Z(e,this.debug,function(){return e.attachShader(i,o)}),Z(e,this.debug,function(){return e.attachShader(i,r)}),bC(e,this.debug,i),this.debug&&kl(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=bD(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&Z(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},t.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&kl(this.gl,this.debug,this.program),Z(this.gl,this.debug,function(){return e.gl.useProgram(n)})},t.prototype.getUniformLocation=function(n,e,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?_C(this.gl,this.debug,n,e):SC(this.gl,n,e)},t.prototype.getAttributeLocation=function(n,e){var r=this;return this.throwIfDisposed(),Z(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,e)})},t.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},t.prototype.setInputMatrixTexture=function(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),TC(this.gl,this.debug,this.program,n,e,r)},t.prototype.setOutputMatrixTexture=function(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)},t.prototype.setOutputPackedMatrixTexture=function(n,e,r){this.throwIfDisposed();var o=nu(e,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(n,i,a)},t.prototype.setOutputMatrixWriteRegion=function(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){this.program!=null&&kl(this.gl,this.debug,this.program),Ws(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Z(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Z(this.gl,this.debug,function(){return n.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Us(this.gl,this.debug,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(n){return J(this,void 0,void 0,function(){var e=this;return ee(this,function(r){switch(r.label){case 0:return[4,Cm(function(){return e.disposed||e.isQueryAvailable(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(n,e){if(e===0)return null;if(e===2){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(n,e){if(e===0)return!0;if(e===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(n){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var n=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},t.prototype.addItemToPoll=function(n,e){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||Cm(function(){return r.pollItems(),r.itemsToPoll.length===0})},t.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Fl(this.gl,this.debug,n,this.framebuffer),this.debug&&Ws(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Fl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ws(this.gl)):Rm(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(n,e,r){this.throwIfDisposed();var o=this.gl;Fl(o,this.debug,n,this.framebuffer),this.debug&&Ws(o),this.outputTexture=n,Z(o,this.debug,function(){return o.viewport(0,0,e,r)}),Z(o,this.debug,function(){return o.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(n,e,r,o){var i=this;this.throwIfDisposed(),Z(this.gl,this.debug,function(){return i.gl.scissor(n,e,r,o)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},t}();function Iw(t,n){if(t.length!==n.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+n.length+" inputs");t.forEach(function(e,r){var o=e.logicalShape,i=n[r],a=i.shape;if(!ft(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!ft(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var Qk=function(t,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=e.filterWidth,o=e.inChannels,i=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=s.left,h=s.top,p=o*r,m=jt(),g=d==="channelsLast",v=g?0:1,b=g?1:2,x="",y=0;y<=1;y++)for(var w=0;w<=1;w++)x+=`
          blockIndex = rc.y + `+w+`;
          pos = rc.x + `+y+`;

          if(blockIndex < `+t[1]+" && pos < "+t[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+h+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+n[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+f+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+n[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*y+w)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*y+w)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+m.output+` = result;
      }
    `},Zk=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},Jk=function(t,n,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=e,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},eF=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},tF=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,e=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=o-1-t.padInfo.top,s=i-1-t.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},nF=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,e=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=s-1-t.padInfo.front,d=u-1-t.padInfo.top,f=c-1-t.padInfo.left,h=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},am=function(t,n,e,r,o,i,a){e===void 0&&(e=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=e?t[1]:t[2],u=Math.ceil(s/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},rF=function(){function t(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){e.seedLoc==null&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,n)}},t}(),oF=function(t,n,e,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},iF=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Jt("rc",n),r=Xe(n),o=function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(n,t,e),i=function(s,u,c,l){if(s===1)return"";var d=l.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(n,t[t.length-1],t[t.length-2],e),a=function(s,u){var c=s.length,l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<d;v++)g=f[f.length-1-v]+","+g;h.push(g)}return h}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(t,e);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},aF=function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,o=Xe(r),i=n.map(function(u){return u[0]}).join(","),a=n.map(function(u,c){return u[0]+t[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},sF=function(t,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(g,v){return g[0]+t[v]+g[1]});for(var r=t.length,o=Xe(r),i=n.map(function(g){return g[0]}).join(","),a=n.map(function(g,v){return g[0]+t[v]}).join(","),s=Jt("rc",r),u=Jt("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+c+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=r===1?2:4;p<m;p++)h+=`
        `+d[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+e+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},sm=function(t,n,e){if(this.variableNames=["x"],n==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f=n==="avg",h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+l+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+l+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},um=function(t,n,e){if(this.variableNames=["x"],n==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var g=n==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+t.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(b="avgValue / count");var x=4*Math.floor(r/4),y=r%4,w=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+w+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(y===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(y===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(y===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+w+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},uF=function(t,n){this.variableNames=["x"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var a="0.0",s="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",s="min"):n==="max"&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var h="";o%e>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},cF=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Go(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+ug(t)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+t[1]+`;
        int cols = `+t[2]+`;

        `+e+`

        setOutput(result);
      }
    `},lF=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},dF=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},fF=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},hF=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},pF=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e],l=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},mF=function(t,n){this.variableNames=["x"];var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=t,e!==1){var r=t.map(function(i,a){return function(s){return n.indexOf(s)!==-1&&t[s]!==1?t[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),o=Xe(e);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+t[0]+` - coord - 1));
        }
      `},gF=function(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=t;var r=Jt("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],a=Xe(e);function s(u){var c=t.map(function(l,d){return function(f,h){return n.indexOf(f)!==-1&&t[f]!==1?t[f]+" - "+h[f]+" - 1":""+h[f]}(d,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+t[0]+` - rc - 1),
            `+t[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+t[0]+` - (rc  + 1) - 1),
                `+t[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},_w=function(t,n,e,r,o,i,a){a===void 0&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Xe(o.length),u=Xe(i.length),c="";e===1?c="i":e===2&&(c="i, j");var l="getIndices("+c+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",h=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+t+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},vF=function(t,n){this.variableNames=["x","segmentIds"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/e);this.outputShape=[r,a];var s=4*Math.floor(e/4),u=e%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";o%e>0&&(l=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var d="";o%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},yF=function(t,n,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Xe(e);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},bF=function(){function t(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,r=Xe(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(a===1)return"sourceLoc";if(a<=6)return cm.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+n.map(function(a,s){return"sourceLoc."+cm[s]+" = start["+s+"] + coords."+cm[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+e+`
        setOutput(getSource(`+i+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,n)}},t}(),cm=["x","y","z","w","u","v"],xF=function(){function t(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=Xe(this.rank),r=Jt("coords",this.rank),o=Jt("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,n)}},t}(),wF=function(t,n,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=Xe(e.length),i=Xe(e.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,e.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+t+`);
      `+o+" strides = "+o+"("+n+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},CF=function(){function t(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(n,e,r){var o,i=Sw(e,r),a=Tw(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===dn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===dn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===dn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===dn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===dn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},t.prototype.releaseTexture=function(n,e,r,o){if(this.freeTextures!=null){var i=Tw(e,Sw(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){n.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Sw(t,n){if(t===fn.UPLOAD)return dn.PACKED_2X2_FLOAT32;if(t===fn.RENDER||t==null)return function(e){return P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?dn.PACKED_2X2_FLOAT32:dn.UNPACKED_FLOAT32:e?dn.PACKED_2X2_FLOAT16:dn.UNPACKED_FLOAT16}(n);if(t===fn.DOWNLOAD||t===fn.PIXELS)return dn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Tw(t,n,e){return t[0]+"_"+t[1]+"_"+n+"_"+e}var DF=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[r]*n[r];this.outputShape=e,this.rank=e.length;var o=Xe(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(t);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},EF=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];this.outputShape=e,this.rank=e.length;var o=Xe(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(n);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},IF=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Xe(this.rank),i=aD("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},cg=1.7580993408473768,lg=1.0507009873554805,ge=function(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Kn="if (isnan(x)) return x;",_F="return x;",Mw="return abs(x);",TD=Kn+`
  return (x < 0.0) ? 0.0 : x;
`,MD=Kn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,RD="return (x >= 0.0) ? x : (exp(x) - 1.0);",SF=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+cg+`;
  float scale = `+lg+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Rw="return -x;",Aw="return ceil(x);",Nw="return floor(x);",kw="return exp(x);",Fw="return exp(x) - 1.0;",TF=Kn+`
  return sin(x);
`,MF=Kn+`
  return cos(x);
`,RF=Kn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,AF=Kn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,NF=Kn+`
  return atan(x);
`,kF=Kn+"return log(x + sqrt(x * x + 1.0));",FF=Kn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,PF=Kn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,El="return x;",OF="return x;",AD=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ND=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kD=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Vs=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},LF=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,e=Jt("rc",n),r=Xe(n),o=function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(n,e),i=e.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},Il={};function _l(t,n){if(n===void 0&&(n=!1),t==="linear")return n?OF:_F;if(t==="relu")return n?AD:TD;if(t==="elu")return n?kD:RD;if(t==="relu6")return n?ND:MD;if(t==="prelu")return n?lD:cD;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var BF=600,FD=function(t){function n(e){var r,o=t.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var i=hr(P().getNumber("WEBGL_VERSION"));o.binaryCache=((r=P().getNumber("WEBGL_VERSION"))in Il||(Il[r]={}),Il[r]),o.gpgpu=new SD(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new CF(o.gpgpu),o.numMBBeforeWarning=P().global.screen==null?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*BF/1024/1024,o.texData=new eD(o,R),o}return $n(n,t),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,r,o){if(P().getBool("DEBUG")&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:fn.UPLOAD}),i},n.prototype.move=function(e,r,o,i){if(P().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:fn.UPLOAD})},n.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;l=c?new Vs(u,El):new ge(u,El);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;var h,p,m=this.activeTimers!=null;return m&&(h=Wn()),i==="complex64"?p=Om(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(e),m&&(this.downloadWaitMs+=Wn()-h),this.convertAndCacheOnCPU(e,p)},n.prototype.read=function(e){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,m,g,v,b,x,y,w,C,T,S;return ee(this,function(I){switch(I.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(_){return r.push(_)})];if(o=this.texData.get(e),i=o.values,a=o.shape,s=o.slice,u=o.dtype,c=o.complexTensors,l=o.isPacked,s!=null)return d=void 0,d=l?new Vs(a,El):new ge(a,El),f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(i!=null)return[2,this.convertAndCacheOnCPU(e)];if(!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&P().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&P().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),g=this.texData.get(m.dataId),p=(S=this.gpgpu).createBufferFromTexture.apply(S,[g.texture].concat(zs(a)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=I.sent(),x=b[0],y=b[1],v=Om(x,y),[3,5];case 4:p==null?v=this.getValuesFromTexture(e):(w=te(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),I.label=5;case 5:return m!=null&&this.disposeData(m.dataId),C=this.convertAndCacheOnCPU(e,v),T=this.pendingRead.get(e),this.pendingRead.delete(e),T.forEach(function(_){return _(C)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,C]}})})},n.prototype.checkNumericalProblems=function(e){if(e!=null)for(var r=0;r<e.length;r++){var o=e[r];if(!pC(o))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.isPacked,u=te(i);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(zs(i))).subarray(0,u);return this.disposeData(c.dataId),d}var f=P().getBool("WEBGL_PACK")&&s===!0,h=f?Pl(i):i,p=f?new Wk(h):new Uk(h),m=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:e}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),v},n.prototype.time=function(e){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return ee(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),a=Nr(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=Nr(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=Zw(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Wn(),endMs:null}},n.prototype.endTimer=function(e){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Wn(),e)},n.prototype.getQueryTime=function(e){return J(this,void 0,void 0,function(){var r;return ee(this,function(o){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return P().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=R.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&e.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(te(o)===0)return It([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,a=eg(e.shape,r,o);if(i||!a){var s=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xF(o):new bF(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},n.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),a=this.makeOutput(o,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=e.dtype;var u=tg(r,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var a=od(r,o,i);if(a.some(function(u){return u===0}))return It([],a);var s=new wF(r,i,a);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,r){var o=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gF(e.shape,r):new mF(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.concat=function(e,r){if(e[0].dtype==="complex64"){var o=e.map(function(h){return _n(h)}),i=e.map(function(h){return lr(h)});return kt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(e.length===1)return e[0];if(e.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),r),u=this.concat(e.slice(a),r);return this.concat([s,u],r)}if(P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new Sk(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=Qo(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,te(h.shape.slice(r)))}),f=new _k(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Rw,e.dtype);var r=new ge(e.shape,Rw);return this.compileAndRun(r,[e])},n.prototype.batchMatMul=function(e,r,o,i){var a=o?e.shape[2]:e.shape[1],s=i?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((a===1||s===1)&&u>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=s===1?e:e.as3D(c,u,1),d=s===1?2:1,f=s===1?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Et(e.dtype,r.dtype),p=new am(e.shape,[c,a,s],o,i);return this.compileAndRun(p,[e,r],h)},n.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Et(r.dtype,o.dtype),p=s!=null,m=c!=null,g=u?_l(u,!0):null,v=new am(r.shape,[f,l,d],i,a,p,g,m),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(v,b,h)},n.prototype.multiply=function(e,r){if(e.dtype==="complex64"){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),a=new yw(wk,e.shape,r.shape),s=new yw(Ck,e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,bw,e.dtype);var f=new it(bw,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){var u=[e,r,o],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(a!=null&&(l=a.shape,u.push(a)),P().getBool("WEBGL_PACK_NORMALIZATION")){var d=new xk(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)}var f=new bk(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){var s=P().getBool("WEBGL_PACK_NORMALIZATION")?new eF(e.shape,r,o,i,a):new Zk(e.shape,r,o,i,a);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){var c=new Jk(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,e])},n.prototype.tile=function(e,r){if(e.dtype==="string"){var o=this.readSync(e.dataId).map(function(a){return qs(a)});return oD(de(e.shape,e.dtype,o),r)}var i=new DF(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.pad=function(e,r,o){var i=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sF(e.shape,r,o):new aF(e.shape,r,o);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new IF(e.shape,r):new EF(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new Kk(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},n.prototype.batchToSpaceND=function(e,r,o){E(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=Gl(e.shape,r,i),s=ql(a.length,r.length),u=Kl(e.shape,r,i),c=qC(o,r.length),l=KC(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){E(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=Gl(u.shape,r,i,!1),l=ql(c.length,r.length,!1),d=Kl(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,r,o){var i=e.shape[0],a=e.shape[1],s=Ol(a),u=new uF({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[e],o);return c.shape[1]===1?c:this.reduce(c,r,o)},n.prototype.argReduce=function(e,r,o){o===void 0&&(o=null);var i=e.shape[0],a=e.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=Ol(a),u=new lk({windowSize:s,inSize:a,batchSize:i},r,o==null),c=[e];o!=null&&c.push(o);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(e,r,l)},n.prototype.argReducePacked=function(e,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:e.shape,a=Ol(i[i.length-1]),s=new gk(i,a,r,o==null),u=o==null?[e]:[e,o],c=this.compileAndRun(s,u,"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},n.prototype.sum=function(e,r){Zt("sum",r,e.rank);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a),u=tm(e.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a),u=tm(e.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(e,r,o){var i=0,a=Gn([i],e.rank),s=e;a!=null&&(s=e.transpose(a),i=qn(1,e.rank)[0]);var u=function(h,p,m){for(var g=[],v=h.length,b=0;b<v;b++)b!==p?g.push(h[b]):g.push(m);return g}(s.shape,i,o),c=te([s.shape[i]]),l=s.as2D(-1,c),d=tm(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,o).reshape(u);return a!=null&&(f=f.transpose(td(a))),f},n.prototype.segOpCompute=function(e,r,o,i,a){var s=e.shape[0],u=e.shape[1],c=function(f,h){var p,m=!1;for(f<=Jm?(p=f,m=!0):p=Wl(f,Math.floor(Math.sqrt(f)));!m;)p>h||p===f?m=!0:p=Wl(f,p+1);return p}(u,a),l=new vF({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),d=this.compileAndRun(l,[e,o],i);return d.shape[1]===a?d:(o=$l(0,a).tile([u/c]),this.segOpCompute(d,r,o,i,a))},n.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(Zt("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!P().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=Ft(e.shape,i),s=a[0],u=te(a[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},n.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},n.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},n.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var a=new Ok(e.shape,o,i);return this.compileAndRun(a,[e])},n.prototype.equal=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(equal(a, b));
`,"bool");var o=new it("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.notEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new it("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new it("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.lessEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new it("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new it("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greaterEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new it("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalNot=function(e){var r=new ge(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},n.prototype.logicalAnd=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new it("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalOr=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new it("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.select=function(e,r,o){var i=new yF(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Et(r.dtype,o.dtype))},n.prototype.where=function(e){Hl("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return sg(e.shape,r)},n.prototype.topk=function(e,r,o){return iD(e.dataSync(),e.shape,e.dtype,r)},n.prototype.min=function(e,r){Zt("min",r,e.rank);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new it(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.mod=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new it(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Zt("max",r,e.rank);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new it(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.all=function(e,r){Zt("all",r,e.rank);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,r){Zt("any",r,e.rank);var o=Ft(e.shape,r),i=o[0],a=te(o[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new it(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},n.prototype.floorDiv=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new it(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},n.prototype.add=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,om);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Et(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,om,o);var i=new it(om,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.packedUnaryOp=function(e,r,o){var i=new Vs(e.shape,r);return this.compileAndRun(i,[e],o)},n.prototype.packedBinaryOp=function(e,r,o,i,a){a===void 0&&(a=!1);var s=new Mr(o,e.shape,r.shape,a);return this.compileAndRun(s,[e,r],i)},n.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,a=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],m=i.makeComplexComponentTensorInfo(e,h),g=i.makeComplexComponentTensorInfo(r,p),v=new it(o,e.shape,r.shape);return i.compileAndRun(v,[m,g],Et(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},n.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>P().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var a=e.map(function(c){return c.dtype}).reduce(function(c,l){return Et(c,l)}),s=e.map(function(c){return c.shape}),u=P().getBool("WEBGL_PACK")?new ck(e[0].shape,s):new uk(e[0].shape,s);return this.compileAndRun(u,e,a)},n.prototype.subtract=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,im);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Et(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,im,e.dtype);var i=new it(im,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.pow=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new it(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,r.shape),i=Et(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Aw,e.dtype);var r=new ge(e.shape,Aw);return this.compileAndRun(r,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Nw,e.dtype);var r=new ge(e.shape,Nw);return this.compileAndRun(r,[e])},n.prototype.sign=function(e){var r=new ge(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[e])},n.prototype.isNaN=function(e){var r=new ge(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isInf=function(e){var r=new ge(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isFinite=function(e){var r=new ge(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.round=function(e){var r=new ge(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kw,e.dtype);var r=new ge(e.shape,kw);return this.compileAndRun(r,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fw,e.dtype);var r=new ge(e.shape,Fw);return this.compileAndRun(r,[e])},n.prototype.softmax=function(e,r){var o=pt([r],e.shape),i=this.max(e,o),a=zt(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var r=new ge(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[e])},n.prototype.log1p=function(e){var r=new ge(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},n.prototype.sqrt=function(e){var r=new ge(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new ge(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},n.prototype.reciprocal=function(e){var r=new ge(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},n.prototype.relu=function(e){var r;return r=P().getBool("WEBGL_PACK")?new Vs(e.shape,AD):new ge(e.shape,TD),this.compileAndRun(r,[e])},n.prototype.relu6=function(e){var r;return r=P().getBool("WEBGL_PACK")?new Vs(e.shape,ND):new ge(e.shape,MD),this.compileAndRun(r,[e])},n.prototype.prelu=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(lD,e.shape,r.shape):new it(cD,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.elu=function(e){if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kD,e.dtype);var r=new ge(e.shape,RD);return this.compileAndRun(r,[e])},n.prototype.eluDer=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,r.shape):new it("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.selu=function(e){var r=new ge(e.shape,SF);return this.compileAndRun(r,[e])},n.prototype.int=function(e){var r=new ge(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},n.prototype.clip=function(e,r,o){var i,a=(i=P().getBool("WEBGL_PACK_CLIP")?new Ek(e.shape):new Dk(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,a)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mw,e.dtype);var r=new ge(e.shape,Mw);return this.compileAndRun(r,[e])},n.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new Ik(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(e){var r=new ge(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},n.prototype.softplus=function(e){var r=new ge(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[e])},n.prototype.sin=function(e){var r=new ge(e.shape,TF);return this.compileAndRun(r,[e])},n.prototype.cos=function(e){var r=new ge(e.shape,MF);return this.compileAndRun(r,[e])},n.prototype.tan=function(e){var r=new ge(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},n.prototype.asin=function(e){var r=new ge(e.shape,RF);return this.compileAndRun(r,[e])},n.prototype.acos=function(e){var r=new ge(e.shape,AF);return this.compileAndRun(r,[e])},n.prototype.atan=function(e){var r=new ge(e.shape,NF);return this.compileAndRun(r,[e])},n.prototype.atan2=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new it(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.sinh=function(e){var r=new ge(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},n.prototype.cosh=function(e){var r=new ge(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},n.prototype.tanh=function(e){var r=new ge(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[e])},n.prototype.asinh=function(e){var r=new ge(e.shape,kF);return this.compileAndRun(r,[e])},n.prototype.acosh=function(e){var r=new ge(e.shape,FF);return this.compileAndRun(r,[e])},n.prototype.atanh=function(e){var r=new ge(e.shape,PF);return this.compileAndRun(r,[e])},n.prototype.erf=function(e){var r=new ge(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[e])},n.prototype.step=function(e,r){var o=new ge(e.shape,function(i){return i===void 0&&(i=0),Kn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(o,[e])},n.prototype.conv2dByMatMul=function(e,r,o,i,a,s){var u=e.shape,c=this.texData.get(e.dataId),l=o.inChannels,d=u[0]*u[1]*u[2],f=o.outChannels,h=o.dataFormat==="channelsLast",p=(d===1||f===1)&&l>1e3,m=u[2]%2!=0&&!!c.isPacked;if(p||!P().getBool("WEBGL_LAZILY_UNPACK")||!P().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(e,[1,g,o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),y={dataId:e.dataId,shape:[1,x,o.inChannels],dtype:e.dtype},w=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,E(Hs(c.shape,y.shape),function(){return"packed reshape "+c.shape+" to "+y.shape+" isn't free"});var C=this.reshape(r,[1,o.inChannels,o.outChannels]),T=this.fusedBatchMatMul({a:y,b:C,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),S=this.texData.get(T.dataId);return E(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=w,S.shape=o.outShape,R.makeTensorFromDataId(T.dataId,o.outShape,T.dtype)},n.prototype.conv2dWithIm2Row=function(e,r,o,i,a,s){var u=o.filterWidth,c=o.filterHeight,l=o.inChannels,d=o.outWidth,f=o.outHeight,h=o.dataFormat==="channelsLast",p=u*c*l,m=f*d,g=[p,m],v=e.squeeze([0]),b=r.reshape([1,p,-1]),x=new Qk(g,v.shape,o),y=this.compileAndRun(x,[v]).reshape([1,g[0],g[1]]),w=i!=null,C=s!=null,T=a?_l(a,!0):null,S=new am(y.shape,[1,m,o.outChannels],!0,!1,w,T,C),I=[y,b];i&&I.push(i),C&&I.push(s);var _=this.compileAndRun(S,I);return h?_.reshape([1,f,d,o.outChannels]):_.reshape([1,o.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(P().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=a!=null,l=u!=null,d=s?_l(s,!1):null,f=new xw(i,c,d,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},n.prototype.conv2d=function(e,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(e,r,o);if(P().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,r,o);var i=new xw(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerInput=function(e,r,o){var i=new Mk(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerFilter=function(e,r,o){var i=new Tk(o);return this.compileAndRun(i,[e,r])},n.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?_l(u,l):null,f=[o,i],h=s!=null,p=c!=null;return h&&f.push(s),p&&f.push(c),l?(r=new Cw(a,h,d,p),this.compileAndRun(r,f)):(r=new ww(a,h,d,p),this.compileAndRun(r,f))},n.prototype.depthwiseConv2D=function(e,r,o){var i;return P().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Cw(o),this.compileAndRun(i,[e,r])):(i=new ww(o),this.compileAndRun(i,[e,r]))},n.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new kk(o);return this.compileAndRun(i,[e,r])},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new Nk(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3d=function(e,r,o){var i=new Fk(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerInput=function(e,r,o){var i=new Ak(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerFilter=function(e,r,o){var i=new Rk(o);return this.compileAndRun(i,[e,r])},n.prototype.maxPool=function(e,r){var o=new sm(r,"max",!1);return this.compileAndRun(o,[e])},n.prototype.avgPool=function(e,r){var o=new sm(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPoolBackprop=function(e,r,o,i){var a=new sm(i,"max",!0),s=this.compileAndRun(a,[r]),u=new tF(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,r,o){var i=new vk(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.cast=function(e,r){return rg(e,r,this)},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.avgPool3d=function(e,r){var o=new um(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,r,o){var i=new yk(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.maxPool3d=function(e,r){var o=new um(r,"max",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,r,o,i){var a=new um(i,"max",!0),s=this.compileAndRun(a,[r]),u=new nF(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!Hs(e.shape,r)&&(o.texture===null||!Hs(o.shape,r))){var i=this.packedReshape(e,r);return R.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Yl(e,r)},n.prototype.resizeBilinear=function(e,r,o,i){var a=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new fF(e.shape,r,o,i):new dF(e.shape,r,o,i);return this.compileAndRun(a,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,r,o){var i=new lF(e,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,r,o,i){var a=new pF(e.shape,r,o,i);return this.compileAndRun(a,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new hF(e,r,o);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,r,o,i){var a=r?e:qt(e),s=a.shape[0],u=a.shape[1],c=new rF(s,u,o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(e,r,o,i){var a=new oF(e.size,r,o,i);return this.compileAndRun(a,[e])},n.prototype.diag=function(e){var r=new Vk(e.size);return this.compileAndRun(r,[e])},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return Hl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ig(e.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(e,r,o,i,a,s){var u=new Pk(e.shape,r.shape,i,a,s);return this.compileAndRun(u,[e,r,o],"float32")},n.prototype.depthToSpace=function(e,r,o){E(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],a=o==="NHWC"?e.shape[1]:e.shape[2],s=o==="NHWC"?e.shape[2]:e.shape[3],u=o==="NHWC"?e.shape[3]:e.shape[1],c=a*r,l=s*r,d=u/(r*r),f=new jk(o==="NHWC"?[i,c,l,d]:[i,d,c,l],r,o);return this.compileAndRun(f,[e])},n.prototype.split=function(e,r,o){return rD(e,r,o)},n.prototype.scatterND=function(e,r,o){var i=Zs(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],f=e.reshape([s,a]),h=r.reshape([s,u]);if(l===0)return Yl(It([]),o);var p=K(0),m=new _w(s,a,f.rank,h.rank,c,d);return this.compileAndRun(m,[h,f,p]).reshape(o)},n.prototype.sparseToDense=function(e,r,o,i){var a=Zs(0,e,o),s=a.sliceRank,u=a.numUpdates,c=a.strides,l=a.outputSize,d=new _w(u,s,e.rank,r.rank,c,[l,1],!1);return this.compileAndRun(d,[r,e,i]).reshape(o)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new Ew($k,e.shape,r),a=new Ew(Gk,e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Zm(e,r),s=a[0],u=a[1],c=a[2],l=a[3],d=r.reshape([u,i]),f=e.reshape([e.size/c,c]),h=new Xk(i,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(s)},n.prototype.fill=function(e,r,o){if((o=o||pa(r))==="string"){var i=Gs(o,te(e));return i.fill(r),R.makeTensor(i,e,o,this)}var a=new qk(e,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},n.prototype.linspace=function(e,r,o){return og(e,r,o)},n.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},n.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return R.makeTensorFromDataId(o,e,r,this)},n.prototype.unpackTensor=function(e){var r=new LF(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},n.prototype.packTensor=function(e){var r=new iF(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,r){var o=[Ys(e.shape)].concat(Qs(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},a=[Ys(r)].concat(Qs(r)),s=new cF(a,o),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,a=o.shape,s=o.dtype,u=Pl(a);return r=i?new Bk(u):new Lk(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Xs.DENSE){var l=zs(e.outputShape);c.texShape=l.map(function(x){return 2*x})}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),te(u.shape)===0)return c.values=fa(u.dtype,0),u;var d=[],f=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var y=s.texData.get(x.dataId);if(y.texture==null){if(!e.packedInputs&&te(x.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=x.shape)}else if(!!y.isPacked!=!!e.packedInputs)x=y.isPacked?s.unpackTensor(x):s.packTensor(x),d.push(x),y=s.texData.get(x.dataId);else if(y.isPacked&&!Hs(y.shape,x.shape)){var w=x,C=x.shape;x.shape=y.shape,x=s.packedReshape(x,C),d.push(x),y=s.texData.get(x.dataId),w.shape=C}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:y,isUniform:!1}});this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:c,isUniform:!1},m=function(x,y,w){var C="";y.concat(w).forEach(function(I){var _=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,N=I.isUniform?"uniform":I.texData.texShape;C+=I.shape+"_"+N+"_"+_});var T=x.userCode,S=x.constructor.name;return S+="_"+C+"_"+T}(e,f,p),g=this.getAndSaveBinary(m,function(){return function(x,y,w,C){var T=y.userCode,S=w.map(function(j,z){var $={logicalShape:j.shape,texShape:j.isUniform?null:j.texData.texShape,isUniform:j.isUniform,isPacked:!j.isUniform&&j.texData.isPacked,flatOffset:null};return j.texData!=null&&j.texData.slice!=null&&j.texData.slice.flatOffset>0&&($.flatOffset=j.texData.slice.flatOffset),{name:y.variableNames[z],shapeInfo:$}}),I=S.map(function(j){return j.shapeInfo}),_={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},N=dk(S,_,T,y.packedInputs),A=x.createProgram(N),B=null,O=x.getUniformLocation(A,"NAN",!1);P().getNumber("WEBGL_VERSION")===1&&(B=x.getUniformLocation(A,"INFINITY",!1));for(var L={},U=0;U<y.variableNames.length;U++){var V=y.variableNames[U];L[V]=x.getUniformLocation(A,V,!1),L["offset"+V]=x.getUniformLocation(A,"offset"+V,!1)}return{program:y,source:N,webGLProgram:A,uniformLocations:L,inShapeInfos:I,outShapeInfo:_,infLoc:B,nanLoc:O}}(s.gpgpu,e,f,p)}),v=this.activeTimers!=null;if(v&&(h=this.startTimer()),function(x,y,w,C,T){Iw(y.inShapeInfos,w),Iw([y.outShapeInfo],[C]);var S=C.texData.texture,I=C.texData.texShape;C.texData.isPacked?x.setOutputPackedMatrixTexture(S,I[0],I[1]):x.setOutputMatrixTexture(S,I[0],I[1]),x.setProgram(y.webGLProgram),P().getNumber("WEBGL_VERSION")===1&&y.infLoc!==null&&x.gl.uniform1f(y.infLoc,1/0),y.nanLoc!==null&&x.gl.uniform1f(y.nanLoc,NaN),w.forEach(function(_,N){var A=y.program.variableNames[N],B=y.uniformLocations[A],O=y.uniformLocations["offset"+A];if(B!=null)if(_.isUniform)if(te(_.shape)<2)x.gl.uniform1f(B,_.uniformValues[0]);else{var L=_.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),x.gl.uniform1fv(B,L)}else _.texData.slice!=null&&O!=null&&x.gl.uniform1i(O,_.texData.slice.flatOffset),x.setInputMatrixTexture(_.texData.texture,B,N)}),T?.(x,y.webGLProgram),x.executeProgram()}(this.gpgpu,g,f,p,i),d.forEach(function(x){return s.disposeData(x.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!P().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(e,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(e,r,o,i,a);return R.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=H(function(){if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=P().getBool("DEBUG");P().set("DEBUG",!1);var o=e.abs(K(1e-8)).dataSync()[0];if(P().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.values,u=o.texture,c=o.usage,l=o.isPacked;if(u==null){var d,f=this.activeTimers!=null;f&&(d=Wn());var h=o.texShape;if(h==null&&(h=AC(i,l),o.texShape=h),s!=null){var p=Pl(i),m=void 0,g=h[1],v=h[0],b=s instanceof Uint8Array;l?(g=(r=nu(h[0],h[1]))[0],v=r[1],m=new zk(p,[v,g],b)):m=new Hk(p,[v,g],b);var x=this.makeTensorInfo([v,g],a);this.texData.get(x.dataId).usage=b?fn.PIXELS:fn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),g,v,s);var y=this.runWebGLProgram(m,[x],a,null,!0),w=this.texData.get(y.dataId);o.texture=w.texture,o.texShape=w.texShape,o.isPacked=w.isPacked,o.usage=w.usage,this.disposeData(x.dataId),this.texData.delete(y.dataId),o.values=null,f&&(this.uploadWaitMs+=Wn()-d)}else{var C=this.acquireTexture(h,c,a,l);o.texture=C}}},n.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),r!=null&&(o.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},n.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},n.prototype.computeBytes=function(e,r){return e[0]*e[1]*Hm(r)},n}(tD);fC()&&R.registerBackend("webgl",function(){return new FD},2);var jF=M({square_:function(t){var n=D(t,"x","square"),e=[n];return R.runKernelFunc(function(r,o){return o([n]),r.square(n)},{x:n},null,"Square",{},e,[])}}),tu="SquaredDifference",PD=M({squaredDifference_:function(t,n){var e,r=D(t,"a","squaredDifference"),o=D(n,"b","squaredDifference");e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return R.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},i,function(s,u){var c=u[0],l=u[1],d=K(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},tu,{},a,[])}}),VF=M({abs_:function(t){var n=D(t,"x","abs");return n.dtype==="complex64"?R.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):R.runKernelFunc(function(e,r){var o=e.abs(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),UF=M({acos_:function(t){var n=D(t,"x","acos");return R.runKernelFunc(function(e,r){var o=e.acos(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(K(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),WF=M({acosh_:function(t){var n=D(t,"x","acosh");return R.runKernelFunc(function(e,r){var o=e.acosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),HF=M({asin_:function(t){var n=D(t,"x","asin");return R.runKernelFunc(function(e,r){var o=e.asin(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(K(1).sub(o.toFloat().square()).sqrt())}}})}}),zF=M({asinh_:function(t){var n=D(t,"x","asinh");return R.runKernelFunc(function(e,r){var o=e.asinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(K(1).add(o.toFloat().square()).sqrt())}}})}}),$F=M({atan_:function(t){var n=D(t,"x","atan");return R.runKernelFunc(function(e,r){var o=e.atan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),GF=M({atanh_:function(t){var n=D(t,"x","atanh");return R.runKernelFunc(function(e,r){var o=e.atanh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(K(1).sub(o.toFloat().square()))}}})}}),qF=M({ceil_:function(t){var n=D(t,"x","ceil");return R.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),ou=M({clipByValue_:function(t,n,e){var r=D(t,"x","clipByValue");E(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."});var o=[r],i={min:n,max:e};return R.runKernelFunc(function(a,s){var u=a.clip(r,n,e);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),ke(a))}}},"ClipByValue",i,o)}}),KF=M({cos_:function(t){var n=D(t,"x","cos"),e=[n];return R.runKernelFunc(function(r,o){var i=r.cos(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},e)}}),XF=M({cosh_:function(t){var n=D(t,"x","cosh");return R.runKernelFunc(function(e,r){var o=e.cosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),YF=M({erf_:function(t){var n=D(t,"x","erf");return E(n.dtype==="int32"||n.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),n.dtype==="int32"&&(n=n.toFloat()),R.runKernelFunc(function(e,r){var o=e.erf(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),sd=M({exp_:function(t){var n=D(t,"x","exp");return R.runKernelFunc(function(e,r){var o=e.exp(n);return r([o]),o},{x:n},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),QF=M({expm1_:function(t){var n=D(t,"x","expm1");return R.runKernelFunc(function(e,r){var o=e.expm1(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),ZF=M({floor_:function(t){var n=D(t,"x","floor");return R.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),JF=M({log_:function(t){var n=D(t,"x","log"),e=[n];return R.runKernelFunc(function(r,o){var i=r.log(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},e)}}),eP=M({log1p_:function(t){var n=D(t,"x","log1p");return R.runKernelFunc(function(e,r){var o=e.log1p(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),tP=M({logSigmoid_:function(t){var n=D(t,"x","logSigmoid");return R.runKernelFunc(function(e,r){var o=e.softplus(n.neg()).neg();return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),iu=M({neg_:function(t){var n=D(t,"x","neg"),e=[n];return R.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},e)}}),nP=M({reciprocal_:function(t){var n=D(t,"x","reciprocal");return R.runKernelFunc(function(e,r){var o=e.reciprocal(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),rP=M({round_:function(t){var n=D(t,"x","round");return R.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),OD=M({rsqrt_:function(t){var n=D(t,"x","rsqrt"),e=[n];return R.runKernelFunc(function(r,o){var i=r.rsqrt(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),dg=M({sigmoid_:function(t){var n=D(t,"x","sigmoid");return R.runKernelFunc(function(e,r){var o=e.sigmoid(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(K(1).sub(o)))}}},"Sigmoid")}}),oP=M({sign_:function(t){var n=D(t,"x","sign");return R.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),iP=M({isNaN_:function(t){var n=D(t,"x","isNaN");return R.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),aP=M({isInf_:function(t){var n=D(t,"x","isInf");return R.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),sP=M({isFinite_:function(t){var n=D(t,"x","isFinite");return R.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),uP=M({sin_:function(t){var n=D(t,"x","sin"),e=[n];return R.runKernelFunc(function(r,o){var i=r.sin(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},e)}}),cP=M({sinh_:function(t){var n=D(t,"x","sinh");return R.runKernelFunc(function(e,r){var o=e.sinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),lP=M({softplus_:function(t){var n=D(t,"x","softplus");return R.runKernelFunc(function(e,r){var o=e.softplus(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),dP=M({sqrt_:function(t){var n=D(t,"x","sqrt");return R.runKernelFunc(function(e,r){var o=e.sqrt(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),fP=M({step_:function(t,n){n===void 0&&(n=0);var e=D(t,"x","step");return R.runKernelFunc(function(r){return r.step(e,n)},{$x:e},function(r){return{$x:function(){return ke(r)}}})}}),hP=M({tan_:function(t){var n=D(t,"x","tan");return R.runKernelFunc(function(e,r){var o=e.tan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),pP=M({tanh_:function(t){var n=D(t,"x","tanh");return R.runKernelFunc(function(e,r){var o=e.tanh(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return K(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function LD(t,n,e,r,o,i){var a,s,u=D(t,"x","batchNorm"),c=D(n,"mean","batchNorm"),l=D(e,"variance","batchNorm");return o!=null&&(a=D(o,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),E(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),E(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),a!=null&&E(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&E(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),au(u,c,l,s,a,i)}function BD(t,n,e,r,o,i){var a,s,u=D(t,"x","batchNorm"),c=D(n,"mean","batchNorm"),l=D(e,"variance","batchNorm");return o!=null&&(a=D(o,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),E(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),E(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),a!=null&&E(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&E(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),au(u,c,l,s,a,i)}function jD(t,n,e,r,o,i){var a,s,u=D(t,"x","batchNorm"),c=D(n,"mean","batchNorm"),l=D(e,"variance","batchNorm");return o!=null&&(a=D(o,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),E(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),E(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),E(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),a!=null&&E(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&E(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),au(u,c,l,s,a,i)}function au(t,n,e,r,o,i){i==null&&(i=.001);var a,s,u,c=D(t,"x","batchNorm"),l=D(n,"mean","batchNorm"),d=D(e,"variance","batchNorm");o!=null&&(a=D(o,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),E(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var f=[c,l,d,a];return R.runKernelFunc(function(h,p){var m=h.batchNormalization(u,Sl(l),Sl(d),i,Sl(a),Sl(s));return p([c,l,d,a]),m},{x:c,mean:l,variance:d,scale:a,offset:s},function(h,p){var m=p,g=m[0],v=m[1],b=m[2],x=m[3],y=x??K(1),w=ht(v.shape,u.shape),C=[];if(v.rank===1){for(var T=0;T<u.shape.length-1;++T)C.push(u.shape[T]);C.push(1)}var S=g.sub(v),I=h.mul(y),_=OD(b.add(K(i))),N=_.mul(_).mul(_).mul(K(-.5));return{x:function(){return v.rank===1?h.mul(Xo(_.as4D(1,1,1,v.shape[0]),C)).mul(y).reshape(g.shape):h.mul(_).mul(y).reshape(g.shape)},mean:function(){var A=_.mul(K(-1)).mul(I);return v.rank===1&&(A=A.sum(w)),A.reshape(v.shape)},variance:function(){var A=N.mul(S).mul(I);return v.rank===1&&(A=A.sum(w)),A.reshape(v.shape)},scale:function(){var A=S.mul(_),B=h.mul(A);return v.rank===1&&(B=B.sum(w)),B.reshape(v.shape)},offset:function(){var A=h;return v.rank===1&&(A=A.sum(w)),A.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},f).reshape(c.shape)}function Sl(t){return t==null?null:t.rank===0?t.as1D():t.rank===1?t:t.rank===2?t.as4D(1,1,t.shape[0],t.shape[1]):t.rank===3?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function ud(){BC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var mP=M({batchNormalization2d_:function(t,n,e,r,o,i){return r===void 0&&(r=.001),ud(),LD(t,n,e,i,o,r)}}),gP=M({batchNormalization3d_:function(t,n,e,r,o,i){return r===void 0&&(r=.001),ud(),BD(t,n,e,i,o,r)}}),vP=M({batchNormalization4d_:function(t,n,e,r,o,i){return r===void 0&&(r=.001),ud(),jD(t,n,e,i,o,r)}}),yP=M({batchNormalization_:function(t,n,e,r,o,i){return r===void 0&&(r=.001),ud(),au(t,n,e,i,o,r)}}),fg=M({batchNorm_:au}),bP=M({batchNorm2d_:LD}),xP=M({batchNorm3d_:BD}),wP=M({batchNorm4d_:jD}),cd=M({logicalAnd_:function(t,n){var e=D(t,"a","logicalAnd","bool"),r=D(n,"b","logicalAnd","bool");return Ce(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),CP=M({logicalNot_:function(t){var n=D(t,"x","logicalNot","bool");return R.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),VD=M({logicalOr_:function(t,n){var e=D(t,"a","logicalOr","bool"),r=D(n,"b","logicalOr","bool");return Ce(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),DP=M({logicalXor_:function(t,n){var e=D(t,"a","logicalXor","bool"),r=D(n,"b","logicalXor","bool");return Ce(e.shape,r.shape),VD(t,n).logicalAnd(cd(t,n).logicalNot())}}),Jo=M({where_:function(t,n,e){var r=D(n,"a","where"),o=D(e,"b","where"),i=D(t,"condition","where","bool");return Le(r.shape,o.shape,"Error in where: "),i.rank===1?E(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Le(i.shape,o.shape,"Error in where: "),R.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return ke(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),UD=function(t){return J(this,void 0,void 0,function(){var n,e,r;return ee(this,function(o){switch(o.label){case 0:return[4,(n=D(t,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=sg(n.shape,e),t!==n&&n.dispose(),[2,r]}})})},ae=M({add_:function(t,n){var e,r=D(t,"a","add"),o=D(n,"b","add");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=ht(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=ht(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),EP=M({addN_:function(t){E(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),E(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var n=t.map(function(o,i){return D(o,"tensors"+i,"addN")}),e=n[0];n.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(o){if(!ft(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=n;return R.runKernelFunc(function(o){return o.addN(n)},r,function(o){var i={};return n.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),IP=M({addStrict_:function(t,n){var e=D(t,"a","addStrict"),r=D(n,"b","addStrict");return Le(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),_P=M({atan2_:function(t,n){var e,r=D(t,"a","atan2"),o=D(n,"b","atan2");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=ae(u.square(),c.square()),d=a.mul(c.div(l)),f=ht(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=ae(u.square(),c.square()),d=iu(a.mul(u.div(l))),f=ht(c.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Sn=M({div_:function(t,n){var e,r=D(t,"a","div"),o=D(n,"b","div");if(e=Qe(r,o),r=e[0],o=e[1],r.dtype==="int32"&&o.dtype==="int32")return WD(r,o);var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=ht(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=ht(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),SP=M({divNoNan_:function(t,n){var e,r=D(t,"a","div"),o=D(n,"b","div");r=(e=Qe(r,o))[0],o=e[1];var i=Sn(r,o),a=ke(i),s=o.equal(a);return Jo(s,a,i)}}),TP=M({divStrict_:function(t,n){var e=D(t,"a","div"),r=D(n,"b","div");return Le(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),WD=M({floorDiv_:function(t,n){var e,r=D(t,"a","floorDiv"),o=D(n,"b","floorDiv");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=ht(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=ht(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),hg=M({maximum_:function(t,n){var e,r=D(t,"a","maximum"),o=D(n,"b","maximum");return e=Qe(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ce(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),MP=M({maximumStrict_:function(t,n){var e=D(t,"a","maximumStrict"),r=D(n,"b","maximumStrict");return Le(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),HD=M({minimum_:function(t,n){var e,r=D(t,"a","minimum"),o=D(n,"b","minimum");return e=Qe(r,o),r=e[0],o=e[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Ce(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),RP=M({minimumStrict_:function(t,n){var e=D(t,"a","minimumStrict"),r=D(n,"b","minimumStrict");return Le(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),AP=M({mod_:function(t,n){var e,r=D(t,"a","mod"),o=D(n,"b","mod");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=ht(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),d=ht(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),NP=M({modStrict_:function(t,n){var e=D(t,"a","modStrict"),r=D(n,"b","modStrict");return Le(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),tt=M({mul_:function(t,n){var e,r=D(t,"a","mul"),o=D(n,"b","mul");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),d=ht(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=ht(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),kP=M({mulStrict_:function(t,n){var e=D(t,"a","mul"),r=D(n,"b","mul");return Le(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),Ql=M({pow_:function(t,n){var e,r=D(t,"base","pow"),o=D(n,"exp","pow");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape),a=[r,o];return R.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=s.mul(f.mul(c.pow(f.sub(K(1))))),p=ht(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,ke(c)),p=s.mul(d.mul(h)),m=ht(l.shape,i);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)}}},"Pow",{},a,[!0])}}),FP=M({powStrict_:function(t,n){return Le(t.shape,n.shape,"Error in powStrict: "),t.pow(n)}}),PP=M({squaredDifferenceStrict_:function(t,n){var e=D(t,"a","squaredDifferenceStrict"),r=D(n,"b","squaredDifferenceStrict");return Le(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),$e=M({sub_:function(t,n){var e,r=D(t,"a","sub"),o=D(n,"b","sub");e=Qe(r,o),r=e[0],o=e[1];var i=Ce(r.shape,o.shape);return R.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=ht(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=ht(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),OP=M({subStrict_:function(t,n){var e=D(t,"a","subStrict"),r=D(n,"b","subStrict");return Le(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),zD=M({equal_:function(t,n){var e,r=D(t,"a","equal"),o=D(n,"b","equal");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),LP=M({equalStrict_:function(t,n){var e=D(t,"a","equalStrict"),r=D(n,"b","equalStrict");return Le(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),BP=M({greater_:function(t,n){var e,r=D(t,"a","greater"),o=D(n,"b","greater");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),$D=M({greaterEqual_:function(t,n){var e,r=D(t,"a","greaterEqual"),o=D(n,"b","greaterEqual");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return ke(s)},b:function(){return ke(u)}}},"GreaterEqual")}}),jP=M({greaterEqualStrict_:function(t,n){var e=D(t,"a","greaterEqualStrict"),r=D(n,"b","greaterEqualStrict");return Le(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),VP=M({greaterStrict_:function(t,n){var e=D(t,"a","greaterStrict"),r=D(n,"b","greaterStrict");return Le(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),UP=M({less_:function(t,n){var e,r=D(t,"a","less"),o=D(n,"b","less");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),WP=M({lessEqual_:function(t,n){var e,r=D(t,"a","lessEqual"),o=D(n,"b","lessEqual");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),HP=M({lessEqualStrict_:function(t,n){var e=D(t,"a","lessEqualStrict"),r=D(n,"b","lessEqualStrict");return Le(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),zP=M({lessStrict_:function(t,n){var e=D(t,"a","lessStrict"),r=D(n,"b","lessStrict");return Le(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),$P=M({notEqual_:function(t,n){var e,r=D(t,"a","notEqual"),o=D(n,"b","notEqual");return e=Qe(r,o),r=e[0],o=e[1],Ce(r.shape,o.shape),R.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),GP=M({notEqualStrict_:function(t,n){var e=D(t,"a","notEqualStrict"),r=D(n,"b","notEqualStrict");return Le(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function Pw(t,n){for(var e=[],r=t;r<n;++r)e.push(r);return e}function Ow(t){for(var n=[],e=0;e<t.length;++e)for(var r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var pg=M({gather_:function(t,n,e){e===void 0&&(e=0);var r=D(t,"x","gather"),o=D(n,"indices","gather","int32");e=pt(e,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,o,e);return R.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,m=Pw(0,f),g=Pw(f+1,f+1+p),v=Ow([d,[l],h]),b=a.reshape(v),x=u.reshape([l]),y=Ow([[f],m,g]),w=b.transpose(y),C=GD(w,x,r.shape[e]),T=td(y);return C=C.transpose(T)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),GD=M({unsortedSegmentSum_:function(t,n,e){var r=D(t,"x","unsortedSegmentSum"),o=D(n,"segmentIds","unsortedSegmentSum","int32");return E(nt(e),function(){return"numSegments must be of dtype int"}),R.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,e);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=hg(c,ke(c)),d=pg(u,l),f=$D(c,K(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=Bt(f,p+1);f=cd(f,ga(d.shape,"bool"));var m=ke(d);return Jo(f,d,m)}(i,s)}}})}}),qP=function(t,n,e){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,m;return ee(this,function(g){switch(g.label){case 0:for(r=D(t,"tensor","boolMask"),o=D(n,"mask","boolMask","bool"),i=e??0,a=o.rank,s=r.shape,E(a>0,function(){return"mask cannot be scalar"}),Le(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(l),f=o.reshape([-1]),[4,UD(f)];case 1:return h=g.sent(),p=h.squeeze([1]),m=pg(d,p,i),t!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,m]}})})};function qD(t,n,e,r,o,i,a){i===void 0&&(i="NHWC"),E(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var s=t,u=n,c=!1;n.rank===3&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,t[0],t[1],t[2]]),E(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),E(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),E(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l=i==="NHWC"?s[3]:s[1],d=i==="NHWC"?u.shape[3]:u.shape[1];E(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),E(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),a!=null&&E(nt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=ad(i),h=fo(s,e.shape,r,1,o,a,!1,f),p=R.runKernelFunc(function(m,g){var v=m.conv2dDerInput(u,e,h);return g([e,u]),v},{dy4D:u,filter:e},function(m,g){var v=g[0],b=g[1];return{dy4D:function(){return _t(m,v,r,o,i,1,a)},filter:function(){return mg(m,b,v.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function lm(t){var n=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(t),e=n[0],r=n[1],o=n[2];return e===1&&r===1&&o===1}function KD(t,n,e,r,o){E(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var i=t,a=n,s=!1;n.rank===4&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];E(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),E(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),E(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),E(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),E(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=eu(i,e.shape,r,1,o),d=R.runKernelFunc(function(f){return f.conv3dDerInput(a,e,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var KP=M({conv1d_:function(t,n,e,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=D(t,"x","conv1d"),u=D(n,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),E(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),E(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&E(nt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),E(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),E($t(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),E(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=_t(f,d,[1,e],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),_t=M({conv2d_:function(t,n,e,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=D(t,"x","conv2d"),u=D(n,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),E(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&E(nt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=o==="NHWC"?c.shape[3]:c.shape[1];E(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),E($t(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var f=ad(o),h=fo(c.shape,u.shape,e,i,r,a,!1,f),p=[u,c],m=R.runKernelFunc(function(g,v){var b=g.conv2d(c,u,h);return v([u,c]),b},{x:c,filter:u},function(g,v){var b=v,x=b[0],y=b[1];return E(Zo(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return XD(y.shape,g,x,e,r,o)},filter:function(){return mg(y,g,x.shape,e,r,o)}}},"Conv2D",h,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),XP=M({conv3d_:function(t,n,e,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=D(t,"x","conv3d"),s=D(n,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),E(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),E(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),E(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),E(function(f,h){return lm(f)||lm(h)}(e,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),E(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=eu(u.shape,s.shape,e,i,r),d=R.runKernelFunc(function(f,h){var p=f.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(f,h){E(lm(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],m=h[1];return{x:function(){return KD(p.shape,f,m,e,r)},$filter:function(){return function(g,v,b,x,y){var w=g;g.rank===4&&(w=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var C=v;C.rank===4&&(C=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),E(w.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+w.shape+"."}),E(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),E(b.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),E(w.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+w.shape[4]+") must match input depth in filter ("+b[3]+"."}),E(C.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+b[4]+")."});var T=eu(w.shape,b,x,1,y);return R.runKernelFunc(function(S){return S.conv3dDerFilter(w,C,T)},{x5D:w,dy5D:C})}(p,f,m.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),mg=M({conv2dDerFilter_:function(t,n,e,r,o,i,a){i===void 0&&(i="NHWC");var s=t;t.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=n;u.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),E(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),E(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),E(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];E(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),E(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),a!=null&&E(nt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=ad(i),f=fo(s.shape,e,r,1,o,a,!1,d);return R.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),XD=M({conv2dDerInput_:qD}),su=M({depthwiseConv2d_:function(t,n,e,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=D(t,"x","depthwiseConv2d"),u=D(n,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),E(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),E($t(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),a!=null&&E(nt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=fo(c.shape,u.shape,e,i,r,a,!0),f=[c,u],h=R.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(c,u,d);return m([c,u]),g},{x:c,filter:u},function(p,m){E(Zo(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=m[0],v=m[1];return{x:function(){return YD(g.shape,p,v,d)},filter:function(){return QD(g,p,v.shape,d)}}},"DepthwiseConv2dNative",d,f);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),YD=M({depthwiseConv2dDerInput_:function(t,n,e,r){var o=n,i=!1;n.rank===3&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=R.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),QD=M({depthwiseConv2dDerFilter_:function(t,n,e,r){var o=t;t.rank===3&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n;return i.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),R.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),uu=M({separableConv2d_:function(t,n,e,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=D(t,"x","separableConv2d"),u=D(n,"depthwiseFilter","separableConv2d"),c=D(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(s.rank===3&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),E(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),E(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),E(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];E(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=su(l,u,r,o,a,i),m=_t(p,c,1,"valid",a);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),YP=M({conv2dTranspose_:function(t,n,e,r,o,i){return qD(e,D(t,"x","conv2dTranspose"),D(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),QP=M({conv3dTranspose_:function(t,n,e,r,o){return KD(e,D(t,"x","conv3dTranspose"),D(n,"filter","conv3dTranspose"),r,o)}}),va=M({matMul_:function(t,n,e,r){var o;e===void 0&&(e=!1),r===void 0&&(r=!1);var i=D(t,"a","matMul"),a=D(n,"b","matMul");o=Qe(i,a),i=o[0],a=o[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=te(d),p=te(f);E(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),E(ft(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),E(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([c,l]),g=e?i.as3D(h,s,c):i.as3D(h,c,s),v=r?a.as3D(p,l,u):a.as3D(p,u,l),b={transposeA:e,transposeB:r};return R.runKernelFunc(function(x,y){var w=x.batchMatMul(g,v,e,r);return y([g,v]),w},{a:g,b:v},function(x,y){var w=y,C=w[0],T=w[1];return e||r?!e&&r?{a:function(){return x.matMul(T,!1,!1)},b:function(){return x.matMul(C,!0,!1)}}:e&&!r?{a:function(){return T.matMul(x,!1,!0)},b:function(){return C.matMul(x,!1,!1)}}:{a:function(){return T.matMul(x,!0,!0)},b:function(){return x.matMul(C,!0,!0)}}:{a:function(){return x.matMul(T,!1,!0)},b:function(){return C.matMul(x,!0,!1)}}},"BatchMatMul",b).reshape(m)}}),ZP=M({dot_:function(t,n){var e=D(t,"t1","dot"),r=D(n,"t2","dot");E(!(e.rank!==1&&e.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];return E(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),e.rank===1&&r.rank===1?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():e.rank===1&&r.rank===2?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():e.rank===2&&r.rank===1?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),JP=M({outerProduct_:function(t,n){var e=D(t,"v1","outerProduct"),r=D(n,"v2","outerProduct");return E(e.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),cu=M({reverse_:function(t,n){var e=D(t,"x","reverse");if(e.rank===0)return e.clone();var r=pt(n,e.shape);return R.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),eO=M({reverse1d_:function(t){var n=D(t,"x","reverse");return E(n.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),cu(n,0)}}),tO=M({reverse2d_:function(t,n){var e=D(t,"x","reverse");return E(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),cu(e,n)}}),nO=M({reverse3d_:function(t,n){var e=D(t,"x","reverse");return E(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),cu(e,n)}}),rO=M({reverse4d_:function(t,n){var e=D(t,"x","reverse");return E(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),cu(e,n)}});function ZD(t,n,e,r,o,i){var a=D(t,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),r==null&&(r=[1,1]),E(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),E($t(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),i!=null&&E(nt(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ha(s.shape,n,e,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))return a.clone();var l=[s],d=R.runKernelFunc(function(f,h){var p=f.maxPool(s,c);return h([s,p]),p},{x:s},function(f,h){var p=h[0],m=h[1];return{x:function(){return function(g,v,b,x,y,w,C,T){var S=D(g,"dy","maxPoolBackprop"),I=D(v,"input","maxPoolBackprop"),_=D(b,"output","maxPoolBackprop");E(I.rank===S.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+S.rank+")"}),w==null&&(w=[1,1]),E($t(y,w),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+w+"'"}),E(S.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),E(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."}),T!=null&&E(nt(C),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var N=ha(I.shape,x,y,w,C,T);return R.runKernelFunc(function(A){return A.maxPoolBackprop(S,I,_,N)},{$dy:S,$input:I})}(f,p,m,n,e,r,o)}}},"MaxPool",c,l);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function JD(t,n,e,r,o,i){var a=D(t,"x","avgPool","float32");r==null&&(r=[1,1]),E($t(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),E(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&E(nt(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ha(s.shape,n,e,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&ft(c.inShape,c.outShape))return a.clone();var l=R.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,h,p,m,g,v){var b=D(f,"dy","avgPoolBackprop"),x=D(h,"input","avgPoolBackprop");E(x.rank===b.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+b.rank+")"}),g==null&&(g=[1,1]),E($t(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var y=x,w=b,C=!1;x.rank===3&&(C=!0,y=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),E(w.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."}),E(y.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+y.rank+"."});var T=ha(y.shape,p,m,g,v),S=R.runKernelFunc(function(I){return I.avgPoolBackprop(w,y,T)},{dy4D:w,input4D:y});return C?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(d,s,n,e,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var rt=M({maxPool_:function(t,n,e,r,o){return ZD(t,n,e,1,r,o)}}),Pr=M({avgPool_:function(t,n,e,r,o){return JD(t,n,e,1,r,o)}}),oO=M({pool_:function(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=D(t,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),E($t(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,l=ha(s.shape,n,i,o,r),d=[l.dilationHeight,l.dilationWidth];c=r==="same"?function(y,w){var C=y.map(function(I,_){return I+(I-1)*(w[_]-1)}).map(function(I){return I-1}),T=C.map(function(I){return Math.floor(I/2)}),S=C.map(function(I,_){return I-T[_]});return C.map(function(I,_){return[T[_],S[_]]})}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,h=function(y,w,C){var T=C.map(function(O){return O[0]}),S=C.map(function(O){return O[1]}),I=y.concat(T,S),_=w.map(function(O,L){return(O-I[L]%O)%O}),N=S.map(function(O,L){return O+_[L]}),A=w.map(function(O,L){return[T[L],N[L]]}),B=w.map(function(O,L){return[0,_[L]]});return[A,B]}([l.inHeight,l.inWidth],d,c),p=h[0],m=h[1],g=f?r:"valid",v=f?s:$C(s,d,p),b=(e==="avg"?function(){return JD(v,n,i,1,g)}:function(){return ZD(v,n,i,1,g)})(),x=f?b:WC(b,d,m);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),iO=M({maxPool3d_:function(t,n,e,r,o,i,a){i===void 0&&(i="NDHWC");var s=D(t,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),E(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),E(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),E($t(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),o!=null&&E(nt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Js(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],m=h[1];return{x:function(){return function(g,v,b,x,y,w,C,T){var S=D(g,"dy","maxPool3dBackprop"),I=D(v,"input","maxPool3dBackprop"),_=D(b,"output","maxPool3dBackprop"),N=S,A=I,B=_,O=!1;I.rank===4&&(O=!0,N=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),A=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),B=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),E(N.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),E(A.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),E(B.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."}),w==null&&(w=[1,1,1]),E($t(y,w),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+w+"'"}),T!=null&&E(nt(C),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+C+"."});var L=Js(A.shape,x,y,w,C,T),U=R.runKernelFunc(function(V){return V.maxPool3dBackprop(N,A,B,L)},{dy5D:N,input5D:A});return O?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U}(f,p,m,n,e,a,r,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),aO=M({avgPool3d_:function(t,n,e,r,o,i,a){i===void 0&&(i="NDHWC");var s=D(t,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),E(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),E(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),E($t(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),o!=null&&E(nt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Js(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,m,g,v,b,x){var y=D(h,"dy","avgPool3dBackprop"),w=D(p,"input","avgPool3dBackprop"),C=y,T=w,S=!1;w.rank===4&&(S=!0,C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),T=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),E(C.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."}),E(T.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),v==null&&(v=[1,1,1]),E($t(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),x!=null&&E(nt(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+b+"."});var I=Js(T.shape,m,g,v,b,x),_=R.runKernelFunc(function(N){return N.avgPool3dBackprop(C,T,I)},{dy5D:C,input5D:T});return S?_.as4D(_.shape[1],_.shape[2],_.shape[3],_.shape[4]):_}(f,u,n,e,a,r,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),zn=M({slice_:function(t,n,e){var r,o,i=D(t,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof n=="number"?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach(function(u){E(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=e==null?new Array(i.rank).fill(-1):typeof e=="number"?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(E(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),QC(i,r,o);var a=i.shape,s={begin:r,size:o};return R.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",s)}}),sO=M({slice1d_:function(t,n,e){var r=D(t,"x","slice1d");return E(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),zn(r,[n],[e])}}),uO=M({slice2d_:function(t,n,e){var r=D(t,"x","slice2d");return E(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),zn(r,n,e)}}),gg=M({slice3d_:function(t,n,e){var r=D(t,"x","slice3d");return E(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),zn(r,n,e)}}),cO=M({slice4d_:function(t,n,e){var r=D(t,"x","slice4d");return E(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),zn(r,n,e)}});function e1(t,n,e,r,o){return n.rank<e.rank&&(n=n.reshape(zt(n.shape,r))),t.rank<e.rank&&(t=t.reshape(zt(t.shape,r))),{x:function(){var i=t.mul(e.equal(n).cast(t.dtype));return o==null?i:i.transpose(o)}}}var lO=M({all_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","all","bool"),o=pt(n,r.shape),i=o,a=Gn(i,r.rank);a!=null&&(r=r.transpose(a),i=qn(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(e){var u=zt(s.shape,o);return s.reshape(u)}return s}}),dO=M({any_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","any","bool"),o=pt(n,r.shape),i=o,a=Gn(i,r.rank);a!=null&&(r=r.transpose(a),i=qn(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(e){var u=zt(s.shape,o);return s.reshape(u)}return s}}),fO=M({argMax_:function(t,n){n===void 0&&(n=0);var e=D(t,"x","argMax");n==null&&(n=0);var r=pt(n,e.shape),o=Gn(r,e.rank);o!=null&&(e=e.transpose(o),r=qn(r.length,e.rank));var i={axis:r[0]},a=[e];return R.runKernelFunc(function(s,u){var c=s.argMax(e,r[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return ke(c)}}},"ArgMax",i,a)}}),hO=M({argMin_:function(t,n){n===void 0&&(n=0);var e=D(t,"x","argMin");n==null&&(n=0);var r=pt(n,e.shape),o=Gn(r,e.rank);return o!=null&&(e=e.transpose(o),r=qn(r.length,e.rank)),R.runKernelFunc(function(i,a){var s=i.argMin(e,r[0]);return a([e]),s},{$x:e},function(i,a){var s=a[0];return{$x:function(){return ke(s)}}})}}),pO=M({logSumExp_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","logSumExp"),o=pt(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(e){var u=zt(s.shape,o);return s.reshape(u)}return s}}),ni=M({max_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","max"),o=r,i=pt(n,r.shape),a=i,s=Gn(a,r.rank);s!=null&&(r=r.transpose(s),a=qn(a.length,r.rank));var u=[r],c=R.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return e1(d,f[1],f[0],i,s)},"Max",{axes:a},u,[!0]);if(e){var l=zt(c.shape,i);c=c.reshape(l)}return c}}),mO=M({mean_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","mean"),o=pt(n,r.shape),i=te(Ft(r.shape,o)[1]);return id(function(a){var s=K(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(ga(a.shape,"float32")).div(i)}}})(r)}}),gO=M({min_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","min"),o=r,i=pt(n,r.shape),a=i,s=Gn(a,r.rank);s!=null&&(r=r.transpose(s),a=qn(a.length,r.rank));var u=[r],c=R.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return e1(d,f[1],f[0],i,s)},"Min",{axes:a},u,[!0]);if(e){var l=zt(c.shape,i);c=c.reshape(l)}return c}}),vO=M({moments_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=pt(n,(t=D(t,"x","moments")).shape),o=t.mean(r,e),i=o.shape;e||(i=zt(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,e)}}}),t1=M({sum_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=pt(n,r.shape);return id(function(i){var a=Gn(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=qn(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(m){p[m]=1}),h.reshape(p).mul(ga(i.shape,"float32"))},l={axes:s},d=R.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",l);if(e){var f=zt(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),yO=M({prod_:function(t,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var r=D(t,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=pt(n,r.shape),i=Gn(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=qn(a.length,r.rank));var u=R.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(e){var c=zt(u.shape,o);u=u.reshape(c)}return u}}),n1=M({elu_:function(t){var n=D(t,"x","elu");return R.runKernelFunc(function(e,r){var o=e.elu(n);return r([o]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return R.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),bO=M({leakyRelu_:function(t,n){n===void 0&&(n=.2);var e=D(t,"x","leakyRelu");return hg(K(n).mul(e),e)}}),r1=M({prelu_:function(t,n){var e=D(t,"x","prelu"),r=D(n,"alpha","prelu");return R.runKernelFunc(function(o,i){var a=o.prelu(e,r);return i([e,r]),a},{x:e,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return Jo(u,o,o.mul(s))},alpha:function(){var c=Jo(u,ke(o),o.mul(a)),l=ht(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),je=M({relu_:function(t){var n=D(t,"x","relu");return n.dtype==="bool"?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),o1=M({relu6_:function(t){var n=D(t,"x","relu6");return n.dtype==="bool"?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu6(n);return r([n]),o},{x:n},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),xO=M({selu_:function(t){var n=D(t,"x","selu");return R.runKernelFunc(function(e,r){var o=e.selu(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(K(0)),a=K(cg),s=K(lg),u=e.mul(s),c=e.mul(a).mul(o.toFloat().exp());return Jo(i,u,c)}}})}}),Tn=M({transpose_:function(t,n){var e=D(t,"x","transpose");if(n==null&&(n=e.shape.map(function(o,i){return i}).reverse()),E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(o){E(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1)return e.clone();var r={perm:n};return R.runKernelFunc(function(o){return o.transpose(e,n)},{x:e},function(o){var i=td(n);return{x:function(){return o.transpose(i)}}},"Transpose",r)}}),wO=M({localResponseNormalization_:function(t,n,e,r,o){n===void 0&&(n=5),e===void 0&&(e=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=D(t,"x","localResponseNormalization");E(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),E(nt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=R.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(a,n,e,r,o);return l([a,d]),d},{x4D:a},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return R.runKernelFunc(function(h){return h.LRNGrad(c,d,f,n,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),i1=M({norm_:function(t,n,e,r){n===void 0&&(n="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1);var o=function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(K(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=D(t,"x","norm"),n,e),i=o.shape;if(r){var a=pt(e,t.shape);i=zt(o.shape,a)}return o.reshape(i)}}),CO=M({basicLSTMCell_:function(t,n,e,r,o,i){var a=D(t,"forgetBias","basicLSTMCell"),s=D(n,"lstmKernel","basicLSTMCell"),u=D(e,"lstmBias","basicLSTMCell"),c=D(r,"data","basicLSTMCell"),l=D(o,"c","basicLSTMCell"),d=D(i,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),h=f.shape[0],p=f.shape[1]/4,m=[h,p],g=f.slice([0,0],m),v=f.slice([0,p],m),b=f.slice([0,2*p],m),x=f.slice([0,3*p],m),y=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),w=y.tanh().mulStrict(x.sigmoid());return[y,w]}}),DO=M({multiRNNCell_:function(t,n,e,r){for(var o=D(n,"data","multiRNNCell"),i=zl(e,"c","multiRNNCell"),a=zl(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),EO=M({movingAverage_:function(t,n,e,r,o){o===void 0&&(o=!0);var i=D(t,"v","movingAverage"),a=D(n,"x","movingAverage"),s=D(e,"decay","movingAverage");dC(i,a),E(ft(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=K(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){E(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=D(r,"step","movingAverage");l=l.div(u.sub(Ql(s,d)))}return i.add(l)}}),IO=M({stridedSlice_:function(t,n,e,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(n.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=D(t,"x","stridedSlice"),l=Fm(s),d=c.shape.slice();l.forEach(function(g){n[g]=0,e[g]=1,d.splice(g,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=ZC(o,n,r,c.shape,f),e[f]=JC(i,e,r,c.shape,f),r[f]=r[f]||1;var h=Fm(u);h.forEach(function(g){e[g]=n[g]+1,r[g]=1});var p=od(n,e,r),m=p.filter(function(g,v){return h.indexOf(v)===-1});return r.every(function(g){return g===1})?zn(c,n,p).reshape(m):R.runKernelFunc(function(g){return g.stridedSlice(c,n,e,r)},{$x:c}).reshape(m)}}),_O=M({topk_:function(t,n,e){n===void 0&&(n=1),e===void 0&&(e=!0);var r=D(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=R.runKernelFunc(function(a){return a.topk(r,n,e)},{$x:r});return{values:i[0],indices:i[1]}}}),SO=M({scatterND_:function(t,n,e){var r=D(t,"indices","scatterND","int32"),o=D(n,"updates","scatterND");return YC(o,r,e),R.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),vg=M({fft_:function(t){E(t.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],e=t.size/n,r=t.as2D(e,n);return R.runKernelFunc(function(o){return o.fft(r)},{input:t}).reshape(t.shape)}}),Zl=M({ifft_:function(t){E(t.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],e=t.size/n,r=t.as2D(e,n);return R.runKernelFunc(function(o){return o.ifft(r)},{input:t}).reshape(t.shape)}}),yg=M({rfft_:function(t,n){E(t.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e,r=t.shape[t.shape.length-1],o=t.size/r;if(n!=null&&n<r){var i=t.shape.map(function(v){return 0}),a=t.shape.map(function(v){return v});a[t.shape.length-1]=n,e=t.slice(i,a),r=n}else if(n!=null&&n>r){var s=t.shape.map(function(v){return v});s[t.shape.length-1]=n-r,e=t.concat(Ke(s),t.shape.length-1),r=n}else e=t;var u=e.zerosLike(),c=kt(e,u).as2D(o,r),l=vg(c),d=Math.floor(r/2)+1,f=_n(l),h=lr(l),p=f.split([d,r-d],f.shape.length-1),m=h.split([d,r-d],h.shape.length-1),g=e.shape.slice();return g[e.shape.length-1]=d,kt(p[0],m[0]).reshape(g)}}),a1=M({irfft_:function(t){var n=t.shape[t.shape.length-1],e=t.size/n;if(n<=2){var r=t.as2D(e,n),o=Zl(r);return _n(o)}var i=[e,2*(n-1)],a=_n(t).as2D(e,n),s=lr(t).as2D(e,n),u=a.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(K(-1)),l=a.concat(u,1),d=s.concat(c,1);return r=kt(l,d).as2D(i[0],i[1]),o=Zl(r),_n(o)}}),TO=Object.freeze({fft:vg,ifft:Zl,rfft:yg,irfft:a1}),MO=M({sparseToDense_:function(t,n,e,r){r===void 0&&(r=0);var o=D(t,"sparseIndices","sparseToDense","int32"),i=D(n,"sparseValues","sparseToDense"),a=D(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,a),R.runKernelFunc(function(s){return s.sparseToDense(o,i,e,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),RO=M({gatherND_:function(t,n){var e=D(n,"indices","gatherND","int32"),r=D(t,"x","gatherND");return R.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),AO=M({diag_:function(t){var n=D(t,"x","diag").flatten(),e=t.shape.concat(t.shape);return R.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(e)}}),NO=M({dropout_:function(t,n,e,r){var o=D(t,"x","dropout");if(E(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),E(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),n===0)return t instanceof ze?o.clone():o;var i=function(u,c){if(c==null)return u.shape.slice();if(ft(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)c[d]==null&&u.shape[d]!=null?l.push(u.shape[d]):l.push(c[d]);return l}return c}(o,e),a=1-n,s=zC(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function s1(t,n,e){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=n-e*Math.cos(a)}return qe(o,"float32")}var bg=M({hannWindow_:function(t){return s1(t,.5,.5)}}),u1=M({hammingWindow_:function(t){return s1(t,.54,.46)}}),xg=M({frame_:function(t,n,e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+n<=t.size;)a.push(zn(t,i,n)),i+=e;if(r)for(;i<t.size;){var s=i+n-t.size,u=Ye([zn(t,i,n-s),mn([s],o)]);a.push(u),i+=e}return a.length===0?dr([],[0,n]):Ye(a).as2D(a.length,n)}}),c1=M({stft_:function(t,n,e,r,o){var i;o===void 0&&(o=bg),r==null&&(i=n,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=xg(t,n,e),s=tt(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(yg(s.slice([c,0],[1,n]),r));return Ye(u)}}),kO=Object.freeze({hannWindow:bg,hammingWindow:u1,frame:xg,stft:c1}),Vt,FO=function(t,n,e){return e===void 0&&(e=1),J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,m,g;return ee(this,function(v){switch(v.label){case 0:return r=D(t,"predictions","inTopK"),o=D(n,"targets","inTopK"),E(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),E(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Le(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],E(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],l=u[1],d=fa("bool",c=u[0]),f=0;f<c;f++){for(h=f*l,p=a.subarray(h,h+l),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(b,x){return x.value-b.value}),d[f]=0,g=0;g<e;g++)if(m[g].index===s[f]){d[f]=1;break}}return t!==r&&r.dispose(),n!==o&&o.dispose(),[2,It(d,o.shape,"bool")]}})})};(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Vt||(Vt={}));var PO=M({absoluteDifference_:function(t,n,e,r){r===void 0&&(r=Vt.SUM_BY_NONZERO_WEIGHTS);var o=D(t,"labels","absoluteDifference"),i=D(n,"predictions","absoluteDifference"),a=null;e!=null&&(a=D(e,"weights","absoluteDifference")),Le(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Or(s,a,r)}}),Or=M({computeWeightedLoss_:function(t,n,e){e===void 0&&(e=Vt.SUM_BY_NONZERO_WEIGHTS);var r=D(t,"losses","computeWeightedLoss"),o=null;n!=null&&(o=D(n,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(e===Vt.NONE)return i;if(e===Vt.SUM)return i.sum();if(e===Vt.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(K(a)):s}if(e===Vt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(K(r.size));var u=o.mul(ga(r.shape)).notEqual(K(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),OO=M({cosineDistance_:function(t,n,e,r,o){o===void 0&&(o=Vt.SUM_BY_NONZERO_WEIGHTS);var i=D(t,"labels","cosineDistance"),a=D(n,"predictions","cosineDistance"),s=null;r!=null&&(s=D(r,"weights","cosineDistance")),Le(i.shape,a.shape,"Error in cosineDistance: ");var u=K(1).sub(i.mul(a).sum(e,!0));return Or(u,s,o)}}),LO=M({hingeLoss_:function(t,n,e,r){r===void 0&&(r=Vt.SUM_BY_NONZERO_WEIGHTS);var o=D(t,"labels","hingeLoss"),i=D(n,"predictions","hingeLoss"),a=null;e!=null&&(a=D(e,"weights","hingeLoss")),Le(o.shape,i.shape,"Error in hingeLoss: ");var s=K(1);o=K(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Or(u,a,r)}}),BO=M({huberLoss_:function(t,n,e,r,o){r===void 0&&(r=1),o===void 0&&(o=Vt.SUM_BY_NONZERO_WEIGHTS);var i=D(t,"labels","huberLoss"),a=D(n,"predictions","huberLoss"),s=null;e!=null&&(s=D(e,"weights","huberLoss")),Le(i.shape,a.shape,"Error in huberLoss: ");var u=K(r),c=a.sub(i).abs(),l=HD(c,u),d=c.sub(l),f=K(.5).mul(l.square()).add(u.mul(d));return Or(f,s,o)}}),jO=M({logLoss_:function(t,n,e,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Vt.SUM_BY_NONZERO_WEIGHTS);var i=D(t,"labels","logLoss"),a=D(n,"predictions","logLoss"),s=null;e!=null&&(s=D(e,"weights","logLoss")),Le(i.shape,a.shape,"Error in logLoss: ");var u=K(1),c=K(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Or(l,s,o)}}),VO=M({meanSquaredError_:function(t,n,e,r){r===void 0&&(r=Vt.SUM_BY_NONZERO_WEIGHTS);var o=D(t,"labels","meanSquaredError"),i=D(n,"predictions","meanSquaredError"),a=null;e!=null&&(a=D(e,"weights","meanSquaredError")),Le(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Or(s,a,r)}}),UO=M({sigmoidCrossEntropy_:function(t,n,e,r,o){r===void 0&&(r=0),o===void 0&&(o=Vt.SUM_BY_NONZERO_WEIGHTS);var i=D(t,"multiClassLabels","sigmoidCrossEntropy"),a=D(n,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=D(e,"weights","sigmoidCrossEntropy")),Le(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=K(r),c=K(1),l=K(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=D(f,"labels","sigmoidCrossEntropyWithLogits"),m=D(h,"logits","sigmoidCrossEntropyWithLogits");Le(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),b=m.abs().neg().exp().log1p();return g.sub(v).add(b)}(i,a);return Or(d,s,o)}}),WO=M({softmaxCrossEntropy_:function(t,n,e,r,o){r===void 0&&(r=0),o===void 0&&(o=Vt.SUM_BY_NONZERO_WEIGHTS);var i=D(t,"onehotLabels","softmaxCrossEntropy"),a=D(n,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=D(e,"weights","softmaxCrossEntropy")),Le(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=K(r),c=K(1),l=K(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return id(function(m,g,v){var b=g.logSumExp([p],!0),x=g.toFloat().sub(b);return v([m,x]),{value:x.mul(m).neg().sum([p]),gradFunc:function(y,w){var C=w[0],T=w[1],S=zt(y.shape,[p]);return[y.reshape(S).mul(C.toFloat().sub(T.exp())),y.reshape(S).mul(T.exp().sub(C.toFloat()))]}}})(f,h)}(i,a);return Or(d,s,o)}}),HO=Object.freeze({get Reduction(){return Vt},absoluteDifference:PO,computeWeightedLoss:Or,cosineDistance:OO,hingeLoss:LO,huberLoss:BO,logLoss:jO,meanSquaredError:VO,sigmoidCrossEntropy:UO,softmaxCrossEntropy:WO});function Lw(t,n){return n===void 0&&(n=!1),R.tidy(function(){if(t.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var e=t.shape[0],r=t.shape[1],o=HC(e),i=t.clone(),a=dr([[1]],[1,1]),s=a.clone(),u=e>=r?r:e,c=function(d){var f,h=i,p=s,m=o;f=R.tidy(function(){var g=i.slice([d,d],[e-d,1]),v=g.norm(),b=i.slice([d,d],[1,1]),x=dr([[-1]]).where(b.greater(0),dr([[1]])),y=b.sub(x.mul(v)),w=g.div(y);s=w.shape[0]===1?a.clone():a.concat(w.slice([1,0],[w.shape[0]-1,w.shape[1]]),0);var C=x.matMul(y).div(v).neg(),T=i.slice([d,0],[e-d,r]),S=C.mul(s);if(d===0)i=T.sub(S.matMul(s.transpose().matMul(T)));else{var I=T.sub(S.matMul(s.transpose().matMul(T)));i=i.slice([0,0],[d,r]).concat(I,0)}var _=o.slice([0,d],[e,o.shape[1]-d]);if(d===0)o=_.sub(_.matMul(s).matMul(S.transpose()));else{var N=_.sub(_.matMul(s).matMul(S.transpose()));o=o.slice([0,0],[e,d]).concat(N,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],en([h,p,m])},l=0;l<u;++l)c(l);return!n&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var zO=M({bandPart_:function(t,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=D(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),e<0&&(e=s);var u=$l(0,a,1,"int32").reshape([-1,1]),c=$l(0,s,1,"int32"),l=$e(u,c),d=cd(l.lessEqual(K(+n,"int32")),l.greaterEqual(K(-e,"int32"))),f=Ke([a,s],r.dtype);return Ot(Ue(r.reshape([-1,a,s])).map(function(h){return Jo(d,h,f)})).reshape(o)}}),$O=M({gramSchmidt_:function(t){var n;if(Array.isArray(t)){n=!1,E(t!=null&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=t[0].shape[0],r=function(u){E(t[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+e+")"})},o=1;o<t.length;++o)r(o)}else n=!0,t=Ym(t,t.shape[0],0).map(function(u){return GC(u,[0])});E(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(u){i.push(R.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var d=t1(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(i1(c,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return n?Ot(i,0):i}}),GO=M({qr_:function(t,n){if(n===void 0&&(n=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(t.rank===2)return Lw(t,n);var e=t.shape.slice(0,t.shape.length-2).reduce(function(a,s){return a*s}),r=Ue(t.reshape([e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=Lw(a,n),u=s[0],c=s[1];o.push(u),i.push(c)}),[Ot(o,0).reshape(t.shape),Ot(i,0).reshape(t.shape)]}}),qO=Object.freeze({bandPart:zO,gramSchmidt:$O,qr:GO});function ld(t,n,e,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=t.shape[0];return e=Math.min(e,a),E(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),E(t.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),E(t.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),E(n.rank===1,function(){return"scores must be a 1D tensor"}),E(n.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]}),E(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var KO=M({resizeBilinear_:function(t,n,e){e===void 0&&(e=!1);var r=D(t,"images","resizeBilinear");E(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),E(n.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,e)},{x:o},function(c,l){return{x:function(){return R.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),XO=M({resizeNearestNeighbor_:function(t,n,e){e===void 0&&(e=!1);var r=D(t,"images","resizeNearestNeighbor");E(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),E(n.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),E(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,e)},{batchImages:o},function(c,l){return{batchImages:function(){return R.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),YO=M({nonMaxSuppression_:function(t,n,e,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=D(t,"boxes","nonMaxSuppression"),a=D(n,"scores","nonMaxSuppression"),s=ld(i,a,e,r,o);e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return R.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,e,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),QO=function(t,n,e,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),J(this,void 0,void 0,function(){var i,a,s,u,c,l,d;return ee(this,function(f){switch(f.label){case 0:return i=D(t,"boxes","nonMaxSuppressionAsync"),a=D(n,"scores","nonMaxSuppressionAsync"),s=ld(i,a,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),c=u[0],l=u[1],d=ig(c,l,e,r,o),i!==t&&i.dispose(),a!==n&&a.dispose(),[2,d]}})})},ZO=M({nonMaxSuppressionWithScore_:function(t,n,e,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=D(t,"boxes","nonMaxSuppression"),s=D(n,"scores","nonMaxSuppression"),u=ld(a,s,e,r,o,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=R.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),JO=function(t,n,e,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),J(this,void 0,void 0,function(){var a,s,u,c,l,d,f;return ee(this,function(h){switch(h.label){case 0:return a=D(t,"boxes","nonMaxSuppressionAsync"),s=D(n,"scores","nonMaxSuppressionAsync"),u=ld(a,s,e,r,o,i),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),l=c[0],d=c[1],f=ag(l,d,e,r,o,i),a!==t&&a.dispose(),s!==n&&s.dispose(),[2,f]}})})},eL=M({cropAndResize_:function(t,n,e,r,o,i){var a=D(t,"image","cropAndResize"),s=D(n,"boxes","cropAndResize","float32"),u=D(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return E(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),E(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),E(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),E(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),E(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),E(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),R.runKernelFunc(function(l,d){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),lu=Object.freeze({resizeBilinear:KO,resizeNearestNeighbor:XO,nonMaxSuppression:YO,nonMaxSuppressionAsync:QO,nonMaxSuppressionWithScore:ZO,nonMaxSuppressionWithScoreAsync:JO,cropAndResize:eL}),wg=function(t,n){return!(t>0)||n==="linear"},Cg=function(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return t.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Dg=function(t,n){var e=n,r=ht(t.shape,n.shape);return r.length>0&&(e=e.sum(r)),e.reshape(t.shape)},Eg=function(t,n,e){if(n==="linear")return t;if(n==="relu")return je(t);if(n==="elu")return n1(t);if(n==="relu6")return o1(t);if(n==="prelu")return r1(t,e);throw new Error("Unknown fused activation "+n+".")},tL=M({fusedMatMul_:function(t){var n,e=t.a,r=t.b,o=t.transposeA,i=o!==void 0&&o,a=t.transposeB,s=a!==void 0&&a,u=t.bias,c=t.activation,l=c===void 0?"linear":c,d=t.preluActivationWeights;if(wg(R.state.gradientDepth,l)===!1){var f=va(e,r,i,s);return u!=null&&(f=ae(f,u)),Eg(f,l,d)}var h=D(e,"a","fused matMul"),p=D(r,"b","fused matMul");n=Qe(h,p),h=n[0],p=n[1];var m=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),y=p.shape.slice(0,-2),w=te(x),C=te(y);E(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),E(ft(x,y),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+y+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),E(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var T,S,I=h.shape.slice(0,-2).concat([v,b]),_=i?h.as3D(w,m,v):h.as3D(w,v,m),N=s?p.as3D(C,b,g):p.as3D(C,g,b);u!=null&&Ce(I,(T=Qe(T=D(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(S=D(d,"prelu weights","fused matMul"));var A={a:_,b:N};u!=null&&(A.bias=T),d!=null&&(A.preluActivationWeights=S);var B=[_,N];return R.runKernelFunc(function(O,L){var U=O.fusedBatchMatMul({a:_,b:N,transposeA:i,transposeB:s,bias:T,activation:l,preluActivationWeights:S});return L([_,N,U]),U},A,function(O,L){var U=L[0],V=L[1],j=L[2],z=Cg(O,j,l),$={};return u!=null&&($={bias:function(){return Dg(T,z)}}),Object.assign(i||s?!i&&s?{a:function(){return z.matMul(V,!1,!1)},b:function(){return z.matMul(U,!0,!1)}}:i&&!s?{a:function(){return V.matMul(z,!1,!0)},b:function(){return U.matMul(z,!1,!1)}}:{a:function(){return V.matMul(z,!0,!0)},b:function(){return z.matMul(U,!0,!0)}}:{a:function(){return z.matMul(V,!1,!0)},b:function(){return U.matMul(z,!0,!1)}},$)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},B,[!0]).reshape(I)}}),nL=M({fusedConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=i===void 0?"NHWC":i,s=t.dilations,u=s===void 0?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=d===void 0?"linear":d,h=t.preluActivationWeights;if(f=f||"linear",wg(R.state.gradientDepth,f)===!1){var p=_t(n,e,r,o,a,u,c);return l!=null&&(p=ae(p,l)),Eg(p,f,h)}var m=D(n,"x","conv2d"),g=D(e,"filter","conv2d"),v=m,b=!1;m.rank===3&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),E(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),E(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),c!=null&&E(nt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),E(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),E($t(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),E(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,y,w=fo(v.shape,g.shape,r,u,o,c);l!=null&&(x=Qe(x=D(l,"bias","fused conv2d"),m)[0],Ce(w.outShape,x.shape)),h!=null&&(y=D(h,"prelu weights","fused conv2d"));var C={x:v,filter:g};l!=null&&(C.bias=x),h!=null&&(C.preluActivationWeights=y);var T=[g,v],S=R.runKernelFunc(function(I,_){var N=I.fusedConv2d({input:v,filter:g,convInfo:w,bias:x,activation:f,preluActivationWeights:y});return _([g,v,N]),N},C,function(I,_){var N=_,A=N[0],B=N[1],O=N[2],L=Cg(I,O,f);E(Zo(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var U={};return l!=null&&(U={bias:function(){return Dg(x,L)}}),Object.assign({x:function(){return XD(B.shape,L,A,r,o)},filter:function(){return mg(B,L,A.shape,r,o)}},U)},"FusedConv2D",{convInfo:w,activation:f},T,[!0]);return b?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),rL=M({fusedDepthwiseConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=i===void 0?"NHWC":i,s=t.dilations,u=s===void 0?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=d===void 0?"linear":d,h=t.preluActivationWeights;if(wg(R.state.gradientDepth,f)===!1){var p=su(n,e,r,o,a,u,c);return l!=null&&(p=ae(p,l)),Eg(p,f,h)}var m=D(n,"x","depthwiseConv2d"),g=D(e,"filter","depthwiseConv2d"),v=m,b=!1;m.rank===3&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),E(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),E(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),E(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),E($t(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),c!=null&&E(nt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var x,y,w=fo(v.shape,g.shape,r,u,o,c,!0);l!=null&&(x=Qe(x=D(l,"bias","fused conv2d"),m)[0],Ce(w.outShape,x.shape)),h!=null&&(y=D(h,"prelu weights","fused depthwiseConv2d"));var C={x:v,filter:g};l!=null&&(C.bias=x),h!=null&&(C.preluActivationWeights=y);var T=[g,v],S=R.runKernelFunc(function(I,_){var N=I.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:x,activation:f,preluActivationWeights:y});return _([g,v,N]),N},C,function(I,_){E(Zo(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=_[0],A=_[1],B=_[2],O=Cg(I,B,f),L={};return l!=null&&(L={bias:function(){return Dg(x,O)}}),Object.assign({x:function(){return YD(A.shape,O,N,w)},filter:function(){return QD(A,O,N.shape,w)}},L)},"FusedDepthwiseConv2D",{convInfo:w,activation:f},T,[!0]);return b?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),oL=Object.freeze({matMul:tL,conv2d:nL,depthwiseConv2d:rL}),iL=Object.freeze({image:lu,linalg:qO,losses:HO,spectral:TO,fused:oL,signal:kO,square:jF,squaredDifference:PD,conv1d:KP,conv2d:_t,conv3d:XP,depthwiseConv2d:su,separableConv2d:uu,conv2dTranspose:YP,conv3dTranspose:QP,op:M,batchNormalization2d:mP,batchNormalization3d:gP,batchNormalization4d:vP,batchNormalization:yP,batchNorm:fg,batchNorm2d:bP,batchNorm3d:xP,batchNorm4d:wP,booleanMaskAsync:qP,complex:kt,real:_n,imag:lr,concat:Ye,concat1d:_N,concat2d:SN,concat3d:TN,concat4d:MN,split:Ym,matMul:va,dot:ZP,outerProduct:JP,reverse:cu,reverse1d:eO,reverse2d:tO,reverse3d:nO,reverse4d:rO,maxPool:rt,avgPool:Pr,pool:oO,maxPool3d:iO,avgPool3d:aO,slice:zn,slice1d:sO,slice2d:uO,slice3d:gg,slice4d:cO,abs:VF,acos:UF,acosh:WF,asin:HF,asinh:zF,atan:$F,atanh:GF,ceil:qF,clipByValue:ou,cos:KF,cosh:XF,erf:YF,exp:sd,expm1:QF,floor:ZF,log:JF,log1p:eP,logSigmoid:tP,neg:iu,reciprocal:nP,round:rP,rsqrt:OD,sigmoid:dg,sign:oP,isNaN:iP,isInf:aP,isFinite:sP,sin:uP,sinh:cP,softplus:lP,sqrt:dP,step:fP,tan:hP,tanh:pP,all:lO,any:dO,argMax:fO,argMin:hO,logSumExp:pO,max:ni,mean:mO,min:gO,moments:vO,sum:t1,prod:yO,equal:zD,equalStrict:LP,greater:BP,greaterEqual:$D,greaterEqualStrict:jP,greaterStrict:VP,less:UP,lessEqual:WP,lessEqualStrict:HP,lessStrict:zP,notEqual:$P,notEqualStrict:GP,add:ae,addN:EP,addStrict:IP,atan2:_P,div:Sn,divNoNan:SP,divStrict:TP,floorDiv:WD,maximum:hg,maximumStrict:MP,minimum:HD,minimumStrict:RP,mod:AP,modStrict:NP,mul:tt,mulStrict:kP,pow:Ql,powStrict:FP,squaredDifferenceStrict:PP,sub:$e,subStrict:OP,elu:n1,leakyRelu:bO,prelu:r1,relu:je,relu6:o1,selu:xO,logicalAnd:cd,logicalNot:CP,logicalOr:VD,logicalXor:DP,where:Jo,whereAsync:UD,buffer:de,print:BN,batchToSpaceND:WC,broadcastTo:jN,cast:VN,clone:UN,cumsum:WN,depthToSpace:HN,expandDims:Bt,eye:HC,multinomial:zN,oneHot:km,pad:Fr,pad1d:$N,pad2d:GN,pad3d:qN,pad4d:KN,rand:XN,randomNormal:YN,randomGamma:QN,randomUniform:zC,reshape:Gt,spaceToBatchND:$C,squeeze:GC,stack:Ot,tile:Xo,truncatedNormal:ZN,unstack:Ue,setdiff1dAsync:JN,fill:mn,linspace:IN,ones:ga,range:$l,scalar:K,tensor:It,tensor1d:qe,tensor2d:dr,tensor3d:nd,tensor4d:xt,tensor5d:CN,tensor6d:DN,variable:EN,zeros:Ke,onesLike:UC,zerosLike:ke,transpose:Tn,softmax:qt,logSoftmax:tk,localResponseNormalization:wO,norm:i1,gather:pg,unsortedSegmentSum:GD,basicLSTMCell:CO,multiRNNCell:DO,movingAverage:EO,stridedSlice:IO,topk:_O,scatterND:SO,fft:vg,ifft:Zl,rfft:yg,irfft:a1,sparseToDense:MO,gatherND:RO,diag:AO,dropout:NO,hannWindow:bg,hammingWindow:u1,frame:xg,stft:c1,inTopKAsync:FO});function W(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(e){e!=null&&E(e.dtype!=="complex64",function(){return n+" does not support complex64 tensors."})})}function dm(t,n,e,r){if(e==="linear")return t.linear(n);if(e==="relu")return t.relu(n);if(e==="elu")return t.elu(n);if(e==="relu6")return t.relu6(n);if(e==="prelu")return t.prelu(n,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var aL=function(t){function n(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new eD(e,R),e}return $n(n,t),n.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&Hl(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:e,dtype:o}),i},n.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var r=this.data.get(e),o=r.dtype,i=r.complexTensors;return o==="complex64"?Om(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(function(i){return qs(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return de(e.shape,e.dtype,o)},n.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return R.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return J(this,void 0,void 0,function(){var r;return ee(this,function(o){return r=Wn(),e(),[2,{kernelMs:Wn()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(W(e,"slice"),eg(e.shape,r,o)){var i=tg(r,e.strides),a=te(o);return It(this.readSync(e.dataId).subarray(i,i+a),o,e.dtype)}for(var s=de(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,f){return d+r[f]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,r,o,i){W(e,"stridedSlice");var a=od(r,o,i);if(a.some(function(h){return h===0}))return It([],a);for(var s=de(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=de([e.size,e.size],e.dtype),i=o.values,a=0;a<r.length;a++)i[a*e.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.reverse=function(e,r){W(e,"reverse");for(var o=de(e.shape,e.dtype),i=this.bufferSync(e),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(e,r){var o=this;if(e[0].dtype==="complex64"){var i=e.map(function(h){return _n(h)}),a=e.map(function(h){return lr(h)});return kt(this.concat(i,r),this.concat(a,r))}var s=e.map(function(h){var p=te(h.shape.slice(r));return h.as2D(-1,p)}),u=Qo(s.map(function(h){return h.shape}),1),c=de(u,e[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),m=0,g=0;g<h.shape[0];++g)for(var v=g*u[1]+d,b=0;b<h.shape[1];++b)c[v+b]=p[m++];d+=h.shape[1]})}var f=Qo(e.map(function(h){return h.shape}),r);return It(c,f,e[0].dtype)},n.prototype.neg=function(e){return W(e,"neg"),this.multiply(K(-1),e)},n.prototype.add=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(e,r,Et(e.dtype,r.dtype),function(o,i){return o+i})},n.prototype.addN=function(e){var r=this;W(e,"addN");for(var o=e.map(function(l){return r.readSync(l.dataId)}),i=de(e[0].shape,e[0].dtype),a=i.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(e,r){var o=pt([r],e.shape),i=this.max(e,o),a=zt(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(e,r,Et(e.dtype,r.dtype),function(o,i){return o-i})},n.prototype.pow=function(e,r){return W([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},n.prototype.batchMatMul=function(e,r,o,i){W([e,r],"matMul");for(var a=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],m=f[2],g=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=g[0],b=g[1],x=g[2],y=s*u,w=de([c,s,u],e.dtype),C=w.values,T=this.blockSize,S=0;S<c;S++)for(var I=0;I<s;I+=T)for(var _=0;_<u;_+=T)for(var N=0;N<a;N+=T)for(var A=Math.min(I+T,s),B=Math.min(_+T,u),O=Math.min(N+T,a),L=I;L<A;L++)for(var U=_;U<B;U++){for(var V=0,j=N;j<O;j++)V+=l[S*h+L*p+j*m]*d[j*v+U*b+S*x];C[S*y+(L*u+U)]+=V}return w.toTensor()},n.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(r,o,i,a);return s&&(l=this.add(l,s)),u&&(l=dm(this,l,u,c)),l},n.prototype.multiply=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(e,r,Et(e.dtype,r.dtype),function(o,i){return o*i})},n.prototype.realDivide=function(e,r){return W([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},n.prototype.floorDiv=function(e,r){return W([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},n.prototype.sum=function(e,r){W(e,"sum"),Zt("sum",r,e.rank);for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,Et(e.dtype,"int32")),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return s},n.prototype.prod=function(e,r){W(e,"sum");for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,Et(e.dtype,"int32")),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return s},n.prototype.unsortedSegmentSum=function(e,r,o){W(e,"unsortedSegmentSum");for(var i=[],a=e.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=K(s,"int32"),c=zD(u,r).asType("float32").mul(e).sum(0);i.push(c)}return Ot(i)},n.prototype.argMin=function(e,r){W(e,"argMin");var o=[r];Zt("argMin",o,e.rank);for(var i=Ft(e.shape,o),a=i[0],s=i[1],u=Ke(a,"int32"),c=te(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],m=0,g=0;g<c;++g){var v=d[h+g];v<p&&(p=v,m=g)}l[f]=m}return u},n.prototype.argMax=function(e,r){W(e,"argMax");var o=[r];Zt("argMax",o,e.rank);for(var i=Ft(e.shape,o),a=i[0],s=i[1],u=Ke(a,"int32"),c=te(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],m=0,g=0;g<c;++g){var v=d[h+g];v>p&&(p=v,m=g)}l[f]=m}return u},n.prototype.cumsum=function(e,r,o,i){if(W(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var a=Et(e.dtype,"int32"),s=Ke(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(g,v){return g+l-v-1}:function(g,v){return g+v},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(h===0)u[p]=o?0:c[p];else{var m=d(f,h-1);u[p]=o?c[m]+u[m]:c[p]+u[m]}}return s},n.prototype.equal=function(e,r){return W([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},n.prototype.notEqual=function(e,r){return W([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},n.prototype.less=function(e,r){return W([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},n.prototype.lessEqual=function(e,r){return W([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},n.prototype.greater=function(e,r){return W([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},n.prototype.greaterEqual=function(e,r){return W([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},n.prototype.logicalNot=function(e){W(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},n.prototype.logicalAnd=function(e,r){return W([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},n.prototype.logicalOr=function(e,r){return W([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},n.prototype.select=function(e,r,o){W([e,r,o],"select");for(var i=this.readSync(e.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Ke(r.shape,Et(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,d=e.rank===0||e.rank>1||r.rank===1?1:te(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)i[f]===1?c[l++]=a[f]:c[l++]=s[f];return u},n.prototype.where=function(e){W([e],"where");var r=this.readSync(e.dataId);return sg(e.shape,r)},n.prototype.topk=function(e,r,o){return W(e,"topk"),iD(this.readSync(e.dataId),e.shape,e.dtype,r)},n.prototype.min=function(e,r){W(e,"min"),Zt("min",r,e.rank);for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,e.dtype),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];m<h&&(h=m)}c[d]=h}return s},n.prototype.minimum=function(e,r){return W([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},n.prototype.mod=function(e,r){return W([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},n.prototype.max=function(e,r){W(e,"max"),Zt("max",r,e.rank);for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,e.dtype),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];m>h&&(h=m)}c[d]=h}return s},n.prototype.maximum=function(e,r){return W([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},n.prototype.all=function(e,r){W(e,"all"),Zt("all",r,e.rank);for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,e.dtype),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];h=h&&m}c[d]=h}return s},n.prototype.any=function(e,r){W(e,"any"),Zt("any",r,e.rank);for(var o=Ft(e.shape,r),i=o[0],a=o[1],s=Ke(i,e.dtype),u=te(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var m=l[f+p];h=h||m}c[d]=h}return s},n.prototype.squaredDifference=function(e,r){return W([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o-i;return a*a})},n.prototype.ceil=function(e){W(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.floor=function(e){W(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sign=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,e.shape,"float32")},n.prototype.isNaN=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isInf=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isFinite=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.round=function(e){W(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,e.shape,"float32")},n.prototype.exp=function(e){W(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.expm1=function(e){W(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log=function(e){W(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,e.shape,"float32")},n.prototype.log1p=function(e){W(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,e.shape,"float32")},n.prototype.sqrt=function(e){W(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,e.shape,"float32")},n.prototype.rsqrt=function(e){W(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,e.shape,"float32")},n.prototype.reciprocal=function(e){W(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){W(e,"relu");for(var r=Ke(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(e){W(e,"relu");for(var r=Ke(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(e,r){return W([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},n.prototype.elu=function(e){W(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,e.shape,"float32")},n.prototype.eluDer=function(e,r){W([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(e){W(e,"selu");for(var r=cg,o=lg,i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},n.prototype.clip=function(e,r,o){W(e,"clip");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,e.shape,"float32")},n.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,e.shape,"float32")},n.prototype.int=function(e){W(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},n.prototype.sigmoid=function(e){W(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},n.prototype.softplus=function(e){W(e,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]),l=void 0;l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,e.shape,"float32")},n.prototype.sin=function(e){W(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cos=function(e){W(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tan=function(e){W(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asin=function(e){W(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acos=function(e){W(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan=function(e){W(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan2=function(e,r){return W([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},n.prototype.sinh=function(e){W(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cosh=function(e){W(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tanh=function(e){W(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Jw(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asinh=function(e){W(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acosh=function(e){W(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atanh=function(e){W(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.erf=function(e){W(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},n.prototype.step=function(e,r){r===void 0&&(r=0),W(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(r,o,i);return a&&(c=this.add(c,a)),s&&(c=dm(this,c,s,u)),c},n.prototype.conv2d=function(e,r,o){W([e,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.dataFormat==="channelsLast",f=de(o.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],m=d?e.strides[2]:1,g=d?1:e.strides[1],v=f.strides[0],b=d?f.strides[1]:f.strides[2],x=d?f.strides[2]:1,y=d?1:f.strides[1],w=this.readSync(e.dataId),C=this.readSync(r.dataId),T=f.values,S=0;S<o.batchSize;++S)for(var I=S*h,_=S*v,N=0;N<o.outHeight;++N)for(var A=_+N*b,B=N*o.strideHeight-l,O=0;O<i;O++){var L=B+O*s;if(!(L<0||L>=o.inHeight))for(var U=O*r.strides[0],V=I+L*p,j=0;j<o.outWidth;++j)for(var z=A+j*x,$=j*o.strideWidth-c,Q=0;Q<a;Q++){var ne=$+Q*u;if(!(ne<0||ne>=o.inWidth))for(var ie=V+ne*m,ye=U+Q*r.strides[1],be=0;be<o.inChannels;++be){for(var De=w[ie+be*g],Te=0;Te<o.outChannels;++Te)T[z+Te*y]+=De*C[ye+Te];ye+=o.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=de(o.outShape,e.dtype),m=this.readSync(e.dataId),g=this.readSync(r.dataId),v=p.values,b=0;b<o.batchSize;++b)for(var x=b*e.strides[0],y=b*p.strides[0],w=0;w<o.outDepth;++w)for(var C=y+w*p.strides[1],T=w*o.strideDepth-d,S=0;S<i;S++){var I=T+S*u;if(!(I<0||I>=o.inDepth))for(var _=S*r.strides[0],N=x+I*e.strides[1],A=0;A<o.outHeight;++A)for(var B=C+A*p.strides[2],O=A*o.strideHeight-h,L=0;L<a;L++){var U=O+L*c;if(!(U<0||U>=o.inHeight))for(var V=_+L*r.strides[1],j=N+U*e.strides[2],z=0;z<o.outWidth;++z)for(var $=B+z*o.outChannels,Q=z*o.strideWidth-f,ne=0;ne<s;ne++){var ie=Q+ne*l;if(!(ie<0||ie>=o.inWidth))for(var ye=V+ne*r.strides[2],be=j+ie*o.inChannels,De=ye,Te=0;Te<o.inChannels;++Te){for(var Ie=m[be+Te],Me=0;Me<o.outChannels;++Me)v[$+Me]+=Ie*g[De+Me];De+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(e,r,o){W([e,r],"conv2dDerInput");for(var i=de(o.inShape,"float32"),a=i.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=o.batchSize,p=o.filterHeight,m=o.filterWidth,g=o.inChannels,v=o.inHeight,b=o.inWidth,x=o.outChannels,y=o.outHeight,w=o.outWidth,C=o.strideHeight,T=o.strideWidth,S=o.dataFormat,I=p-1-o.padInfo.top,_=m-1-o.padInfo.left,N=S==="channelsLast",A=i.strides[0],B=N?i.strides[1]:i.strides[2],O=N?i.strides[2]:1,L=N?1:i.strides[1],U=e.strides[0],V=N?e.strides[1]:e.strides[2],j=N?e.strides[2]:1,z=N?1:e.strides[1],$=0;$<h;++$)for(var Q=0;Q<g;++Q)for(var ne=0;ne<v;++ne)for(var ie=ne-I,ye=Math.max(0,Math.ceil(ie/C)),be=Math.min(y,(p+ie)/C),De=0;De<b;++De){for(var Te=De-_,Ie=Math.max(0,Math.ceil(Te/T)),Me=Math.min(w,(m+Te)/T),at=0,_e=ye;_e<be;++_e)for(var He=_e*C-ie,Pe=Ie;Pe<Me;++Pe)for(var ot=U*$+V*_e+j*Pe,Je=l*(p-1-He)+d*(m-1-(Pe*T-Te))+f*Q,et=0;et<x;++et)at+=s[ot+z*et]*u[Je+et];a[A*$+B*ne+O*De+L*Q]=at}return i.toTensor()},n.prototype.conv3dDerInput=function(e,r,o){for(var i=de(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],m=h[1],g=h[2],v=h[3],b=this.readSync(r.dataId),x=r.strides,y=x[0],w=x[1],C=x[2],T=x[3],S=o.batchSize,I=o.filterDepth,_=o.filterHeight,N=o.filterWidth,A=o.inChannels,B=o.inDepth,O=o.inHeight,L=o.inWidth,U=o.outChannels,V=o.outDepth,j=o.outHeight,z=o.outWidth,$=o.strideDepth,Q=o.strideHeight,ne=o.strideWidth,ie=I-1-o.padInfo.front,ye=_-1-o.padInfo.top,be=N-1-o.padInfo.left,De=0;De<S;++De)for(var Te=0;Te<A;++Te)for(var Ie=0;Ie<B;++Ie)for(var Me=Ie-ie,at=Math.max(0,Math.ceil(Me/$)),_e=Math.min(V,(I+Me)/$),He=0;He<O;++He)for(var Pe=He-ye,ot=Math.max(0,Math.ceil(Pe/Q)),Je=Math.min(j,(_+Pe)/Q),et=0;et<L;++et){for(var Qn=et-be,Zn=Math.max(0,Math.ceil(Qn/ne)),nn=Math.min(z,(N+Qn)/ne),hi=0,vr=at;vr<_e;++vr)for(var $r=vr*$-Me,yr=ot;yr<Je;++yr)for(var pi=yr*Q-Pe,br=Zn;br<nn;++br)for(var Bd=p*De+m*vr+g*yr+v*br,mi=y*(I-1-$r)+w*(_-1-pi)+C*(N-1-(br*ne-Qn))+T*Te,Jn=0;Jn<U;++Jn)hi+=f[Bd+Jn]*b[mi+Jn];a[u*De+c*Ie+l*He+d*et+Te]=hi}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,r,o){W([e,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dataFormat==="channelsLast",l=de(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((f-m)/i)),v=Math.min(o.outHeight,(o.inHeight+f-m)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((d-b)/a)),y=Math.min(o.outWidth,(o.inWidth+d-b)/a),w=0;w<o.inChannels;++w)for(var C=0;C<o.outChannels;++C){for(var T=0,S=0;S<o.batchSize;++S)for(var I=g;I<v;++I)for(var _=m+I*i-f,N=x;N<y;++N){var A=b+N*a-d;T+=c?h.get(S,_,A,w)*p.get(S,I,N,C):h.get(S,w,_,A)*p.get(S,C,I,N)}l.set(T,m,b,w,C)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=de(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],m=h[1],g=h[2],v=h[3],b=this.readSync(r.dataId),x=r.strides,y=x[0],w=x[1],C=x[2],T=x[3],S=this.readSync(e.dataId),I=e.strides,_=I[0],N=I[1],A=I[2],B=I[3],O=o.padInfo.front,L=o.padInfo.left,U=o.padInfo.top,V=0;V<u;++V)for(var j=Math.max(0,Math.ceil((O-V)/i)),z=Math.min(o.outDepth,(o.inDepth+O-V)/i),$=V*p,Q=0;Q<c;++Q)for(var ne=Math.max(0,Math.ceil((U-Q)/a)),ie=Math.min(o.outHeight,(o.inHeight+U-Q)/a),ye=Q*m+$,be=0;be<l;++be)for(var De=Math.max(0,Math.ceil((L-be)/s)),Te=Math.min(o.outWidth,(o.inWidth+L-be)/s),Ie=be*g+ye,Me=0;Me<o.inChannels;++Me)for(var at=Me*v+Ie,_e=0;_e<o.outChannels;++_e){for(var He=0,Pe=0;Pe<o.batchSize;++Pe)for(var ot=Pe*_,Je=Pe*y,et=j;et<z;++et)for(var Qn=(V+et*i-O)*N+ot,Zn=et*w+Je,nn=ne;nn<ie;++nn)for(var hi=(Q+nn*a-U)*A+Qn,vr=nn*C+Zn,$r=De;$r<Te;++$r){var yr=$r*T+vr;He+=S[(be+$r*s-L)*B+hi+Me]*b[yr+_e]}f[at+_e]=He}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(r,o,i);return a&&(c=this.add(c,a)),s&&(c=dm(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,r,o){W([e,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.outChannels/o.inChannels,f=de(o.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),m=f.values,g=0;g<o.batchSize;++g)for(var v=g*e.strides[0],b=g*f.strides[0],x=0;x<o.outHeight;++x)for(var y=b+x*f.strides[1],w=x*o.strideHeight-c,C=0;C<i;++C){var T=w+C*s;if(!(T<0||T>=o.inHeight))for(var S=C*r.strides[0],I=v+T*e.strides[1],_=0;_<o.outWidth;++_)for(var N=y+_*f.strides[2],A=_*o.strideWidth-l,B=0;B<a;++B){var O=A+B*u;if(!(O<0||O>=o.inWidth))for(var L=S+B*r.strides[1],U=I+O*o.inChannels,V=N,j=L,z=0;z<o.inChannels;++z){for(var $=h[U+z],Q=0;Q<d;++Q)m[V+Q]+=$*p[j+Q];V+=d,j+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,r,o){W([e,r],"depthwiseConv2DDerInput");for(var i=de(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],m=f[2],g=this.readSync(r.dataId),v=r.strides,b=v[0],x=v[1],y=v[2],w=o.batchSize,C=o.filterHeight,T=o.filterWidth,S=o.inChannels,I=o.inHeight,_=o.inWidth,N=o.outChannels,A=o.outHeight,B=o.outWidth,O=o.strideHeight,L=o.strideWidth,U=C-1-o.padInfo.top,V=T-1-o.padInfo.left,j=N/S,z=0;z<w;++z)for(var $=0;$<S;++$)for(var Q=0;Q<I;++Q)for(var ne=Q-U,ie=Math.max(0,Math.ceil(ne/O)),ye=Math.min(A,(C+ne)/O),be=0;be<_;++be){for(var De=be-V,Te=Math.max(0,Math.ceil(De/L)),Ie=Math.min(B,(T+De)/L),Me=0,at=ie;at<ye;++at)for(var _e=at*O-ne,He=Te;He<Ie;++He)for(var Pe=h*z+p*at+m*He,ot=b*(C-1-_e)+x*(T-1-(He*L-De))+y*$,Je=0;Je<j;++Je)Me+=d[Pe+($*j+Je)]*g[ot+Je];a[u*z+c*Q+l*be+$]=Me}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){W([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=de(o.filterShape,"float32"),l=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/i)),v=Math.min(o.outHeight,(o.inHeight+d-m)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((l-b)/a)),y=Math.min(o.outWidth,(o.inWidth+l-b)/a),w=0;w<o.outChannels;++w){for(var C=Math.trunc(w/f),T=w%f,S=0,I=0;I<o.batchSize;++I)for(var _=g;_<v;++_)for(var N=m+_*i-d,A=x;A<y;++A){var B=b+A*a-l;S+=h.get(I,N,B,C)*p.get(I,_,A,w)}c.set(S,m,b,C,T)}return c.toTensor()},n.prototype.tile=function(e,r){return W(e,"tile"),oD(this.bufferSync(e),r)},n.prototype.pad=function(e,r,o){W(e,"pad");var i=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=de(i,e.dtype);o!==0&&u.values.fill(o);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,r){W(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var a=this.readSync(e.dataId),s=de(o,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=s.locToIndex(l);s.values[f]=a[i]}return s.toTensor()},n.prototype.gather=function(e,r,o){W([e,r],"gather");var i=e.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=de(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[o]=a[l[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,r,o){W([e],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=Gl(e.shape,r,i),s=ql(a.length,r.length),u=Kl(e.shape,r,i),c=qC(o,r.length),l=KC(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){W([e],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=Gl(u.shape,r,i,!1),l=ql(c.length,r.length,!1),d=Kl(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,r,o){W(e,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),m=de(r.outShape,e.dtype),g=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],x=r.outShape[3],y=0;y<r.batchSize;++y)for(var w=y*v,C=y*e.strides[0],T=0;T<r.inChannels;++T)for(var S=0;S<r.outHeight;++S)for(var I=S*i-d,_=Math.max(0,I),N=Math.min(r.inHeight,c+I),A=w+S*b,B=0;B<r.outWidth;++B){for(var O=B*a-f,L=Math.max(0,O),U=Math.min(r.inWidth,l+O),V=h,j=0,z=0,$=_;$<N;$+=s){for(var Q=C+$*e.strides[1],ne=L;ne<U;ne+=u){var ie=p[Q+ne*e.strides[2]+T];o==="max"&&ie>V?V=ie:o==="avg"&&(j+=ie,z++)}if(isNaN(V))break}g[A+B*x+T]=o==="avg"?j/z:V}return m.toTensor()},n.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},n.prototype.maxPoolPositions=function(e,r){for(var o=de(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var g=0;g<r.outHeight;++g){for(var v=g*i-d,b=v;b<0;)b+=s;for(var x=Math.min(r.inHeight,c+v),y=0;y<r.outWidth;++y){for(var w=y*a-f,C=w;C<0;)C+=u;for(var T=Math.min(r.inWidth,l+w),S=Number.NEGATIVE_INFINITY,I=-1,_=b;_<x;_+=s)for(var N=_-v,A=C;A<T;A+=u){var B=A-w,O=h.get(p,_,A,m);O>S&&(S=O,I=N*l+B)}o.set(I,p,g,y,m)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(e,r,o,i){W([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,m=de(r.shape,"float32"),g=this.bufferSync(a),v=this.bufferSync(e),b=0;b<i.batchSize;++b)for(var x=0;x<i.inChannels;++x)for(var y=0;y<i.inHeight;++y)for(var w=0;w<i.inWidth;++w){for(var C=y-p,T=w-h,S=0,I=0;I<d;I+=c){var _=(C+I)/s;if(!(_<0||_>=i.outHeight||Math.floor(_)!==_))for(var N=0;N<f;N+=l){var A=(T+N)/u;if(!(A<0||A>=i.outWidth||Math.floor(A)!==A)){var B=d*f-1-g.get(b,_,A,x)===I*f+N?1:0;B!==0&&(S+=v.get(b,_,A,x)*B)}}}m.set(S,b,y,w,x)}return m.toTensor()},n.prototype.avgPoolBackprop=function(e,r,o){W([e,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,m=de(r.shape,"float32"),g=1/(s*u),v=this.bufferSync(e),b=0;b<o.batchSize;++b)for(var x=0;x<o.inChannels;++x)for(var y=0;y<o.inHeight;++y)for(var w=0;w<o.inWidth;++w){for(var C=y-p,T=w-h,S=0,I=0;I<d;I+=c){var _=(C+I)/i;if(!(_<0||_>=o.outHeight||Math.floor(_)!==_))for(var N=0;N<f;N+=l){var A=(T+N)/a;A<0||A>=o.outWidth||Math.floor(A)!==A||(S+=v.get(b,_,A,x))}}m.set(S*g,b,y,w,x)}return m.toTensor()},n.prototype.pool3d=function(e,r,o){W(e,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),x=de(r.outShape,e.dtype),y=x.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],S=r.outShape[4],I=0;I<r.batchSize;++I)for(var _=I*w,N=I*e.strides[0],A=0;A<r.inChannels;++A)for(var B=0;B<r.outDepth;++B){for(var O=B*i-p,L=O;L<0;)L+=u;for(var U=Math.min(r.inDepth,d+O),V=_+B*C,j=0;j<r.outHeight;++j){for(var z=j*a-m,$=z;$<0;)$+=c;for(var Q=Math.min(r.inHeight,f+z),ne=V+j*T,ie=0;ie<r.outWidth;++ie){for(var ye=ie*s-g,be=ye;be<0;)be+=l;for(var De=Math.min(r.inWidth,h+ye),Te=ne+ie*S,Ie=v,Me=0,at=0,_e=L;_e<U;_e+=u){for(var He=N+_e*e.strides[1],Pe=$;Pe<Q;Pe+=c){for(var ot=He+Pe*e.strides[2],Je=be;Je<De;Je+=l){var et=b[ot+Je*e.strides[3]+A];if(o==="max"&&et>Ie?Ie=et:o==="avg"&&(Me+=et,at++),isNaN(Ie))break}if(isNaN(Ie))break}if(isNaN(Ie))break}y[Te+A]=o==="avg"?Me/at:Ie}}}return x.toTensor()},n.prototype.avgPool3d=function(e,r){return W(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,r,o){W([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,v=p-1-o.padInfo.front,b=g-1-o.padInfo.left,x=m-1-o.padInfo.top,y=de(r.shape,"float32"),w=1/(u*c*l),C=this.bufferSync(e),T=0;T<o.batchSize;++T)for(var S=0;S<o.inChannels;++S)for(var I=0;I<o.inDepth;++I)for(var _=0;_<o.inHeight;++_)for(var N=0;N<o.inWidth;++N){for(var A=I-v,B=_-x,O=N-b,L=0,U=0;U<p;U+=d){var V=(A+U)/i;if(!(V<0||V>=o.outDepth||Math.floor(V)!==V))for(var j=0;j<m;j+=f){var z=(B+j)/a;if(!(z<0||z>=o.outHeight||Math.floor(z)!==z))for(var $=0;$<g;$+=h){var Q=(O+$)/s;Q<0||Q>=o.outWidth||Math.floor(Q)!==Q||(L+=C.get(T,V,z,Q,S))}}}y.set(L*w,T,I,_,N,S)}return y.toTensor()},n.prototype.maxPool3d=function(e,r){return W(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,r){for(var o=de(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.outDepth;++y){for(var w=y*i-p,C=w;C<0;)C+=u;for(var T=Math.min(r.inDepth,d+w),S=0;S<r.outHeight;++S){for(var I=S*a-m,_=I;_<0;)_+=c;for(var N=Math.min(r.inHeight,f+I),A=0;A<r.outWidth;++A){for(var B=A*s-g,O=B;O<0;)O+=l;for(var L=Math.min(r.inWidth,h+B),U=Number.NEGATIVE_INFINITY,V=-1,j=C;j<T;j+=u)for(var z=j-w,$=_;$<N;$+=c)for(var Q=$-I,ne=O;ne<L;ne+=l){var ie=ne-B,ye=v.get(b,j,$,ne,x);ye>=U&&(U=ye,V=z*f*h+Q*f+ie)}o.set(V,b,y,S,A,x)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(e,r,o,i){W([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,m=i.effectiveFilterWidth,g=h-1-i.padInfo.front,v=m-1-i.padInfo.left,b=p-1-i.padInfo.top,x=de(r.shape,"float32"),y=this.bufferSync(a),w=this.bufferSync(e),C=0;C<i.batchSize;++C)for(var T=0;T<i.inChannels;++T)for(var S=0;S<i.inDepth;++S)for(var I=0;I<i.inHeight;++I)for(var _=0;_<i.inWidth;++_){for(var N=S-g,A=I-b,B=_-v,O=0,L=0;L<h;L+=l){var U=(N+L)/s;if(!(U<0||U>=i.outDepth||Math.floor(U)!==U))for(var V=0;V<p;V+=d){var j=(A+V)/u;if(!(j<0||j>=i.outHeight||Math.floor(j)!==j))for(var z=0;z<m;z+=f){var $=(B+z)/c;if(!($<0||$>=i.outWidth||Math.floor($)!==$)){var Q=h*p*m-1-y.get(C,U,j,$,T)===L*p*m+V*m+z?1:0;Q!==0&&(O+=w.get(C,U,j,$,T)*Q)}}}}x.set(O,C,S,I,_,T)}return x.toTensor()},n.prototype.cast=function(e,r){return rg(e,r,this)},n.prototype.reshape=function(e,r){return Yl(e,r)},n.prototype.avgPool=function(e,r){return W(e,"avgPool"),this.pool(e,r,"avg").toFloat()},n.prototype.resizeBilinear=function(e,r,o,i){W(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(te([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=0,g=h[0]/p[0],v=h[1]/p[1],b=0;b<s;b++)for(var x=0;x<r;x++)for(var y=g*x,w=Math.floor(y),C=y-w,T=Math.min(u-1,Math.ceil(y)),S=b*e.strides[0]+w*e.strides[1],I=b*e.strides[0]+T*e.strides[1],_=0;_<o;_++)for(var N=v*_,A=Math.floor(N),B=N-A,O=Math.min(c-1,Math.ceil(N)),L=S+A*e.strides[2],U=I+A*e.strides[2],V=S+O*e.strides[2],j=I+O*e.strides[2],z=0;z<l;z++){var $=d[L+z],Q=d[U+z],ne=$+(d[V+z]-$)*B,ie=ne+(Q+(d[j+z]-Q)*B-ne)*C;f[m++]=ie}return It(f,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(e,r,o){W([e,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],m=[o&&d>1?d-1:d,o&&f>1?f-1:f],g=p[0]/m[0],v=p[1]/m[1],b=this.readSync(e.dataId),x=0,y=0;y<a;y++)for(var w=y*r.strides[0],C=0;C<d;C++)for(var T=C*g,S=Math.floor(T),I=Math.min(Math.ceil(T),s-1),_=w+S*r.strides[1],N=w+I*r.strides[1],A=T-S,B=1-A,O=0;O<f;O++)for(var L=O*v,U=Math.floor(L),V=Math.min(Math.ceil(L),u-1),j=L-U,z=1-j,$=_+U*r.strides[2],Q=_+V*r.strides[2],ne=N+U*r.strides[2],ie=N+V*r.strides[2],ye=B*z,be=B*j,De=A*z,Te=A*j,Ie=0;Ie<c;Ie++){var Me=b[x++];h[$+Ie]+=Me*ye,h[Q+Ie]+=Me*be,h[ne+Ie]+=Me*De,h[ie+Ie]+=Me*Te}return xt(h,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(e,r,o,i){W(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],m=h[0]/p[0],g=h[1]/p[1],v=0,b=0;b<s;b++)for(var x=b*e.strides[0],y=0;y<r;y++)for(var w=m*y,C=x+Math.min(u-1,i?Math.round(w):Math.floor(w))*e.strides[1],T=0;T<o;T++)for(var S=g*T,I=C+Math.min(c-1,i?Math.round(S):Math.floor(S))*e.strides[2],_=0;_<l;_++){var N=d[I+_];f[v++]=N}return It(f,[s,r,o,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){W([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(e.dataId),m=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=m[0]/g[0],b=m[1]/g[1],x=1/v,y=1/b,w=2*Math.ceil(x)+2,C=2*Math.ceil(y)+2,T=0;T<a;T++)for(var S=T*r.strides[0],I=0;I<s;I++)for(var _=S+I*r.strides[1],N=Math.floor(I*x),A=Math.floor(N-w/2),B=0;B<u;B++)for(var O=_+B*r.strides[2],L=Math.floor(B*y),U=Math.floor(L-C/2),V=0;V<c;V++){for(var j=0,z=0;z<w;z++){var $=z+A;if(!($<0||$>=d)){var Q=S+$*e.strides[1],ne=$*v;if(I===Math.min(s-1,o?Math.round(ne):Math.floor(ne)))for(var ie=0;ie<C;ie++){var ye=ie+U;if(!(ye<0||ye>=f)){var be=Q+ye*e.strides[2],De=ye*b;B===Math.min(u-1,o?Math.round(De):Math.floor(De))&&(j+=p[be+V])}}}}h[O+V]=j}return xt(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){W([e,r,o,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,m=d.length,g=l.length,v=c.length,b=0,x=0,y=0,w=0,C=0;C<u.length;++C)h[C]=f[b++]+(u[C]-c[x++])*d[y++]/Math.sqrt(l[w++]+i),b>=p&&(b=0),x>=v&&(x=0),y>=m&&(y=0),w>=g&&(w=0);return xt(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){W(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(g){for(var v=g%s,b=g-v+Math.max(0,v-r),x=g-v+Math.min(v+r,u),y=0;b<=x;b++){var w=c[b];y+=w*w}return y}for(var h=0;h<l;h++){var p=f(h),m=c[h]*Math.pow(o+i*p,-a);d[h]=m}return xt(d,e.shape)},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){W(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(e.size),p=e.size,m=0;m<p;m++){for(var g=m%c,v=m-g+Math.max(0,g-i),b=m-g+Math.min(c,g+i+1),x=0,y=v;y<b;y++)x+=Math.pow(d[y],2);for(x=s*x+a,y=v;y<b;y++){var w=-2*s*u*d[y]*f[m]/x;m===y&&(w+=Math.pow(x,-u)),w*=l[m],h[y]+=w}}return xt(h,e.shape)},n.prototype.multinomial=function(e,r,o,i){W(e,"multinomial");for(var a=r?e:qt(e),s=a.shape[0],u=a.shape[1],c=Ke([s,o],"int32"),l=this.readSync(c.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var m=1;m<p.length;++m)p[m]=p[m-1]+d[h+m];for(var g=rd(i.toString()),v=f*o,b=0;b<o;++b){var x=g();l[v+b]=p.length;for(var y=0;y<p.length;y++)if(x<p[y]){l[v+b]=y;break}}}return c},n.prototype.oneHot=function(e,r,o,i){W(e,"oneHot");var a=new Float32Array(e.size*r);a.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return dr(a,[e.size,r],"int32")},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return W(e,"nonMaxSuppression"),ig(this.readSync(e.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],a=de(e.shape,"float32"),s=de(e.shape,"float32"),u=_n(e).as2D(o,i),c=lr(e).as2D(o,i),l=0;l<o;l++)for(var d=u.slice([l,0],[1,i]),f=c.slice([l,0],[1,i]),h=kt(d,f),p=this.readSync(this.fftImpl(h,r).dataId),m=0;m<i;m++){var g=gw(p,m);a.values[l*i+m]=g.real,s.values[l*i+m]=g.imag}return kt(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(a=kt(_n(a).div(K(i)),lr(a).div(K(i)))),a}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,r));return kt(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return(e&e-1)==0},n.prototype.fftRadix2=function(e,r,o){if(r===1)return e;var i=this.readSync(e.dataId),a=r/2,s=function(v){for(var b=Math.ceil(v.length/4),x=new Float32Array(b),y=new Float32Array(b),w=0;w<v.length;w+=4)x[Math.floor(w/4)]=v[w],y[Math.floor(w/4)]=v[w+1];return{real:x,imag:y}}(i),u=kt(s.real,s.imag).as1D(),c=function(v){for(var b=Math.floor(v.length/4),x=new Float32Array(b),y=new Float32Array(b),w=2;w<v.length;w+=4)x[Math.floor(w/4)]=v[w],y[Math.floor(w/4)]=v[w+1];return{real:x,imag:y}}(i),l=kt(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var d=function(v,b){for(var x=new Float32Array(v/2),y=new Float32Array(v/2),w=0;w<Math.ceil(v/2);w++){var C=(b?2:-2)*Math.PI*(w/v);x[w]=Math.cos(C),y[w]=Math.sin(C)}return{real:x,imag:y}}(r,o),f=kt(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),m=_n(h).concat(_n(p)),g=lr(h).concat(lr(p));return kt(m,g).as1D()},n.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=rk(a*c,r,o),d=gw(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}o&&(s/=r,u/=r),nk(i,s,u,a)}return i},n.prototype.depthToSpace=function(e,r,o){E(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),E(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*r,l=s*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),p=0,m=0;m<i;++m)for(var g=0;g<c;++g)for(var v=Math.floor(g/r),b=g%r,x=0;x<l;++x)for(var y=Math.floor(x/r),w=(b*r+x%r)*d,C=0;C<d;++C){var T=C+w+u*(y+s*(v+a*m));h[p++]=f[T]}return xt(h,[i,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,r,o,i){var a=Ce(e.shape,r.shape),s=de(a,o),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Ar(e.shape,a),d=Ar(r.shape,a),f=s.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),m=this.bufferSync(r),g=function(v){var b=s.indexToLoc(v),x=b.slice(-e.rank);l.forEach(function(T){return x[T]=0});var y=p.locToIndex(x),w=b.slice(-r.rank);d.forEach(function(T){return w[T]=0});var C=m.locToIndex(w);f[v]=i(u[y],c[C])};for(h=0;h<f.length;++h)g(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=Ce(e.shape,r.shape),a=de(i,"float32"),s=de(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Ar(e.shape,i),d=Ar(r.shape,i),f=a.values,h=s.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var m=p%u.length,g=p%c.length,v=o(u[2*m],u[2*m+1],c[2*g],c[2*g+1]);f[p]=v.real,h[p]=v.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),y=function(w){var C=a.indexToLoc(w),T=C.slice(-e.rank);l.forEach(function(A){return T[A]=0});var S=b.locToIndex(T),I=C.slice(-r.rank);d.forEach(function(A){return I[A]=0});var _=x.locToIndex(I),N=o(u[2*S],u[2*S+1],c[2*_],c[2*_+1]);f[w]=N.real,h[w]=N.imag};for(p=0;p<f.length;p++)y(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(e,r,o){return rD(e,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,r,o,i,a,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],m=i[1],g=de([h,p,m,f],"float32"),v=this.readSync(r.dataId),b=this.readSync(o.dataId),x=this.readSync(e.dataId),y=e.strides,w=g.strides,C=0;C<h;C++){var T=4*C,S=v[T],I=v[T+1],_=v[T+2],N=v[T+3],A=b[C];if(!(A>=c))for(var B=p>1?(_-S)*(l-1)/(p-1):0,O=m>1?(N-I)*(d-1)/(m-1):0,L=0;L<p;L++){var U=p>1?S*(l-1)+L*B:.5*(S+_)*(l-1);if(U<0||U>l-1)for(var V=0;V<m;V++)for(var j=0;j<f;j++){var z=j+V*w[2]+L*w[1]+C*w[0];g.values[z]=s}else if(a==="bilinear"){var $=Math.floor(U),Q=Math.ceil(U),ne=U-$;for(V=0;V<m;V++)if((_e=m>1?I*(d-1)+V*O:.5*(I+N)*(d-1))<0||_e>d-1)for(j=0;j<f;j++)z=j+V*w[2]+L*w[1]+C*w[0],g.values[z]=s;else{var ie=Math.floor(_e),ye=Math.ceil(_e),be=_e-ie;for(j=0;j<f;j++){var De=x[z=j+ie*y[2]+$*y[1]+A*y[0]],Te=x[z=j+ye*y[2]+$*y[1]+A*y[0]],Ie=x[z=j+ie*y[2]+Q*y[1]+A*y[0]],Me=De+(Te-De)*be,at=Ie+(x[z=j+ye*y[2]+Q*y[1]+A*y[0]]-Ie)*be;z=j+V*w[2]+L*w[1]+C*w[0],g.values[z]=Me+(at-Me)*ne}}}else for(V=0;V<m;++V){var _e;if((_e=m>1?I*(d-1)+V*O:.5*(I+N)*(d-1))<0||_e>d-1)for(j=0;j<f;j++)z=j+V*w[2]+L*w[1]+C*w[0],g.values[z]=s;else{var He=Math.round(_e),Pe=Math.round(U);for(j=0;j<f;j++){var ot=j+He*y[2]+Pe*y[1]+A*y[0],Je=j+V*w[2]+L*w[1]+C*w[0];g.values[Je]=x[ot]}}}}}return g.toTensor()},n.prototype.sparseToDense=function(e,r,o,i){var a=Zs(0,e,o),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,l=a.strides,d=a.outputSize;return this.scatter(e,r,o,d,c,u,s,l,i,!1)},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Zm(e,r),s=a[0],u=a[1],c=a[2],l=a[3];if(u===0)return It([],s,e.dtype);for(var d=new Ks([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var m=[],g=0,v=0;v<i;v++){var b=f[p*i+v];g+=b*l[v],m.push(b)}if(g<0||g>=e.size/c)throw new Error("Invalid indices: "+m+" does not index into "+e.shape);for(var x=0;x<c;x++)d.values[p*c+x]=h[g*c+x]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,r,o){var i=Zs(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=K(0);return this.scatter(e,r,o,l,u,s,a,c,d,!0)},n.prototype.fill=function(e,r,o){var i=Gs(o=o||pa(r),te(e));return i.fill(r),R.makeTensor(i,e,o,this)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var r=Gs(e.dtype,te(e.shape));return this.makeOutput(r,e.shape,e.dtype)},n.prototype.linspace=function(e,r,o){return og(e,r,o)},n.prototype.scatter=function(e,r,o,i,a,s,u,c,l,d){var f=[i/a,a],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(i===0)return It([],o,r.dtype);var m=new Ks(f,r.dtype);m.values.fill(this.readSync(l.dataId)[0]);for(var g=0;g<s;g++){for(var v=[],b=0,x=0;x<u;x++){var y=h[g*u+x];v.push(y),b+=y*c[x]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+v+" does not index into "+o);for(var w=0;w<a;w++)d?m.values[b*a+w]+=p[g*a+w]:m.values[b*a+w]=r.rank===0?p[0]:p[g*a+w]}return m.toTensor().reshape(o)},n}(tD);R.registerBackend("cpu",function(){return new aL},1);for(Tl=0,fm=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs,o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,f=e;W(i,"NonMaxSuppressionWithScore");var h=ag(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=n.x,o=e;W(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:tu,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=n,o=r.a,i=r.b,a=e;W([o,i],tu);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(f,h,p,m,g,v){var b=Ce(f,h),x=b.length,y=Hn(b),w=fa(g,te(b)),C=f.length,T=h.length,S=Hn(f),I=Hn(h),_=Ar(f,b),N=Ar(h,b);if(_.length+N.length===0)for(var A=0;A<w.length;++A)w[A]=v(p[A%p.length],m[A%m.length]);else{var B=function(O){var L=uC(O,x,y),U=L.slice(-C);_.forEach(function($){return U[$]=0});var V=Em(U,C,S),j=L.slice(-T);N.forEach(function($){return j[$]=0});var z=Em(j,T,I);w[O]=v(p[V],m[z])};for(A=0;A<w.length;++A)B(A)}return[w,b]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),l=c[0],d=c[1];return{dataId:a.write(l,d,o.dtype),shape:d,dtype:o.dtype}}}];Tl<fm.length;Tl++)Yw(fm[Tl]);var Tl,fm,na,sL=function(t){this.variableNames=["A"];var n=jt(),e=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+e+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},uL=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=jt(),e=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+e+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(Ml=0,hm=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs,o=n.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],d=[l,c],f=[l,c,i];(s||a)&&(na==null&&(na=document.createElement("canvas").getContext("2d")),na.canvas.width=c,na.canvas.height=l,na.drawImage(o,0,0,c,l),o=na.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=fn.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),o);var p=P().getBool("WEBGL_PACK")?new uL(f):new sL(f),m=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs;Hl("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,f=e,h=ag(f.readSync(i.dataId),f.readSync(a.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=n.x,o=e,i=new ge(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:tu,backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=n,o=r.a,i=r.b,a=e,s=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mr("return (a - b) * (a - b);",o.shape,i.shape):new it("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Ml<hm.length;Ml++)Yw(hm[Ml]);var Ml,hm;for(Rl=0,pm=[{kernelName:"Square",gradFunc:function(t,n){var e=n[0];return{x:function(){return t.mul(e.toFloat().mul(2))}}}},{kernelName:tu,gradFunc:function(t,n){var e=n[0],r=n[1],o=K(2);return{a:function(){return tt(t,tt(o,$e(e,r)))},b:function(){return tt(t,tt(o,$e(r,e)))}}}}];Rl<pm.length;Rl++)dN(pm[Rl]);var Rl,pm,cL=function(){function t(){}return t.prototype.fetch=function(n,e){return fetch(n,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},t}();P().get("IS_BROWSER")&&P().setPlatform("browser",new cL);var mm,lL=function(){return uw()},dL=function(){function t(){this.util=cw(),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(n,e){return P().global.fetch!=null?P().global.fetch(n,e):(mm==null&&(mm=lL()),mm(n,e))},t.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},t.prototype.encode=function(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)},t}();P().get("IS_NODE")&&P().setPlatform("node",new dL);var Lm={float32:4,int32:4,uint16:2,uint8:1,bool:1},Jl=4;function l1(t,n){for(var e={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,d=te(l),f=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Lm[h.dtype],m=t.slice(r,r+d*p),g=h.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(c==="float32")f=Float32Array.from(g,function(C){return C*h.scale+h.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(g,function(C){return Math.round(C*h.scale+h.min)})}r+=d*p}else if(c==="string"){var v=te(s.shape);f=[];for(var b=0;b<v;b++){var x=new Uint32Array(t.slice(r,r+Jl))[0];r+=Jl;var y=new Uint8Array(t.slice(r,r+x));f.push(y),r+=x}}else{var w=Lm[c];if(m=t.slice(r,r+d*w),c==="float32")f=new Float32Array(m);else if(c==="int32")f=new Int32Array(m);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(m)}r+=d*w}e[u]=It(f,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return e}function fL(t){if(t===null)throw new Error("Invalid input value: "+JSON.stringify(t));var n=0,e=[];t.forEach(function(i){if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(n),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var Bm=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Bw(t){return Bm?Buffer.byteLength(t):new Blob([t]).size}function Ig(t){var n=0;t.forEach(function(o){n+=o.byteLength});var e=new Uint8Array(n),r=0;return t.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function jw(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var n=t.split("/");return n[n.length-1]}function du(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:Bw(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:Bw(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}var pn=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerSaveRouter=function(n){t.getInstance().saveRouters.push(n)},t.registerLoadRouter=function(n){t.getInstance().loadRouters.push(n)},t.getSaveHandlers=function(n){return t.getHandlers(n,"save")},t.getLoadHandlers=function(n,e){return t.getHandlers(n,"load",e)},t.getHandlers=function(n,e,r){var o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(i){var a=i(n,r);a!==null&&o.push(a)}),o},t}(),ca="://",co=function(){function t(){this.managers={}}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerManager=function(n,e){E(n!=null,function(){return"scheme must not be undefined or null."}),n.endsWith(ca)&&(n=n.slice(0,n.indexOf(ca))),E(n.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();E(r.managers[n]==null,function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=e},t.getManager=function(n){var e=this.getInstance().managers[n];if(e==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Ll(t){if(t.indexOf(ca)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+co.getSchemes().join(","));return{scheme:t.split(ca)[0],path:t.split(ca)[1]}}function Vw(t,n,e){return e===void 0&&(e=!1),J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d;return ee(this,function(f){switch(f.label){case 0:return E(t!==n,function(){return"Old path and new path are the same: '"+t+"'"}),E((r=pn.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),E(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],E((i=pn.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),E(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),a=i[0],s=Ll(t).scheme,u=Ll(t).path,c=s===Ll(t).scheme,[4,o.load()];case 1:return l=f.sent(),e&&c?[4,co.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,co.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var qo="models_store",uo="model_info_store";function d1(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function jm(t){var n=t.result;n.createObjectStore(qo,{keyPath:"modelPath"}),n.createObjectStore(uo,{keyPath:"modelPath"})}var la=function(){function t(n){if(this.indexedDB=d1(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return t.prototype.save=function(n){return J(this,void 0,void 0,function(){return ee(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},t.prototype.load=function(){return J(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(n,e){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return jm(a)},a.onsuccess=function(){var s=a.result;if(e==null){var u=s.transaction(qo,"readonly"),c=u.objectStore(qo).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(m){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=du(e),f=s.transaction(uo,"readwrite"),h=f.objectStore(uo),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var m=(l=s.transaction(qo,"readwrite")).objectStore(qo).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});m.onsuccess=function(){return o({modelArtifactsInfo:d})},m.onerror=function(g){var v=(h=f.objectStore(uo)).delete(r.modelPath);v.onsuccess=function(){return s.close(),i(m.error)},v.onerror=function(b){return s.close(),i(m.error)}}},p.onerror=function(m){return s.close(),i(p.error)},f.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},t.URL_SCHEME="indexeddb://",t}(),Uw=function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(la.URL_SCHEME)?(n=t.slice(la.URL_SCHEME.length),new la(n)):null;var n};pn.registerSaveRouter(Uw),pn.registerLoadRouter(Uw);var hL=function(){function t(){this.indexedDB=d1()}return t.prototype.listModels=function(){return J(this,void 0,void 0,function(){var n=this;return ee(this,function(e){return[2,new Promise(function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return jm(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(uo,"readonly"),u=s.objectStore(uo).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},t.prototype.removeModel=function(n){return J(this,void 0,void 0,function(){var e=this;return ee(this,function(r){var o;return n=(o=n).startsWith(la.URL_SCHEME)?o.slice(la.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return jm(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(uo,"readwrite"),d=l.objectStore(uo),f=d.get(n);f.onsuccess=function(){if(f.result==null)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),p=function(){var m=(u=c.transaction(qo,"readwrite")).objectStore(qo).delete(n);m.onsuccess=function(){return i(f.result.modelArtifactsInfo)},m.onerror=function(g){return a(f.error)}};h.onsuccess=p,h.onerror=function(m){return p(),c.close(),a(f.error)}},f.onerror=function(h){return c.close(),a(f.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},t}();if(P().getBool("IS_BROWSER"))try{co.registerManager(la.URL_SCHEME,new hL)}catch{}var Rr="/",sa="tensorflowjs_models",f1="info",pL="model_topology",mL="weight_specs",gL="weight_data",vL="model_metadata";function h1(t){return{info:[sa,t,f1].join(Rr),topology:[sa,t,pL].join(Rr),weightSpecs:[sa,t,mL].join(Rr),weightData:[sa,t,gL].join(Rr),modelMetadata:[sa,t,vL].join(Rr)}}function yL(t){var n=t.split(Rr);if(n.length<3)throw new Error("Invalid key format: "+t);return n.slice(1,n.length-1).join(Rr)}var da=function(){function t(n){if(!P().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=h1(this.modelPath)}return t.prototype.save=function(n){return J(this,void 0,void 0,function(){var e,r,o;return ee(this,function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=du(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(Bm)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return J(this,void 0,void 0,function(){var n,e,r,o,i,a,s;return ee(this,function(u){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(Bm){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),Ww=function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(da.URL_SCHEME)?(n=t.slice(da.URL_SCHEME.length),new da(n)):null;var n};pn.registerSaveRouter(Ww),pn.registerLoadRouter(Ww);var bL=function(){function t(){E(P().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),E(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return J(this,void 0,void 0,function(){var n,e,r,o,i,a;return ee(this,function(s){for(n={},e=sa+Rr,r=Rr+f1,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(a=yL(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]})})},t.prototype.removeModel=function(n){return J(this,void 0,void 0,function(){var e,r;return ee(this,function(o){var i;if(n=(i=n).startsWith(da.URL_SCHEME)?i.slice(da.URL_SCHEME.length):i,e=h1(n),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(P().getBool("IS_BROWSER"))try{co.registerManager(da.URL_SCHEME,new bL)}catch{}var xL="model",wL=".json",CL=".weights.bin";function Hw(t){return new Promise(function(n){return setTimeout(n)}).then(t)}var gm=function(){function t(n){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(t.URL_SCHEME)&&(n=n.slice(t.URL_SCHEME.length)),n!=null&&n.length!==0||(n=xL),this.modelTopologyFileName=n+wL,this.weightDataFileName=n+CL}return t.prototype.save=function(n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s;return ee(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Hw(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,Hw(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:du(n)}]}})})},t.URL_SCHEME="downloads://",t}(),DL=function(){function t(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return t.prototype.load=function(){return J(this,void 0,void 0,function(){var n,e,r=this;return ee(this,function(o){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){e.length===0&&i({modelTopology:l});var d=c.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(g){return void a(g)}var h=[],p=[],m=[];d.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),h.push.apply(h,g.weights)}),d.forEach(function(g){g.paths.forEach(function(v){var b=new FileReader;b.onload=function(x){var y=x.target.result,w=p.indexOf(v);m[w]=y,m.indexOf(null)===-1&&i({modelTopology:l,weightSpecs:h,weightData:Ig(m),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(x){return a("Failed to weights data from file of path '"+v+"'.")},b.readAsArrayBuffer(f[v])})})}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(n,e){for(var r=[],o=e.map(function(u){return jw(u.name)}),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach(function(u){var c=jw(u);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),o.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[o.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},t}();function zw(t,n,e,r){(function(i){E(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(t),function(i,a){E(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),E(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),E(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(e=e??0,r=r??1);var o=0;return Promise.all(t.map(function(i){return i.then(function(a){var s=e+ ++o/t.length*(r-e);return n(s),a}),i}))}function p1(t,n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l;return ee(this,function(d){switch(d.label){case 0:return n==null&&(n={}),e=n.fetchFunc==null?P().platform.fetch:n.fetchFunc,r=t.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),o=0,i=.5,n.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,zw(r,n.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,zw(s,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function $w(t){var n=this;return function(e,r,o){return r===void 0&&(r=""),J(n,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p;return ee(this,function(m){switch(m.label){case 0:if(i=e.map(function(){return!1}),a={},s=o!=null?o.map(function(){return!1}):[],u=[],e.forEach(function(g,v){var b=0;g.weights.forEach(function(x){var y="quantization"in x?x.quantization.dtype:x.dtype,w=Lm[y]*te(x.shape),C=function(){i[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:x,groupOffset:b,sizeBytes:w})};o!=null?o.forEach(function(T,S){T===x.name&&(C(),s[S]=!0)}):C(),u.push(x.name),b+=w})}),!s.every(function(g){return g}))throw c=o.filter(function(g,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=i.reduce(function(g,v,b){return v&&g.push(b),g},[]),d=[],l.forEach(function(g){e[g].paths.forEach(function(v){var b=r+(r.endsWith("/")?"":"/")+v;d.push(b)})}),[4,t(d)];case 1:return f=m.sent(),h={},p=0,l.forEach(function(g){for(var v=e[g].paths.length,b=0,x=0;x<v;x++)b+=f[p+x].byteLength;for(var y=new ArrayBuffer(b),w=new Uint8Array(y),C=0,T=0;T<v;T++){var S=new Uint8Array(f[p+T]);w.set(S,C),C+=S.byteLength}a[g].forEach(function(I){var _=l1(y.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var N in _)h[N]=_[N]}),p+=v}),[2,h]}})})}}pn.registerSaveRouter(function(t){return P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(gm.URL_SCHEME)?function(n){return n===void 0&&(n="model"),new gm(n)}(t.slice(gm.URL_SCHEME.length)):null});var m1=function(){function t(n,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(E(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=P().platform.fetch,E(n!=null&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&E(n.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(n){return J(this,void 0,void 0,function(){var e,r,o,i;return ee(this,function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),n.weightData!=null&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:du(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return J(this,void 0,void 0,function(){var n,e,r,o,i,a,s,u,c,l,d,f;return ee(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.modelTopology,i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},t.prototype.loadWeights=function(n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d,f;return ee(this,function(h){switch(h.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),v=p.substring(0,m),b=g>m?p.substring(g):"";return[v+"/",b]}(e),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return d=[],n.forEach(function(p){p.paths.forEach(function(m){d.push(a+m+i)})}),[4,p1(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,Ig(f)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function Vm(t){return t.match(m1.URL_SCHEME_REGEX)!=null}var Gw=function(t,n){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(e){return Vm(e)}):Vm(t))?Um(t,{onProgress:n}):null};function Um(t,n){return new m1(t,n)}pn.registerSaveRouter(Gw),pn.registerLoadRouter(Gw);var vm=function(){function t(n){this.modelArtifacts=n}return t.prototype.load=function(){return J(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.modelArtifacts]})})},t}(),EL=function(){function t(n){this.saveHandler=n}return t.prototype.save=function(n){return J(this,void 0,void 0,function(){return ee(this,function(e){return[2,this.saveHandler(n)]})})},t}(),dd=Object.freeze({browserFiles:function(t){return new DL(t)},browserHTTPRequest:function(t,n){return Um(t,n)},concatenateArrayBuffers:Ig,decodeWeights:l1,encodeWeights:function(t,n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ee(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),i=function(c){var l=o[c],d=Array.isArray(t)?t[c].tensor:t[l];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(p){return J(s,void 0,void 0,function(){var m,g,v,b,x,y,w;return ee(this,function(C){switch(C.label){case 0:return[4,d.bytes()];case 1:for(m=C.sent(),g=m.reduce(function(T,S){return T+S.length},0)+Jl*m.length,v=new Uint8Array(g),b=0,x=0;x<m.length;x++)y=m[x],w=new Uint8Array(new Uint32Array([y.length]).buffer),v.set(w,b),b+=Jl,v.set(y,b),b+=y.length;return p(v),[2]}})})});r.push(h)}else r.push(d.data());n!=null&&(f.group=n),e.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:fL(u.sent()),specs:e}]}})})},fromMemory:function(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new vm(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vm({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vm({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))},getLoadHandlers:function(t,n){return pn.getLoadHandlers(t,n)},getModelArtifactsInfoForJSON:du,getSaveHandlers:function(t){return pn.getSaveHandlers(t)},http:Um,isHTTPScheme:Vm,loadWeights:function(t,n,e,r){return n===void 0&&(n=""),J(this,void 0,void 0,function(){return ee(this,function(o){return[2,$w(function(i){return p1(i,{requestInit:r})})(t,n,e)]})})},registerLoadRouter:function(t){return pn.registerLoadRouter(t)},registerSaveRouter:function(t){return pn.registerSaveRouter(t)},weightsLoaderFactory:$w,withSaveHandler:function(t){return new EL(t)},copyModel:function(t,n){return J(this,void 0,void 0,function(){return ee(this,function(e){return[2,Vw(t,n,!1)]})})},listModels:function(){return J(this,void 0,void 0,function(){var t,n,e,r,o,i,a;return ee(this,function(s){switch(s.label){case 0:t=co.getSchemes(),n={},e=0,r=t,s.label=1;case 1:return e<r.length?(o=r[e],[4,co.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())n[o+ca+a]=i[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(t,n){return J(this,void 0,void 0,function(){return ee(this,function(e){return[2,Vw(t,n,!0)]})})},removeModel:function(t){return J(this,void 0,void 0,function(){var n;return ee(this,function(e){return n=Ll(t),[2,co.getManager(n.scheme).removeModel(n.path)]})})}}),ra,IL=M({confusionMatrix_:function(t,n,e){var r=D(t,"labels","confusionMatrix"),o=D(n,"predictions","confusionMatrix");E(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),E(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),E(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),E(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),E(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=km(r.asType("int32"),e),a=km(o.asType("int32"),e);return i.transpose().matMul(a).asType("int32")}}),BH=Object.freeze({confusionMatrix:IL}),_L=M({fromPixels_:function(t,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else{if(t.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Xw("FromPixels",R.backendName)!=null)return R.runKernel("FromPixels",{pixels:t},{numChannels:n});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,d).data:r||e?s=t.data:(i||o)&&(ra==null&&(ra=document.createElement("canvas").getContext("2d")),ra.canvas.width=l,ra.canvas.height=d,ra.drawImage(t,0,0,l,d),s=ra.getImageData(0,0,l,d).data),n===4)u=new Int32Array(s);else{var f=l*d;u=new Int32Array(f*n);for(var h=0;h<f;h++)for(var p=0;p<n;++p)u[h*n+p]=s[4*h+p]}return nd(u,[d,l,n],"int32")}}),ya=Object.freeze({toPixels:function(t,n){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d,f,h,p,m,g,v,b,x,y,w,C,T,S;return ee(this,function(I){switch(I.label){case 0:if(e=D(t,"img","toPixels"),t instanceof ze||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(a=e.rank===2?1:e.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=I.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=I.sent(),d=l[0],f=l[1],h=d[0],p=f[0],u.dispose(),c.dispose(),e.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(m=e.dtype==="float32"?255:1,g=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)b=void 0,x=void 0,y=void 0,w=void 0,a===1?(b=s[v]*m,x=s[v]*m,y=s[v]*m,w=255):a===3?(b=s[3*v]*m,x=s[3*v+1]*m,y=s[3*v+2]*m,w=255):a===4&&(b=s[4*v]*m,x=s[4*v+1]*m,y=s[4*v+2]*m,w=s[4*v+3]*m),g[(C=4*v)+0]=Math.round(b),g[C+1]=Math.round(x),g[C+2]=Math.round(y),g[C+3]=Math.round(w);return n!=null&&(n.width=i,n.height=o,T=n.getContext("2d"),S=new ImageData(g,i,o),T.putImageData(S,0,0)),e!==t&&e.dispose(),[2,g]}})})},fromPixels:_L}),g1=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(n,e){return new n(e)},t}(),v1=function(){function t(){this.classNameMap={}}return t.getMap=function(){return t.instance==null&&(t.instance=new t),t.instance},t.register=function(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]},t}();function ho(t){E(t.className!=null,function(){return"Class being registered does not have the static className property defined."}),E(typeof t.className=="string",function(){return"className is required to be a string, but got type "+typeof t.className}),E(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),v1.register(t)}var jH=Object.freeze({Serializable:g1,SerializationMap:v1,registerClass:ho}),SL=.001,y1=.1;function ym(){return R.backend.floatPrecision()===32?SL:y1}function bm(t,n,e){var r=!0;if((Pt(t)||Pt(n))&&(r=!1),Pt(t)&&Pt(n)&&(r=!0),r){var o=t.constructor.name,i=n.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(n)){var a=fr(t),s=fr(n);if(!ft(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Pt(t)?t:Nr(t),c=Pt(n)?n:Nr(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+`.
Actual:   `+u+`.
Expected: `+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+`.
Actual:   `+u+`.
Expected: `+c+".")}}function xm(t,n,e){return!isFinite(t)&&!isFinite(n)||!(isNaN(t)||isNaN(n)||Math.abs(t-n)>e)}var VH=Object.freeze({TEST_EPSILON_FLOAT16:y1,expectArraysClose:function(t,n,e){return e==null&&(e=ym()),bm(t,n,function(r,o){return xm(r,o,e)})},testEpsilon:ym,expectPromiseToFail:function(t,n){t().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(t,n){var e=typeof n=="string"||typeof n=="number"||typeof n=="boolean"?[n]:n;return so(t)||so(t[0])||so(n)||so(n[0])?bm(t,e,function(r,o){return r==o}):bm(t,n,function(r,o){return xm(r,o,0)})},expectNumbersClose:function(t,n,e){if(e==null&&(e=ym()),!xm(t,n,e))throw new Error("Numbers differ: actual === "+t+", expected === "+n)},expectValuesInRange:function(t,n,e){for(var r=0;r<t.length;r++)if(t[r]<n||t[r]>e)throw new Error("Value out of range:"+t[r]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(t,n){expect(new Float32Array(t)).toEqual(new Float32Array(n))}});var UH=Object.freeze({gpgpu_util:Yk,webgl_util:xN,forceHalfFloat:function(){P().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:FD,setWebGLContext:hC,GPGPUContext:SD}),ri=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return $n(n,t),n.prototype.minimize=function(e,r,o){r===void 0&&(r=!1);var i=this.computeGradients(e,o),a=i.value,s=i.grads;if(o!=null){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return en(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,r){return ek(e,r)},n.prototype.dispose=function(){this.iterations_!=null&&en(this.iterations_)},n.prototype.saveIterations=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:K(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return J(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},n}(g1);Object.defineProperty(ri,Symbol.hasInstance,{value:function(t){return t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null}});var b1=function(t){function n(e,r,o){o===void 0&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=R.backend.epsilon()),i}return $n(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:H(function(){return ke(a).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:H(function(){return ke(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(s!=null){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;H(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(en(this.accumulatedGrads.map(function(e){return e.variable})),en(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return ee(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=e.length/2,this.accumulatedGrads=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(ri);ho(b1);var x1=function(t){function n(e,r){r===void 0&&(r=.1);var o=t.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return $n(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:H(function(){return mn(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(s!=null){var u=r.accumulatedGrads[i].variable;H(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(R.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&en(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(ri);ho(x1);var w1=function(t){function n(e,r,o,i){i===void 0&&(i=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],H(function(){a.accBeta1=K(r).variable(),a.accBeta2=K(o).variable()}),i==null&&(a.epsilon=R.backend.epsilon()),a}return $n(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);H(function(){var i=$e(1,r.accBeta1),a=$e(1,r.accBeta2);o.forEach(function(s,u){var c=R.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:H(function(){return ke(c).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:H(function(){return ke(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(l!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),m=h.div(i),g=p.div(a);d.assign(h),f.assign(p);var v=m.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&en(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&en(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return ee(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r,o=this;return ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),H(function(){o.accBeta1.assign(Ql(o.beta1,o.iterations_+1)),o.accBeta2.assign(Ql(o.beta2,o.iterations_+1))}),r=e.length/2,this.accumulatedFirstMoment=e.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(ri);ho(w1);var C1=function(t){function n(e,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=t.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],H(function(){s.iteration=K(0).variable(),s.accBeta1=K(r).variable()}),i==null&&(s.epsilon=R.backend.epsilon()),s}return $n(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);H(function(){var i=$e(1,r.accBeta1),a=Sn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=R.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ke(c).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:ke(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(l!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),m=l.abs(),g=p.maximum(m);d.assign(h),f.assign(g);var v=a.div(i).mul(h.div(g.add(r.epsilon))).add(c);c.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&en(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&en(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(ri);ho(C1);var _g=function(t){function n(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return $n(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=Array.isArray(e)?e[i].tensor:e[o];if(a!=null){var s=R.registeredVariables[o];H(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=wN(K(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,r){return new e(r.learningRate)},n.className="SGD",n}(ri);ho(_g);var D1=function(t){function n(e,r,o){o===void 0&&(o=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=K(i.momentum),i}return $n(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:H(function(){return ke(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[o];u!=null&&H(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&en(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return ee(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(_g);ho(D1);var E1=function(t){function n(e,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=t.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=R.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return $n(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:H(function(){return ke(a).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:H(function(){return ke(a).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:H(function(){return ke(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;H(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=a.sub(h);a.assign(p)}else{var m=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&en(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&en(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&en(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return ee(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r;return ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),r=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(ri);ho(E1);var Ho=function(){function t(){}return t.sgd=function(n){return new _g(n)},t.momentum=function(n,e,r){return r===void 0&&(r=!1),new D1(n,e,r)},t.rmsprop=function(n,e,r,o,i){return e===void 0&&(e=.9),r===void 0&&(r=0),o===void 0&&(o=null),i===void 0&&(i=!1),new E1(n,e,r,o,i)},t.adam=function(n,e,r,o){return n===void 0&&(n=.001),e===void 0&&(e=.9),r===void 0&&(r=.999),o===void 0&&(o=null),new w1(n,e,r,o)},t.adadelta=function(n,e,r){return n===void 0&&(n=.001),e===void 0&&(e=.95),r===void 0&&(r=null),new b1(n,e,r)},t.adamax=function(n,e,r,o,i){return n===void 0&&(n=.002),e===void 0&&(e=.9),r===void 0&&(r=.999),o===void 0&&(o=null),i===void 0&&(i=0),new C1(n,e,r,o,i)},t.adagrad=function(n,e){return e===void 0&&(e=.1),new x1(n,e)},t}(),WH={sgd:Ho.sgd,momentum:Ho.momentum,adadelta:Ho.adadelta,adagrad:Ho.adagrad,rmsprop:Ho.rmsprop,adamax:Ho.adamax,adam:Ho.adam};ze.prototype.squaredDifference=function(t){return PD(this,t)},F=iL;var Ra={};eI(Ra,{AnchorPosition:()=>Ur,DrawBox:()=>Bg,DrawBoxOptions:()=>N1,DrawFaceLandmarks:()=>K1,DrawFaceLandmarksOptions:()=>q1,DrawTextField:()=>pu,DrawTextFieldOptions:()=>vd,drawContour:()=>Lr,drawDetections:()=>FL,drawFaceExpressions:()=>PL,drawFaceLandmarks:()=>OL});function Lr(t,n,e){if(e===void 0&&(e=!1),t.beginPath(),n.slice(1).forEach(function(i,a){var s=i.x,u=i.y,c=n[a];t.moveTo(c.x,c.y),t.lineTo(s,u)}),e){var r=n[n.length-1],o=n[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var Sg=function(t,n){return Sg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])},Sg(t,n)};function Y(t,n){Sg(t,n);function e(){this.constructor=t}t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}var mt=function(){return mt=Object.assign||function(n){for(var e,r=1,o=arguments.length;r<o;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},mt.apply(this,arguments)};function G(t,n,e,r){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}function q(t,n){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(c[0]===6&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(t,e)}catch(l){c=[6,l],o=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function oi(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Mn=function(){function t(n,e){if(!pr(n)||!pr(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function fu(t,n){return t instanceof ze&&t.shape.length===n}function I1(t){return fu(t,2)}function po(t){return fu(t,3)}function Rn(t){return fu(t,4)}function _1(t){return t%1!==0}function Tg(t){return t%2===0}function ba(t,n){n===void 0&&(n=2);var e=Math.pow(10,n);return Math.floor(t*e)/e}function Mg(t){return t&&t.width&&t.height}function S1(t,n){var e=t.width,r=t.height,o=n/Math.max(r,e);return new Mn(Math.round(e*o),Math.round(r*o))}function xa(t){return t.reduce(function(n,e){return n.add(e)},new pe(0,0)).div(new pe(t.length,t.length))}function Br(t,n,e){return Array(t).fill(0).map(function(r,o){return n+o*e})}function pr(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||t===0}function fd(t){return pr(t)&&0<=t&&t<=1}var pe=function(){function t(n,e){this._x=n,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.sub=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.mul=function(n){return new t(this.x*n.x,this.y*n.y)},t.prototype.div=function(n){return new t(this.x/n.x,this.y/n.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}();var St=function(){function t(n,e){e===void 0&&(e=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(pr),i=[r.x,r.y,r.width,r.height].every(pr);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(pr)},t.assertIsValidBox=function(n,e,r){if(r===void 0&&(r=!1),!t.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new pe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new pe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new pe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new pe(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),e=n[0],r=n[1],o=n[2],i=n[3];return new t({x:e,y:r,width:o,height:i})},t.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),e=n[0],r=n[1],o=n[2],i=n[3];return new t({x:e,y:r,width:o,height:i})},t.prototype.toSquare=function(){var n=this,e=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(e-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:e,y:r,width:o,height:i})},t.prototype.rescale=function(n){var e=Mg(n)?n.width:n,r=Mg(n)?n.height:n;return new t({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},t.prototype.pad=function(n,e){var r=[this.x-n/2,this.y-e/2,this.width+n,this.height+e],o=r[0],i=r[1],a=r[2],s=r[3];return new t({x:o,y:i,width:a,height:s})},t.prototype.clipAtImageBorders=function(n,e){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,d=s-c,f=Math.min(l,n-u),h=Math.min(d,e-c);return new t({x:u,y:c,width:f,height:h}).floor()},t.prototype.shift=function(n,e){var r=this,o=r.width,i=r.height,a=this.x+n,s=this.y+e;return new t({x:a,y:s,width:o,height:i})},t.prototype.padAtBorders=function(n,e){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+r,d=e),f>n&&(u=-f+n+o,f=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:a,edy:u,dx:i,edx:s,y:l,ey:f,x:c,ex:d,w:r,h:o}},t.prototype.calibrate=function(n){return new t({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},t}();var ii=function(t){Y(n,t);function n(e,r,o,i,a){return a===void 0&&(a=!1),t.call(this,{left:e,top:r,right:o,bottom:i},a)||this}return n}(St);var hd=function(){function t(n,e,r,o,i){this._imageDims=new Mn(i.width,i.height),this._score=n,this._classScore=e,this._className=r,this._box=new St(o).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new St(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},t}();var Ze=function(t){Y(n,t);function n(e,r,o){return t.call(this,e,e,"",r,o)||this}return n.prototype.forSize=function(e,r){var o=t.prototype.forSize.call(this,e,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new n(i,a,s)},n}(hd);function T1(t,n,e){e===void 0&&(e=!0);var r=Math.max(0,Math.min(t.right,n.right)-Math.max(t.left,n.left)),o=Math.max(0,Math.min(t.bottom,n.bottom)-Math.max(t.top,n.top)),i=r*o;return e?i/(t.area+n.area-i):i/Math.min(t.area,n.area)}function M1(t){var n=t.map(function(s){return s.x}),e=t.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=e.reduce(function(s,u){return s<u?u:s},0);return new ii(r,o,i,a)}function jr(t,n,e,r){r===void 0&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++){var d=u[l],f=t[s],h=t[d];c.push(T1(f,h,r))}o=o.filter(function(p,m){return c[m]<=e})};o.length>0;)a();return i}function mr(t,n){return H(function(){var e=n[0],r=n[1],o=n[2],i=mn(oi(t.shape.slice(0,3),[1]),e),a=mn(oi(t.shape.slice(0,3),[1]),r),s=mn(oi(t.shape.slice(0,3),[1]),o),u=Ye([i,a,s],3);return $e(t,u)})}function R1(t,n){return n===void 0&&(n=!1),H(function(){var e=t.shape.slice(1),r=e[0],o=e[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(h){var p=t.shape.slice();return p[s]=h,mn(p,0)},c=u(a),l=i-c.shape[s],d=n&&l?u(l):null,f=[d,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Ye(f,s)})}function pd(t){return 1/(1+Math.exp(-t))}var wa=function(t){Y(n,t);function n(e,r,o,i,a){return a===void 0&&(a=!1),t.call(this,{x:e,y:r,width:o,height:i},a)||this}return n}(St);var ML=.5,RL=.43,AL=.45,Xn=function(){function t(n,e,r){r===void 0&&(r=new pe(0,0));var o=e.width,i=e.height;this._imgDims=new Mn(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new pe(o,i)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new pe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new pe(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},t.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new pe(n,e))},t.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},t.prototype.align=function(n,e){if(e===void 0&&(e={}),n){var r=n instanceof Ze?n.box.floor():new St(n);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},t.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),e=n[0],r=n[1],o=n[2],i=function(d){return o.sub(d).magnitude()},a=(i(e)+i(r))/2,s=Math.floor(a/AL),u=xa(n),c=Math.floor(Math.max(0,u.x-ML*s)),l=Math.floor(Math.max(0,u.y-RL*s));return new wa(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},t.prototype.alignMinBbox=function(n){var e=M1(this.positions);return e.pad(e.width*n,e.height*n)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}();var A1=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],xa([e[3],e[4]])]},n}(Xn);var md=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(xa)},n}(Xn);var Rg=function(){function t(n,e){this._label=n,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+ba(this.distance)+")":"")},t}();var Ag=function(t){Y(n,t);function n(e,r){var o=t.call(this,e)||this;return o._label=r,o}return n.assertIsValidLabeledBox=function(e,r){if(St.assertIsValidBox(e,r),!pr(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(St);var hu=function(){function t(n,e){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},t.fromJSON=function(n){var e=n.descriptors.map(function(r){return new Float32Array(r)});return new t(n.label,e)},t}();var Jz=function(t){Y(n,t);function n(e,r,o,i){var a=t.call(this,e,r)||this;return a._score=o,a._classScore=i,a}return n.assertIsValidPredictedBox=function(e,r){if(Ag.assertIsValidLabeledBox(e,r),!fd(e.score)||!fd(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n}(Ag);function Vr(t){return t.detection instanceof Ze}function mo(t,n){var e={detection:n};return Object.assign({},t,e)}function Ng(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:n}}function gd(t){var n="";if(!t)try{t=Hd("fs")}catch(r){n=r.toString()}var e=t?function(r){return new Promise(function(o,i){t.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:e}}function kg(){var t=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,e=function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=gd();return mt({Canvas:t||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:n||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:e,createImageElement:r,fetch:o},i)}function Fg(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Pg(){return typeof global=="object"&&typeof Hd=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var wt;function NL(){if(!wt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return wt}function Og(t){wt=t}function Lg(){Fg()&&Og(Ng()),Pg()&&Og(kg())}function kL(t){if(wt||Lg(),!wt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=t.Canvas,e=n===void 0?wt.Canvas:n,r=t.Image,o=r===void 0?wt.Image:r;wt.Canvas=e,wt.Image=o,wt.createCanvasElement=t.createCanvasElement||function(){return new e},wt.createImageElement=t.createImageElement||function(){return new o},wt.ImageData=t.ImageData||wt.ImageData,wt.Video=t.Video||wt.Video,wt.fetch=t.fetch||wt.fetch,wt.readFile=t.readFile||wt.readFile}var Fe={getEnv:NL,setEnv:Og,initialize:Lg,createBrowserEnv:Ng,createFileSystem:gd,createNodejsEnv:kg,monkeyPatch:kL,isBrowser:Fg,isNodejs:Pg};Lg();function Ca(t){return!Fe.isNodejs()&&typeof t=="string"?document.getElementById(t):t}function Lt(t){var n=Fe.getEnv(),e=n.Canvas,r=n.CanvasRenderingContext2D;if(t instanceof r)return t;var o=Ca(t);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var Ur=function(t){return t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT",t}(Ur||{}),vd=function(){function t(n){n===void 0&&(n={});var e=n.anchorPosition,r=n.backgroundColor,o=n.fontColor,i=n.fontSize,a=n.fontStyle,s=n.padding;this.anchorPosition=e||Ur.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4}return t}();var pu=function(){function t(n,e,r){r===void 0&&(r={}),this.text=typeof n=="string"?[n]:n instanceof t?n.text:n,this.anchor=e,this.options=new vd(r)}return t.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(r){return n.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},t.prototype.measureHeight=function(){var n=this.options,e=n.fontSize,r=n.padding;return this.text.length*e+2*r},t.prototype.getUpperLeft=function(n,e){var r=this.options.anchorPosition,o=r===Ur.BOTTOM_RIGHT||r===Ur.TOP_RIGHT,i=r===Ur.BOTTOM_LEFT||r===Ur.BOTTOM_RIGHT,a=this.measureWidth(n),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var l=e.width,d=e.height,f=Math.max(Math.min(u,l-a),0),h=Math.max(Math.min(c,d-s),0);return{x:f,y:h}}return{x:u,y:c}},t.prototype.draw=function(n){var e=Ca(n),r=Lt(e),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,u=o.fontStyle,c=o.padding;r.font=s+"px "+u;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=a,this.text.forEach(function(h,p){var m=c+f.x,g=c+f.y+(p+1)*s;r.fillText(h,m,g)})},t}();var N1=function(){function t(n){n===void 0&&(n={});var e=n.boxColor,r=n.lineWidth,o=n.label,i=n.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o;var a={anchorPosition:Ur.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new vd(Object.assign({},a,i))}return t}();var Bg=function(){function t(n,e){e===void 0&&(e={}),this.box=new St(n),this.options=new N1(e)}return t.prototype.draw=function(n){var e=Lt(n),r=this.options,o=r.boxColor,i=r.lineWidth,a=this.box,s=a.x,u=a.y,c=a.width,l=a.height;e.strokeStyle=o,e.lineWidth=i,e.strokeRect(s,u,c,l);var d=this.options.label;d&&new pu([d],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(n)},t}();function FL(t,n){var e=Array.isArray(n)?n:[n];e.forEach(function(r){var o=r instanceof Ze?r.score:Vr(r)?r.detection.score:void 0,i=r instanceof Ze?r.box:Vr(r)?r.detection.box:new St(r),a=o?""+ba(o):void 0;new Bg(i,{label:a}).draw(t)})}function yd(t){var n=Fe.getEnv(),e=n.Image,r=n.Video;return t instanceof e&&t.complete||t instanceof r&&t.readyState>=3}function k1(t){return new Promise(function(n,e){if(t instanceof Fe.getEnv().Canvas||yd(t))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}t.addEventListener("load",r),t.addEventListener("error",o)})}function F1(t){return new Promise(function(n,e){if(!(t instanceof Blob))return e("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if(typeof r.result!="string")return e("bufferToImage - expected reader.result to be a string, in onload");var o=Fe.getEnv().createImageElement();o.onload=function(){return n(o)},o.onerror=e,o.src=r.result},r.onerror=e,r.readAsDataURL(t)})}function Da(t){var n=Fe.getEnv(),e=n.Image,r=n.Video;return t instanceof e?new Mn(t.naturalWidth,t.naturalHeight):t instanceof r?new Mn(t.videoWidth,t.videoHeight):new Mn(t.width,t.height)}function ai(t){var n=t.width,e=t.height,r=Fe.getEnv().createCanvasElement,o=r();return o.width=n,o.height=e,o}function Ea(t,n){var e=Fe.getEnv().ImageData;if(!(t instanceof e)&&!yd(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=n||Da(t),o=r.width,i=r.height,a=ai({width:o,height:i});return t instanceof e?Lt(a).putImageData(t,0,0):Lt(a).drawImage(t,0,0,o,i),a}function P1(t,n){return G(this,void 0,void 0,function(){var e,r,o,i,a,s;return q(this,function(u){switch(u.label){case 0:return e=n||Fe.getEnv().createCanvasElement(),r=t.shape.slice(Rn(t)?1:0),o=r[0],i=r[1],a=r[2],s=H(function(){return t.as3D(o,i,a).toInt()}),[4,ya.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function jg(t){var n=Fe.getEnv(),e=n.Image,r=n.Canvas,o=n.Video;return t instanceof e||t instanceof r||t instanceof o}function O1(t,n,e){e===void 0&&(e=!1);var r=Fe.getEnv(),o=r.Image,i=r.Canvas;if(!(t instanceof o||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Da(t),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=ai({width:n,height:n}),d=t instanceof i?t:Ea(t),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return Lt(l).drawImage(d,h,p,u,c),l}var si=function(){function t(n,e){var r=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(o,i){if(po(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(Rn(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Fe.getEnv().Canvas?o:Ea(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Br(this.batchSize,0,1).map(function(e,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},t.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},t.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},t.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},t.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(n),r=this.getInputHeight(n);return S1({width:e,height:r},this.inputSize)},t.prototype.toBatchTensor=function(n,e){var r=this;return e===void 0&&(e=!0),this._inputSize=n,H(function(){var o=Br(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof ze){var u=Rn(s)?s:s.expandDims();return u=R1(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=lu.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof Fe.getEnv().Canvas)return ya.fromPixels(O1(s,n,e));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=Ot(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3);return i})},t}();function We(t){return G(this,void 0,void 0,function(){var n,e,r;return q(this,function(o){switch(o.label){case 0:if(t instanceof si)return[2,t];if(n=Array.isArray(t)?t:[t],!n.length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(t)?" at input index "+i+":":""},r=n.map(Ca),r.forEach(function(i,a){if(!jg(i)&&!po(i)&&!Rn(i))throw typeof n[a]=="string"?new Error("toNetInput -"+e(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+e(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Rn(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+e(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return jg(i)&&k1(i)}))];case 1:return o.sent(),[2,new si(r,Array.isArray(t))]}})})}function mu(t,n){return G(this,void 0,void 0,function(){var e,r,o,i,a,s,u;return q(this,function(c){switch(c.label){case 0:return e=Fe.getEnv().Canvas,r=t,t instanceof e?[3,5]:[4,We(t)];case 1:if(o=c.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof e?(a=i,[3,4]):[3,2];case 2:return[4,P1(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=Lt(r),u=n.map(function(l){return l instanceof Ze?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,m=ai({width:h,height:p});return Lt(m).putImageData(s.getImageData(d,f,h,p),0,0),m})]}})})}function gu(t,n){return G(this,void 0,void 0,function(){return q(this,function(e){if(!po(t)&&!Rn(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Rn(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,H(function(){var r=t.shape.slice(Rn(t)?1:0),o=r[0],i=r[1],a=r[2],s=n.map(function(c){return c instanceof Ze?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}),u=s.map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return gg(t.as3D(o,i,a),[d,l,0],[h,f,a])});return u})]})})}function vu(t,n){return G(this,void 0,void 0,function(){var e,r;return q(this,function(o){switch(o.label){case 0:return e=Fe.getEnv().fetch,[4,e(t,n)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function L1(t){return G(this,void 0,void 0,function(){var n,e;return q(this,function(r){switch(r.label){case 0:return[4,vu(t)];case 1:return n=r.sent(),[4,n.blob()];case 2:if(e=r.sent(),!e.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+e.type+", for url: "+n.url);return[2,F1(e)]}})})}function B1(t){return G(this,void 0,void 0,function(){return q(this,function(n){switch(n.label){case 0:return[4,vu(t)];case 1:return[2,n.sent().json()]}})})}function bd(t,n){var e=n+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:e};if(t==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"";t=t.replace(r,"");var o=t.split("/").filter(function(s){return s}),i=t.endsWith(".json")?o[o.length-1]:e,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=t.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function j1(t,n){return G(this,void 0,void 0,function(){var e,r,o,i;return q(this,function(a){switch(a.label){case 0:return e=bd(t,n),r=e.manifestUri,o=e.modelBaseUri,[4,B1(r)];case 1:return i=a.sent(),[2,dd.loadWeights(i,o)]}})})}function Vg(t,n,e){e===void 0&&(e=!1);var r=e?Da(n):n,o=r.width,i=r.height;return t.width=o,t.height=i,{width:o,height:i}}var Tt=function(){function t(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n),r=e.obj,o=e.objProp;return r[o]},t.prototype.reassignParamFromPath=function(n,e){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},t.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Yo})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Yo)})},t.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){var r=e.path,o=e.tensor;n.reassignParamFromPath(r,o.variable())})},t.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=It(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var e=n.tensor;return Array.from(e.dataSync())}).reduce(function(n,e){return n.concat(e)}))},t.prototype.load=function(n){return G(this,void 0,void 0,function(){return q(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(n){return G(this,void 0,void 0,function(){var e;return q(this,function(r){switch(r.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,j1(n,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(n){return G(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return q(this,function(f){switch(f.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=Fe.getEnv().readFile,r=bd(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(h){return Promise.all(h.map(function(p){return e(p).then(function(m){return m.buffer})}))},s=dd.weightsLoaderFactory(a),l=(c=JSON).parse,[4,e(o)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},t.prototype.extractWeights=function(n){var e=this.extractParams(n),r=e.paramMappings,o=e.params;this._paramMappings=r,this._params=o},t.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!r||!o||!(r[o]instanceof ze))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},t}();function Kt(t,n,e){return H(function(){var r=uu(t,n.depthwise_filter,n.pointwise_filter,e,"same");return r=ae(r,n.bias),r})}function xd(t,n,e){return e===void 0&&(e=!1),H(function(){var r=je(e?ae(_t(t,n.conv0.filters,[2,2],"same"),n.conv0.bias):Kt(t,n.conv0,[2,2])),o=Kt(r,n.conv1,[1,1]),i=je(ae(r,o)),a=Kt(i,n.conv2,[1,1]);return je(ae(r,ae(o,a)))})}function yu(t,n,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),H(function(){var o=je(e?ae(_t(t,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):Kt(t,n.conv0,r?[2,2]:[1,1])),i=Kt(o,n.conv1,[1,1]),a=je(ae(o,i)),s=Kt(a,n.conv2,[1,1]),u=je(ae(o,ae(i,s))),c=Kt(u,n.conv3,[1,1]);return je(ae(o,ae(i,ae(s,c))))})}function Ut(t,n,e,r){return e===void 0&&(e="same"),r===void 0&&(r=!1),H(function(){var o=ae(_t(t,n.filters,[1,1],e),n.bias);return r?je(o):o})}function Mt(t,n){Object.keys(t).forEach(function(e){n.some(function(r){return r.originalPath===e})||t[e].dispose()})}function go(t,n){return function(e,r,o,i){var a=xt(t(e*r*o*o),[o,o,e,r]),s=qe(t(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function Ia(t,n){return function(e,r,o){var i=dr(t(e*r),[e,r]),a=qe(t(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var Ug=function(){function t(n,e,r){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=r}return t}();function _a(t,n){return function(e,r,o){var i=xt(t(9*e),[3,3,e,1]),a=xt(t(e*r),[1,1,e,r]),s=qe(t(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Ug(i,a,s)}}function Sa(t){return function(n){var e=t(n+"/depthwise_filter",4),r=t(n+"/pointwise_filter",4),o=t(n+"/bias",1);return new Ug(e,r,o)}}function Wt(t,n){return function(e,r,o){var i=t[e];if(!fu(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:e,paramPath:o||e}),i}}function Rt(t){var n=t;function e(o){var i=n.slice(0,o);return n=n.slice(o),i}function r(){return n}return{extractWeights:e,getRemainingWeights:r}}function wd(t,n){var e=go(t,n),r=_a(t,n);function o(a,s,u,c){c===void 0&&(c=!1);var l=c?e(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),d=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:l,conv1:d,conv2:f}}function i(a,s,u,c){c===void 0&&(c=!1);var l=o(a,s,u,c),d=l.conv0,f=l.conv1,h=l.conv2,p=r(s,s,u+"/conv3");return{conv0:d,conv1:f,conv2:h,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function V1(t){var n=[],e=Rt(t),r=e.extractWeights,o=e.getRemainingWeights,i=wd(r,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}function Cd(t){return function(n){var e=t(n+"/filters",4),r=t(n+"/bias",1);return{filters:e,bias:r}}}function Dd(t,n){var e=Wt(t,n),r=Cd(e),o=Sa(e);function i(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),d=o(s+"/conv2");return{conv0:c,conv1:l,conv2:d}}function a(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),d=o(s+"/conv2"),f=o(s+"/conv3");return{conv0:c,conv1:l,conv2:d,conv3:f}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function U1(t){var n=[],e=Dd(t,n).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return Mt(t,n),{params:r,paramMappings:n}}var Ed=function(t){Y(n,t);function n(){return t.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return H(function(){var o=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=mr(o,i).div(K(255)),s=yu(a,r.dense0,!0);return s=yu(s,r.dense1),s=yu(s,r.dense2),s=yu(s,r.dense3),s=Pr(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return U1(e)},n.prototype.extractParams=function(e){return V1(e)},n}(Tt);function tn(t,n){return H(function(){return ae(va(t,n.weights),n.bias)})}function W1(t,n,e){var r=[],o=Rt(t),i=o.extractWeights,a=o.getRemainingWeights,s=Ia(i,r),u=s(n,e,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function H1(t){var n=[],e=Wt(t,n);function r(i){var a=e(i+"/weights",2),s=e(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return Mt(t,n),{params:o,paramMappings:n}}function Id(t){var n={},e={};return Object.keys(t).forEach(function(r){var o=r.startsWith("fc")?e:n;o[r]=t[r]}),{featureExtractorMap:n,classifierMap:e}}var _d=function(t){Y(n,t);function n(e,r){var o=t.call(this,e)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return H(function(){var i=e instanceof si?r.faceFeatureExtractor.forwardInput(e):e;return tn(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return W1(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var r=Id(e),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),H1(i)},n.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n}(Tt);var z1=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ta=function(){function t(n){var e=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);z1.forEach(function(r,o){e[r]=n[o]})}return t.prototype.asSortedArray=function(){var n=this;return z1.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,r){return r.probability-e.probability})},t}();var $1=function(t){Y(n,t);function n(e){return e===void 0&&(e=new Ed),t.call(this,"FaceExpressionNet",e)||this}return n.prototype.forwardInput=function(e){var r=this;return H(function(){return qt(r.runNet(e))})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(e){return G(this,void 0,void 0,function(){var r,o,i,a,s=this;return q(this,function(u){switch(u.label){case 0:return[4,We(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(Ue(o).map(function(c){return G(s,void 0,void 0,function(){var l;return q(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new Ta(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(_d);function G1(t){return t.expressions instanceof Ta}function Wg(t,n){var e={expressions:n};return Object.assign({},t,e)}function PL(t,n,e,r){e===void 0&&(e=.1);var o=Array.isArray(n)?n:[n];o.forEach(function(i){var a=i instanceof Ta?i:G1(i)?i.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(d){return d.probability>e}),c=Vr(i)?i.detection.box.bottomLeft:r||new pe(0,0),l=new pu(u.map(function(d){return d.expression+" ("+ba(d.probability)+")"}),c);l.draw(t)})}function Ma(t){return Vr(t)&&t.landmarks instanceof Xn&&t.unshiftedLandmarks instanceof Xn&&t.alignedRect instanceof Ze}function ui(t,n){var e=t.detection.box,r=n.shiftBy(e.x,e.y),o=r.align(),i=t.detection.imageDims,a=new Ze(t.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:n,alignedRect:a};return Object.assign({},t,s)}var q1=function(){function t(n){n===void 0&&(n={});var e=n.drawLines,r=e===void 0?!0:e,o=n.drawPoints,i=o===void 0?!0:o,a=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"}return t}();var K1=function(){function t(n,e){e===void 0&&(e={}),this.faceLandmarks=n,this.options=new q1(e)}return t.prototype.draw=function(n){var e=Lt(n),r=this.options,o=r.drawLines,i=r.drawPoints,a=r.lineWidth,s=r.lineColor,u=r.pointSize,c=r.pointColor;if(o&&this.faceLandmarks instanceof md&&(e.strokeStyle=s,e.lineWidth=a,Lr(e,this.faceLandmarks.getJawOutline()),Lr(e,this.faceLandmarks.getLeftEyeBrow()),Lr(e,this.faceLandmarks.getRightEyeBrow()),Lr(e,this.faceLandmarks.getNose()),Lr(e,this.faceLandmarks.getLeftEye(),!0),Lr(e,this.faceLandmarks.getRightEye(),!0),Lr(e,this.faceLandmarks.getMouth(),!0)),i){e.strokeStyle=c,e.fillStyle=c;var l=function(d){e.beginPath(),e.arc(d.x,d.y,u,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(l)}},t}();function OL(t,n){var e=Array.isArray(n)?n:[n];e.forEach(function(r){var o=r instanceof Xn?r:Ma(r)?r.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new K1(o).draw(t)})}function LL(t,n){var e=go(t,n),r=_a(t,n);function o(a,s,u){var c=r(a,s,u+"/separable_conv0"),l=r(s,s,u+"/separable_conv1"),d=e(a,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:d}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),c=r(a,a,s+"/separable_conv1"),l=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function X1(t,n){var e=[],r=Rt(t),o=r.extractWeights,i=r.getRemainingWeights,a=LL(o,e),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),f=c(32,64,"entry_flow/reduction_block_0"),h=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:f,reduction_block_1:h},m={};Br(n,0,1).forEach(function(x){m["main_block_"+x]=l(128,"middle_flow/main_block_"+x)});var g=c(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),b={reduction_block:g,separable_conv:v};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:m,exit_flow:b}}}function BL(t,n){var e=Wt(t,n),r=Cd(e),o=Sa(e);function i(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function a(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function Y1(t,n){var e=[],r=BL(t,e),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),c=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:c,reduction_block_1:l},f={};Br(n,0,1).forEach(function(g){f["main_block_"+g]=s("middle_flow/main_block_"+g)});var h=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),m={reduction_block:h,separable_conv:p};return Mt(t,e),{params:{entry_flow:d,middle_flow:f,exit_flow:m},paramMappings:e}}function Q1(t,n,e){return ae(_t(t,n.filters,e,"same"),n.bias)}function Hg(t,n,e){e===void 0&&(e=!0);var r=e?je(t):t;return r=Kt(r,n.separable_conv0,[1,1]),r=Kt(je(r),n.separable_conv1,[1,1]),r=rt(r,[3,3],[2,2],"same"),r=ae(r,Q1(t,n.expansion_conv,[2,2])),r}function jL(t,n){var e=Kt(je(t),n.separable_conv0,[1,1]);return e=Kt(je(e),n.separable_conv1,[1,1]),e=Kt(je(e),n.separable_conv2,[1,1]),e=ae(e,t),e}var Z1=function(t){Y(n,t);function n(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return n.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return H(function(){var i=e.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=mr(i,a).div(K(256)),u=je(Q1(s,o.entry_flow.conv_in,[2,2]));return u=Hg(u,o.entry_flow.reduction_block_0,!1),u=Hg(u,o.entry_flow.reduction_block_1),Br(r._numMainBlocks,0,1).forEach(function(c){u=jL(u,o.middle_flow["main_block_"+c])}),u=Hg(u,o.exit_flow.reduction_block),u=je(Kt(u,o.exit_flow.separable_conv,[1,1])),u})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Y1(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return X1(e,this._numMainBlocks)},n}(Tt);function J1(t){var n=[],e=Rt(t),r=e.extractWeights,o=e.getRemainingWeights,i=Ia(r,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}function eE(t){var n=[],e=Wt(t,n);function r(i){var a=e(i+"/weights",2),s=e(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Mt(t,n),{params:o,paramMappings:n}}var bu=function(t){return t.FEMALE="female",t.MALE="male",t}(bu||{});var tE=function(t){Y(n,t);function n(e){e===void 0&&(e=new Z1(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return H(function(){var i=e instanceof si?r.faceFeatureExtractor.forwardInput(e):e,a=Pr(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=tn(a,o.fc.age).as1D(),u=tn(a,o.fc.gender);return{age:s,gender:u}})},n.prototype.forwardInput=function(e){var r=this;return H(function(){var o=r.runNet(e),i=o.age,a=o.gender;return{age:i,gender:qt(a)}})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return G(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return q(this,function(l){switch(l.label){case 0:return[4,We(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=Ue(o.age),a=Ue(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return G(c,void 0,void 0,function(){var p,m,g,v,b;return q(this,function(x){switch(x.label){case 0:return[4,f.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return m=x.sent()[0],g=m>.5,v=g?bu.MALE:bu.FEMALE,b=g?m:1-m,f.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return J1(e)},n.prototype.extractParamsFromWeigthMap=function(e){var r=Id(e),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),eE(i)},n.prototype.extractParams=function(e){var r=1539,o=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n}(Tt);var Sd=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.postProcess=function(e,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return H(function(){var s=function(f,h){return Ot([mn([68],f),mn([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],m=p.width,g=p.height;return h(m,g)?Math.abs(m-g)/2:0},c=function(f){return u(f,function(h,p){return h<p})},l=function(f){return u(f,function(h,p){return p<h})},d=e.mul(mn([a,136],r)).sub(Ot(Array.from(Array(a),function(f,h){return s(c(h),l(h))}))).div(Ot(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})));return d})},n.prototype.forwardInput=function(e){var r=this;return H(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(e){return G(this,void 0,void 0,function(){var r,o,i,a=this;return q(this,function(s){switch(s.label){case 0:return[4,We(e)];case 1:return r=s.sent(),o=H(function(){return Ue(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return G(a,void 0,void 0,function(){var l,d,f,h,p;return q(this,function(m){switch(m.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[m.sent()]),h=l.filter(function(g,v){return Tg(v)}),p=l.filter(function(g,v){return!Tg(v)}),[2,new md(Array(68).fill(0).map(function(g,v){return new pe(h[v],p[v])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(_d);var Td=function(t){Y(n,t);function n(e){return e===void 0&&(e=new Ed),t.call(this,"FaceLandmark68Net",e)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(Sd);function nE(t){var n=[],e=Dd(t,n).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return Mt(t,n),{params:r,paramMappings:n}}function rE(t){var n=[],e=Rt(t),r=e.extractWeights,o=e.getRemainingWeights,i=wd(r,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}var oE=function(t){Y(n,t);function n(){return t.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return H(function(){var o=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=mr(o,i).div(K(255)),s=xd(a,r.dense0,!0);return s=xd(s,r.dense1),s=xd(s,r.dense2),s=Pr(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return nE(e)},n.prototype.extractParams=function(e){return rE(e)},n}(Tt);var iE=function(t){Y(n,t);function n(e){return e===void 0&&(e=new oE),t.call(this,"FaceLandmark68TinyNet",e)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(Sd);var F8=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n}(Td);function aE(t,n){return ae(tt(t,n.weights),n.biases)}function zg(t,n,e,r,o){o===void 0&&(o="same");var i=n.conv,a=i.filters,s=i.bias,u=_t(t,a,e,o);return u=ae(u,s),u=aE(u,n.scale),r?je(u):u}function sE(t,n){return zg(t,n,[1,1],!0)}function $g(t,n){return zg(t,n,[1,1],!1)}function Md(t,n){return zg(t,n,[2,2],!0,"valid")}function VL(t,n){function e(s,u,c){var l=t(s),d=l.length/(u*c*c);if(_1(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return H(function(){return Tn(xt(l,[u,d,c,c]),[2,3,1,0])})}function r(s,u,c,l){var d=e(s,u,c),f=qe(t(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}function o(s,u){var c=qe(t(s)),l=qe(t(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function i(s,u,c,l){var d=r(s,u,c,l+"/conv"),f=o(u,l+"/scale");return{conv:d,scale:f}}function a(s,u,c,l,d){d===void 0&&(d=!1);var f=i((d?.5:1)*s,u,c,l+"/conv1"),h=i(s,u,c,l+"/conv2");return{conv1:f,conv2:h}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function uE(t){var n=Rt(t),e=n.extractWeights,r=n.getRemainingWeights,o=[],i=VL(e,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),T=H(function(){return Tn(dr(e(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var S={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:b,conv256_down:x,conv256_1:y,conv256_2:w,conv256_down_out:C,fc:T};return{params:S,paramMappings:o}}function UL(t,n){var e=Wt(t,n);function r(a){var s=e(a+"/scale/weights",1),u=e(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=e(a+"/conv/filters",4),u=e(a+"/conv/bias",1),c=r(a);return{conv:{filters:s,bias:u},scale:c}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function cE(t){var n=[],e=UL(t,n),r=e.extractConvLayerParams,o=e.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),v=o("conv256_1"),b=o("conv256_2"),x=o("conv256_down_out"),y=t.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!I1(y))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var w={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:b,conv256_down_out:x,fc:y};return Mt(t,n),{params:w,paramMappings:n}}function Yn(t,n){var e=sE(t,n.conv1);return e=$g(e,n.conv2),e=ae(e,t),e=je(e),e}function xu(t,n){var e=Md(t,n.conv1);e=$g(e,n.conv2);var r=Pr(t,2,2,"valid"),o=Ke(r.shape),i=r.shape[3]!==e.shape[3],a=r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2];if(a){var s=oi(e.shape);s[1]=1;var u=Ke(s);e=Ye([e,u],1);var c=oi(e.shape);c[2]=1;var l=Ke(c);e=Ye([e,l],2)}return r=i?Ye([r,o],3):r,e=ae(r,e),e=je(e),e}var Gg=function(t){Y(n,t);function n(){return t.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return H(function(){var o=e.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=mr(o,i).div(K(256)),s=Md(a,r.conv32_down);s=rt(s,3,2,"valid"),s=Yn(s,r.conv32_1),s=Yn(s,r.conv32_2),s=Yn(s,r.conv32_3),s=xu(s,r.conv64_down),s=Yn(s,r.conv64_1),s=Yn(s,r.conv64_2),s=Yn(s,r.conv64_3),s=xu(s,r.conv128_down),s=Yn(s,r.conv128_1),s=Yn(s,r.conv128_2),s=xu(s,r.conv256_down),s=Yn(s,r.conv256_1),s=Yn(s,r.conv256_2),s=xu(s,r.conv256_down_out);var u=s.mean([1,2]),c=va(u,r.fc);return c})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return G(this,void 0,void 0,function(){var r,o,i,a=this;return q(this,function(s){switch(s.label){case 0:return[4,We(e)];case 1:return r=s.sent(),o=H(function(){return Ue(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return cE(e)},n.prototype.extractParams=function(e){return uE(e)},n}(Tt);function qg(t,n){var e={descriptor:n};return Object.assign({},t,e)}function Kg(t,n){var e={age:n};return Object.assign({},t,e)}function Xg(t,n,e){var r={gender:n,genderProbability:e};return Object.assign({},t,r)}var wu=function(){function t(n){var e=n===void 0?{}:n,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,a=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function WL(t,n){function e(u,c){var l=xt(t(9*u),[3,3,u,1]),d=qe(t(u)),f=qe(t(u)),h=qe(t(u)),p=qe(t(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}function r(u,c,l,d,f){var h=xt(t(u*c*l*l),[l,l,u,c]),p=qe(t(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,d){var f=r(u,c,l,d,!0),h=f.filters,p=f.bias;return{filters:h,batch_norm_offset:p}}function i(u,c,l){var d=e(u,l+"/depthwise_conv"),f=o(u,c,1,l+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),c=i(32,64,"mobilenetv1/conv_1"),l=i(64,128,"mobilenetv1/conv_2"),d=i(128,128,"mobilenetv1/conv_3"),f=i(128,256,"mobilenetv1/conv_4"),h=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),m=i(512,512,"mobilenetv1/conv_7"),g=i(512,512,"mobilenetv1/conv_8"),v=i(512,512,"mobilenetv1/conv_9"),b=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),y=i(512,1024,"mobilenetv1/conv_12"),w=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:m,conv_8:g,conv_9:v,conv_10:b,conv_11:x,conv_12:y,conv_13:w}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),c=o(256,512,3,"prediction_layer/conv_1"),l=o(512,128,1,"prediction_layer/conv_2"),d=o(128,256,3,"prediction_layer/conv_3"),f=o(256,128,1,"prediction_layer/conv_4"),h=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),m=o(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),y=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),w=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),S=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),_=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),A={box_encoding_predictor:g,class_predictor:v},B={box_encoding_predictor:b,class_predictor:x},O={box_encoding_predictor:y,class_predictor:w},L={box_encoding_predictor:C,class_predictor:T},U={box_encoding_predictor:S,class_predictor:I},V={box_encoding_predictor:_,class_predictor:N};return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:m,box_predictor_0:A,box_predictor_1:B,box_predictor_2:O,box_predictor_3:L,box_predictor_4:U,box_predictor_5:V}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function lE(t){var n=[],e=Rt(t),r=e.extractWeights,o=e.getRemainingWeights,i=WL(r,n),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l=nd(r(5118*4),[1,5118,4]),d={extra_dim:l};if(n.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}function HL(t,n){var e=Wt(t,n);function r(c,l,d){var f=e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),h=e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:h}}function o(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv",p=e(d+"/depthwise_weights",4,f+"/filters"),m=e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),g=e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),v=e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),b=e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:b},pointwise_conv:r("MobilenetV1",c,h)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(c,l){var d=e(c+"/weights",4,l+"/filters"),f=e(c+"/biases",1,l+"/bias");return{filters:d,bias:f}}function s(c){var l=a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),d=a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function dE(t){var n=[],e=HL(t,n),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=t["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!po(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Mt(t,n),{params:a,paramMappings:n}}function An(t,n,e){return H(function(){var r=_t(t,n.filters,e,"same");return r=ae(r,n.batch_norm_offset),ou(r,0,6)})}var zL=.0010000000474974513;function $L(t,n,e){return H(function(){var r=su(t,n.filters,e,"same");return r=fg(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,zL),ou(r,0,6)})}function GL(t){return[2,4,6,12].some(function(n){return n===t})?[2,2]:[1,1]}function fE(t,n){return H(function(){var e=null,r=An(t,n.conv_0,[2,2]),o=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(o.forEach(function(i,a){var s=a+1,u=GL(s);r=$L(r,i.depthwise_conv,u),r=An(r,i.pointwise_conv,[1,1]),s===11&&(e=r)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}function hE(t,n,e,r,o){var i=t.shape[0],a=Math.min(e,i),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>o}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=qL(t,l.boxIndex,c[f]);if(h!==0&&(l.score*=u(h),l.score<=o))break}d===l.score&&c.push(l.boxIndex)}}),c}function qL(t,n,e){var r=t.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(a-o)*(s-i),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(o,u),m=Math.max(i,c),g=Math.min(a,l),v=Math.min(s,d),b=Math.max(g-p,0)*Math.max(v-m,0);return b/(f+h-b)}function KL(t){var n=Ue(Tn(t,[1,0])),e=[$e(n[2],n[0]),$e(n[3],n[1])],r=[ae(n[0],Sn(e[0],K(2))),ae(n[1],Sn(e[1],K(2)))];return{sizes:e,centers:r}}function XL(t,n){var e=KL(t),r=e.sizes,o=e.centers,i=Ue(Tn(n,[1,0])),a=Sn(tt(sd(Sn(i[2],K(5))),r[0]),K(2)),s=ae(tt(Sn(i[0],K(10)),r[0]),o[0]),u=Sn(tt(sd(Sn(i[3],K(5))),r[1]),K(2)),c=ae(tt(Sn(i[1],K(10)),r[1]),o[1]);return Tn(Ot([$e(s,a),$e(c,u),ae(s,a),ae(c,u)]),[1,0])}function pE(t,n,e){return H(function(){var r=t.shape[0],o=XL(Gt(Xo(e.extra_dim,[r,1,1]),[-1,4]),Gt(t,[-1,4]));o=Gt(o,[r,o.shape[0]/r,4]);var i=dg(zn(n,[0,0,1],[-1,-1,-1])),a=zn(i,[0,0,0],[-1,-1,1]);a=Gt(a,[r,a.shape[1]]);var s=Ue(o),u=Ue(a);return{boxes:s,scores:u}})}function ci(t,n){return H(function(){var e=t.shape[0],r=Gt(Ut(t,n.box_encoding_predictor),[e,-1,1,4]),o=Gt(Ut(t,n.class_predictor),[e,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function mE(t,n,e){return H(function(){var r=An(t,e.conv_0,[1,1]),o=An(r,e.conv_1,[2,2]),i=An(o,e.conv_2,[1,1]),a=An(i,e.conv_3,[2,2]),s=An(a,e.conv_4,[1,1]),u=An(s,e.conv_5,[2,2]),c=An(u,e.conv_6,[1,1]),l=An(c,e.conv_7,[2,2]),d=ci(n,e.box_predictor_0),f=ci(t,e.box_predictor_1),h=ci(o,e.box_predictor_2),p=ci(a,e.box_predictor_3),m=ci(u,e.box_predictor_4),g=ci(l,e.box_predictor_5),v=Ye([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),b=Ye([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:v,classPredictions:b}})}var vo=function(){function t(n){var e=n===void 0?{}:n,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}();var Rd=function(t){Y(n,t);function n(){return t.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return H(function(){var o=e.toBatchTensor(512,!1).toFloat(),i=$e(tt(o,K(.007843137718737125)),K(1)),a=fE(i,r.mobilenetv1),s=mE(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return pE(u,c,r.output_layer)})},n.prototype.forward=function(e){return G(this,void 0,void 0,function(){var r;return q(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,We(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(e,r){return r===void 0&&(r={}),G(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,m,g,v,b,x,y,w,C,T,S;return q(this,function(I){switch(I.label){case 0:return o=new vo(r),i=o.maxResults,a=o.minConfidence,[4,We(e)];case 1:for(s=I.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,d=c[0],f=l[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return g=(m=Array).from,[4,f.data()];case 2:return p=g.apply(m,[I.sent()]),v=.5,b=hE(d,p,i,v,a),x=s.getReshapedInputDimensions(0),y=s.inputSize,w=y/x.width,C=y/x.height,T=d.arraySync(),S=b.map(function(_){var N=[Math.max(0,T[_][0]),Math.min(1,T[_][2])].map(function(V){return V*C}),A=N[0],B=N[1],O=[Math.max(0,T[_][1]),Math.min(1,T[_][3])].map(function(V){return V*w}),L=O[0],U=O[1];return new Ze(p[_],new wa(L,A,U-L,B-A),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,S]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return dE(e)},n.prototype.extractParams=function(e){return lE(e)},n}(Tt);var Z7=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n}(Rd);var gE=.4,vE=[new pe(.738768,.874946),new pe(2.42204,2.65704),new pe(4.30971,7.04493),new pe(10.246,4.59428),new pe(12.6868,11.8741)],yE=[new pe(1.603231,2.094468),new pe(6.041143,7.080126),new pe(2.882459,3.518061),new pe(4.266906,5.178857),new pe(9.041765,10.66308)],bE=[117.001,114.697,97.404],xE="tiny_yolov2_model",wE="tiny_yolov2_separable_conv_model";var Ad=function(t){return typeof t=="number"};function CE(t){if(!t)throw new Error("invalid config: "+t);if(typeof t.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!Ad(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(n){return n||{}}).every(function(n){return Ad(n.x)&&Ad(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||t.meanRgb.length!==3||!t.meanRgb.every(Ad)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function Aa(t){return H(function(){var n=tt(t,K(.10000000149011612));return ae(je($e(t,n)),n)})}function Wr(t,n){return H(function(){var e=Fr(t,[[0,0],[1,1],[1,1],[0,0]]);return e=_t(e,n.conv.filters,[1,1],"valid"),e=$e(e,n.bn.sub),e=tt(e,n.bn.truediv),e=ae(e,n.conv.bias),Aa(e)})}function Hr(t,n){return H(function(){var e=Fr(t,[[0,0],[1,1],[1,1],[0,0]]);return e=uu(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),e=ae(e,n.bias),Aa(e)})}function YL(t,n){var e=go(t,n);function r(a,s){var u=qe(t(a)),c=qe(t(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function o(a,s,u){var c=e(a,s,3,u+"/conv"),l=r(s,u+"/bn");return{conv:c,bn:l}}var i=_a(t,n);return{extractConvParams:e,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function DE(t,n,e,r){var o=Rt(t),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=YL(i,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,f;if(n.withSeparableConvs){var h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],b=r[5],x=r[6],y=r[7],w=r[8],C=n.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),T=d(p,m,"conv1"),S=d(m,g,"conv2"),I=d(g,v,"conv3"),_=d(v,b,"conv4"),N=d(b,x,"conv5"),A=y?d(x,y,"conv6"):void 0,B=w?d(y,w,"conv7"):void 0,O=c(w||y||x,5*e,1,"conv8");f={conv0:C,conv1:T,conv2:S,conv3:I,conv4:_,conv5:N,conv6:A,conv7:B,conv8:O}}else{var h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],b=r[5],x=r[6],y=r[7],w=r[8],C=l(h,p,"conv0"),T=l(p,m,"conv1"),S=l(m,g,"conv2"),I=l(g,v,"conv3"),_=l(v,b,"conv4"),N=l(b,x,"conv5"),A=l(x,y,"conv6"),B=l(y,w,"conv7"),O=c(w,5*e,1,"conv8");f={conv0:C,conv1:T,conv2:S,conv3:I,conv4:_,conv5:N,conv6:A,conv7:B,conv8:O}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}function QL(t,n){var e=Wt(t,n);function r(s){var u=e(s+"/sub",1),c=e(s+"/truediv",1);return{sub:u,truediv:c}}function o(s){var u=e(s+"/filters",4),c=e(s+"/bias",1);return{filters:u,bias:c}}function i(s){var u=o(s+"/conv"),c=r(s+"/bn");return{conv:u,bn:c}}var a=Sa(e);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function EE(t,n){var e=[],r=QL(t,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return Mt(t,e),{params:s,paramMappings:e}}var li=function(){function t(n){var e=n===void 0?{}:n,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}();var Nd=function(t){Y(n,t);function n(e){var r=t.call(this,"TinyYolov2")||this;return CE(e),r._config=e,r}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,r){var o=Wr(e,r.conv0);return o=rt(o,[2,2],[2,2],"same"),o=Wr(o,r.conv1),o=rt(o,[2,2],[2,2],"same"),o=Wr(o,r.conv2),o=rt(o,[2,2],[2,2],"same"),o=Wr(o,r.conv3),o=rt(o,[2,2],[2,2],"same"),o=Wr(o,r.conv4),o=rt(o,[2,2],[2,2],"same"),o=Wr(o,r.conv5),o=rt(o,[2,2],[1,1],"same"),o=Wr(o,r.conv6),o=Wr(o,r.conv7),Ut(o,r.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?Aa(Ut(e,r.conv0,"valid",!1)):Hr(e,r.conv0);return o=rt(o,[2,2],[2,2],"same"),o=Hr(o,r.conv1),o=rt(o,[2,2],[2,2],"same"),o=Hr(o,r.conv2),o=rt(o,[2,2],[2,2],"same"),o=Hr(o,r.conv3),o=rt(o,[2,2],[2,2],"same"),o=Hr(o,r.conv4),o=rt(o,[2,2],[2,2],"same"),o=Hr(o,r.conv5),o=rt(o,[2,2],[1,1],"same"),o=r.conv6?Hr(o,r.conv6):o,o=r.conv7?Hr(o,r.conv7):o,Ut(o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return H(function(){var a=e.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?mr(a,o.config.meanRgb):a,a=a.div(K(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(e,r){return G(this,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,We(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(e,r){return r===void 0&&(r={}),G(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,m,g,v,b=this;return q(this,function(x){switch(x.label){case 0:return o=new li(r),i=o.inputSize,a=o.scoreThreshold,[4,We(e)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),c=H(function(){return Ue(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return d=x.sent(),u.dispose(),c.dispose(),f=d.map(function(y){return y.box}),h=d.map(function(y){return y.score}),p=d.map(function(y){return y.classScore}),m=d.map(function(y){return b.config.classes[y.label]}),g=jr(f.map(function(y){return y.rescale(i)}),h,this.config.iouThreshold,!0),v=g.map(function(y){return new hd(h[y],p[y],m[y],f[y],l)}),[2,v]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return EE(e,this.config)},n.prototype.extractParams=function(e){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return DE(e,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(e,r,o){return G(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,m,g,v,b,x,y,w,C,T,S,I,_,N,A,B,O,L,U,V,j=this;return q(this,function(z){switch(z.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=e.shape[1],d=this.config.anchors.length,f=H(function(){var $=e.reshape([l,l,d,j.boxEncodingSize]),Q=$.slice([0,0,0,0],[l,l,d,4]),ne=$.slice([0,0,0,4],[l,l,d,1]),ie=j.withClassScores?qt($.slice([0,0,0,5],[l,l,d,j.config.classes.length]),3):K(0);return[Q,ne,ie]}),h=f[0],p=f[1],m=f[2],g=[],[4,p.array()];case 1:return v=z.sent(),[4,h.array()];case 2:b=z.sent(),x=0,z.label=3;case 3:if(!(x<l))return[3,12];y=0,z.label=4;case 4:if(!(y<l))return[3,11];w=0,z.label=5;case 5:return w<d?(C=pd(v[x][y][w][0]),!o||C>o?(T=(y+pd(b[x][y][w][0]))/l*u,S=(x+pd(b[x][y][w][1]))/l*c,I=Math.exp(b[x][y][w][2])*this.config.anchors[w].x/l*u,_=Math.exp(b[x][y][w][3])*this.config.anchors[w].y/l*c,N=T-I/2,A=S-_/2,B={row:x,col:y,anchor:w},this.withClassScores?[4,this.extractPredictedClass(m,B)]:[3,7]):[3,9]):[3,10];case 6:return V=z.sent(),[3,8];case 7:V={classScore:1,label:0},z.label=8;case 8:O=V,L=O.classScore,U=O.label,g.push(mt({box:new ii(N,A,N+I,A+_),score:C,classScore:C*L,label:U},B)),z.label=9;case 9:return w++,[3,5];case 10:return y++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),m.dispose(),[2,g]}})})},n.prototype.extractPredictedClass=function(e,r){return G(this,void 0,void 0,function(){var o,i,a,s;return q(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(Tt);var Yg=function(t){Y(n,t);function n(e){e===void 0&&(e=!0);var r=this,o=Object.assign({},{withSeparableConvs:e,iouThreshold:gE,classes:["face"]},e?{anchors:yE,meanRgb:bE}:{anchors:vE,withClassScores:!0});return r=t.call(this,o)||this,r}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return G(this,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Ze(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?wE:xE},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(Nd);var Cu=function(t){Y(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return n}(li);var gr=function(){function t(){}return t.prototype.then=function(n){return G(this,void 0,void 0,function(){var e;return q(this,function(r){switch(r.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return G(this,void 0,void 0,function(){return q(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},t}();function di(t,n,e,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),G(this,void 0,void 0,function(){var i,a,s,u,c;return q(this,function(l){switch(l.label){case 0:return i=t.map(function(d){return Ma(d)?o(d):d.detection}),s=r,s?[3,5]:n instanceof ze?[4,gu(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,mu(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return a=s,[4,e(a)];case 6:return c=l.sent(),a.forEach(function(d){return d instanceof ze&&d.dispose()}),[2,c]}})})}function Na(t,n,e,r,o){return G(this,void 0,void 0,function(){var i=this;return q(this,function(a){return[2,di([t],n,function(s){return G(i,void 0,void 0,function(){return q(this,function(u){return[2,e(s[0])]})})},r,o)]})})}function IE(t){return H(function(){return Ot(Ue(t,3).reverse(),3)})}var Du=2,fi=12;function ZL(t,n){var e=go(t,n),r=Ia(t,n);function o(c,l){var d=qe(t(c));return n.push({paramPath:l}),d}function i(c,l,d){d===void 0&&(d=!1);var f=e(c[0],c[1],3,l+"/conv1"),h=o(c[1],l+"/prelu1_alpha"),p=e(c[1],c[2],3,l+"/conv2"),m=o(c[2],l+"/prelu2_alpha"),g=e(c[2],c[3],d?2:3,l+"/conv3"),v=o(c[3],l+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function a(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return mt(mt({},c),{conv4_1:l,conv4_2:d})}function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return mt(mt({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})}function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return mt(mt({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function _E(t){var n=Rt(t),e=n.extractWeights,r=n.getRemainingWeights,o=[],i=ZL(e,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:o}}function JL(t,n){var e=Wt(t,n);function r(l){var d=e(l+"/weights",4,l+"/filters"),f=e(l+"/bias",1);return{filters:d,bias:f}}function o(l){var d=e(l+"/weights",2),f=e(l+"/bias",1);return{weights:d,bias:f}}function i(l){return e(l,1)}function a(l){var d=r(l+"/conv1"),f=i(l+"/prelu1_alpha"),h=r(l+"/conv2"),p=i(l+"/prelu2_alpha"),m=r(l+"/conv3"),g=i(l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:h,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function s(){var l=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return mt(mt({},l),{conv4_1:d,conv4_2:f})}function u(){var l=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return mt(mt({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})}function c(){var l=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),m=o("onet/fc2_1"),g=o("onet/fc2_2"),v=o("onet/fc2_3");return mt(mt({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function SE(t){var n=[],e=JL(t,n),r=e.extractPNetParams,o=e.extractRNetParams,i=e.extractONetParams,a=r(),s=o(),u=i();return Mt(t,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}function Eu(t,n){var e=n[0],r=n[1];return{height:Math.floor(e*t),width:Math.floor(r*t)}}function TE(t,n,e){for(var r=e[0],o=e[1],i=fi/t,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s=s*n,u+=1;return a}var ka=function(t){Y(n,t);function n(e,r,o,i){return t.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return n}(St);function kd(t){return H(function(){return tt($e(t,K(127.5)),K(.0078125))})}function zr(t,n){return H(function(){return ae(je(t),tt(n,iu(je(iu(t)))))})}function Fa(t,n,e){return e===void 0&&(e=!1),H(function(){var r=Ut(t,n.conv1,"valid");return r=zr(r,n.prelu1_alpha),r=rt(r,e?[2,2]:[3,3],[2,2],"same"),r=Ut(r,n.conv2,"valid"),r=zr(r,n.prelu2_alpha),r=e?r:rt(r,[3,3],[2,2],"valid"),r=Ut(r,n.conv3,"valid"),r=zr(r,n.prelu3_alpha),r})}function ME(t,n){return H(function(){var e=Fa(t,n,!0),r=Ut(e,n.conv4_1,"valid"),o=Bt(ni(r,3),3),i=qt($e(r,o),3),a=Ut(e,n.conv4_2,"valid");return{prob:i,regions:a}})}function eB(t,n){return H(function(){var e=Eu(n,t.shape.slice(1)),r=e.height,o=e.width,i=lu.resizeBilinear(t,[r,o]),a=kd(i);return Tn(a,[0,2,1,3])})}function tB(t,n,e,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new pe(s,a));var u=o.map(function(c){var l=new ii(Math.round((c.y*Du+1)/e),Math.round((c.x*Du+1)/e),Math.round((c.y*Du+fi)/e),Math.round((c.x*Du+fi)/e)),d=i[c.y][c.x],f=n.arraySync(),h=new ka(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3]);return{cell:l,score:d,region:h}});return u}function RE(t,n,e,r,o){o.stage1=[];var i=n.map(function(f){return H(function(){var h={scale:f},p=eB(t,f),m=Date.now(),g=ME(p,r),v=g.prob,b=g.regions;h.pnet=Date.now()-m;var x=Ue(Ue(v,3)[1])[0],y=Ue(b)[0];return{scoresTensor:x,regionsTensor:y,scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,m=f.scale,g=f.statsForScale,v=tB(h,p,m,e);if(h.dispose(),p.dispose(),!v.length)return o.stage1.push(g),[];var b=Date.now(),x=jr(v.map(function(y){return y.cell}),v.map(function(y){return y.score}),.5);return g.nms=Date.now()-b,g.numBoxes=x.length,o.stage1.push(g),x.map(function(y){return v[y]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=jr(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-l,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new ii(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function Fd(t,n,e){var r=e.width,o=e.height;return G(this,void 0,void 0,function(){var i,a,s,u=this;return q(this,function(c){switch(c.label){case 0:return i=Lt(t),[4,Promise.all(n.map(function(l){return G(u,void 0,void 0,function(){var d,f,h,p,m,g,v,b;return q(this,function(x){return d=l.padAtBorders(t.height,t.width),f=d.y,h=d.ey,p=d.x,m=d.ex,g=p-1,v=f-1,b=i.getImageData(g,v,m-g,h-v),[2,Fe.isNodejs()?Ea(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var d=ai({width:r,height:o}),f=Lt(d);f.drawImage(l,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],m=0;m<h.length;m+=4)p.push(h[m+2]),p.push(h[m+1]),p.push(h[m]);s.push(p)}),[2,s.map(function(l){var d=H(function(){var f=Tn(xt(l,[1,r,o,3]),[0,2,1,3]).toFloat();return kd(f)});return d})]}})})}function AE(t,n){return H(function(){var e=Fa(t,n),r=Gt(e,[e.shape[0],n.fc1.weights.shape[0]]),o=tn(r,n.fc1),i=zr(o,n.prelu4_alpha),a=tn(i,n.fc2_1),s=Bt(ni(a,1),1),u=qt($e(a,s),1),c=tn(i,n.fc2_2),l=Ue(u,1)[1];return{scores:l,regions:c}})}function NE(t,n,e,r,o){return G(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,m,g,v,b;return q(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,Fd(t,n,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(y){var w=AE(y,r);return y.dispose(),w}),o.stage2_rnet=Date.now()-i,u=s.length>1?Ye(s.map(function(y){return y.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[x.sent()]),u.dispose(),f=c.map(function(y,w){return{score:y,idx:w}}).filter(function(y){return y.score>e}).map(function(y){var w=y.idx;return w}),h=f.map(function(y){return n[y]}),p=f.map(function(y){return c[y]}),m=[],g=[],h.length>0&&(i=Date.now(),v=jr(h,p,.7),o.stage2_nms=Date.now()-i,b=v.map(function(y){var w=s[f[y]].regions.arraySync();return new ka(w[0][0],w[0][1],w[0][2],w[0][3])}),g=v.map(function(y){return p[y]}),m=v.map(function(y,w){return h[y].calibrate(b[w])})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function kE(t,n){return H(function(){var e=Fa(t,n);e=rt(e,[2,2],[2,2],"same"),e=Ut(e,n.conv4,"valid"),e=zr(e,n.prelu4_alpha);var r=Gt(e,[e.shape[0],n.fc1.weights.shape[0]]),o=tn(r,n.fc1),i=zr(o,n.prelu5_alpha),a=tn(i,n.fc2_1),s=Bt(ni(a,1),1),u=qt($e(a,s),1),c=tn(i,n.fc2_2),l=tn(i,n.fc2_3),d=Ue(u,1)[1];return{scores:d,regions:c,points:l}})}function FE(t,n,e,r,o){return G(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,m,g,v,b,x;return q(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,Fd(t,n,{width:48,height:48})];case 1:return a=y.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var C=kE(w,r);return w.dispose(),C}),o.stage3_onet=Date.now()-i,u=s.length>1?Ye(s.map(function(w){return w.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),f=c.map(function(w,C){return{score:w,idx:C}}).filter(function(w){return w.score>e}).map(function(w){var C=w.idx;return C}),h=f.map(function(w){var C=s[w].regions.arraySync();return new ka(C[0][0],C[0][1],C[0][2],C[0][3])}),p=f.map(function(w,C){return n[w].calibrate(h[C])}),m=f.map(function(w){return c[w]}),g=[],v=[],b=[],p.length>0&&(i=Date.now(),x=jr(p,m,.7,!1),o.stage3_nms=Date.now()-i,g=x.map(function(w){return p[w]}),v=x.map(function(w){return m[w]}),b=x.map(function(w,C){return Array(5).fill(0).map(function(T,S){var I=s[w].points.arraySync();return new pe(I[0][S]*(g[C].width+1)+g[C].left,I[0][S+5]*(g[C].height+1)+g[C].top)})})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose(),w.points.dispose()}),[2,{boxes:g,scores:v,points:b}]}})})}var Qg=function(t){Y(n,t);function n(){return t.call(this,"Mtcnn")||this}return n.prototype.load=function(e){return G(this,void 0,void 0,function(){return q(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return G(this,void 0,void 0,function(){return q(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,r){return r===void 0&&(r={}),G(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,m,g,v,b,x,y,w,C,T,S;return q(this,function(I){switch(I.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=e.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=H(function(){return IE(Bt(ya.fromPixels(i)).toFloat())}),c=function(_){return u.dispose(),a.total=Date.now()-s,_},l=u.shape.slice(1),d=l[0],f=l[1],h=new wu(r),p=h.minFaceSize,m=h.scaleFactor,g=h.maxNumScales,v=h.scoreThresholds,b=h.scaleSteps,x=(b||TE(p,m,[d,f])).filter(function(_){var N=Eu(_,[d,f]);return Math.min(N.width,N.height)>fi}).slice(0,g),a.scales=x,a.pyramid=x.map(function(_){return Eu(_,[d,f])}),y=Date.now(),[4,RE(u,x,v[0],o.pnet,a)];case 1:return w=I.sent(),a.total_stage1=Date.now()-y,w.boxes.length?(a.stage2_numInputBoxes=w.boxes.length,y=Date.now(),[4,NE(i,w.boxes,v[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return C=I.sent(),a.total_stage2=Date.now()-y,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,y=Date.now(),[4,FE(i,C.boxes,v[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return T=I.sent(),a.total_stage3=Date.now()-y,S=T.boxes.map(function(_,N){return ui(mo({},new Ze(T.scores[N],new wa(_.left/f,_.top/d,_.width/f,_.height/d),{height:d,width:f})),new A1(T.points[N].map(function(A){return A.sub(new pe(_.left,_.top)).div(new pe(_.width,_.height))}),{width:_.width,height:_.height}))}),[2,c({results:S,stats:a})]}})})},n.prototype.forward=function(e,r){return r===void 0&&(r={}),G(this,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,We(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(e,r){return r===void 0&&(r={}),G(this,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,We(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return SE(e)},n.prototype.extractParams=function(e){return _E(e)},n}(Tt);var PE=.4,OE=[new pe(1.603231,2.094468),new pe(6.041143,7.080126),new pe(2.882459,3.518061),new pe(4.266906,5.178857),new pe(9.041765,10.66308)],LE=[117.001,114.697,97.404];var Zg=function(t){Y(n,t);function n(){var e=this,r={withSeparableConvs:!0,iouThreshold:PE,classes:["face"],anchors:OE,meanRgb:LE,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=t.call(this,r)||this,e}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return G(this,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Ze(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(Nd);var ct={ssdMobilenetv1:new Rd,tinyFaceDetector:new Zg,tinyYolov2:new Yg,mtcnn:new Qg,faceLandmark68Net:new Td,faceLandmark68TinyNet:new iE,faceRecognitionNet:new Gg,faceExpressionNet:new $1,ageGenderNet:new tE};var BE=function(t){Y(n,t);function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return n}(gr);var Iu=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o=this;return q(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,di(e,this.input,function(a){return G(o,void 0,void 0,function(){return q(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ct.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){return Wg(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new Su(this,this.input)},n}(BE);var _u=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r;return q(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,Na(e,this.input,function(i){return ct.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,Wg(e,r)]}})})},n.prototype.withAgeAndGender=function(){return new Tu(this,this.input)},n}(BE);var Pa=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new La(this,this.input)},n.prototype.withFaceDescriptors=function(){return new ja(this,this.input)},n}(Iu);var Oa=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Ba(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Va(this,this.input)},n}(_u);var jE=function(t){Y(n,t);function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return n}(gr);var Su=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o=this;return q(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,di(e,this.input,function(a){return G(o,void 0,void 0,function(){return q(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ct.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){var u=r[s],c=u.age,l=u.gender,d=u.genderProbability;return Kg(Xg(a,l,d),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Iu(this,this.input)},n}(jE);var Tu=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o,i,a;return q(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?[4,Na(e,this.input,function(u){return ct.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,Kg(Xg(e,i,a),o)]}})})},n.prototype.withFaceExpressions=function(){return new _u(this,this.input)},n}(jE);var La=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Pa(this,this.input)},n.prototype.withFaceDescriptors=function(){return new ja(this,this.input)},n}(Su);var Ba=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Oa(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Va(this,this.input)},n}(Tu);var VE=function(t){Y(n,t);function n(e,r){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o}return n}(gr);var ja=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r;return q(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,di(e,this.input,function(i){return Promise.all(i.map(function(a){return ct.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return qg(e[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new Pa(this,this.input)},n.prototype.withAgeAndGender=function(){return new La(this,this.input)},n}(VE);var Va=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r;return q(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),e?[4,Na(e,this.input,function(i){return ct.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,qg(e,r)]}})})},n.prototype.withFaceExpressions=function(){return new Oa(this,this.input)},n.prototype.withAgeAndGender=function(){return new Ba(this,this.input)},n}(VE);var UE=function(t){Y(n,t);function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ct.faceLandmark68TinyNet:ct.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(gr);var WE=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return q(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof ze?[4,gu(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,mu(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof ze&&c.dispose()}),[2,e.map(function(c,l){return ui(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new Pa(this,this.input)},n.prototype.withAgeAndGender=function(){return new La(this,this.input)},n.prototype.withFaceDescriptors=function(){return new ja(this,this.input)},n}(UE);var HE=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o,i,a;return q(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?(r=e.detection,this.input instanceof ze?[4,gu(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,mu(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof ze&&u.dispose()}),[2,ui(e,a)]}})})},n.prototype.withFaceExpressions=function(){return new Oa(this,this.input)},n.prototype.withAgeAndGender=function(){return new Ba(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Va(this,this.input)},n}(UE);var zE=function(t){Y(n,t);function n(e,r){r===void 0&&(r=new vo);var o=t.call(this)||this;return o.input=e,o.options=r,o}return n}(gr);var Jg=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r,o,i;return q(this,function(a){switch(a.label){case 0:return e=this,r=e.input,o=e.options,o instanceof wu?[4,ct.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof Cu?function(s){return ct.tinyFaceDetector.locateFaces(s,o)}:o instanceof vo?function(s){return ct.ssdMobilenetv1.locateFaces(s,o)}:o instanceof li?function(s){return ct.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return G(e,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return mo({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new WE(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Iu(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Su(this.runAndExtendWithFaceDetections(),this.input)},n}(zE);var nB=function(t){Y(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n.prototype.run=function(){return G(this,void 0,void 0,function(){var e,r;return q(this,function(o){switch(o.label){case 0:return[4,new Jg(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return G(e,void 0,void 0,function(){var o;return q(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?mo({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new HE(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new _u(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Tu(this.runAndExtendWithFaceDetection(),this.input)},n}(zE);function Pd(t,n){return n===void 0&&(n=new vo),new Jg(t,n)}function $E(t,n){if(t.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(t),r=Array.from(n);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}var WY=function(){function t(n,e){e===void 0&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof hu)return a;if(a instanceof Float32Array)return new hu(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new hu(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(n,e){return e.map(function(r){return $E(r,n)}).reduce(function(r,o){return r+o},0)/(e.length||1)},t.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new Rg(i,e.computeMeanDistance(n,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},t.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new Rg("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},t.fromJSON=function(n){var e=n.labeledDescriptors.map(function(r){return hu.fromJSON(r)});return new t(e,n.distanceThreshold)},t}();function Od(t,n){var e=new Mn(n.width,n.height),r=e.width,o=e.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(t))return t.map(function(s){return Od(s,{width:r,height:o})});if(Ma(t)){var i=t.detection.forSize(r,o),a=t.unshiftedLandmarks.forSize(i.box.width,i.box.height);return ui(mo(t,i),a)}return Vr(t)?mo(t,t.detection.forSize(r,o)):t instanceof Xn||t instanceof Ze?t.forSize(r,o):t}var oB=["video"],iB=["overlay"];function aB(t,n){if(t&1&&(Sr(0,"div",11)(1,"h4"),Ui(2,"Captured Image"),Un(),to(3,"img",12),Un()),t&2){let e=Bb();Uh(3),Kc("src",e.capturedImage,z0)}}var Ld=(()=>{class t{constructor(e){this.platformId=e,this.stream=null,this.capturedImage=null,this.faceInfos=[],this.isBrowser=ox(this.platformId)}ngOnInit(){return xr(this,null,function*(){this.isBrowser&&(yield this.loadModels())})}ngOnDestroy(){this.stopCamera()}loadModels(){return xr(this,null,function*(){yield Promise.all([ct.tinyFaceDetector.loadFromUri("/assets/models"),ct.ageGenderNet.loadFromUri("/assets/models"),ct.faceExpressionNet.loadFromUri("/assets/models")])})}startCamera(){return xr(this,null,function*(){this.isBrowser&&(this.stream=yield navigator.mediaDevices.getUserMedia({video:!0}),this.videoRef.nativeElement.srcObject=this.stream,this.videoRef.nativeElement.addEventListener("play",()=>{let e=this.videoRef.nativeElement,r=this.canvasRef.nativeElement;e.width=e.videoWidth,e.height=e.videoHeight,r.width=e.videoWidth,r.height=e.videoHeight;let o={width:e.videoWidth,height:e.videoHeight};Vg(r,o),this.detectInterval=setInterval(()=>xr(this,null,function*(){let i=yield Pd(e,new Cu).withAgeAndGender().withFaceExpressions(),a=Od(i,o),s=r.getContext("2d");s?.clearRect(0,0,r.width,r.height),Ra.drawDetections(r,a),s.font="14px Arial",s.fillStyle="rgba(0, 0, 0, 0.7)",s.strokeStyle="#fff",s.lineWidth=2,a.forEach(u=>{let{age:c,gender:l,expressions:d,detection:f}=u,h=f.box.topLeft,p=Object.entries(d).sort((v,b)=>b[1]-v[1]),m=p.length?p[0][0]:"Neutral",g=`Age: ${Math.round(c)}, Gender: ${l}, Emotion: ${m}`;if(s&&h){let[v,b]=[h.x,h.y-10];s.fillStyle="rgba(0, 0, 0, 0.6)",s.fillRect(v,b-16,s.measureText(g).width+10,20),s.fillStyle="#fff",s.fillText(g,v+5,b)}}),this.faceInfos=a.map(u=>{let c=Object.entries(u.expressions).sort((l,d)=>d[1]-l[1]);return{age:u.age,gender:u.gender,emotion:c.length?c[0][0]:"Neutral"}})}),500)}))})}stopCamera(){this.stream&&this.stream.getTracks().forEach(e=>e.stop()),this.detectInterval&&clearInterval(this.detectInterval)}captureImage(){return xr(this,null,function*(){let e=this.videoRef.nativeElement;if(e.videoWidth===0||e.videoHeight===0){console.warn("Video not ready yet");return}let r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;let o=r.getContext("2d");if(!o)return;o?.drawImage(e,0,0),this.capturedImage=r.toDataURL("image/png");let i=yield L1(this.capturedImage),a=this.canvasRef.nativeElement,s={width:i.width,height:i.height};Vg(a,s);let u=yield Pd(r,new Cu).withAgeAndGender().withFaceExpressions(),c=this.canvasRef.nativeElement;c.width=r.width,c.height=r.height;let l=Od(u,s);c.getContext("2d")?.clearRect(0,0,c.width,c.height),Ra.drawDetections(c,l),Ra.drawFaceExpressions(c,l),this.faceInfos=l.map(f=>{let h=Object.entries(f.expressions).sort((p,m)=>m[1]-p[1]);return{age:f.age,gender:f.gender,emotion:h.length?h[0][0]:"Neutral"}})})}static{this.\u0275fac=function(r){return new(r||t)(Po(En))}}static{this.\u0275cmp=Li({type:t,selectors:[["app-webcam"]],viewQuery:function(r,o){if(r&1&&(Zh(oB,5),Zh(iB,5)),r&2){let i;Xc(i=Yc())&&(o.videoRef=i.first),Xc(i=Yc())&&(o.canvasRef=i.first)}},standalone:!0,features:[Wi],decls:16,vars:1,consts:[["video",""],["overlay",""],[1,"container","text-center","m-0","p-4"],[1,"video-container","position-relative"],["autoplay","","muted","","playsinline",""],[1,"position-absolute","top-0","start-0"],[1,"mt-3"],[1,"btn","btn-success","me-2",3,"click"],[1,"btn","btn-danger","me-2",3,"click"],[1,"btn","btn-primary",3,"click"],["class","mt-4",4,"ngIf"],[1,"mt-4"],["alt","Captured frame",1,"img-fluid","rounded","border",3,"src"]],template:function(r,o){if(r&1){let i=Ob();Sr(0,"div",2)(1,"h2"),Ui(2,"Webcam Feed with Face Detection"),Un(),Sr(3,"div",3),to(4,"video",4,0)(6,"canvas",5,1),Un(),Sr(8,"div",6)(9,"button",7),Vi("click",function(){return Fc(i),Pc(o.startCamera())}),Ui(10,"Start"),Un(),Sr(11,"button",8),Vi("click",function(){return Fc(i),Pc(o.stopCamera())}),Ui(12,"Stop"),Un(),Sr(13,"button",9),Vi("click",function(){return Fc(i),Pc(o.captureImage())}),Ui(14,"Capture"),Un()(),Qh(15,aB,4,1,"div",10),Un()}r&2&&(Uh(15),Kc("ngIf",o.capturedImage))},dependencies:[ms,rx],styles:[".container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;background:linear-gradient(135deg,#dff9fb,#c7ecee);width:100%;max-width:none}h2[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-weight:700;margin-bottom:20px;color:#2c3e50}.video-container[_ngcontent-%COMP%]{position:relative;display:inline-block;border:2px solid #3498db;border-radius:12px;overflow:hidden;background-color:#fff;box-shadow:0 8px 16px #0003;height:auto}video[_ngcontent-%COMP%], canvas[_ngcontent-%COMP%]{border-radius:10px;width:100%;height:650px}canvas[_ngcontent-%COMP%]{pointer-events:none}button[_ngcontent-%COMP%]{font-size:18px;padding:10px 20px;border-radius:8px;font-weight:600}.btn-success[_ngcontent-%COMP%]{background-color:#27ae60;border-color:#27ae60}.btn-danger[_ngcontent-%COMP%]{background-color:#e74c3c;border-color:#e74c3c}.img-fluid[_ngcontent-%COMP%]{width:350px;height:auto}.faceinfos[_ngcontent-%COMP%]{width:100%}@media (max-width: 768px){video[_ngcontent-%COMP%], canvas[_ngcontent-%COMP%]{width:90vw;height:auto}}"]})}}return t})();var GE=[{path:"",redirectTo:"webcam",pathMatch:"full"},{path:"webcam",component:Ld}];var qE={providers:[iw(GE),Ex()]};var KE=(()=>{class t{constructor(){this.title="face-recognition-app"}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=Li({type:t,selectors:[["app-root"]],standalone:!0,features:[Wi],decls:1,vars:0,template:function(r,o){r&1&&to(0,"app-webcam")},dependencies:[ms,Ld],encapsulation:2})}}return t})();Cx(KE,qE).catch(t=>console.error(t));
